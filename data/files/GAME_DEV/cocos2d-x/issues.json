[{"title":"TileMapTest may have z-fighting issues on mac","body":"If two sprites with the same depth value overlapped when depth test is enabled, then may cause z-fighting issues.","comments":[],"labels":["platform:mac"]},{"title":"cocos2d-x compile broken on Ubuntu 17\u300118","body":"- cocos2d-x version: 3.17, 3.17.1\r\n- devices test on: ubuntu 17, 18\r\n\r\ncompile errors like:\r\n```\r\nusr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(ftbase.linux64.o): relocation R_X86_64_32 against `.rodata' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(ftinit.linux64.o): relocation R_X86_64_32 against symbol `tt_driver_class' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(ftsystem.linux64.o): relocation R_X86_64_32 against `.rodata.str1.1' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(sfnt.linux64.o): relocation R_X86_64_32 against `.rodata' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(psaux.linux64.o): relocation R_X86_64_32S against `.rodata' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(psnames.linux64.o): relocation R_X86_64_32S against `.rodata' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(pfr.linux64.o): relocation R_X86_64_32 against `.rodata' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(truetype.linux64.o): relocation R_X86_64_32 against `.text' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(winfnt.linux64.o): relocation R_X86_64_32 against `.rodata' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(type1.linux64.o): relocation R_X86_64_32 against `.rodata.str1.1' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(type42.linux64.o): relocation R_X86_64_32 against `.rodata.str1.1' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(cff.linux64.o): relocation R_X86_64_32 against `.text' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(type1cid.linux64.o): relocation R_X86_64_32 against `.rodata.str1.1' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(bdf.linux64.o): relocation R_X86_64_32 against `.rodata' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(pcf.linux64.o): relocation R_X86_64_32 against `.rodata' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(ftf.linux64.o): relocation R_X86_64_32S against `.text' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(smooth.linux64.o): relocation R_X86_64_32S against `.rodata' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(raster.linux64.o): relocation R_X86_64_32S against symbol `ft_raster1_renderer_class' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(autofit.linux64.o): relocation R_X86_64_32 against `.rodata' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(pshinter.linux64.o): relocation R_X86_64_32S against `.text' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(ftglyph.linux64.o): relocation R_X86_64_32S against symbol `ft_bitmap_glyph_class' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(ftstroke.linux64.o): relocation R_X86_64_32S against symbol `ft_outline_glyph_class' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(ftgzip.linux64.o): relocation R_X86_64_32S against `.rodata.str1.1' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(ftlzw.linux64.o): relocation R_X86_64_32S against `.text' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: ..\/..\/..\/..\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a(ftbitmap.linux64.o): relocation R_X86_64_32S against `.rodata' can not be used when making a PIE object; recompile with -fPIC\r\n\/usr\/bin\/ld: final link failed: Nonrepresentable section on output\r\ncollect2: error: ld returned 1 exit status\r\nengine\/tests\/cpp-empty-test\/CMakeFiles\/cpp-empty-test.dir\/build.make:185: recipe for target 'bin\/Debug\/cpp-empty-test\/cpp-empty-test' failed\r\nmake[2]: *** [bin\/Debug\/cpp-empty-test\/cpp-empty-test] Error 1\r\nCMakeFiles\/Makefile2:1445: recipe for target 'engine\/tests\/cpp-empty-test\/CMakeFiles\/cpp-empty-test.dir\/all' failed\r\nmake[1]: *** [engine\/tests\/cpp-empty-test\/CMakeFiles\/cpp-empty-test.dir\/all] Error 2\r\nmake[1]: *** Waiting for unfinished jobs....\r\n```\r\n","comments":["Hi, you can add \"  set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -no-pie -fno-exceptions -std=c++11 -Wno-deprecated-declarations -Wno-reorder\") \" to CMakeList below line 70.It worked for me!\r\n","@flykule Thank you for commenting! I am going to try this out.","@flykule Thank you so much!\r\n\r\nI have to modify a bit to:\r\n\r\n```sh\r\nset(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -no-pie -fexceptions -std=c++11 -Wno-deprecated-declarations -Wno-reorder\")\r\n```","> @flykule Thank you so much!\r\n> \r\n> I have to modify a bit to:\r\n> \r\n> ```shell\r\n> set(CMAKE_CXX_FLAGS \"${CMAKE_CXX_FLAGS} -no-pie -fexceptions -std=c++11 -Wno-deprecated-declarations -Wno-reorder\")\r\n> ```\r\n\r\nCompiling with -no-pie option just for one library (freetype2) sounds a little bit strange. In my opinion the prebuilt of libfreetype.a should be compiled with -fPIC option, or i am wrong?\r\n\r\nSorry, i am not a compiler\/linker expert.\r\n\r\nIf you remove the dependency to libfreetype.a (i.e. in link.txt)  you are able to successfully link everything with a clean\/new project.\r\n\r\nI compiled and linked the libfreetype.a by myself and replaced it with the prebuilt. Now it's linking.","@playmyskay Yeah, true perhaps.\r\n\r\nI have tried a few things, so far and nothing works. \r\n```sh\r\nelseif(LINUX)\r\n        #target_compile_options(${target} PUBLIC -fPIC)\r\n        #target_compile_options(${target} PUBLIC -no-pie)\r\n```","@slackmoehrle  \r\n\r\nstep1:\r\nCompile the freetype library by yourself from: https:\/\/github.com\/cocos2d\/cocos2d-x-3rd-party-libs-src\r\n\r\n`.\/build.sh -p=linux --libs=freetype --arch=x86_64 --mode=release`\r\n\r\noutput file: `cocos2d-x-3rd-party-libs-src\/build\/linux\/freetype\/prebuilt\/x86_64\/libfreetype.a`\r\n\r\nstep2:\r\nCreate or use an existing project and replace the file libfreetype.a with the output file of step1. Now link again and it works in my case.\r\n\r\nfile to replace: `_YourProject_\/cocos2d\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a`\r\n\r\n\r\nThe file in repo 'https:\/\/github.com\/cocos2d\/cocos2d-x-3rd-party-libs-bin' must be replaced with a correct binary.\r\n","> @slackmoehrle\r\n> \r\n> step1:\r\n> Compile the freetype library by yourself from: https:\/\/github.com\/cocos2d\/cocos2d-x-3rd-party-libs-src\r\n> \r\n> `.\/build.sh -p=linux --libs=freetype --arch=x86_64 --mode=release`\r\n> \r\n> output file: `cocos2d-x-3rd-party-libs-src\/build\/linux\/freetype\/prebuilt\/x86_64\/libfreetype.a`\r\n> \r\n> step2:\r\n> Create or use an existing project and replace the file libfreetype.a with the output file of step1. Now link again and it works in my case.\r\n> \r\n> file to replace: `_YourProject_\/cocos2d\/external\/freetype2\/prebuilt\/linux\/64-bit\/libfreetype.a`\r\n> \r\n> The file in repo 'https:\/\/github.com\/cocos2d\/cocos2d-x-3rd-party-libs-bin' must be replaced with a correct binary.\r\n\r\nThank you very much i had the same problem and it solved it","It solve by rollback  gcc version and g++ version ,reference the file `cocos2d-x-3.17.1\/build\/install-deps-linux.sh`  , in the end:\r\n\r\n```sh\r\n........\r\nsudo update-alternatives --remove-all gcc\r\nsudo update-alternatives --remove-all g++\r\n\r\nsudo update-alternatives --install \/usr\/bin\/gcc gcc \/usr\/bin\/gcc-4.9 60\r\nsudo update-alternatives --install \/usr\/bin\/g++ g++ \/usr\/bin\/g++-4.9 60\r\n\r\necho \"Cocos uses GCC Version: `gcc --version`\"\r\necho \"Cocos uses G++ Version: `g++ --version`\"\r\necho \"Cocos uses ld Version: `ld --version`\"\r\necho \"Cocos uses \/usr\/bin\/ld Version: `\/usr\/bin\/ld --version`\"\r\n```\r\n\r\nthe \"-fPIC\" error occur because gcc\\g++ version too new (ubuntu17 or 18) , may be cocos2d-x should update gcc version","i think we can use ubuntu 18 for next the testing version ","That would be fantastic, @minggo!  I just started learning Cocos and this was a pain point.","Just to share another [easier] solution for 3.17.1 (Ubuntu 18.04 LTS \/ LinuxMint 19.1):\r\nI just created a symlink to avoid editing my shared CMake build's link.txt.\r\n\r\n```\r\n$ cd ~\/cocos2d-x\/external\/freetype2\/prebuilt\/linux\/64-bit\r\n$ mv libfreetype.a libfreetype.a.bak\r\n$ ln -s \/usr\/lib\/x86_64-linux-gnu\/libfreetype.a\r\n```\r\n\r\n_(Edit) Note: The package libfreetype6-dev must be installed._","I just had a similar issue with **libfmod**:\r\n\r\n`\/usr\/bin\/ld: ..\/..\/cocos2d\/external\/linux-specific\/fmod\/prebuilt\/64-bit\/libfmod.so: .dynsym local symbol at index 2 (>= sh_info of 2)`\r\n\r\nHow can I solve it?","Can you improve the documentation for cocos2dx installation in Linux? It\u2019s best not to set the operating system dependency.  but I can\u2019t see it in the documentation. I use kubuntu 20.04"],"labels":["platform:linux"]},{"title":"3.17 external update request, include solve Lua issues","body":"- cocos2d-x version:3.17\r\n- devices test on: request by forum\r\n\r\n1. NDK 18 stable have been published, consider to update android external built tool to NDK 18\r\n2. Lua crash when use 3.17, but not older versions, possible external issues\r\n\r\n### thread\r\n\r\nLua issues,\r\n\r\n- may be caused by https:\/\/github.com\/cocos2d\/cocos2d-x-3rd-party-libs-src\/pull\/160\r\n- developer report this at Chinese forum, http:\/\/forum.cocos.com\/t\/cocos-3-17-lua\/67539","comments":["I have doubt on this commit https:\/\/github.com\/cocos2d\/cocos2d-x-3rd-party-libs-src\/pull\/160\/commits\/c7ce4f6ae9de5fddc7b76ff73c81ef628a655b96\r\n\r\nwhen compile `luajit`, why use `gcc` directly, is it a cross-compiler ? change it to compiler same with others will trigger what errors. \r\n\r\ncould you research this when you free. @PatriceJiang ","\ud83d\udc4c\uff0c pls assign this issue to me ","more Lua release crash feedback in Chinese forum\r\n\r\nhttps:\/\/forum.cocos.com\/t\/cocos2d-x-3-1-7-release\/68421","so I think lua external libs issues should been solved before 3.17.1 released. but all 3.17 external update we can put it into next release. @PatriceJiang @crazyhappygame ","can't reproduce lua issue by run lua-tests release, move it into next  milestone","how about the issue now?@drelaptop @PatriceJiang  ","i think lua crash issue is fixed in 3.17.1","@minggo thx,  i will take a test.","@minggo i upgraded to 3.17.1 and got other issues.\r\nwin32: crash on close window and some performance issues\r\nThere may be some parts that have not been upgraded sucessfully. I don't have much time to debug . Is there any way to upgrade only part of it?","Yep, you can just replace the luajit lib.","I replace the luajit and crash again,release mode debug is ok ","Does it crash in luajit. And did you clean and rebuild the application?","It works, but you need to pay attention to the changes in luajit\r\nmath.mod -> math.fmod\r\nstring.gfind -> string.gmatch\r\nhttps:\/\/github.com\/LuaJIT\/LuaJIT\/pull\/302","Thanks for the information. How did you find it?","i replace luajit lib, it crashes for math.mod is nil. i fixed it by google and test on many devices. everything is ok."],"labels":["script:lua","critical","module:3rdParty"]},{"title":"Toggle AudioPlayer debug output on\/off","body":"- cocos2d-x version: 3.16\r\n- devices test on: win7\r\n- developing environments\r\n   - VS version: 2013\r\n\r\nA request: I wish I could disable the output that AudioPlayer prints out sometimes, because when you have a few of your own CCLOGs in your code, they drown in all the AudioPlayer output.\r\nI'm thinking something like `AudioEngine::setDebugOutputEnabled(true\/false);` or similar.","comments":["An alternative suggestion, can the debug output be disabled by default and only enabled via a pre-processor define (one that can even be passed as a compilation switch via -D XYZ etc).\r\n"],"labels":["type:request","module:audio"]},{"title":"IOS web socket crash when close app","body":"- cocos2d-x version:3.16 3.17\r\n- devices test on:\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version:<------\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n--------------------------------------- bug 1\r\nstd::__1::system_error\r\nmutex lock failed: Invalid argument\r\n\r\n0\u00a0libc++abi.dylib | 0x00000001828f6000\u00a0+\u00a0107852\r\n-- | --\r\n1\u00a0libc++abi.dylib | std::terminate()\u00a0+\u00a060\r\n2\u00a0Badam Oyuni | LuaWebSocket::~LuaWebSocket()\u00a0+\u00a012\r\n3\u00a0Badam Oyuni | tolua_collect_WebSocket(lua_State*)\u00a0+\u00a036\r\n4\u00a0Badam Oyuni | _lj_BC_JFUNCV\u00a0+\u00a044\r\n5\u00a0Badam Oyuni | _class_gc_event\u00a0+\u00a0224\r\n6\u00a0Badam Oyuni | _lj_BC_JFUNCV\u00a0+\u00a044\r\n7\u00a0Badam Oyuni | _gc_finalize\u00a0+\u00a0412\r\n8\u00a0Badam Oyuni | _lj_gc_finalize_udata\u00a0+\u00a028\r\n9\u00a0Badam Oyuni | _cpfinalize\u00a0+\u00a028\r\n10\u00a0Badam Oyuni | _lj_vm_cpcall\u00a0+\u00a0100\r\n11\u00a0Badam Oyuni | _lua_close\u00a0+\u00a0124\r\n12\u00a0Badam Oyuni | cocos2d::LuaStack::~LuaStack()\u00a0+\u00a044\r\n13\u00a0Badam Oyuni | cocos2d::LuaStack::~LuaStack()\u00a0+\u00a012\r\n14\u00a0Badam Oyuni | cocos2d::LuaEngine::~LuaEngine()\u00a0+\u00a044\r\n15\u00a0Badam Oyuni | cocos2d::LuaEngine::~LuaEngine()\u00a0+\u00a012\r\n16\u00a0Badam Oyuni | cocos2d::ScriptEngineManager::destroyInstance()\u00a0+\u00a044\r\n17\u00a0Badam Oyuni | cocos2d::ApplicationProtocol::~ApplicationProtocol()\u00a0+\u00a036\r\n18\u00a0libsystem_c.dylib | __cxa_finalize_ranges\u00a0+\u00a0384\r\n19\u00a0libsystem_c.dylib | exit\u00a0+\u00a024\r\n20\u00a0UIKit | -[UIApplication applicationWillTerminate]\r\n21\u00a0UIKit | ___98-[__UICanvasLifecycleMonitor_Compatability deactivateEventsOnly:withContext:forceExit:completion:]_block_invoke.271\u00a0+\u00a0344\r\n22\u00a0UIKit | __runAfterCACommitDeferredBlocks\u00a0+\u00a0292\r\n23\u00a0UIKit | __cleanUpAfterCAFlushAndRunDeferredBlocks\u00a0+\u00a0288\r\n24\u00a0UIKit | __afterCACommitHandler\u00a0+\u00a0132\r\n25\u00a0CoreFoundation | ___CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__\u00a0+\u00a032\r\n26\u00a0CoreFoundation | ___CFRunLoopDoObservers\u00a0+\u00a0412\r\n27\u00a0CoreFoundation | ___CFRunLoopRun\u00a0+\u00a01292\r\n28\u00a0CoreFoundation | CFRunLoopRunSpecific\u00a0+\u00a0436\r\n29\u00a0GraphicsServices | GSEventRunModal\u00a0+\u00a0100\r\n30\u00a0UIKit | UIApplicationMain\u00a0+\u00a0208\r\n31\u00a0Badam Oyuni | main (main.m:13)\r\n32\u00a0libdyld.dylib | _start\u00a0+\u00a04\r\n\r\n\r\n\u4ee5\u4e0a\u662fbugly \u7684\u5d29\u6e83\u62a5\u9519 Android \u65e0\u95ee\u9898 ios \u5d29\u6e83\u738710%\u5de6\u53f3\u633a\u9ad8\u7684\r\n\u5927\u6982\u770b\u4e86\u4e0b\u5b9e\u73b0\u7684\u4ee3\u7801\uff0c\u611f\u89c9\u90e8\u5206\u5904\u7406data race\u7684\u903b\u8f91\u5904\u7406\u7684\u4e0d\u5230\u4f4d,\u66f4\u8be6\u7ec6\u4e5f\u5c31\u6ca1\u770b\u4e86\r\n\u6211\u8fd9\u8fb9\u5c06websocket \u6539\u6210\u5355\u7ebf\u7a0b\u540e\u5c31\u6ca1\u5d29\u4e86, \u5bf9\u4e8e\u6211\u4eec\u9879\u76ee\u5355\u7ebf\u7a0b\u591f\u7528\u4e86 \u800c\u4e14\u8fd8\u7701\u7535\uff0c\u4e5f\u89e3\u51b3\u4e86\u5d29\u6e83\u95ee\u9898\u3002\r\n\r\nps. \u6211\u4eec\u9879\u76ee\u662f\u68cb\u724c\u9879\u76ee\uff0c\u6bcf\u4e2a\u5c0f\u6e38\u620f\u90fd\u662f\u4e00\u4e2a socket \u6240\u4ee5\u6709\u9891\u7e41\u521b\u5efa\u9500\u6bc1websocket\u7684\u60c5\u51b5","comments":["\u8fd9\u4e2a\u62a5\u9519\u8c8c\u4f3c\u5f71\u54cd\u4e0d\u5927\u4e3b\u8981\u662f\u5173\u95ed\u6e38\u620f\u7684\u65f6\u5019\u89e6\u53d1\u7684","@CarlZhongZ  \u4f60\u597d \u6211\u4e5f\u5728\u4f7f\u7528websocket \u6709\u4e00\u4e9b\u95ee\u9898\u60f3\u4ea4\u6d41\u4e00\u4e0b \u65b9\u4fbf\u7684\u8bdd\u53ef\u4ee5\u7559\u4e2aQQ\u4e0d\u3002"],"labels":["module:network"]},{"title":"Mac FullScreen unable to switch application & its fix","body":"- cocos2d-x version: 3.17\r\n- devices test on:\r\n- developing environments\r\n   - Xcode version: 9.3\r\n\r\n\r\nSteps to Reproduce:\r\n\r\n1. Open your mac app in fullscreen\r\n2. Press Command tab\r\n3. Application won't switch\r\n\r\nAnother one really annoying thing about this is. When your app crashes you can't switch to xcode to view console or stop the process you have to force quit xcode.\r\n\r\n\r\nMy simple solution to this is go to CCApplication-mac.mm\r\ngo to Application::run() after glview->retain(); add the following\r\n```\r\n    NSWindow *nsWindow = glview->getCocoaWindow();\r\n    nsWindow.hidesOnDeactivate = true;\r\n```\r\nThis allows you to switch task by hiding the current window. But in this case your game wont pause.\r\n\r\nSo you will have to go to GLViewImpl-Desktop.cpp\r\n```\r\nvoid GLViewImpl::onGLFWWindowFocusCallback(GLFWwindow* \/*window*\/, int focused)\r\n{\r\n    if (focused == GL_TRUE)\r\n    {\r\n        Director::getInstance()->getEventDispatcher()->dispatchCustomEvent(GLViewImpl::EVENT_WINDOW_FOCUSED, nullptr);\r\n        Application::getInstance()->applicationWillEnterForeground();\r\n\r\n    }\r\n    else\r\n    {\r\n        Director::getInstance()->getEventDispatcher()->dispatchCustomEvent(GLViewImpl::EVENT_WINDOW_UNFOCUSED, nullptr);\r\n        Application::getInstance()->applicationDidEnterBackground();\r\n\r\n    }\r\n}\r\n```\r\n\r\nadd applicationDidEnterBackground() and add ApplicationDidEnterForeground().\r\nEverything now should run smoothly. Sorry I don't get much free time otherwise I would have made pull requests.\r\n\r\n","comments":[],"labels":["platform:mac"]},{"title":"Change Action::setTag to return the action instead of void, to allow chaining","body":"This would allow for something replacing this:\r\n\r\n```\r\nauto my_action = MoveBy::create(0.5f, {10.0f, 10.0f});\r\nmy_action->setTag(123);\r\nmy_node->runAction(my_action);\r\n```\r\n\r\nwith something less verbose\r\n\r\n`my_node->runAction(MoveBy::create(0.5f, {10.0f, 10.0f})->setTag(123));`\r\n\r\nThe upside is shorter and clearer code, the downside is that overrides in custom code would need to change, but I can't imagine many custom actions override `setTag` anyway.","comments":["Oh, I love builder pattern! However, this should be changed for **all** methods which modify object, so... just leave it for bright future of cocos2d-x 4!","Please don't do it"],"labels":["type:request"]},{"title":"Logging in Android with Java","body":"- cocos2d-x version: 3.17\r\n\r\nIn the Android part, the logging is done with simple Log.d(), but without any check for release or logging tags. Because of that, even the release build prints debug information into the logcat. \r\n\r\nIf I use CCLOG in C++, this will be truncated from the release build. It would be nice, to have the same behavior in the Java world: **if (BuildConfig.DEBUG) Log.d();** (this is now usable because of **implementation** instead of **compile** in the build.gradle file) or something similar (e.g. usage of Timber). ","comments":["You could make a JNI call from c++ to java to use these log methods.","@Alakolmiomatriisi The C++ part is calling Log.X to write into the logcat. But you misunderstood the issue. It's about **blocking logging** in Java\/Kotlin for release builds. The C++ code would not report any debugging logs in release build, because it's truncate from code with #define."],"labels":["platform:android"]},{"title":"Redesign sync listFilesRecursively to don't use output argument.","body":"- cocos2d-x version: git\r\n- devices test on: all\r\n\r\n`listFiles` return `std::vector`, but `listFilesRecursively` accept it by pointer and return nothing!.\r\n\r\nI think that it is pretty bad idea of using input argument with returning void in C++. I can done adding `return std::vector` version by myself (leave existing for backwards compatiblity). What others do think about it?\r\n","comments":[],"labels":["type:request"]},{"title":"Might be missing a reset() in ReloadDefaultGLProgram?","body":"- cocos2d-x version: 3.9, 3.16\r\n- devices test on: Simulator iOS 9.2\r\n- developing environments\r\n   - NDK version: r10d\r\n   - Xcode version: 9.2\r\n   - VS version: -\r\n   - browser type and version: -\r\n\r\nActually, there wasn't a bug, I just have a question in cocos2d-x\/cocos\/renderer\/CCGLProgramCache.cpp. I am new to cocos2d, so I don't know if this is a bug or it did on purpose.\r\n\r\n![screen shot 2018-05-16 at 12 17 53 pm](https:\/\/user-images.githubusercontent.com\/5497594\/40129786-3361ffd4-5903-11e8-8dc6-b274d3f269c5.png)\r\nThere is no reset() called between line 349 and line 350 in ReloadDefaultGLProgram function and is it on purpose? if so, why? The code is in cocos2d-x\/cocos\/renderer\/CCGLProgramCache.cpp.","comments":[],"labels":["unconfirmed"]},{"title":"awful default value existed on macOS  FileUtils::getWritablePath() ","body":"default value of `getWritablePath()` on macOS is system __Document__ dir, if one write his code as\r\n```C++\r\nauto path = FileUtils::getInstance()->getWritablePath();\r\nthis->downloader->createDownloadFileTask(sURLList[3], path, sNameList[3]);\r\n```\r\nthe older files in __Document__ dir will be deleted, it's awful.","comments":["I wish we can get a pointer to the app cache folder, which is at least available on Android and iOS. But I didn't find any useful implementation for that right now.","@mars3142 On linux we can use `${HOME}\/.cache\/APP_NAME` or `\/tmp\/APP_NAME` (or `\/tmp\/process_id`) . Second one will be cleaned on boot, first will not.\r\n\r\nOn Windows we probably can use `Temp`.\r\n\r\nI don't know about macOS place for cache.","Also, data directory on mac probably should be `Documents\/APP_NAME`. It will avoid this issue.","But did you use a framework call? I didn't find any \r\n\r\n    FileUtils::getInstance()->getCachePath()\r\n\r\nyet. I would be happy to have such an implementation. We should create a pull request, but I think, that such PRs will be ignored for a long time.\r\n\r\nThe temp folder isn't the best such a directory. On macOS there is $HOME\/Library\/Caches\/bundleIdentifier for that. Android and iOS does have similar folders within the app sandbox folder. I don't know the places for linux\/Windows.","@mars3142 As I wrote, on linux `${HOME}\/.cache\/APP_NAME` is very common place to store some unimportant temporary data AKA cache.","@mars3142 I bet such PR won't be ignored for a long time, but ASAP. I stay at the same office with minggo .If I can't review that PR, I will ask @minggo, even he is busy now.","> We should create a pull request, but I think, that such PRs will be ignored for a long time.\r\n\r\nUnfortunately, yes... \r\n\r\n`getWritablePath()` should be here: \r\n\r\n`\/Users\/**UserName**\/Library\/Application Support\/**GameName**\/..`\r\n\r\nIn SBX it's implemented [here](https:\/\/github.com\/KAMIKAZEUA\/SpriteBuilderX\/blob\/SpriteBuilderX\/SpriteBuilder\/ccBuilder\/SettingsManager.m#L31), very simple. ","I wouldn't change getWritablePath() in v3.x for backward compatibility. \r\n\r\nThe main issues is this is currently being used internal to the engine for everything, basically, from caches to 'document' data that is desired to be backed up, and therefore folks here can use `setWritablePath()` to change this simply, for now, to get one of the following new paths.\r\n\r\n**Instead I would suggest adding some, all, or other paths on all platforms:**\r\n- Documents (users' documents, currently where getWritablePath returns on macOS)\r\n- Cache (temporary, don't care if destroyed by OS)\r\n- Preferences (usually backed up, meant for preferences and documents\/files data)\r\n- Package (data stored inside app package itself, default root for FileUtils)\r\n- ?Temporary\/tmp? (data cleaned up between app launches)\r\n- ???\r\n\r\n\r\n\\* method names (API) can be changed and\/or prefixed (e.g. AppCache, AppDocs)\r\n** any conceptual path not supported could probably just use one of the others. Temp could use Cache, Prefs could use Documents, etc. I think most if not all platforms have 4 or all 5 of the suggestions.\r\n*** Use the platform API to get these directories instead of hard-coded paths where possible, at least for the prefix and then append the game Name or Package Url (com.example.game).\r\n(e.g. %APPDATA%, NSHomeDirectory, NSCachesDirectory, getCacheDir, etc)\r\n\r\n2c","@stevetranby It's even more complicated on Android, because you can use [Context.getCacheDir()](https:\/\/developer.android.com\/reference\/android\/content\/Context#getcachedir), [Context.getExternalCacheDir()](https:\/\/developer.android.com\/reference\/android\/content\/Context#getexternalcachedir) or [Context.getExternalCacheDirs()](https:\/\/developer.android.com\/reference\/android\/content\/Context#getexternalcachedirs). So you can have 2 options (the last one is not really useful, because it's returning an array of folders) for you to use.\r\n\r\nCurrently the **FileUtils::getWritablePath** refers to the local files folder, which is in the same partition as **Context.getCacheDir()**, but the local storage isn't often large, because of that the external folders are preferred, but this needs sometimes SD-Card Read\/Write Permission (between API 21 and 23). We should at least offer an option for the developer to choose internal\/external, where internal is the default.\r\n\r\nI could implement the Android part, including the permission request (if denied, I would switch to the internal storage). I would write stubs for the other platforms, so someone else can write it, if I didn't find a solution."],"labels":["critical","platform:mac"]},{"title":"SHOW_ALL without borders","body":"- cocos2d-x version: git\r\n\r\nThis problem is well described in https:\/\/discuss.cocos2d-x.org\/t\/multiresolution-how-to-show-all-without-black-borders\/26508. In short words, I want same view as SHOW_ALL actually provide, but with actual image instead of black borders.\r\n\r\nSome person wrote a patch to add this feature, but it is for old cocos2d-x (I didn't tested, but still want to use mainline version). This is extremely helpful feature, so can you, please, add it to cocos2d-x?","comments":["I'm not shure, but it is probably actually possible to do same thing by comparing screen and designed screen aspect ratios and selecting FIXED_HEIGHT or FIXED_WIDTH.","I remember that topic, and to be honest I do not think that the engine needs a new resolution. Since you can get the same result using current `ResolutionPolicy`s.\r\nIf you are interested, I can look at this in more detail when I can again access the forum.","link PR https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/19063"],"labels":["type:request","highlight"]},{"title":"audio crash in version 3.15","body":"- cocos2d-x version:3.15\r\n- devices test on: ios ,all device\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version:9.3\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nmy app build on cocos2d-x lua  3.15 .  from bugly ,I find a lot of crash in audio system.  crash have 2 different stack:\r\n\r\n-------------------------------------\r\ntype A:\r\n0 libsystem_platform.dylib _platform_memmove + 176\r\n1 OpenAL OALSource::DoRender(AudioBufferList*, unsigned int) + 2380\r\n2 OpenAL OALSource::DoRender(AudioBufferList*, unsigned int) + 2380\r\n3 OpenAL OALSource::SourceInputProc(void*, unsigned int*, AudioTimeStamp const*, unsigned int, unsigned int, AudioBufferList*) + 60\r\n4 AudioToolbox AUSpatialMixer::Render(unsigned int&, AudioTimeStamp const&, unsigned int) + 1772\r\n5 AudioToolbox AUBase::DoRenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, AUOutputElement*, unsigned int, AudioBufferList&) + 172\r\n6 AudioToolbox AUBase::DoRender(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int, AudioBufferList&) + 492\r\n7 AudioToolbox AUMethodRender(void*, unsigned int*, AudioTimeStamp const*, unsigned int, unsigned int, AudioBufferList*) + 44\r\n8 AudioToolbox AUConverterBase::RenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int) + 324\r\n9 AudioToolbox AURemoteIO::RenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int) + 156\r\n10 AudioToolbox AUBase::DoRenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, AUOutputElement*, unsigned int, AudioBufferList&) + 172\r\n11 AudioToolbox AUBase::DoRender(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int, AudioBufferList&) + 492\r\n12 AudioToolbox AURemoteIO::PerformIO(unsigned int, unsigned int, unsigned int, AudioTimeStamp const&, AudioTimeStamp const&, AudioBufferList const*, AudioBufferList*, int&) + 744\r\n13 AudioToolbox _AURIOCallbackReceiver_PerformIO + 356\r\n14 AudioToolbox __XPerformIO + 104\r\n15 AudioToolbox _mshMIGPerform + 232\r\n16 AudioToolbox _MSHMIGDispatchMessage + 40\r\n17 AudioToolbox AURemoteIO::IOThread::Run() + 284\r\n18 AudioToolbox AURemoteIO::IOThread::Entry(void*) + 156\r\n19 AudioToolboxCAPThread::Entry(CAPThread*) + 88\r\n\r\nand devices type and system version list :\r\n\r\niPhone x\t\t\t    11.3 (15E216)\r\niPhone 6s Plus\t    11.3 (15E216)\r\niPhone 6s Plus            11.2.5 (15D60)\r\niPhone 7 Plus\t\t    11.3 (15E216)\r\niPad 5th generation\t    11.3 (15E216)\r\niPhone 6\t\t\t    11.3 (15E216)\r\niPhone 7 Plus\t\t    11.3 (15E216)\r\niPhone 6\t\t\t    11.3 (15E216)\r\niPhone 6\t\t\t    11.3 (15E216)\r\niPad Pro 10.5-inch\t    11.3 (15E216)\r\n\r\nand so on.\r\n\r\n-------------------------------------------\r\ntype B:\r\n0 AudioToolbox\t_CrashIfClientProvidedBogusAudioBufferList + 56\r\n1 AudioToolbox\tAudioConverterConvertComplexBuffer + 868\r\n2 AudioToolbox\tAUSpatialMixer::Render(unsigned int&, AudioTimeStamp const&, unsigned int) + 2048\r\n3 AudioToolbox\tAUBase::DoRenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, AUOutputElement*, unsigned int, AudioBufferList&) + 172\r\n4 AudioToolbox\tAUBase::DoRender(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int, AudioBufferList&) + 492\r\n5 AudioToolbox\tAUMethodRender(void*, unsigned int*, AudioTimeStamp const*, unsigned int, unsigned int, AudioBufferList*) + 44\r\n6 AudioToolbox\tAUInputElement::PullInput(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int) + 140\r\n7 AudioToolbox\tAUInputFormatConverter2::InputProc(OpaqueAudioConverter*, unsigned int*, AudioBufferList*, AudioStreamPacketDescription**, void*) + 220\r\n8 AudioToolbox\tAudioConverterChain::CallInputProc(unsigned int) + 640\r\n9 AudioToolbox\tAudioConverterChain::FillBufferFromInputProc(unsigned int*, CABufferList*) + 128\r\n10 AudioToolbox\tBufferedAudioConverter::GetInputBytes(unsigned int, unsigned int&, CABufferList const*&) + 192\r\n11 AudioToolbox\tResampler2Wrapper::RenderOutput(CABufferList*, unsigned int, unsigned int&) + 192\r\n12 AudioToolbox\tSampleRateConverter::RenderOutput(CABufferList*, unsigned int, unsigned int&, AudioStreamPacketDescription*) + 48\r\n13 AudioToolbox\tBufferedAudioConverter::FillBuffer(unsigned int&, AudioBufferList&, AudioStreamPacketDescription*) + 804\r\n14 AudioToolbox\tAudioConverterChain::RenderOutput(CABufferList*, unsigned int, unsigned int&, AudioStreamPacketDescription*) + 120\r\n15 AudioToolbox\tBufferedAudioConverter::FillBuffer(unsigned int&, AudioBufferList&, AudioStreamPacketDescription*) + 804\r\n16 AudioToolbox\tAudioConverterFillComplexBuffer + 964\r\n17 AudioToolbox\tAUConverterBase::RenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int) + 632\r\n18 AudioToolbox\tAURemoteIO::RenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int) + 156\r\n19 AudioToolbox\tAUBase::DoRenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, AUOutputElement*, unsigned int, AudioBufferList&) + 172\r\n20 AudioToolbox\tAUBase::DoRender(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int, AudioBufferList&) + 492\r\n21 AudioToolbox\tAURemoteIO::PerformIO(unsigned int, unsigned int, unsigned int, AudioTimeStamp const&, AudioTimeStamp const&, AudioBufferList const*, AudioBufferList*, int&) + 744\r\n22 AudioToolbox\t_AURIOCallbackReceiver_PerformIO + 356\r\n23 AudioToolbox\t__XPerformIO + 104\r\n24 AudioToolbox\t_mshMIGPerform + 232\r\n25 AudioToolbox\t_MSHMIGDispatchMessage + 40\r\n26 AudioToolbox\tAURemoteIO::IOThread::Run() + 284\r\n27 AudioToolbox\tAURemoteIO::IOThread::Entry(void*) + 156\r\n28 AudioToolbox\tCAPThread::Entry(CAPThread*) + 88\r\n29 libsystem_pthread.dylib\t__pthread_body + 272\r\n30 libsystem_pthread.dylib\t__pthread_body\r\n\r\nand devices type and system version list :\r\niPhone x\t\t\t11.3 (15E216)\r\niPhone x\t\t\t11.2 (15C114)\r\niPhone 7\t\t\t11.3 (15E216)\r\niPad Pro 10.5-inch\t11.3 (15E216)\r\niPhone 6s\t\t\t11.1.1 (15B150)\r\niPhone 7 Plus\t\t11.3 (15E216)\r\niPad Air\t\t\t11.3 (15E216)\r\niPad mini 2\t\t\t11.3 (15E216)\r\niPhone 6s\t\t\t11.3 (15E216)\r\nipad7,5\t\t\t\t11.3 (15E216)\r\n\r\nthis crash happend aboult 10000 times from app version 1.0.0 to 1.4.0 in one year.\r\n\r\n----------------\r\nby the way ,When these crash occurs ,most users have enter to background for a period of time and return back. bellow is one of users action history:\r\n\r\n04-27 15:09:23.371 UIApplication DidFinishLaunching\r\n--\r\n204-27 15:09:23.608 UIApplication DidBecomeActive\r\n304-27 15:10:13.273 UIApplication WillResignActive\r\n404-27 15:10:14.091 UIApplication DidBecomeActive\r\n504-27 15:10:24.620 UIApplication WillResignActive\r\n604-27 15:10:25.500 UIApplication DidBecomeActive\r\n704-27 15:10:26.246 UIApplication WillResignActive\r\n804-27 15:10:26.965 UIApplication DidBecomeActive\r\n904-27 15:10:26.987 UIApplication WillResignActive\r\n1004-27 15:10:30.299 UIApplication DidBecomeActive\r\n1104-27 15:10:31.014 UIApplication WillResignActive\r\n1204-27 15:10:32.141 UIApplication DidEnterBackground\r\n1304-27 15:10:32.389 UIApplication WillEnterForeground\r\n1404-27 15:10:32.693 UIApplication DidBecomeActive\r\n\r\n dumganhar said: Fixed at #17500 and #17518 .\r\n the code has merged to my engine version. but help nothing.\r\n\r\nthanks\r\n\r\n\r\n\r\n\r\n","comments":["how to reproduce it, any simple code?","@drelaptop I wish I can reproduce,but i can not .  the crash messages is from bugly. I have no idea to fix it,so I feedback here.","thanks for feedback, hope any other developers know the reason.","Also the same problem. Almost on ios 11. Everyday thousands of crashs are almost there of below. I used cocos3.3, but never occured until ios 11 came out.\r\n\r\nBugly crash stack1:\r\n\r\n0\u00a0AudioToolbox | _CrashIfClientProvidedBogusAudioBufferList\u00a0+\u00a056\r\n-- | --\r\n1\u00a0AudioToolbox | AudioConverterConvertComplexBuffer\u00a0+\u00a0920\r\n2\u00a0AudioToolbox | AUSpatialMixer::Render(unsigned int&, AudioTimeStamp const&, unsigned int)\u00a0+\u00a01652\r\n3\u00a0AudioToolbox | AUBase::DoRenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, AUOutputElement*, unsigned int, AudioBufferList&)\u00a0+\u00a0172\r\n4\u00a0AudioToolbox | AUBase::DoRender(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int, AudioBufferList&)\u00a0+\u00a0948\r\n5\u00a0AudioToolbox | AUMethodRender(void*, unsigned int*, AudioTimeStamp const*, unsigned int, unsigned int, AudioBufferList*)\u00a0+\u00a044\r\n6\u00a0AudioToolbox | AUInputElement::PullInput(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int)\u00a0+\u00a0140\r\n7\u00a0AudioToolbox | AUInputFormatConverter2::InputProc(OpaqueAudioConverter*, unsigned int*, AudioBufferList*, AudioStreamPacketDescription**, void*)\u00a0+\u00a0220\r\n8\u00a0AudioToolbox | AudioConverterChain::CallInputProc(unsigned int)\u00a0+\u00a0596\r\n9\u00a0AudioToolbox | AudioConverterChain::FillBufferFromInputProc(unsigned int*, CABufferList*)\u00a0+\u00a0128\r\n10\u00a0AudioToolbox | BufferedAudioConverter::GetInputBytes(unsigned int, unsigned int&, CABufferList const*&)\u00a0+\u00a0192\r\n11\u00a0AudioToolbox | CBRConverter::RenderOutput(CABufferList*, unsigned int, unsigned int&, AudioStreamPacketDescription*)\u00a0+\u00a0120\r\n12\u00a0AudioToolbox | BufferedAudioConverter::FillBuffer(unsigned int&, AudioBufferList&, AudioStreamPacketDescription*)\u00a0+\u00a0800\r\n13\u00a0AudioToolbox | AudioConverterChain::RenderOutput(CABufferList*, unsigned int, unsigned int&, AudioStreamPacketDescription*)\u00a0+120\r\n14\u00a0AudioToolbox | BufferedAudioConverter::FillBuffer(unsigned int&, AudioBufferList&, AudioStreamPacketDescription*)\u00a0+\u00a0800\r\n15\u00a0AudioToolbox | AudioConverterFillComplexBuffer\u00a0+\u00a01048\r\n16\u00a0AudioToolbox | AUConverterBase::RenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int)\u00a0+\u00a0640\r\n17\u00a0AudioToolbox | AURemoteIO::RenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int)\u00a0+\u00a0104\r\n18\u00a0AudioToolbox | AUBase::DoRenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, AUOutputElement*, unsigned int, AudioBufferList&)\u00a0+\u00a0172\r\n19\u00a0AudioToolbox | AUBase::DoRender(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int, AudioBufferList&)\u00a0+\u00a0948\r\n20\u00a0AudioToolbox | AURemoteIO::PerformIO(unsigned int, unsigned int, unsigned int, AudioTimeStamp const&, AudioTimeStamp const&, AudioBufferList const*, AudioBufferList*, int&)\u00a0+\u00a0756\r\n21\u00a0AudioToolbox | _AURIOCallbackReceiver_PerformIO\u00a0+\u00a0356\r\n22\u00a0AudioToolbox | __XPerformIO\u00a0+\u00a0104\r\n23\u00a0AudioToolbox | _mshMIGPerform\u00a0+\u00a0232\r\n24\u00a0AudioToolbox | _MSHMIGDispatchMessage\u00a0+\u00a036\r\n25\u00a0AudioToolbox | AURemoteIO::IOThread::Run()\u00a0+\u00a0288\r\n26\u00a0AudioToolbox | AURemoteIO::IOThread::Entry(void*)\u00a0+\u00a0160\r\n27\u00a0AudioToolbox | CAPThread::Entry(CAPThread*)\u00a0+\u00a084\r\n28\u00a0libsystem_pthread.dylib | __pthread_body\u00a0+\u00a0308\r\n29\u00a0libsystem_pthread.dylib | __pthread_body\r\n\r\n\r\n\r\nBugly crash stack2:\r\n\r\n0\u00a0libsystem_platform.dylib | _platform_memmove\u00a0+\u00a0176\r\n-- | --\r\n1\u00a0OpenAL | OALSource::DoRender(AudioBufferList*, unsigned int)\u00a0+\u00a02380\r\n2\u00a0OpenAL | OALSource::DoRender(AudioBufferList*, unsigned int)\u00a0+\u00a02380\r\n3\u00a0OpenAL | OALSource::SourceInputProc(void*, unsigned int*, AudioTimeStamp const*, unsigned int, unsigned int, AudioBufferList*)\u00a0+\u00a060\r\n4\u00a0AudioToolbox | AUSpatialMixer::Render(unsigned int&, AudioTimeStamp const&, unsigned int)\u00a0+\u00a01772\r\n5\u00a0AudioToolbox | AUBase::DoRenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, AUOutputElement*, unsigned int, AudioBufferList&)\u00a0+\u00a0172\r\n6\u00a0AudioToolbox | AUBase::DoRender(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int, AudioBufferList&)\u00a0+\u00a0492\r\n7\u00a0AudioToolbox | AUMethodRender(void*, unsigned int*, AudioTimeStamp const*, unsigned int, unsigned int, AudioBufferList*)\u00a0+\u00a044\r\n8\u00a0AudioToolbox | AUConverterBase::RenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int)\u00a0+\u00a0324\r\n9\u00a0AudioToolbox | AURemoteIO::RenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int)\u00a0+\u00a0156\r\n10\u00a0AudioToolbox | AUBase::DoRenderBus(unsigned int&, AudioTimeStamp const&, unsigned int, AUOutputElement*, unsigned int, AudioBufferList&)\u00a0+\u00a0172\r\n11\u00a0AudioToolbox | AUBase::DoRender(unsigned int&, AudioTimeStamp const&, unsigned int, unsigned int, AudioBufferList&)\u00a0+\u00a0492\r\n12\u00a0AudioToolbox | AURemoteIO::PerformIO(unsigned int, unsigned int, unsigned int, AudioTimeStamp const&, AudioTimeStamp const&, AudioBufferList const*, AudioBufferList*, int&)\u00a0+\u00a0744\r\n13\u00a0AudioToolbox | _AURIOCallbackReceiver_PerformIO\u00a0+\u00a0356\r\n14\u00a0AudioToolbox | __XPerformIO\u00a0+\u00a0104\r\n15\u00a0AudioToolbox | _mshMIGPerform\u00a0+\u00a0232\r\n16\u00a0AudioToolbox | _MSHMIGDispatchMessage\u00a0+\u00a040\r\n17\u00a0AudioToolbox | AURemoteIO::IOThread::Run()\u00a0+\u00a0284\r\n18\u00a0AudioToolbox | AURemoteIO::IOThread::Entry(void*)\u00a0+\u00a0156\r\n19\u00a0AudioToolbox | CAPThread::Entry(CAPThread*)\u00a0+\u00a088\r\n20\u00a0libsystem_pthread.dylib | __pthread_body\u00a0+\u00a0272\r\n21\u00a0libsystem_pthread.dylib | __pthread_body\r\n\r\n\r\n\r\nBugly crash stack3:\r\n\r\n\r\n0\u00a0libsystem_kernel.dylib | __pthread_kill\u00a0+\u00a08\r\n-- | --\r\n1\u00a0libsystem_pthread.dylib | _pthread_kill$VARIANT$mp\u00a0+\u00a0376\r\n2\u00a0libsystem_c.dylib | abort\u00a0+\u00a0140\r\n3\u00a0libc++abi.dylib | __cxa_bad_cast\u00a0+\u00a00\r\n4\u00a0libc++abi.dylib | default_terminate_handler()\u00a0+\u00a0280\r\n5\u00a0libobjc.A.dylib | _objc_terminate()\u00a0+\u00a0140\r\n6\u00a0libc++abi.dylib | std::__terminate(void (*)())\u00a0+\u00a016\r\n7\u00a0libc++abi.dylib | __cxxabiv1::exception_cleanup_func(_Unwind_Reason_Code, _Unwind_Exception*)\r\n8\u00a0libc++.1.dylib | std::__1::__throw_system_error(int, char const*)\u00a0+\u00a088\r\n9\u00a0libc++.1.dylib | std::__1::mutex::try_lock()\u00a0+\u00a00\r\n10\u00a0Modernship_iOS_China_Release | cocos2d::experimental::AudioCache::invokingCallbacks()\u00a0+\u00a036\r\n11\u00a0Modernship_iOS_China_Release | cocos2d::experimental::AudioCache::readDataTask()\u00a0+\u00a0556\r\n12\u00a0Modernship_iOS_China_Release | cocos2d::experimental::AudioEngineThreadPool::threadFunc(int)\u00a0+\u00a0132\r\n13\u00a0Modernship_iOS_China_Release | void* std::__1::__thread_proxy<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, std::__1::__bind<void (cocos2d::experimental::AudioEngineThreadPool::*)(int), cocos2d::experimental::AudioEngineThreadPool*, int&> > >(void*)\u00a0+\u00a072\r\n14\u00a0libsystem_pthread.dylib | __pthread_body\u00a0+\u00a0272\r\n15\u00a0libsystem_pthread.dylib | __pthread_body\r\n\r\n","this is the same bug as this one (I gave a more detailed explanation there):\r\n\r\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/18948\r\n"],"labels":["type:bug","module:audio"]},{"title":"Why RenderQueue push back five ocupy after clear?","body":"void RenderQueue::clear()\r\n{\r\n    _commands.clear();\r\n    for(int index = 0; index < QUEUE_COUNT; ++index)\r\n    {\r\n        _commands.push_back(std::vector<RenderCommand*>());\r\n    }\r\n}\r\nwhy push_back five RenderCommand after clear,which is too slow.\r\n","comments":["What's your points about `QUEUE_COUNT = 5` is slow, added detail descriptions is better @yafacex "],"labels":["type:question"]},{"title":"Ability to get mouse pos. without event handler","body":"For platforms that uses a mouse as input, it would be nice to be able to get the cursor position without using an event handler.","comments":["It is probably currently easier to make two variables and change them in event handler.\r\n\r\nP.S.: I also encourage this idea, it is just quick-and-dirty solution."],"labels":["type:request"]},{"title":"drawBatchedTriangles crash on Android","body":"- cocos2d-x version: 3.15.1\r\n- developing environments\r\n   - NDK version: r13b\r\n -platform: IOS, Android\r\n\r\nI am getting lots of crashes on Crashlytics in Renderer::drawBatchedTriangles() \r\n\r\n`glBufferData(GL_ARRAY_BUFFER, sizeof(_verts[0]) * _filledVertex, nullptr, GL_STATIC_DRAW);`\r\n`void *buf = glMapBuffer(GL_ARRAY_BUFFER, GL_WRITE_ONLY);`\r\n`memcpy(buf, _verts, sizeof(_verts[0]) * _filledVertex);`\r\n`glUnmapBuffer(GL_ARRAY_BUFFER);`\r\n\r\nCrash is happening at line `memcpy(buf, _verts, sizeof(_verts[0]) * _filledVertex);`\r\n\r\nI am not able to reproduce this crash on my side but i have seen many instances of this crash on Crashlytics as well as on Google Play Dashboard. Crash is happening mostly on non popular devices Example: \"Kobo Arc 10HD\" and \"Rockchip Tablet PC\" the most common devices with crash. As i see it looks to me that @dumganhar you have been trying to fix some issues related to this part of the code in https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/15805.\r\n\r\nDo you think that this issue is related? Any ideas about how it can be solved?","comments":["@minggo @dumganhar Guys any update on this?","Update:: \r\nIf i set VBO_SIZE to a less number then the crash can be reproduced easily. on debug mode it asserts but on release mode i get the similar crash stack as well as line number which i am getting on crashlytics.\r\nI set VBO_SIZE  to 655 in my test scenario.\r\nand INDEX_VBO_SIZE is set using formula VBO_SIZE * 6 \/ 4;\r\nWith above configuration when fillVerticesAndIndices is called then `_indices[_filledIndex + i] = _filledVertex + indices[i];` sometimes _indices index increased from `INDEX_VBO_SIZE` which leads to memory corruption. and hence it leads to crash at random places.\r\nI checked that after this `_filledVertex` `_buffersVAO` `_triBatchesToDraw` gets garbaged.\r\n\r\nPlease help, I desperately wants to fix this crash. ","I also encountered this problem.  Who can solve it?","May be the device doesn't support map buffer\/VAO though it returns true when checking the feature.","hi, minggo ! there are the same crushes in 3.17.2\r\n![crush-batch-render2](https:\/\/user-images.githubusercontent.com\/58680017\/70412748-8bb92180-1a90-11ea-98b7-d177edf0cbd3.png)\r\n"],"labels":["module:renderer"]},{"title":"some ProgressTimer nodes do not show on Android device","body":"- cocos2d-x version: v3.13\r\n- devices test on: Samsung S7 (problematic device).. No issue on my iPhone 8Plus, iOS simulators, or android emulators.\r\n- developing environments\r\n   - NDK version: android-ndk-r13b\r\n   - Xcode version: 9.2\r\n\r\n\r\nSteps to Reproduce:\r\n\r\nOn my game's title screen (A Scene + 1 Layer), I have multiple ProgressTimer nodes. They all show correctly on iOS, Android, simulator and emulators. However in one of my game scenes with many Layers and Sprites, I have added a ProgressTimer node, and it does not show up on the Android device. This happens for all of my game scenes with ProgressTimer nodes after the title screen. This is only happening on an actual Android device, the android emulators have no issues showing these ProgressTimers. One example is the health bar above my game units. None of them have a healthbar on the Android device, but they all show on the android emulator and all iOS devices.\r\n\r\nIs there some sort of draw difference on the Android device? Did I reach some limit that is not allowing these to be drawn?\r\n\r\nDo I need to provide any additional information?\r\n","comments":["Possibly related to #17292 "],"labels":["type:bug","platform:android"]},{"title":"TMXlayer getTileAt in Hexagonal Map ","body":"- cocos2d-x version: 3.16 (clone from repository)\r\n- devices test on: Windows 10 PC\r\n- developing environments\r\n   - VS version: 2017 Community\r\n\r\nWas asking this first in forum: [http:\/\/discuss.cocos2d-x.org\/t\/tmxlayer-gettileat\/37051](url) @slackmoehrle \r\n\r\n\r\nWhen trying to use getTileAt on some tiles, these tiles are not beeing rendered anymore. I tested this in the cpp-tests:\r\n![missing tile cpp test](https:\/\/user-images.githubusercontent.com\/7666187\/38627170-9d44c9e2-3dae-11e8-879a-bbc11f538a2a.PNG)\r\naccording code with changes:\r\n![missing tile cpp test code](https:\/\/user-images.githubusercontent.com\/7666187\/38627179-a3c842a8-3dae-11e8-9c55-1b2f9b9e22d6.PNG)\r\n\r\n\r\nI also found out that if I copy the code to test Issue 16512 from the other hexmap test, the tile is rendered again:\r\n\r\n![no missing tile after issue test](https:\/\/user-images.githubusercontent.com\/7666187\/38627219-c2cd8fe6-3dae-11e8-8802-006cbdeaf2f3.PNG)\r\naccording code with changes:\r\n![image](https:\/\/user-images.githubusercontent.com\/7666187\/38627245-d2e21da2-3dae-11e8-8e59-1dd188628303.png)\r\n\r\n\r\nHowever this is probably not a good solution as it creates a Sprite for every tile, at least thats my understanding.\r\n","comments":[],"labels":["platform:win32"]},{"title":"Label::getLetter lose label's color","body":"- cocos2d-x version: 3.12\r\n- devices test on: iOS 11.3\/iPad Air 2\r\n- developing environments\r\n   - Xcode version: 9.3\r\n\r\nSteps to Reproduce:\r\n\r\n`Label* pLabel = Label::createWithTTF(\"TEST\", LOCALIZED_FONT, 60);\r\npLabel->setPosition(WIN_SIZE.width \/ 2, WIN_SIZE.height \/ 2);\r\naddChild(pLabel);\r\n        \r\npLabel->setColor(Color3B::RED);\r\npLabel->getLetter(0);`\r\n\r\nIt wil show a label with white \"T\" and red \"EST\".\r\n","comments":[],"labels":["module:ui","unconfirmed"]},{"title":"Can't clone a ui::Button with a BMFont title label due to setTitleColor assertion","body":"- cocos2d-x version: 3.16\r\n- devices test on: Win32 \r\n- developing environments\r\n   - NDK version: 11c\r\n   - VS version: 2013\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n1. Create a ui::Button\r\n2. Set its title font to a BMFont\r\n3. Clone the button\r\n4. Title color tried to get cloned, but since BMFonts can't be colored, cocos throws an assertion error at setting label's color [CCLabel.cpp](https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/cocos2d-x-3.16\/cocos\/2d\/CCLabel.cpp?utf8=%E2%9C%93#L1961), called from [Button::copySpecialProperties](https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/cocos2d-x-3.16\/cocos\/ui\/UIButton.cpp?utf8=%E2%9C%93#L917)\r\n\r\nCouldn't see a nice way to check for the type of label, short of maybe checking the ending of the font name. Workaround is to comment out the line I think.","comments":[],"labels":["type:bug","module:renderer"]},{"title":"android custom AssetsManager make cocos anr","body":"- cocos2d-x version:3.10\r\n- devices test on:android\r\n\r\nSteps to Reproduce:\r\n\r\nI need custom AssetsManager\r\neg:\r\n`public static AssetManager generateAssetManager(String resDir) {\r\n        try {\r\n            AssetManager assetManager = AssetManager.class.newInstance();\r\n            Method addAssetPathMethod = AssetManager.class.getMethod(\"addAssetPath\", new Class[]{String.class});\r\n            addAssetPathMethod.setAccessible(true);\r\n            int cookie = (Integer) addAssetPathMethod.invoke(assetManager, resDir);\r\n            return assetManager;\r\n        } catch (Throwable t) {\r\n            t.printStackTrace();\r\n            return null;\r\n        }\r\n    }`\r\n\r\nand set it for cocos c++ FileUtilsAndroid use\r\n`FileUtilsAndroid::setassetmanager(AAssetManager_fromJava(env, assetManager));`\r\n\r\nresult in anr,this trace is\r\n` at java.lang.Object.wait!(Native method)\r\n  - waiting on <0x07c52fab> (a android.opengl.GLSurfaceView$GLThreadManager)\r\n  at android.opengl.GLSurfaceView$GLThread.requestRenderAndWait(GLSurfaceView.java:1646)\r\n  - locked <0x07c52fab> (a android.opengl.GLSurfaceView$GLThreadManager)\r\n  at android.opengl.GLSurfaceView.surfaceRedrawNeeded(GLSurfaceView.java:551)\r\n  at android.view.SurfaceView.updateWindow(SurfaceView.java:655)\r\n  at android.view.SurfaceView$3.onPreDraw(SurfaceView.java:162)\r\n  at android.view.ViewTreeObserver.dispatchOnPreDraw(ViewTreeObserver.java:944)\r\n  at android.view.ViewRootImpl.performTraversals(ViewRootImpl.java:2239)\r\n  at android.view.ViewRootImpl.doTraversal(ViewRootImpl.java:1280)\r\n  at android.view.ViewRootImpl$TraversalRunnable.run(ViewRootImpl.java:6432)\r\n  at android.view.Choreographer$CallbackRecord.run(Choreographer.java:874)\r\n  at android.view.Choreographer.doCallbacks(Choreographer.java:686)\r\n  at android.view.Choreographer.doFrame(Choreographer.java:621)\r\n  at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:860)\r\n  at android.os.Handler.handleCallback(Handler.java:751)\r\n  at android.os.Handler.dispatchMessage(Handler.java:95)\r\n  at android.os.Looper.loop(Looper.java:154)\r\n  at android.app.ActivityThread.main(ActivityThread.java:6290)\r\n  at java.lang.reflect.Method.invoke!(Native method)\r\n  at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:886)\r\n  at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:776)`","comments":[],"labels":["platform:android"]},{"title":"When quitting the app, director init is called again","body":"Reporting that when app is quitting, certain sequences causes the Director to be recreated again\r\n\r\nE.g in win32, onGLWMouseMoveCallback,  it calls Director::getInstance ()->geteventDispatcher, after Director dtor is already called, resultin in a new instance.\r\n\r\nRepro:\r\n1. Have a quit button in the scene that calls Director end (e.g. Helloworld)\r\n2. Click the button and move the mouse at same time.\r\n\r\nhttps:\/\/filedn.com\/l3TGy7Y83c247u0RDYa9fkp\/temp\/cocos2dx\/directordtor.jpg","comments":[],"labels":["unconfirmed"]},{"title":"Compiling Spidermonkey","body":"I'm trying to compile your version of spidermonkey (available over at  https:\/\/github.com\/cocos2d\/Spidermonkey), but everytime i try to \"make\" it it errors out.\r\nHere's the error: http:\/\/termbin.com\/qgmk.\r\nI may be using an older version, or i may be trying to compile it correctly, ive been following the offical mozilla spidermonkey compilation tutorial, available at their website.\r\nI would love to get some help.","comments":[],"labels":["module:3rdParty","type:question"]},{"title":"RefPtr should have a release method","body":"Hi, like std unique_ptr, RefPtr should have a release method so we can manage the smart ptr ourselves","comments":["@imtrobin please give more description, for example why need this, what will happen if not","Now, it seem like assigning it to null ,but std ptr do not allow this kind of auto conversions because it is potentiall dangerous as it prevents some accidental pointer conversions.\r\n\r\nThere are some old discussions on why std ptr is designed to be explicit, \r\nhttps:\/\/stackoverflow.com\/questions\/34882140\/why-cant-a-pointer-be-automatically-converted-into-a-unique-ptr-when-returning\r\n"],"labels":["unconfirmed"]},{"title":"support of specular map","body":"- cocos2d-x version: 3.16\r\nhow to make materials support specular map?\r\n\r\n","comments":[],"labels":["type:request"]},{"title":"TextureAtlas::drawNumberOfQuads crashes","body":"Hi guys! We are using cocos2d-x v3.15 and we have a very big issue with the following crash (top 2nd crash). We can't reproduce it but based on our Crashlytics report, it is happening to thousands of users every month, on different model phones and ios versions.\r\n\r\n![screen shot 2018-03-21 at 11 25 45 am](https:\/\/user-images.githubusercontent.com\/8600099\/37702328-d5ebc832-2cfa-11e8-9e5c-25e0b1e3967a.png)\r\n\r\nAny ideas on how we can fix this problem will be appreciated. Searching the forum, the only ideas we have found is to set CC_TEXTURE_ATLAS_USE_VAO to 0, but since we can't reproduce, we are not aware if this will fix the issue. We are afraid to change CC_TEXTURE_ATLAS_USE_VAO from 0 to 1 as we will have to send live this change which might cause new crashes. \r\n\r\nAlso please let us know if you believe this might have been fixed in v3.16 or 3.17.\r\n\r\nThanks in advance","comments":["Hi!\r\nDid you try that option?\r\nDid you find a solution?","Hi!\r\nI'm using cocos creator 1.8.2, and this  TextureAtlas::drawNumberOfQuads() issue is causing thousands of crashes (top 1 in the android vitals report on google developer console). Please help fix it! Any clue will be appreciated","Anybody seen if this has been fixed in a later version or not?"],"labels":["unconfirmed"]},{"title":"Edit box text overlaps caps icon","body":"- cocos2d-x version: 3.16\r\n- devices test on: Simulator iPhone 8\r\n- developing environments\r\n   - NDK version: N\/A\r\n   - Xcode version: 9.1\r\n   - VS version: N\/A\r\n   - browser type and version: N\/A\r\n\r\nSteps to Reproduce:\r\n\r\n1.  Go to EditBoxTests in cocos cpp tests\r\n2. Increase the size of the password edit box (it is set to 6 initially) and type till the string occupies the entire box.\r\n3. Turn on caps lock for the software keyboard by pressing shift twice. The caps icon will appear on the right of the edit box.\r\n4. Notice how the text overlaps the icon\r\n\r\n![screen shot 2018-03-16 at 5 02 47 pm](https:\/\/user-images.githubusercontent.com\/11037660\/37548767-cc3ae3e0-293f-11e8-84fc-d39ed29343e7.png)\r\n\r\n\r\n","comments":[],"labels":["module:ui"]},{"title":"Warning message appearing in logs caused by ui::ScrollViewBar::onEnter","body":"- cocos2d-x version: 3.16\r\n- devices test on: Win32\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version:\r\n   - VS version: 2017\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n1. Add a ui::ScrollView to a scene, push the scene into the stack, then pop it back.\r\n2. This warning comes up in the logs every time the scene is popped back:\r\n\r\n            \"warning: don't update it again\"\r\n\r\nIt is caused by scheduleUpdate being called from within ui::ScrollViewBar::onEnter().  It's not a big issue, just annoying to see it in the logs, and given that it is in the core cocos2dx code, there is little I can do about it.  Is the warning really necessary? schedulePerFrame is already doing the relevant checks, and the warning seems redundant.\r\n\r\nHere is a stack trace:\r\n```\r\n\r\n \tlibcocos2d.dll!cocos2d::Scheduler::schedulePerFrame(const std::function<void __cdecl(float)> & callback, void * target, int priority, bool paused) Line 476\tC++\r\n \tlibcocos2d.dll!cocos2d::Scheduler::scheduleUpdate<cocos2d::Node>(cocos2d::Node * target, int priority, bool paused) Line 286\tC++\r\n \tlibcocos2d.dll!cocos2d::Node::scheduleUpdateWithPriority(int priority) Line 1518\tC++\r\n \tlibcocos2d.dll!cocos2d::Node::scheduleUpdate() Line 1513\tC++\r\n\tlibcocos2d.dll!cocos2d::ui::ScrollViewBar::onEnter() Line 182\tC++\r\n \tlibcocos2d.dll!cocos2d::ProtectedNode::onEnter() Line 350\tC++\r\n \tlibcocos2d.dll!cocos2d::ui::Widget::onEnter() Line 239\tC++\r\n \tlibcocos2d.dll!cocos2d::ui::Layout::onEnter() Line 104\tC++\r\n \tlibcocos2d.dll!cocos2d::ui::ScrollView::onEnter() Line 115\tC++\r\n \tlibcocos2d.dll!cocos2d::Node::onEnter() Line 1313\tC++\r\n \tlibcocos2d.dll!cocos2d::ProtectedNode::onEnter() Line 349\tC++\r\n \tlibcocos2d.dll!cocos2d::ui::Widget::onEnter() Line 239\tC++\r\n \tlibcocos2d.dll!cocos2d::ui::Layout::onEnter() Line 104\tC++\r\n \tlibcocos2d.dll!cocos2d::Node::onEnter() Line 1313\tC++\r\n \tlibcocos2d.dll!cocos2d::Node::onEnter() Line 1313\tC++\r\n \tlibcocos2d.dll!cocos2d::Director::setNextScene() Line 1176\tC++\r\n \tlibcocos2d.dll!cocos2d::Director::drawScene() Line 291\tC++\r\n \tlibcocos2d.dll!cocos2d::Director::mainLoop() Line 1446\tC++\r\n \tlibcocos2d.dll!cocos2d::Application::run() Line 112\tC++\r\n```\r\n\r\n","comments":[],"labels":["module:ui"]},{"title":"setGLProgramState resets ProgressTimer position","body":"\r\nI have found an issue where using a Shader is messing with the position of the ProgressTimer class (only).\r\nI have a sprite with a bunch of children (one ProgressTimer and a list of other Sprites). The base sprite is added to a Layer:\r\n```\r\nauto spriteCache = SpriteFrameCache::getInstance();\r\n\r\nauto skullBackground = Sprite::createWithSpriteFrame(spriteCache->getSpriteFrameByName(\"skull_background.png\"));\r\nskullBackground->setNormalizedPosition(Vec2(1, 0.25));\r\nskullBackground->setName(\"run\");\r\n addChild(skullBackground);\r\n    \r\nauto runBackground = Sprite::createWithSpriteFrame(spriteCache->getSpriteFrameByName(\"run_background.png\"));\r\nrunBackground->setNormalizedPosition(Vec2::ANCHOR_MIDDLE);\r\nskullBackground->addChild(runBackground);\r\n\r\nauto progress = ProgressTimer::create(Sprite::createWithSpriteFrame(spriteCache->getSpriteFrameByName(\"run.png\")));\r\nprogress->setName(\"progress\"); \r\nprogress->setType(ProgressTimer::Type::RADIAL);\r\nprogress->setNormalizedPosition(Vec2::ANCHOR_MIDDLE);\r\nskullBackground->addChild(progress);\r\n```\r\n\r\nI apply a Shader to the entire set of nodes by iterating through the children. If I reset later the GLProgram then the ProgressTimer's position is reset to the bottom left of the Layer and ignores skullBackground's position:\r\n\r\n```\r\nrun->setGLProgramState(GLProgramState::getOrCreateWithGLProgramName(GLProgram::SHADER_NAME_POSITION_TEXTURE_COLOR_NO_MVP)); \r\n\r\nfor(const auto & node : run->getChildren())\r\n{              \r\n\r\n    node->setGLProgramState(GLProgramState::getOrCreateWithGLProgramName(GLProgram::SHADER_NAME_POSITION_TEXTURE_COLOR_NO_MVP)); \r\n }\r\n```\r\n\r\nEven if I reset the normalized position of the ProgressTimer to ANCHOR_MIDDLE it does not correct the position.\r\n\r\nI am working with cocos2d-x 3.16 and the issue is reproducible both with Linux and Android versions.\r\n","comments":[],"labels":["module:renderer"]},{"title":"TransitionCrossFade not working on iPhoneX ","body":"- cocos2d-x version: 3.16\r\n- devices test on: iPhone X, iPhone X Sumulator\r\n- developing environments\r\n   - Xcode version: 9.2\r\n\r\n\r\nSteps to Reproduce:\r\n1. Set the design resolution to 2048x3072 with FIXED_WIDTH as resolution policy\r\n2. Replace running scene with crossfade transition. \r\n3. The app gets to an assert in RenderTexture and closes:\r\n`CCASSERT(glCheckFramebufferStatus(GL_FRAMEBUFFER) == GL_FRAMEBUFFER_COMPLETE, \"Could not attach texture to framebuffer\");`\r\n\r\nI've attached a test project.\r\n[TransitionTest.zip](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/1796090\/TransitionTest.zip)\r\n","comments":[],"labels":["type:bug"]},{"title":"RenderTexture::setVirtualViewport() misses a lot of pixels and has wrong offset","body":"- cocos2d-x version: 3.16\r\n- devices test on: Windows 10\r\n- VS version: Visual Studio Enterprise 2017\r\n\r\nI wanted to capture a part of my scene with a code similar to the following (the design resolution is 1920*1080):\r\n\r\n    unsigned int SIZE_X = 960;\r\n    unsigned int SIZE_Y = 540;\r\n    unsigned int POS_X = 100;\r\n    unsigned int POS_Y = 100;\r\n\r\n    RenderTexture* texture = RenderTexture::create(SIZE_X, SIZE_Y);\r\n    texture->setVirtualViewport(Vec2(POX_X, POS_Y),\r\n                                Rect(0, 0, 1920, 1080),\r\n                                Rect(0, 0, SIZE_X, SIZE_Y));\r\n\r\n    texture->begin();\r\n    this->visit();\r\n    texture->end();\r\n\r\n    texture->saveToFile(\"test.png\", Image::Format::PNG);\r\n\r\nI've tried a lot of different combinations of parameters, but whatever I do, at most the pixels from the rectangle 0, 0, SIZE_X, SIZE_Y are captured, the rest is filled with transparent pixels. Also the offset is wrong.\r\n\r\nHere is the result of the code above for a mockup scene, where red means transparent pixel:\r\n\r\n![offset_rtbegin](https:\/\/user-images.githubusercontent.com\/17441062\/36953131-fbc9f7c2-2020-11e8-8d3c-a2ae0b1c3ae7.png)\r\n\r\nAll the pixels that I have displayed in red are empty and they shouldn't, and the offset is wrong.\r\n","comments":[],"labels":["module:renderer"]},{"title":"Suggestion: update third party webp library to v0.6.1","body":"- cocos2d-x version: v3.16\r\n\r\nThe webp library that cocos2d-x has been using is v0.5.0 and is outdated, please consider to support the latest version for sake of performance. Thank you.\r\n","comments":["@minggo I'm using webp for all my res, this update is really good.","Also, TP already updated to it:\r\n\r\n![screen shot](https:\/\/user-images.githubusercontent.com\/3391456\/37156045-9d39195c-22ed-11e8-942e-e137b81b0e1a.png)\r\n","Hello? The latest version of webp is 1.0.2 already","@minggo you closed the https:\/\/github.com\/cocos2d\/cocos2d-x\/milestone\/40 is this done? I can't seem to find the PR?\r\n\r\nThanks!","@vkreal i move the issue to next version."],"labels":["type:request","module:3rdParty"]},{"title":"tweenfunc::easeOut is incorrect","body":"Please study this: http:\/\/www.cnblogs.com\/cocos2d-x\/archive\/2012\/03\/15\/2398516.html\r\n\r\nAs a mirror of easeIn, _**s(t) = t<sup>r<\/sup>**_, easeOut should not be **_s(t) = t<sup>1\/r<\/sup>_**.\r\nInstead it should be **_s(t) = 1 - (1 - t)<sup>r<\/sup>_**. This resultant behaviour is more realistic to the desired one.  \r\n\r\nThat say, the function `tweenfunc::easeOut` should be corrected as:\r\n```c++\r\nfloat easeOut(float time, float rate)\r\n{\r\n    return (1 - powf(1 - time, rate));\r\n}\r\n```\r\n\r\n","comments":["anyone?"],"labels":["unconfirmed"]},{"title":"Suggestions\/Requests for PhysicsBody ","body":"- cocos2d-x version: 3.16\r\n- devices test on: PC\r\n- developing environments\r\n   - VS version: VS Community 2013\r\n\r\n1. It would be nice if PhysicsBody had functions for getting minX\/maxX + minY\/maxY.\r\n2. Functions for checking how much force is being applied to the body (for when you want to make something break when something heavy is resting on top of it, for example).\r\n3. Functions for checking width\/height of body.\r\n4. Function for setting position?\r\n5. When drawing physics debug, if would be nice if the body colors where randomized, instead of just red - and thinner outlines maybe? (Sleeping\/resting bodies could get a slightly darker color.) \r\nOh, and a diagonal line from the body's center to one of its corners. It could be useful for when you make bodies expand outside the screen for example :)\r\n\r\n(I used to play with another physics library called Nape that I really enjoyed that had all of these features, check it out if you want http:\/\/napephys.com\/samples.html).\r\n\r\n","comments":[],"labels":["type:request"]},{"title":"Image can't move smoothly on win32 platform, it always slightly jitters when moving.","body":"- cocos2d-x version:3.15.1\r\n- devices test on:win32\r\n- developing environments\r\n   - VS version:VS2015\r\n\r\nSteps to Reproduce:\r\n\r\n1. Use the project cpp-empty-test. Then add the following image to the resource.\r\n\r\n[k3.zip](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/1685020\/k3.zip)\r\n\r\n\r\n2. We can use one of the following two situations to reproduce:\r\n    \u2460add code to HelloWorld::init()\r\n    ```\r\n    ...\r\n    \/\/ add the sprite as a child to this layer\r\n    this->addChild(sprite);\r\n\r\n    \/\/situation 1\r\n    auto s1 = Sprite::create(\"k3.png\");\r\n    this->addChild(s1);\r\n    s1->runAction(RepeatForever::create(Sequence::create(\r\n        MoveTo::create(5, Vec2(1000, 600)),\r\n        MoveTo::create(5, Vec2(0, 0)),\r\n        nullptr\r\n    )));\r\n\r\n    return true;\r\n    ```\r\n\r\n    \u2461add code to HelloWrold::init()\r\n\r\n    ```\r\n    ...\r\n    \/\/ add the sprite as a child to this layer\r\n    this->addChild(sprite);\r\n\r\n    \/\/situation 2\r\n    auto s1 = Sprite::create(\"k3.png\");\r\n    this->addChild(s1);\r\n    s1->setName(\"s1\");\r\n\r\n    this->scheduleUpdate();\r\n    \r\n    return true;\r\n    ```\r\n    add update function\r\n    ```\r\n    void HelloWorld::update(float delta)\r\n    {\r\n        static bool isPositive = true;\r\n        static float elapse = 0.0f;\r\n        const float TOTAL = 5.0f;\r\n        elapse += delta;\r\n\r\n        if (elapse > TOTAL)\r\n        {\r\n            isPositive = !isPositive;\r\n            elapse -= TOTAL;\r\n        }\r\n\r\n        auto s1 = this->getChildByName(\"s1\");\r\n        if (s1)\r\n        {\r\n            float rate = (isPositive ? elapse : (TOTAL - elapse)) \/ TOTAL;\r\n            s1->setPosition(1000 * rate, 600 * rate);\r\n        }\r\n    }\r\n    ```\r\n\r\nNo matter which way to move the image, there will be the problem of picture jitter on win32 platform.\r\nI test this with android, there's no problem on Android real machine.\r\nA few days ago, [I raised the relevant issues in the Chinese forum](http:\/\/forum.cocos.com\/t\/topic\/55701\/24), but did not solve it.\r\n\r\nThe problem confused me for a long time, hope someone to solve it.\r\n","comments":["Could you please pay attention to this issue? @minggo  Thanks!"],"labels":["module:renderer"]},{"title":"[BUG] PageView - scroll jumps glitch from the end","body":"- cocos2d-x version: latest commit from github\r\n- devices test on: Mac, iOS\r\n- developing environments\r\n   - Xcode version: 9.2\r\nSteps to Reproduce:\r\n\r\n1. Use this code for UIPageViewTest: \r\n```\r\n\/\/ Create the page view\r\n    Size pageViewSize(209.1, 70.0);\r\n    Size pageSize(26, 26);\r\n    \r\n    PageView* pageView = PageView::create();\r\n    pageView->setDirection(PageView::Direction::HORIZONTAL);\r\n    pageView->setContentSize(pageViewSize);        \r\n    pageView->setBounceEnabled(true);\r\n    Size backgroundSize = background->getContentSize();\r\n    pageView->setPosition((widgetSize - pageView->getContentSize()) \/ 2.0f);\r\n    pageView->setItemsMargin(35);\r\n    pageView->removeAllItems();\r\n    pageView->setGlobalZOrder(200);\r\n\r\n    for (int i = 1; i < 10; ++i)\r\n    {\r\n        Layout* layout = Layout::create();\r\n        layout->setContentSize(pageSize);\r\n        ImageView* imageView = ImageView::create(\"cocosui\/scrollviewbg.png\");\r\n        imageView->setScale9Enabled(true);\r\n        imageView->setContentSize(pageSize);\r\n        imageView->setPosition(Vec2(layout->getContentSize().width \/ 2.0f, layout->getContentSize().height \/ 2.0f));\r\n        layout->addChild(imageView);\r\n        Text* label = Text::create(StringUtils::format(\"page %d\",(i)), \"fonts\/Marker Felt.ttf\", 15);\r\n        label->setColor(Color3B(192, 192, 192));\r\n        label->setPosition(Vec2(layout->getContentSize().width \/ 2.0f, layout->getContentSize().height \/ 2.0f));\r\n        layout->addChild(label);\r\n        pageView->addPage(layout);\r\n    }\r\n    pageView->scrollToItem(4);\r\n```\r\n2. Scroll till the end of the list and it jumps! Somewhere in the middle of the list of items: \r\n\r\n![giphy](https:\/\/user-images.githubusercontent.com\/3391456\/34724754-b4e92042-f557-11e7-8a88-38be203f491e.gif)\r\n\r\n\r\n","comments":["@drelaptop maybe you can help and push it to fix :) ? \r\nFirst time I've reported about this here http:\/\/discuss.cocos2d-x.org\/t\/pageview-how-to-use\/40474\/28?u=kamikaze but no attention to this. ","got this bug, I will test it using the code you give. and look into it, make a feedback for you in days","You forget to say, to reproduce this bug we need to modify UIPageView.cpp, refer to the discuss page, modify like:\r\n```C++\r\nvoid PageView::remedyLayoutParameter(Widget *item)\r\n{\r\n    if(!isPreventResize){\r\n        item->setContentSize(this->getContentSize());\r\n    }\r\n    ListView::remedyLayoutParameter(item);\r\n}\r\n```\r\nI can't find the main logic wrong anywhere, not any difference when debug. see your discuss in detail, this bug is related to the size of `PageView `. so I tested different sizes, change the `pageViewSize` from `(209.1, 70.0)` to `(209, 70.0)`, `(209.3, 70.0)`, `(220, 70.0)`, even `(117.7, 70)`. Bug occurs only when `(209.1, 70.0)` and `(209.3, 70.0)` .\r\n\r\nsuggest you change another size such as `(209,70)` to use for now. @KAMIKAZEUA  I will keep focus on this issue. ","Actually I'm using `(210,70)` for one PageView and got not problems(however, not sure if it will work and all resolutions screen sizes, will it be not depends on this?).\r\n\r\nAnd yes, it depends on a size in this case, but something else too, like `ItemsMargin` I think.\r\nBut I have another PageView with with (`210, 120`) and it has this bug.. \r\n\r\nIsn't it feels like somewhere there `ListView` or `ScrollView` has an awkward code inside or really not tested well?(But anyway such this dependence is really bad.. code design of the component). \r\n\r\nI think these components should be rewritten from scratch.. ","yep, this dependence is really bad. I think the original design didn't consider this way that you prevent the resize and make more than one page item into one page.so it's works well at that time, but not works well after your custom.\r\n\r\nYou can find this bug and fix it for this feature you want. as for rewriting these components, AFAIK cocos2d-x team have no plan in recent months, might do it in the future.","@minggo any comments?","@drelaptop takes charge of UI now, after he is more familiar with UI system, he can do refactor.","And why if @drelaptop takes charge of UI now, he seemed to be offering me to fix this bug by myself? That UI system design is very bad by the way.. when using it I'm always struggle with something.. but no other options for now..  Anyway,  I reported this bug, now it's not possible to use PageView in games with this engine, this bug is a nightmare and I can\u2019t use page view at all, because if that. That\u2019s blocker for my game.  What is sad, that more I'm reporting bugs or problems like mostly on the forum - it's been ignored.","> You forget to say, to reproduce this bug we need to modify UIPageView.cpp, refer to the discuss page\r\n\r\n@drelaptop Actually I've tested this on cocos2d-x without making changes to it sources. I only changed UIPageViewTest code. ","@KAMIKAZEUA Can you please check this pull request #18650","@tiagomartines11 Thanks for sharing. It worked as well for one scroll in my game, but for other  pageView with different options - not ideally.\r\nI've same scroll as firstly provided code, but with added new size and time: \r\n\r\n```\r\nSize pageSize(17.5, 50);\r\n...\r\npageView->setScrollDuration(0.1);\r\n```\r\n\r\nProblem - from left side it's bounces fast like it should -  0.1ms, but from right side - it's very slow, like 0.5ms. Here is result:\r\n\r\n![giphy](https:\/\/user-images.githubusercontent.com\/3391456\/35167779-5ce8bd84-fd5f-11e7-9904-6e599b3f501c.gif)\r\n\r\nAnd in my actual game it's like even worse, like takes 1 sec for bounce from glue..\r\n","@drelaptop @tiagomartines11 any news :) as you see from right part scroll has wrong duration - it's very slow, but should be 0.1sec, like from left side. Specially in my game, for special size list it's even more.. looks very weird.. ","@drelaptop @minggo @slackmoehrle Is anyone checked this bug? It's still jumps and fix from this pull request only partially fixes this issue - time of bouncing is varying from left and right. As I pointed before in my previous posts. ","The engineering team will get to this when they can. Right now they are focused on 3.17 release. ","Release 3.17 with less number of bugs should be like a good idea, right? ","@KAMIKAZEUA please refrain from the rhetorical comments. It pollutes the issue. This bug will be fixed when it makes it into the engineering schedule.","Engineering using milestones, is this bug added into 3.17? ","Not to my knowledge.","@KAMIKAZEUA I know this is a urgent issue for you, and it should be fixed, all the bugs should be fixed, it's quite hard to fix so much in one version. I will try to solve it after recent works finished.","@drelaptop It's actually urgent for any game or programmer who's using scroll or page view. ","I bet that 1 year will pass and this error will not be fixed.\r\nIssue was created Jan 9, so it's almost 8 months already passed. \r\n\r\n@walzer @dabingnn @fusijie @linshun @pandamicro @zilongshanren \r\n\r\nDo you seriously think that with such a dynamics this engine will survive? It's already dead as I see and as well as many other see this and already leaved it. \r\n\r\nSo please accept that and just give an official info like - we no longer support this engine and bla bla bla. Don't lie to people.\r\n\r\n[I was banned on cocos2d-x forum](https:\/\/discuss.cocos2d-x.org\/u\/kamikaze\/summary) because I asked this, the same question and said the same thoughts. What a shame. I'm just telling the truth. ","@KAMIKAZEUA you were banned on our forums because you don't contribute productively. You spread FUD and don't stop when asked. \r\n\r\nPlease refrain from doing the same to our GitHub issues. This clouds the issue and makes it harder to sort out work to be done versus noise that causes confusion.\r\n\r\nOur engineering team prioritizes bugs and they will complete this work when it comes up, currently __v3.18__ (See above, please). We also welcome pull requests if you want to fix this yourself so your SpriteBuilder X product works better.","https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/18616#issuecomment-406580281\r\n\r\n\r\n\ud83c\udf81 Happy birthday `Bug`, **1 year old**. Sadly."],"labels":["module:ui"]},{"title":"orthographic camera and scroll view issue","body":"- cocos2d-x version: git version\r\n- devices test on: iphone6s plus\r\n\r\nif we set orthographic camera than scroll view is not shown on full screen. I don't understand but some issue with camera parameters. @drelaptop can you please have a look.\r\n\r\nCode is attached, please add cocos2d folder to it and compile.  \r\n\r\n[cameraandscrollviewissue.zip](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/1596444\/cameraandscrollviewissue.zip)\r\n","comments":["sorry for I didn't have a good knowledge on camera, this is a simple explain about camera [3d\/camera](http:\/\/cocos2d-x.org\/docs\/cocos2d-x\/en\/3d\/camera.html?h=camera), you can have a look. and I suggest you to discuss this on http:\/\/discuss.cocos2d-x.org\/ to get more info.","> if we set orthographic camera than scroll view is not shown on full screen\r\n\r\nI run the test with latest github codes, it seems there is not different using camera or not. But can not scroll it when using camera.","There is some serious issue to use orthographic camera and scroll view.\nPlease run my code and see the issue. If you want i can send screenshots as\nwell.\n\nOn Wed, 17 Jan 2018 at 13:29, minggo <notifications@github.com> wrote:\n\n> if we set orthographic camera than scroll view is not shown on full screen\n>\n> I run the test with latest github codes, it seems there is not different\n> using camera or not. But can not scroll it when using camera.\n>\n> \u2014\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/18600#issuecomment-358232347>,\n> or mute the thread\n> <https:\/\/github.com\/notifications\/unsubscribe-auth\/ACC8g_rVySyx31NhFMNBcGR3wqdBgIhAks5tLa9dgaJpZM4RQMSM>\n> .\n>\n-- \nBest Regards\nSohaib Hussain\n","Yep, i run the codes you provided.","I have also noticed that scrollview scrolling is very poor if we use camera\non it as in the code. It lags alot. Especially if scrollview contain heavy\nanimations e.g like spine instances.\n\nOn Wed, 17 Jan 2018 at 14:19, minggo <notifications@github.com> wrote:\n\n> Yep, i run the codes you provided.\n>\n> \u2014\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> <https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/18600#issuecomment-358244425>,\n> or mute the thread\n> <https:\/\/github.com\/notifications\/unsubscribe-auth\/ACC8g3TqlxJyXoE92X97SyHLVIj0Ds9Jks5tLbs2gaJpZM4RQMSM>\n> .\n>\n-- \nBest Regards\nSohaib Hussain\n"],"labels":["type:bug"]},{"title":"[cocos2d-x C++] UIEditBox - Android - set it to SENSTIVE mode, it still show autocompletion hints","body":"- cocos2d-x version: 3.16 (also tried latest EditBox code from Github)\r\n- devices test on: Galaxy Tab S3, Galaxy S5, iPad Air, iPad Pro, iPhone 6S\r\n- developing environments\r\n   - NDK version: 16\r\n   - Xcode version: 9.2\r\n   - VS version: -\r\n   - browser type and version: -\r\n\r\nThe UIEditBox on Android is giving us quite a headache at the moment. Some of them are\r\n\r\n- It often skips letters that the users enter, e.g. you enter 5 letters but it only shows 4\r\n- If you set it to SENSTIVE mode, it still show autocompletion hints\r\n- If you hold the backspace button on the keyboard, it will only delete one character and not delete word-wise or everything after holding for a while (like it does on Android).\r\n","comments":["this is some views\r\n1. didn't occur skips letter on `UIEditBoxTest` of `cpp-tests` project, when I tested on Galaxy S7 Edge, how often did it occur, 1% ,10% or others?\r\n2. I didn't understand the 2nd item, could you explain it more detail.\r\n3. tested 3rd issue on `UIEditBoxTest`, it will delete characters one by one when you hold backspace button.","Thank you, 1) and 3) was indeed partly our fault and the cpp-tests work perfectly. Sorry about this. We've been calling setText on the EditBox and on Android this does reset the cursor to the end. On iOS the cursor is not being reset to the end when doing this. So maybe it's also something that you might want to fix or copy the behaviour from iOS to Android.\r\n\r\nAbout 2) \r\n\r\nWe're doing this:\r\n\r\n```getEditBox()->setInputFlag(cocos2d::ui::EditBox::InputFlag::SENSITIVE);```\r\n\r\nThe code comments about SENSITIVE, say:\r\n\r\n```            \/**\r\n             * Indicates that the text entered is sensitive data that the\r\n             * implementation must never store into a dictionary or table for use\r\n             * in predictive, auto-completing, or other accelerated input schemes.\r\n             * A credit card number is an example of sensitive data.\r\n             *\/\r\n            SENSITIVE,\r\n```\r\n\r\nBut on our Samsung Galaxy S5 with the Samsung Standard Keyboard, we're getting autocompletion with these Edit boxes. That means that above the keyboard these three little word-suggestions show that you can tap on to autocomplete. I think, this shouldn't happen, right?\r\n  ","I review the EditBox code for the question 2, Cocos2dxEditBox.java:\r\n```java\r\n    public void setInputFlag(int inputFlag) {\r\n\r\n        switch (inputFlag) {\r\n            case kEditBoxInputFlagPassword:\r\n                this.mInputFlagConstraints = InputType.TYPE_CLASS_TEXT | InputType.TYPE_TEXT_VARIATION_PASSWORD;\r\n                this.setTypeface(Typeface.DEFAULT);\r\n                this.setTransformationMethod(new PasswordTransformationMethod());\r\n                break;\r\n            case kEditBoxInputFlagSensitive:\r\n                this.mInputFlagConstraints = InputType.TYPE_TEXT_FLAG_NO_SUGGESTIONS;\r\n                break;\r\n            case kEditBoxInputFlagInitialCapsWord:\r\n                this.mInputFlagConstraints = InputType.TYPE_TEXT_FLAG_CAP_WORDS;\r\n                break;\r\n            case kEditBoxInputFlagInitialCapsSentence:\r\n                this.mInputFlagConstraints = InputType.TYPE_TEXT_FLAG_CAP_SENTENCES;\r\n                break;\r\n            case kEditBoxInputFlagInitialCapsAllCharacters:\r\n                this.mInputFlagConstraints = InputType.TYPE_TEXT_FLAG_CAP_CHARACTERS;\r\n                break;\r\n            case kEditBoxInputFlagLowercaseAllCharacters:\r\n                this.mInputFlagConstraints = InputType.TYPE_CLASS_TEXT | InputType.TYPE_TEXT_VARIATION_NORMAL;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        this.setInputType(this.mInputFlagConstraints | this.mInputModeConstraints);\r\n    }\r\n```\r\nsearch Android Docs, the meaning of `TYPE_TEXT_FLAG_NO_SUGGESTIONS` is the same as `EditBox::InputFlag::SENSITIVE`, It's strange to occur that issue","@drelaptop Thanks for reviewing, that's very interesting. Do you also see the issue on your Samsung phone with Samsung keyboard even though ```TYPE_TEXT_FLAG_NO_SUGGESTIONS``` should be set?","I should do that, it's better to build a simple Android App only a EditBox on a Activity, and set the `InputType.TYPE_TEXT_FLAG_NO_SUGGESTIONS` to see the difference","@drelaptop Okay cool, let me know the results. I'm super curious what happens on your end :)"],"labels":["platform:android","module:ui"]},{"title":"Game stops music at opening - Android regression compare to cocos2d-x.3.14.1","body":"- cocos2d-x version: 3.16\r\n- devices test on: Android\/all\r\n- developing environments\r\n   - NDK version:  android-ndk-r14b \r\n   - Xcode version:\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n1. Play music on Android  device\r\n2. Run any cocos2d-x app \r\n\r\nBug:\r\ncocos2d-x app stops music at opening:\r\nThis regression compare to cocos2d-x.3.14.1\r\n\r\n\r\n\r\n","comments":["@dumganhar Is there any chance for some quick workaround?","Perhaps you should modify code in Cocos2dxActivity.java\r\n```java\r\n    @Override\r\n    protected void onResume() {\r\n    \tLog.d(TAG, \"onResume()\");\r\n        super.onResume();\r\n        AudioManager manager =\r\n            (AudioManager)this.getSystemService(Context.AUDIO_SERVICE);\r\n       if (!manager.isMusicActive()) {\r\n             Cocos2dxAudioFocusManager.registerAudioFocusListener(this);\r\n       }\r\n        this.hideVirtualButton();\r\n       \tresumeIfHasFocus();\r\n```","@dumganhar this solves the problem. ","@dumganhar, AhmetAbak this change should be done in cocos2dx code or game code?","@dumganhar could you also explain issue and how this change fix it? It is \"proper fix\" or some workaround?","@crazyhappygame i modified the Cocos2dxActivity class in cocos2dx library.","@AhmetAbak , good to know it works for you.\r\n\r\nI think most games will take the ownership of audio, so it's a specific requirement.\r\nProbably, we need to add a new interface for setting this.",">  could you also explain issue and how this change fix it? It is \"proper fix\" or some workaround?\r\n\r\nIt need to be tested. I think it's a fix not just a workaround.\r\nBut first of all, we need to define a new method for setting this.\r\nCould you guys test this patch and give me the feedback? Thanks.","@dumganhar \r\n[crash log](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/1477474\/com.sngict.sngsolitaire_issue_135_crash_5A0D2270019500016317E2E7A9E3E25D_4b3a8580ca8f11e79ca756847afe9799_0_v2.txt)\r\nI have a crash log related to Audio manager that surfaced with this version. \r\nThis may be one of the problems that should be solved with new AudioFocusManager.\r\n","@AhmetAbak  Thanks for your feedback. I'm checking this issue now.","@dumganhar did you have a chance to work on this issue? Is there chance to have fix in next release?","I personally just commented the call `Cocos2dxAudioFocusManager.registerAudioFocusListener(this)` and both calls to `Cocos2dxAudioFocusManager.unregisterAudioFocusListener(this)` in `Cocos2dxActivity.java`.\r\nI'll see if I have crash reports, the update is live."],"labels":["module:audio"]},{"title":"Gap between sound loop","body":"- cocos2d-x version: 3.16\r\n- devices test on: Nexus 6P\r\n- developing environments\r\n   - NDK version: r13b\r\n   - Xcode version: 9.0\r\n   - VS version: N\/A\r\n   - browser type and version: N\/A\r\n\r\nSteps to Reproduce:\r\n\r\nSo, in my app, I have a music playing in a loop. It's 26 seconds long. \r\n\r\nOn iOS I'm using caf file format and it works fine.\r\nOn Android, I tried using wav (2.3 MB) or ogg (217 KB). Tried different bitrates (ogg) and also mono\/stereo, but it doesn't really matter. \r\n\r\nUsing SimpleAudioEngine it only loops first few seconds - I've found there's a fixed limit of file size. I've also tried using playBackgroundMusic instead of playEffect.\r\nThen I switched to AudioEngine and there's a 0.3-0.5s gap between loop. \r\n\r\nThis gap is on Nexus 6P (android 8.0), but it's working fine on Samsung Galaxy J3 2016 (android 5.1.1). \r\n\r\nI've tried a different, shorter sound (5 seconds long), and on Nexus 6P it's looping without gaps.\r\n\r\nI need this song play gapless :)\r\n\r\nHere's the song in WAV:\r\n\r\nhttp:\/\/www94.zippyshare.com\/v\/2rCqA7GK\/file.html\r\n\r\nand in OGG:\r\n\r\nhttp:\/\/www56.zippyshare.com\/v\/H22xN5h7\/file.html","comments":["@mingoo can you take a look?","The gap is caused by `OpenSLES` internally, when the ogg file size is bigger than 128K, we use `UrlAudioPlayer` for playing audio. `UrlAudioPlayer` streams and mixes audios in system side \r\n which cost a lot. The implementation of `UrlAudioPlayer` is really simple, just some invocations of `OpenSLES` so I could confirm that it's the bug of Android.\r\n\r\nFor the further, we need to deprecate `UrlAudioPlayer` just use `PcmAudioPlayer` but before that we need to implement `streaming` for `PcmAudioPlayer` first.\r\n\r\nFor now, you could change the configuration of how to select `UrlAudioPlayer` or `PcmAudioPlayer` in AudioPlayerProvider.cpp.\r\n\r\n```c++\r\nstatic AudioFileIndicator __audioFileIndicator[] = {\r\n        {\"default\", 128000}, \/\/ If we could not handle the audio format, return default value, the position should be first.\r\n        {\".wav\",    1024000},\r\n        {\".ogg\",    128000}, \/\/ Changes these values bigger than your background music size to ensure only PcmAudioPlayer work for all audios.\r\n        {\".mp3\",    160000}\r\n};\r\n```\r\nChanging configuration will make the `preload` waste more time, therefore it's better to preload background music in the `loading` scene. And you have to listen the preload callback while loading.  Since AudioEngine::preload is asynchronous, you need to add a callback for listen preload finish event.\r\n\r\n```c++\r\nAudioEngine::preload(\"a.mp3\", [](){\r\n   \/\/ a.mp3 has been finished.\r\n});\r\n```\r\n","So, in other words, it works like that:\r\n\r\n1) when file is smaller than limit it's loading a whole file\r\n2) limit is needed because the whole file is loaded and it can cause memory problems and\/or long loading on bigger files. Instead, it should use streaming, but it's not implemented yet.\r\n3) as a workaround, it's using UrlAudioPlayer for bigger files, but it has its downsides such as audio won't loop without gaps.\r\n\r\nNow I understand why AudioEngine is still experimental. It needs more work, I guess :) \r\n\r\nAfter changing the limit to 512k it works flawlessly. \r\n\r\nI have to say this: audio on Android is hell :d\r\n\r\nI'd like to help implementing streaming, but I don't know where to start. Also, probably it's not just Android, but other platforms too.","Other platforms like `macOS`, `iOS`, `win32` which are using `OpenAL` for the backend of AudioEngine is support streaming.\r\nStreaming is needed to be implemented for Android only.\r\nBasically, we need to implement a `partial audio decoder` rather that `whole file decoder`.\r\n`tremolo` which is used for decoding `ogg` files and `pvmp3dec` for decoding `mp3` files should support partial decoding since `Android` uses them internally.\r\nBut `AudioDecoderSLES.cpp` which is used for decoding audios exclude `ogg, mp3, wav`,  is hard to implement `partial decoding`. AudioDecoderSLES uses `OpenSLES` API for decoding. I have no idea how to make that work. Perhaps, we could only support `ogg, mp3, wav` for Android and remove `AudioDecoderSLES`.\r\n","Seems hard, I don't think I have enough knowledge about audio to do this :( But this needs to be fixed. Why audio on Android has so many problems :( ?","Having the very same problem here","after reading this:\r\nhttps:\/\/issuetracker.google.com\/issues\/36931073\r\n\r\nI concluded there is nothing that can be done but a workaround\r\nThen I applied this:\r\nhttp:\/\/discuss.cocos2d-x.org\/t\/background-music-loop-on-android\/22519\/4\r\n\r\nAnd now everything works fine!\r\n","@dumganhar I think you can use OpenAL + mpg123 & ogg at android platform. ","I have used the \"two players\" workaround for years now. After so much time, I think this could be an acceptable solution. The solution described on the forum topic above generates some issues. I solved them with this following final implementation on my Cocos2dxMusic.java:\r\n\r\n```\r\nprivate void createNextMediaPlayer (final String path) throws IllegalStateException {\r\n        new Thread(new Runnable() {\r\n            @Override\r\n            public void run() {\r\n                try {\r\n                    mBackgroundMediaPlayer2 = createMediaPlayer(path);\r\n                    mBackgroundMediaPlayer.setNextMediaPlayer(mBackgroundMediaPlayer2);\r\n                    mBackgroundMediaPlayer.setOnCompletionListener(onCompletionListener);\r\n                }\r\n                catch (IllegalStateException e) {\r\n                }\r\n            }\r\n        }).start();\r\n    }\r\n    private MediaPlayer.OnCompletionListener onCompletionListener = new MediaPlayer.OnCompletionListener () {\r\n        @Override\r\n        public void onCompletion(MediaPlayer mediaPlayer) {\r\n            mediaPlayer.release();\r\n            if(mBackgroundMediaPlayer2 == null){\r\n                mBackgroundMediaPlayer2 = createMediaPlayer (mCurrentPath);\r\n            }\r\n            if(mBackgroundMediaPlayer2 != null) {\r\n                mBackgroundMediaPlayer.release();\r\n                mBackgroundMediaPlayer = mBackgroundMediaPlayer2;\r\n                try {\r\n                    createNextMediaPlayer(mCurrentPath);\r\n                } catch (IllegalStateException e) {\r\n                }\r\n            }\r\n        }\r\n    };\r\n```","I'm using OpenAL on android and it seems work fine. And I use streaming method in playback to get gapless loop. My repo is [here](https:\/\/github.com\/Xrysnow\/lstgx_Audio), hope can help someone.","Well, OpenAL is a good backend, we also use it for all platforns.","@Xrysnow \r\n@halx99 \r\nHow it affect application size?","@minggo \r\nThe libopenal.so file I compiled is about 450KB, much smaller than cocos (about 18MB). So I think it won't affect much.","@Xrysnow thanks for the information. And how about the compatibility in different Android devices?","Hi, our game is published at tencent platform: https:\/\/hongjing.qq.com\r\nand so far, it seems it is very stable. may be, my repo is easy to merge to the official engine, if you have any plan, you can see:\r\nhttps:\/\/github.com\/halx99\/x-studio365\/tree\/master\/cocos2d-x-patch"],"labels":["type:bug","platform:android","module:audio"]},{"title":"All effects will be canceled if play many effects at the same time and turn to background on iOS","body":"- cocos2d-x version: 3.6\r\n- devices test on: iPhone5s(10.2.1)   iPhone 6S(10.3.3)\r\n- Xcode version: 8.3\r\n\r\n1. play many effects at the same time\r\n2. click HOME to make app into background\r\n3. make app to foreground\r\n4. all effects will lost even invoke codes to resume effects\r\n\r\nUse `SimpleAudioEngine`.","comments":[],"labels":["platform:ios"]},{"title":"Support to play wav audio on Win32","body":"","comments":["\u5565\u65f6\u5019\u52a0\u554a","@qcdong2016 \u6700\u8fd1\u91cd\u6784\u4e86\u4e00\u4e0b\u58f0\u97f3\u6a21\u5757\uff0cwin32\u652f\u6301\u64ad\u653ewav\u683c\u5f0f\u58f0\u97f3\u4e86\uff0c\u770b\u8fd9\u91cc: https:\/\/github.com\/halx99\/x-studio365\/tree\/master\/cocos2d-x-patch","\u611f\u8c22\u611f\u8c22\u3002"],"labels":["platform:win32"]},{"title":"[iOS] Uses Asset Catalog for setting icon","body":"Could refer to :\r\nhttps:\/\/developer.apple.com\/ios\/human-interface-guidelines\/icons-and-images\/app-icon\/\r\nhttps:\/\/developer.apple.com\/library\/content\/qa\/qa1686\/_index.html","comments":["I don't think we should use asset catalog, as [discussed here](http:\/\/discuss.cocos2d-x.org\/t\/iphone-x-slow-transitions-xcode-bug-and-not-full-screen-solved\/38942)."],"labels":["platform:ios"]},{"title":"cocos2d::experimental::PcmAudioPlayer::prepare crash","body":"- cocos2d-x version:3.15.1\r\n- devices test on: multiple devices\r\n- developing environments\r\n   - NDK version: r13b\r\n\r\nGetting following crash on several android devices. Log is from crashlytics dashboard.\r\n\r\n`Crashed: lots.wolf.magic|\r\n0  libcocos2dcpp.so                                        0xa442b66a cocos2d::experimental::PcmAudioPlayer::prepare(std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > const&, cocos2d::experimental::PcmData const&)::{lambda(cocos2d::experimental::Track::State)#1}::operator()(cocos2d::experimental::Track::State) const::{lambda()#1}::operator()() const (functional:1756)\r\n1  libcocos2dcpp.so                                        0xa44f60fc cocos2d::Scheduler::update(float) (functional:1756)\r\n2  libcocos2dcpp.so                                        0xa44e5354 cocos2d::Director::drawScene() (CCDirector.cpp:295)\r\n3  libcocos2dcpp.so                                        0xa44e5394 cocos2d::Director::mainLoop() (CCDirector.cpp:1486)\r\n`","comments":["did you play .ogg file?","@Sevellion  yes. I am playing .ogg files.","Try to replace the audio module in v3.16 branch and test again.\r\nWe have fixed some audio issues in v3.16 branch.","I have the same problem using mp3 (I am using the latest 3.16 branch):\r\n\r\n#00 pc 000000000001d714  \/system\/lib64\/libc.so (abort+120)\r\n#01 pc 000000000008ce88  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libclang_rt.asan-aarch64-android.so (__sanitizer::Abort()+60)\r\n#02 pc 0000000000092d40  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libclang_rt.asan-aarch64-android.so (__sanitizer::Die()+152)\r\n#03 pc 0000000000079b84  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libclang_rt.asan-aarch64-android.so (__asan::ScopedInErrorReport::~ScopedInErrorReport()+332)\r\n#04 pc 000000000007abb8  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libclang_rt.asan-aarch64-android.so (__asan::ReportGenericError(unsigned long, unsigned long, unsigned long, unsigned long, bool, unsigned long, unsigned int, bool)+312)\r\n#05 pc 000000000007b6d8  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libclang_rt.asan-aarch64-android.so (__asan_report_load8+64)\r\n#06 pc 00000000050d5a0c  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libXXX.so (_ZZZN7cocos2d12experimental14PcmAudioPlayer7prepareERKNSt6__ndk112basic_stringIcNS2_11char_traitsIcEENS2_9allocatorIcEEEERKNS0_7PcmDataEENK3$_0clENS0_5Track5StateEENKUlvE_clEv+548)\r\n#07 pc 00000000050d9e64  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libXXX.so (_ZNSt6__ndk128__invoke_void_return_wrapperIvE6__callIJRZZN7cocos2d12experimental14PcmAudioPlayer7prepareERKNS_12basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEERKNS4_7PcmDataEENK3$_0clENS4_5Track5StateEEUlvE_EEEvDpOT_+44)\r\n#08 pc 00000000050d9be4  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libXXX.so (_ZNSt6__ndk110__function6__funcIZZN7cocos2d12experimental14PcmAudioPlayer7prepareERKNS_12basic_stringIcNS_11char_traitsIcEENS_9allocatorIcEEEERKNS3_7PcmDataEENK3$_0clENS3_5Track5StateEEUlvE_NS8_ISJ_EEFvvEEclEv+36)\r\n#09 pc 00000000011bd710  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libXXX.so (std::__ndk1::function<void ()>::operator()() const+324)\r\n#10 pc 0000000004ef6698  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libXXX.so (cocos2d::Scheduler::update(float)+7792)\r\n#11 pc 0000000004dbbdfc  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libXXX.so (cocos2d::Director::drawScene()+620)\r\n#12 pc 0000000004dca6a8  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libXXX.so (cocos2d::Director::mainLoop()+520)\r\n#13 pc 00000000045caf4c  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libXXX.so (Java_org_cocos2dx_lib_Cocos2dxRenderer_nativeRender+20)\r\n#14 pc 000000000001dc30  \/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/oat\/arm64\/base.odex (offset 0x1b000)\r\n03-02 17:27:48.643 278-278\/? E\/\/system\/bin\/tombstoned: Tombstone written to: \/data\/tombstones\/tombstone_09\r\n\r\n\r\nI am using android sanitizer, and the crash is due to a:\r\n\r\n03-02 17:27:40.261 20953-20953\/? I\/wrap.sh: SUMMARY: AddressSanitizer: heap-use-after-free (\/data\/app\/com.XXX.YYY-LTSl0qb0PS1Xonhwu7L1Uw==\/lib\/arm64\/libXXX.so+0x50d5a0f) \r\n"],"labels":["module:audio"]},{"title":"cc.view.resizeWithBrowserSize didn't work!","body":"- cocos2d-x version: 3.15.1\r\n- devices test on: web browser (safari, chrome)\r\n- developing environments\r\n   - NDK version: 12b\r\n   - Xcode version: 8.3.3\r\n   - VS version: -\r\n   - browser type and version: safari (10.1.2), chrome (60.0.3112.101)\r\n\r\nSteps to Reproduce:\r\n\r\n1. create a javascript sample project.\r\n2. simple run 'cocos run -p web' and check it.\r\n\r\n![resize_screenshot](https:\/\/user-images.githubusercontent.com\/6712589\/29406540-5819d462-837c-11e7-9dd2-8c415c05af58.png)\r\n","comments":["In your project path  \"frameworks\/cocos2d-html5\/cocos2d\/core\/platform\/\", edit file \"CCEGLView.js\" in 128 line , change \"_orientationChanging: true\" to \"_orientationChanging: false\", then it work.","@udzhou Thanks! Great solution. it works!!!"],"labels":["platform:web"]},{"title":"HIGH energy consumption and GPU load on empty cocos2d-x starter project for iPhone6\/6+. Probably more models affected.","body":"**Test Specs:**\r\n- cocos2d-x version: 3.15.1\r\n- devices test on: iphone 6, iphone6+\r\n- developing environments\r\n   - Xcode version:8.3.3 (8E3004b) but probably any version will have the same results.\r\n   - iOS 10.x\r\n\r\n**Steps to Reproduce:**\r\n1. Download the latest Cocos2d-x v3.15.1\r\n2. Run the cpp-empty-test iOS on iPhone 6 or iPhone 6+.\r\n3. It should be at running at 60fps with 72 GL vests, 3 GL calls\r\n![19688534_10154865388471872_951622678_o](https:\/\/user-images.githubusercontent.com\/8600099\/27770130-d348663a-5f41-11e7-8607-82fefaaa31eb.jpg)\r\n\r\n4. Checking energy consumption using xCode. You will notice around 15% CPU (not an issue), that GPU is being used and a report for high energy consumption. \r\n![iphone high energy](https:\/\/user-images.githubusercontent.com\/8600099\/27770118-a3be3b06-5f41-11e7-8acc-efb84d9c81e5.png)\r\n\r\n5. Repeat the test on iPad 3 or iPad mini. The energy consumption should be low and GPU is not being used. \r\n![ipad low energy](https:\/\/user-images.githubusercontent.com\/8600099\/27770120-a7a0c126-5f41-11e7-9256-3253975de96a.png)\r\n\r\nUsers have reported that phones are heating up while playing games powered by Cocos2d-x.\r\n\r\n\r\n\r\n\r\n\r\n","comments":["Any news with the issue?","Hi @gestern . We noticed a post you made in the past regarding a similar issue. And we remember that nobody replied. :) Yes, we have some more info. We created a new cocos2d-x empty project and we noticed  low energy consumption on the above devices. After some comparison between an new cocos2d-x project and cpp-empty-test iOS, the difference was the surface size of the phone. In new project, the phone is using the provided launch images and a much lower resolution instead of the phones native resolution.  On cpp-empty-test iOS and in our project, cocos2d-x has a surface size of the native resolution of the phone which is much higher. The only way to force a lower resolution is to not specific launch images for iphone 6 and 6+ which in our case is not an option, so we have yet to find a solution. What we want is to provide the launch images but use a lower surface resolution with scaling. The way we provide launch images is through a storyboard launch screen where we use 1 image and center it on all devices. \r\n\r\nNo help from coco2d-x team. We are a bit disappointed. It seems that cocos2d-x cant handle high resolution which is sad. Except if the cause is something else. At least we have gathered a lot of info so that someone more expert in the matter can have a look.","Oh, i haven't noticed it. It seems it is a tricky issue since all the codes are the same.","@minggo - Is there any way to change cocos2d-x surface size? Even if device has a bigger surface size. Let's say force it \/2 so there are 50% less pixels to render on screen. ","currently, retina is enabled by default, you may [disable it](https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/v3\/cocos\/platform\/ios\/CCEAGLView-ios.mm#L151) but it may cause problem. ","@minggo  This problem is very serious,our game have 1500w downloads\uff0cMany users report that power consumption is serious,We will never use cocos2d-x again","We managed to solve partially the issue by modyfing internally cocos2d-x. A static boolean variable controls cocos main draw function and is set as false by default. It is set to true only if some label, sprite, node etc must be drawn. e.g. to achieve this for a sprite we set variable to true if its position, opacity, color etc change in the respective setter functions. It\u2019s a big change as many functions in many classes must be modified. However, this solution works if u have states in ur application with 0 animation. If you have ongoing animation, this solution is useless to you. ","This is serious. It may even lead to a ban of cocos2d-x games by apple.","@kkafas can you share what you modified so I can take a look?  And did you test with 3.16 or the latest from `master` and is utilization less now from your screenshots above?","@kyriakos89 Do you have any idea how to change cocos2d-x surface size now? After cocos2d-x use Storyboard as launch screen #18276 to compatible with iPhoneX, we face the same problem with you. It's a very serious problem and we will lost many users because of it.\r\n\r\n@minggo @dumganhar Can anybody help us?\r\n\r\n","@koalli \r\nDespite the fact that your question does not concern the performance problem in cocos2d-x that is discussed here. I'll try to suggest a workaround with your problem with iPhoneX, so you have to stop using storyboard with loading screen and start using static way with [Static Launch Screen](https:\/\/developer.apple.com\/ios\/human-interface-guidelines\/icons-and-images\/launch-screen\/). This approach will deprive you of most bugs with dynamic orientation (for example the call `applicationScreenSizeChanged()` is absolutely useless if you using dynamic way with storyboard ) that were never described here. So, try to use \"Static Launch Screen\" which linked above, and avoid using stroyboards way while you support iPhoneX","> @kkafas can you share what you modified so I can take a look? And did you test with 3.16 or the latest from `master` and is utilization less now from your screenshots above?\r\n\r\nI've just tested with 3.17 and the problem still persists. This is very serious\r\n\r\n@drelaptop was there any progress in finding\/fixing this issue?","Yep, the energy is high, it clears frame buffer many times which is not needed. I sent a PR to fix it https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/19131.\r\n\r\nYou can see that the energy of `cpp-empty-test` is still high. It is because:\r\n\r\n* the FPS is 60\r\n* it draws a full screen sprite\r\n* it draws fps info in bottom left\r\n* it draws a safe range area\r\n* it draw a button in upper right\r\n\r\nIf you change to 30 FPS and don't draw the full screen sprite, then the energy will be slow.","In theory, if the content of a scene is static(not changed), then should not redraw. As cocos2d-x doesn't consider it at first, so can not implement it easily.","\"In theory, if the content of a scene is static(not changed), then should not redraw. \"-> This is true. Our solution is not drawing the scene unless there is a change. However, our game has long static screens while user is not interacting. If you have continuous drawing, this solution is useless. Only dropping FPS might help. \r\n\r\nIn case you are interested about this solution i can provide some guidance but not the whole solution as it is now part of commercial product. Be warned, this solution is very huge and involves changes almost every cocos2d-x class.\r\n\r\n1. In void Director::drawScene(), it should draw only when our custom flag is set to true. Initially its set to true. After every draw, it is set back to false. it will get true again, only when something will change position, color, scale etc.\r\n\r\n\r\nconst bool drawThisFrame = _runningScene ? _CustomWasUpdatedForDraw( _runningScene ) : true;\r\nif( drawThisFrame ) {\r\n    _renderer->clear();\r\n......\r\n\r\n\r\n2. _CustomWasUpdatedForDraw\r\n\r\nbool _CustomWasUpdatedForDraw( Node * parent ) {\r\n    if( !parent->isVisible() ) {\r\n        return false;\r\n    }\r\n    bool res = false;\r\n    if( parent->_CustomWasUpdatedForDraw ) {\r\n        parent->_CustomWasUpdatedForDraw = false;\r\n        res = true;\r\n    }\r\n    for( auto& child : parent->getChildren() ) {\r\n        if( _CustomWasUpdatedForDraw( child ) ) {\r\n            res = true;\r\n        }\r\n    }\r\n    return res;\r\n}\r\n\r\n\r\n3.  For every class\/object that is rendered on screen, you need to identify all cases that this item is updated and set this value to true. Examples of updates are position, scale, rotation, color, opacity etc. Since cocos2d-x uses very well inheritance, cocos2d-x team might find a better solution than ours.  Example in Label.cpp:\r\n\r\n void Label::updateColor()\r\n{\r\n    if (_batchNodes.empty())\r\n    {\r\n        return;\r\n    }\r\n\r\nColor4B color4( _displayedColor.r, _displayedColor.g, _displayedColor.b, _displayedOpacity );\r\n\r\n  ........\r\n   _CustomWasUpdatedForDraw = true;\r\n}\r\n\r\n\r\nBut as I said earlier, this will work in 1% of cases and will not help the majority of games except in scenes like a pause scene where no animation is done or if your game is liek a board game where nothing moves if user doesn't interact. Who all this info will help new ideas on the table. \r\n   \r\n\r\n\r\n    ","As @gestern [said](https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/18020#issuecomment-377965377) , I use a lower resolution LaunchImage instead of LaunchStoryboard, it can reduce the energy consumption in iPhone 6\/7\/8 plus obviously, this is a iOS screen compatibility mode since iPhone5 or iPhone6 I guess, it will create a smaller surface size. But we still cannot solve it in iPhone X because it will show black safe area in this mode.\r\n\r\nIn my test case, I found lower surface size also used lower energy. @kyriakos89 [mention](https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/18020#issuecomment-313729666) that changing surface size may reduce energy consumption, but disable retina is not a good solution. Maybe we can try to detect iPhoneX device and hardcode a lower contentScaleFactor in this [code](https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/v3\/cocos\/platform\/ios\/CCEAGLView-ios.mm#L151). But I have not idea what problem it will cause according to @minggo [said](https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/18020#issuecomment-315651545), do you guys have any idea ?","will cocos2d-x provide a fix to this my energyconsumption also just keeps going up , is at very high rightnow","would anyone recommend releasing my game or wait until this issue is fixed ?","I would say yeah try releasing it. \r\n\r\nAre you running the release build when testing? If not, do so.\r\nWhat energy impact are you seeing on your own game? Make sure release build.\r\nAre you able to play your game at 30fps? If so try changing the interval to 1\/30 instead of 1\/60. Half Energy :D (not actually, might be more or less).\r\n\r\nYou could also render at 60fps, but more manually manage your scheduled updates and animations\/actions. Have your scene or root node schedule frame-based update, but then track elapsed time or frames and only call game play update functionality every .1s or every 3 frames or similar.\r\n\r\nThere are ways to render to a smaller framebuffer and then blit that framebuffer into a fullscreen quad with the simplest shader. Any non-simplest shaders will run on 1\/4th the pixels if you render to a 1\/2 screen width 1\/2 screen height framebuffer, for example.\r\nhttps:\/\/discuss.cocos2d-x.org\/t\/big-window-small-framebuffer\/23711","> I would say yeah try releasing it.\r\n> \r\n> Are you running the release build when testing? If not, do so.\r\n> What energy impact are you seeing on your own game? Make sure release build.\r\n> Are you able to play your game at 30fps? If so try changing the interval to 1\/30 instead of 1\/60. Half Energy :D (not actually, might be more or less).\r\n> \r\n> You could also render at 60fps, but more manually manage your scheduled updates and animations\/actions. Have your scene or root node schedule frame-based update, but then track elapsed time or frames and only call game play update functionality every .1s or every 3 frames or similar.\r\n> \r\n> There are ways to render to a smaller framebuffer and then blit that framebuffer into a fullscreen quad with the simplest shader. Any non-simplest shaders will run on 1\/4th the pixels if you render to a 1\/2 screen width 1\/2 screen height framebuffer, for example.\r\n> https:\/\/discuss.cocos2d-x.org\/t\/big-window-small-framebuffer\/23711\r\n\r\nIn fact, I have done this in my project.\r\nIt really can reduce energy consumption. But if you look closely, you will find that the pictures are not clear enough, especially the labels.\r\nSo I added a quality option for the players. The default selection is non-HD.\r\nI think cocos2d-x' s developers should provide an API in the engine that can dynamically change the resolution.","Curious what the resolution you're rendering at is and what the native resolution is of the device that's slow. Also, you could consider rendering labels at full resolution, especially if they're all in the UI layer allowing you to render them separately.\r\n\r\nThis has been common practice throughout video game history where games offer both resolution and quality settings. Players can start at max or medium and bump up\/down as needed to hit certain frame rate (or in this case energy usage).\r\n\r\nYou could also offer 60 fps \/ 30 fps option, unless your game requires 60 for gameplay?"],"labels":["critical"]},{"title":"[android] Dead lock in wilhelm (OpenSLES) while destroying OpenSLES object right after it was initialized","body":"- cocos2d-x version: v3.15.1\r\n- devices test on: Android 7.0\r\n- developing environments\r\n   - NDK version: r10e\r\n   - Xcode version:\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n```c++\r\n    schedule([](float dt){\r\n        for (int i = 0; i < 20; ++i) {\r\n            AudioEngine::play2d(\"fonts\/audio_music_004.mp3\");\r\n            std::this_thread::sleep_for(std::chrono::milliseconds(5));\r\n            AudioEngine::stopAll();\r\n        }\r\n    }, \"bbbb\");\r\n```\r\n\r\nResult:\r\n```\r\n06-28 15:38:30.240 6674-6707\/org.cocos2dx.cpp_empty_test V\/UrlAudioPlayer: Current UrlAudioPlayer instance count: 1\r\n06-28 15:38:30.240 6674-6707\/org.cocos2dx.cpp_empty_test V\/UrlAudioPlayer: UrlAudioPlayer::prepare: assets\/fonts\/audio_music_004.mp3, SL_DATALOCATOR_ANDROIDFD, 52, 468084, 1454144\r\n06-28 15:38:30.251 6674-6707\/org.cocos2dx.cpp_empty_test V\/UrlAudioPlayer: UrlAudioPlayer::stop (0xe36c9020, 9746)\r\n06-28 15:38:30.251 6674-6707\/org.cocos2dx.cpp_empty_test V\/AudioEngineImpl: Removing player id=9746, state:4\r\n06-28 15:38:30.251 6674-6707\/org.cocos2dx.cpp_empty_test V\/UrlAudioPlayer: UrlAudioPlayer::destroy() 0xe36c9020\r\n06-28 15:38:30.263 6674-7250\/org.cocos2dx.cpp_empty_test E\/libOpenSLES: frameworks\/wilhelm\/src\/android\/AudioPlayer_to_android.cpp:785: pthread_mutex_lock_timeout_np returned 110\r\n06-28 15:38:30.283 6674-7250\/org.cocos2dx.cpp_empty_test E\/libOpenSLES: frameworks\/wilhelm\/src\/android\/AudioPlayer_to_android.cpp:785: pthread_mutex_lock_timeout_np returned 110\r\n06-28 15:38:30.313 6674-7250\/org.cocos2dx.cpp_empty_test E\/libOpenSLES: frameworks\/wilhelm\/src\/android\/AudioPlayer_to_android.cpp:785: pthread_mutex_lock_timeout_np returned 110\r\n06-28 15:38:30.354 6674-7250\/org.cocos2dx.cpp_empty_test E\/libOpenSLES: frameworks\/wilhelm\/src\/android\/AudioPlayer_to_android.cpp:785: pthread_mutex_lock_timeout_np returned 110\r\n06-28 15:38:30.404 6674-7250\/org.cocos2dx.cpp_empty_test E\/libOpenSLES: frameworks\/wilhelm\/src\/android\/AudioPlayer_to_android.cpp:785: pthread_mutex_lock_timeout_np returned 110\r\n06-28 15:38:30.504 6674-7250\/org.cocos2dx.cpp_empty_test E\/libOpenSLES: frameworks\/wilhelm\/src\/android\/AudioPlayer_to_android.cpp:785: pthread_mutex_lock_timeout_np returned 110\r\n06-28 15:38:30.505 6674-7250\/org.cocos2dx.cpp_empty_test W\/libOpenSLES: frameworks\/wilhelm\/src\/android\/AudioPlayer_to_android.cpp:785: pthread 0xd2561920 (tid 7250) sees object 0xe320a800 was locked by pthread 0xe8a7f920 (tid 6707) at frameworks\/wilhelm\/src\/itf\/IObject.c:411\r\n\r\n```\r\nIt's a bug of Android System.\r\nPlease also refer to \r\nhttp:\/\/grokbase.com\/t\/gg\/android-ndk\/156tayqf1c\/opensl-deadlock-issue\r\nhttp:\/\/webmail.dev411.com\/p\/gg\/android-ndk\/154fhnm2ce\/why-does-opensl-destroy-function-block-forever-on-some-devices\r\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/12479\r\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/11762\r\n\r\n","comments":["Will this bug fixed at 3.17 version?","confirm bug on cocos2d-x version 3.16 too","This bug will still on 3.17.1. I use schedule function delay play sound. Temporarily circumvented this problem. \r\n\r\n```\r\n    node->scheduleOnce([=](float time){\r\n        AudioEngine::play2d(filePath);\r\n    }, 0.01, \"play_sound\");\r\n```\r\n","I still face problems after putting delay.\r\nAnyone has the solution?\r\n","I also found the same problem.. How can I not solve this? It's a problem because the game freezes. It's a really big problem.","\u64ad\u653e\u7684\u65f6\u5019\u4f1a\u8fd4\u56de\u4e00\u4e2aId,\u8bb0\u5f55\u4e0b\u8fd9\u4e2aid\u5f00\u59cb\u64ad\u653e\u7684\u65f6\u95f4,\u9500\u6bc1\u7684\u65f6\u5019\u5224\u65ad\u4e00\u4e0b\u8fd9\u4e2a\u65f6\u95f4\u662f\u5426\u8d85\u8fc7\u6bd4\u59820.5\u79d2,\u5982\u679c\u8d85\u8fc7\u5219\u9500\u6bc1\uff0c\u5426\u5219\u5ef6\u8fdf\u52300.5\u79d2\u540e\u518d\u9500\u6bc1\u5c31\u53ef\u4ee5\u4e86"],"labels":["platform:android","module:audio"]},{"title":"Android RenderTexture lost when switch to background!","body":"- cocos2d-x version: 3.5\r\n- devices test on: Xiaomi Huawei\r\n- developing environments\r\n   - NDK version: r13b\r\n   - Xcode version:\r\n   - VS version: \r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n1.\r\n \u5b89\u5353\u5feb\u901f\u5207\u524d\u540e\u53f0 RenderTexture\u7684\u7eb9\u7406\u4e22\u5931\u600e\u4e48\u89e3\u51b3\uff08\u53ea\u8981\u5f53\u524d\u573a\u666f\u91cc\u6709\u4e00\u4e2arenderTexture\uff0c\u8dd1\u4e0b\u9762\u7684\u547d\u4ee4\u5c31\u4f1a\u590d\u73b0\u3002\u3002\u6211\u8bd5\u4e86\u534e\u4e3a\u5c0f\u7c73\u90fd\u8fd9\u8fd9\u6837\u3002\u3002\u3002\uff09\r\n\r\n2.\r\nadb shell input keyevent 3\r\nadb shell am start -n com.xxx.xxx.xxx\/org.cocos2dx.lua.AppActivity    (xxx\u662f\u5305\u540d)\r\n \r\n","comments":["Can the RenderTextureTest in cpp-tests reproduce the issue?"],"labels":["platform:android"]},{"title":"[Request] Support for Tiled 1.0","body":"- cocos2d-x version: v3.15\r\n\r\nSteps to Reproduce:\r\n\r\n1. Create a new project and create a new Tiled map file `.tmx` using [Tiled v1.0](http:\/\/www.mapeditor.org\/2017\/05\/24\/tiled-1-0-0-released.html) which was recently released.\r\n\r\n2. Add one of the following to `HelloWorld::init`\r\n\r\n```cpp\r\nauto map = experimental::TMXTiledMap::create(\"test.tmx\");\r\n```\r\nOR\r\n```cpp\r\nauto map = TMXTiledMap::create(\"test.tmx\");\r\n```\r\n\r\n3. Run the project and it will crash giving you the following error:\r\n```\r\ncocos2d: TMXFormat: Unsupported TMX version: 1.0.0\r\n```\r\n\r\nEven after removing the [code block that parses the version](https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/v3\/cocos\/2d\/CCTMXXMLParser.cpp#L235-L238) to force load the map, the game will crash with a segmentation fault in Linux. Here's the relevant excerpt from `valgrind`:\r\n\r\n```\r\n==8709== Process terminating with default action of signal 11 (SIGSEGV): dumping core\r\n==8709==  Access not within mapped region at address 0xFFFFFFFFFFFFFFF8\r\n==8709==    at 0xA27052: cocos2d::Vector<cocos2d::TMXTilesetInfo*>::back() const (CCVector.h:283)\r\n==8709==    by 0xA22CA4: cocos2d::TMXMapInfo::startElement(void*, char const*, char const**) (CCTMXXMLParser.cpp:423)\r\n==8709==    by 0xA2CF7D: cocos2d::SAXParser::startElement(void*, unsigned char const*, unsigned char const**) (CCSAXParser.cpp:179)\r\n==8709==    by 0xA2CB99: cocos2d::XmlSaxHander::VisitEnter(tinyxml2::XMLElement const&, tinyxml2::XMLAttribute const*) (CCSAXParser.cpp:72)\r\n==8709==    by 0xC8858E: tinyxml2::XMLElement::Accept(tinyxml2::XMLVisitor*) const (tinyxml2.cpp:1479)\r\n==8709==    by 0xC885C7: tinyxml2::XMLElement::Accept(tinyxml2::XMLVisitor*) const (tinyxml2.cpp:1481)\r\n==8709==    by 0xC885C7: tinyxml2::XMLElement::Accept(tinyxml2::XMLVisitor*) const (tinyxml2.cpp:1481)\r\n==8709==    by 0xC85F04: tinyxml2::XMLDocument::Accept(tinyxml2::XMLVisitor*) const (tinyxml2.cpp:574)\r\n==8709==    by 0xA2CD34: cocos2d::SAXParser::parse(char const*, unsigned long) (CCSAXParser.cpp:143)\r\n==8709==    by 0xA2CE07: cocos2d::SAXParser::parse(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) (CCSAXParser.cpp:152)\r\n```\r\n\r\nTiled also uses a new XML file ending in `.tsx` for loading tilesets.","comments":["Hi, \r\nI don't have the same errer, but with the last version of Tiled, 'getLayer' return nullptre and : \r\ngetMapSize().width return 0\r\ngetMapSize().height return 1077805056 \r\nYet I have a 32 by 32 map...\r\n\r\nIf you have information about the support of this version I am taker.\r\nThanks."],"labels":["type:request"]},{"title":" [Playback] \u2757\ufe0fFailed to queue any items.  iOS-videoPlayer","body":"- cocos2d-x version:0x00030500\r\n- devices test on: IOS\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version:\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nError:\r\n[Playback] \u2757\ufe0fFailed to queue any items.\r\n1. create a \"VideoPlayer\" ,ccexp.VideoPlayer:create()\r\n2. setFileName and play it , addEventListener\r\n3. then  add a listener  ,as follows:\r\nself.videoPlayer:addEventListener(function(videoPlayer, eventType) \r\n        if eventType == ccexp.VideoPlayerEvent.PLAYING then\r\n            print(\"PLAYING\")\r\n        elseif eventType == ccexp.VideoPlayerEvent.PAUSED then\r\n            print(\"PAUSED\")\r\n        elseif eventType == ccexp.VideoPlayerEvent.STOPPED then\r\n            print(\"STOPPED\")\r\n        elseif eventType == ccexp.VideoPlayerEvent.COMPLETED then\r\n        --\u64ad\u653e\u5b8c\u6210\u65f6\u5904\u7406\u56de\u8c03\r\n            print(\"COMPLETED\")\r\n            self.videoPlayer:stop()\r\n        end\r\n    end)\r\n4. You will see  errors in terminal in Xcode :\r\n [Playback] \u2757\ufe0fFailed to queue any items.\r\n5.if you dont call stop or  remove this scene, this error will not appeared.  BTW:it will not crashed ,but error so bright, I want to know how to fix it  or use videoplayer correctly to stop it and remove it.\r\n\r\nTHX for reading it.\r\n","comments":["It is better to provide a test case that i can reproduce it.","MPMoviePlayerController is deprecated, thats why you getting this error.","Our product need this feature,so we use this interface. thx  for review.","you're welcome ","is there an alternative to VideoPlayer:create()? I have the same issue and it's causing crashes on some iOS devices","The apple doc of [MPMoviePlayerController](https:\/\/developer.apple.com\/documentation\/mediaplayer\/mpmovieplayercontroller?language=objc) suggests to use  `AVPictureInPictureController` or `AVPlayerViewController` instead.  `AVPlayerViewController` is added since iOS 8.0, and `AVPictureInPictureController` is available since iOS 9, so i will choose `AVPlayerViewController`.","@gurhub but i found `MPMoviePlayerController` is not removed in iOS 11. Will a deprecated class cause crash?","K, i misunderstood, it is an error message. And i can reproduced it.","I am using `AVPlayerViewController `, but i met some issues:\r\n\r\n- i don't know how to make it full screen\r\n- there is not call back for `pause` and `resume`\r\n- keep ratio enabled or not\r\n\r\nAs i read the Apple doc, it seems these features are missed.","i sent https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/18467 to fix it, but i can not resolved the issues mentioned above.","From Apple docs:\r\n\r\nThe MPMoviePlayerController class is formally deprecated in iOS 9. (The MPMoviePlayerViewController class is also formally deprecated.) To play video content in iOS 9 and later, instead use the AVPictureInPictureController or AVPlayerViewController class from the AVKit framework, or the WKWebView class from WebKit.\r\n\r\nMaybe we should try to use AVPlayerViewController instead of AVPictureInPictureController? I'm not familiar with neither of those but maybe the second one has the missing features?","Sorry, it is my fault, i used AVPlayerViewController.","After I little research, I think we can use a combination of \r\n\r\nhttps:\/\/developer.apple.com\/documentation\/avfoundation\/avplayerlayer\r\n\r\nand\r\n\r\nhttps:\/\/developer.apple.com\/documentation\/avfoundation\/avplayer\r\n\r\nwhich seem to be more customizable instead of AVPlayerViewController?\r\n","I don't see any more features with avplayelayer. The callback event is sent to avplayer if it has, not sent to avplayerlayer or AVPlayerViewController.","Hi guys, what do you think about the PR? Is it acceptable to fix it like this? I can not find better method.","one of the two CI tool reported this error\r\n\r\n** BUILD FAILED **\r\nThe following build commands failed:\r\n\tLd \/Users\/travis\/Library\/Developer\/Xcode\/DerivedData\/cocos2d_tests-fyshfmromhjeaqfapjwmvtirdnlv\/Build\/Products\/Debug-iphonesimulator\/lua-empty-test\\ iOS.app\/lua-empty-test\\ iOS normal i386\r\n(1 failure)\r\n\r\nThis might be safe to ignore?\r\n","i will fix it, i think it is because new libs should be dependent. You can ignore it if you are using CPP project.","Thanks!\r\nI'm testing your PR right now and I have a couple of findings:\r\n\r\n1. for some reason it broke the touch listener. \r\n\r\n```\r\n    \/\/ event listener\r\n    touchListener = EventListenerTouchOneByOne::create();\r\n    touchListener->setSwallowTouches(false);\r\n    touchListener->onTouchBegan = CC_CALLBACK_2(SplashLayer::onTouchBegan, this);\r\n    _eventDispatcher->addEventListenerWithSceneGraphPriority(touchListener, this);\r\n```\r\n\r\n```\r\nvoid SplashLayer::videoEventCallback(Ref* sender, VideoPlayer::EventType eventType)\r\n{\r\n    switch (eventType)\r\n    {\r\n    }\r\n}\r\n```\r\n\r\nbut when I tap on the video, the video disappears and the videoEventCallback is not invoked. It is invoked when the video ends.\r\n\r\n2. I always need to hide the playback buttons, so I added \r\n\r\n`self.moviePlayer.showsPlaybackControls = false;`\r\n\r\nto initializeMoviePlayer. It would be nice to have an API to do this.\r\n\r\n3. When I play a second video, it prints out \r\n\r\n```\r\n[LayoutConstraints] Unable to simultaneously satisfy constraints.\r\n\tProbably at least one of the constraints in the following list is one you don't want. \r\n\tTry this: \r\n\t\t(1) look at each constraint and try to figure out which you don't expect; \r\n\t\t(2) find the code that added the unwanted constraint or constraints and fix it. \r\n(\r\n    \"<NSLayoutConstraint:0x174093240 UIImageView:0x10237ca70.centerX == AVAudioOnlyIndicatorView:0x10237c8d0.centerX   (active)>\",\r\n    \"<NSLayoutConstraint:0x1740933d0 H:|-(>=10)-[UIImageView:0x10237ca70]   (active, names: '|':AVAudioOnlyIndicatorView:0x10237c8d0 )>\",\r\n    \"<NSLayoutConstraint:0x1700905e0 H:|-(0)-[AVAudioOnlyIndicatorView:0x10237c8d0]   (active, names: '|':UIView:0x10237c3b0 )>\",\r\n    \"<NSLayoutConstraint:0x170090590 H:[AVAudioOnlyIndicatorView:0x10237c8d0]-(0)-|   (active, names: '|':UIView:0x10237c3b0 )>\",\r\n    \"<NSLayoutConstraint:0x170090860 H:|-(0)-[UIView:0x10237c3b0]   (active, names: '|':AVPlayerView:0x10237c210 )>\",\r\n    \"<NSLayoutConstraint:0x170090810 H:[UIView:0x10237c3b0]-(0)-|   (active, names: '|':AVPlayerView:0x10237c210 )>\",\r\n    \"<NSLayoutConstraint:0x174098330 'UIView-Encapsulated-Layout-Width' AVPlayerView:0x10237c210.width == 0   (active)>\"\r\n)\r\n```\r\n\r\nconstraints issues. This might be related to the way I play the second video, I'm investigating now\r\n\r\nPoint 1 is probably the most critical.","About the constraints, I've found this thread:\r\n\r\nhttps:\/\/stackoverflow.com\/questions\/32860362\/unable-to-simultaneously-satisfy-constraints-warnings-with-avplayerviewcontrolle\r\n\r\n> I realised this is happening when you try to present the same AVPlayerViewController instance (using a strong reference property) the second, third...etc time and the player controls are not reset (i.e. the progress is not at the beginning).\r\n\r\nI can confirm that having two videos at the same time logs the constraint issue. \r\nTo solve this I had to create one video instance at a time and had to add\r\n`self.moviePlayer.showsPlaybackControls = false; `\r\nas well\r\n\r\n----------\r\n\r\nAbout the touch not working anymore, it looks like\r\n\r\n```\r\n-(void) stop\r\n{\r\n    \/\/ AVPlayer doesn't have a `stop` method, so invoke `destroyMoviePlayer` to have the same effect.\r\n    [self destroyMoviePlayer];\r\n    _paused = false;\r\n}\r\n```\r\n\r\ndoesn't trigger a STOP event so my callback functions are not triggered, resulting in wrong behavior","Found the touch issue! \r\nI think in the pause callback we'd need to add the PAUSED EventType as follows?\r\n\r\n```\r\n-(void) pause\r\n{\r\n    if (self.moviePlayer != nullptr)\r\n    {\r\n        **if(_videoPlayer != nullptr)\r\n            _videoPlayer->onPlayEvent((int)VideoPlayer::EventType::PAUSED);**\r\n        \r\n        _currentTime = [self.moviePlayer.player currentTime];\r\n        _paused = true;\r\n        [self.moviePlayer.player pause];\r\n    }\r\n}\r\n```\r\n\r\nAfter all these modifications it looks like everything works as intended on my devices","I can not find a way to stop AvPlayer, it doesn't have a stop function.","Yes, I've noticed that. \r\nMy workaround was to treat the pause event as a stop event (player taps on the screen > pauses the video, but in my game this works as a skip option, so I can basically use the PAUSE event as a STOP event)","When will this issue be apply?"],"labels":["platform:ios"]},{"title":"[android] Avoid FPS greater than 60 if vsync is closed","body":"","comments":["More info here, https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/16912 \r\n"],"labels":["platform:android"]},{"title":"DrawNode sometimes not visible in Android API 16 and may crash","body":"- cocos2d-x version: Cocos2d-x 3.15\r\n- devices test on: Andromax JSR U - Android API 16\r\n- developing environments\r\n   - NDK version: r13b\r\n   - Xcode version:-\r\n   - VS version:-\r\n   - browser type and version:-\r\n\r\nSteps to Reproduce:\r\n\r\n1. Create DrawNode on init then make draw segment on touchBegan\/Moved\r\n2. Clear onTouchEnd\r\n3. Retry if not crashed yet, it will have 2 options: draw is shown but crash, or draw is not shown.\r\n\r\nfor now i just add API protection so it will not using drawNode in API 16 or lower.","comments":["I am not sure if i can find a device with API 16 to test."],"labels":["platform:android"]},{"title":"Downloader stopped working after updating cocos to 3.15. Issue only for Android.","body":"- cocos2d-x version: 3.15\r\n- devices test on:\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version:\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n1. \r\n2. \r\n","comments":["How to reproduce it?","Mine working fine"],"labels":["platform:android"]},{"title":"Multiple Calls to DrawNode->clear then draw stops \/ flashes drawing on Android","body":"- cocos2d-x version: 3.15.0\r\n- devices test on: Samsung Galaxy Tablet Android 4.4.2\r\n- developing environments\r\n   - NDK version: Android Studio r14B\r\n\r\nSteps to Reproduce:\r\n\r\nIf you make multiple edits to the draw node and clear and then draw, sometimes the draw node remains empty. With the following example, the draw node will flash continually.\r\n\r\nOn iOS, the drawing will stay constant; while on Android, the drawing flashes continually. As a work around, I am creating a draw node every time.\r\n\r\n`void MyNode::visit(Renderer* renderer, const Mat4& parentTransform, uint32_t parentFlags)\r\n{\r\n\r\n    _drawNode->clear();\r\n    _drawNode->drawDot(Point(10.0f, 10.0f), 10.0f, Color4F::BLACK);\r\n\r\n    \/\/ Super\r\n    Node::visit(renderer, parentTransform, parentFlags);\r\n}`","comments":["I met this bug as well \r\nIs there a way to solve the problem now?","Four years goes, now I meet this problem as well. I solved this by double buffered."],"labels":["platform:android"]},{"title":"Memory leak at spine jsb.","body":"- cocos2d-x version: 3.15\r\n- devices test on: Mac-Mini, IPhone 6S\r\n- developing environments\r\n   - NDK version: r14b\r\n   - Xcode version: 8.1\r\nSteps to Reproduce:\r\n\r\n1. Run js test project included in sdk packet\r\n2. Press Spine Test and then press Main Menu\r\n3. press Sys Tests and find restartGame and press it\r\n4. press Spine Test\r\n5. memory will increase about 300kb per second until system crash.\r\nIn my working project I have the same problem. How to check where the problem, or you know solution?","comments":["Check if you are calling removealleventlistner any where. If you using\nspine calling removealleventlistner will cause memory leak. Remove all\nlistners by name.\n\nThanks\nOn Mon, 22 May 2017 at 14:54, Yurii <notifications@github.com> wrote:\n\n>\n>    - cocos2d-x version: 3.15\n>    - devices test on: Mac-Mini, IPhone 6S\n>    - developing environments\n>       - NDK version: r14b\n>       - Xcode version: 8.1\n>       Steps to Reproduce:\n>\n>\n>    1. Run js test project included in sdk packet\n>    2. Press Spine Test and then press Main Menu\n>    3. press Sys Tests and find restartGame and press it\n>    4. press Spine Test\n>    5. memory will increase about 300kb per second until system crash.\n>    In my working project I have the same problem. How to check where the\n>    problem, or you know solution?\n>\n> \u2014\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/17853>, or mute the thread\n> <https:\/\/github.com\/notifications\/unsubscribe-auth\/ACC8g7iVVSe0jnmXC_eRkp4eIQFpLIM5ks5r8VtJgaJpZM4NiITY>\n> .\n>\n-- \nBest Regards\nSohaib Hussain\n","@hussain-sohaib  what you mean by \"removealleventlisteners\". It spine listeners or other? For spine I only use their.\r\n` this._skeleton.setStartListener(listener);`\r\n` this._skeleton.setCompleteListener(listener);`\r\nAnd null it when destroy object? Mayby removeFromParent with cleanup do this? ","No no, the listner you mentioned are spine objects listner. I was talking\nabout cocos2dx listners, like touchonebyone listner or custom listners. I\nfaced this issue with c++ version and i resolved it by removing listners\nthat I used in scene by name. I dont know what could be the issue in js\nversion.\n\nPlease see spine runtime examples. But i am sure some thing wrong happens\nwhen you restart the scene.  Check how spine guys are moving from one scene\nto another.\n\nThanks\nOn Mon, 22 May 2017 at 16:02, Yurii <notifications@github.com> wrote:\n\n> @hussain-sohaib <https:\/\/github.com\/hussain-sohaib> what you mean by\n> \"removealleventlisteners\". It spine listeners or other? For spine I only\n> use their.\n> this._skeleton.setStartListener(listener);\n> this._skeleton.setCompleteListener(listener);\n> And null it when destroy object? Mayby removeFromParent with cleanup do\n> this?\n>\n> \u2014\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/17853#issuecomment-303068693>,\n> or mute the thread\n> <https:\/\/github.com\/notifications\/unsubscribe-auth\/ACC8g6mXTMn_nVT7qF_TigtBOcazNGk5ks5r8WspgaJpZM4NiITY>\n> .\n>\n-- \nBest Regards\nSohaib Hussain\n","See spine runtime examples by esoteric software the make of spine.\nOn Mon, 22 May 2017 at 17:24, Sohaib Hussain <sohaib.hussain7@gmail.com>\nwrote:\n\n> No no, the listner you mentioned are spine objects listner. I was talking\n> about cocos2dx listners, like touchonebyone listner or custom listners. I\n> faced this issue with c++ version and i resolved it by removing listners\n> that I used in scene by name. I dont know what could be the issue in js\n> version.\n>\n> Please see spine runtime examples. But i am sure some thing wrong happens\n> when you restart the scene.  Check how spine guys are moving from one scene\n> to another.\n>\n> Thanks\n>\n> On Mon, 22 May 2017 at 16:02, Yurii <notifications@github.com> wrote:\n>\n>> @hussain-sohaib <https:\/\/github.com\/hussain-sohaib> what you mean by\n>> \"removealleventlisteners\". It spine listeners or other? For spine I only\n>> use their.\n>> this._skeleton.setStartListener(listener);\n>> this._skeleton.setCompleteListener(listener);\n>> And null it when destroy object? Mayby removeFromParent with cleanup do\n>> this?\n>>\n>> \u2014\n>> You are receiving this because you were mentioned.\n>> Reply to this email directly, view it on GitHub\n>> <https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/17853#issuecomment-303068693>,\n>> or mute the thread\n>> <https:\/\/github.com\/notifications\/unsubscribe-auth\/ACC8g6mXTMn_nVT7qF_TigtBOcazNGk5ks5r8WspgaJpZM4NiITY>\n>> .\n>>\n> --\n> Best Regards\n> Sohaib Hussain\n>\n-- \nBest Regards\nSohaib Hussain\n","@hussain-sohaib. You mean that every event listener must have name. and when I remove every object that have some listeners I must delete they manually? And about restart of game. I use restart for update source code of game. In firs scene i have pre-preloader new build if it need and restart game when source outdated. Is it have any influince to this bug?"],"labels":["script:jsb"]},{"title":"cocos2d-x 3.4  libpng warning: Application built with libpng-1.6.2 but running with 1.5.12","body":"- cocos2d-x version:3.4\r\n- devices test on: iOS Simulator\r\n- developing environments\r\n   - Xcode version: 7.2.1\r\n\r\nLoading 3d scene error\uff1a\r\n\r\n```\r\nlibpng warning: Application built with libpng-1.6.2 but running with 1.5.12\r\nFails: init fps_images\r\nlibpng warning: Application built with libpng-1.6.2 but running with 1.5.12\r\nFails: init fps_images\r\nlibpng warning: Application built with libpng-1.6.2 but running with 1.5.12\r\nFails: init fps_images\r\njpeg error: JPEG parameter struct mismatch: library thinks size is 664, caller expects 632\r\n```\r\nAnd\r\n\r\n```\r\nSprite* sprite = Sprite::create(\"*****\");\r\n\tsprite->setAnchorPoint(Vec2(0.5, 0.5));\r\n\r\n```\r\nSprite-> NULL","comments":["I just worked through this problem on v3.17. I believe it's an issue of the framework building with the version it pulls down (1.6.2, in your case) from download-deps.py, then linking your project with whatever version you have set up for linking (which, inevitably, ends up getting changed by something other than your package manager). open up terminal and check the result of: `find \/usr \/Library \/opt \/lib -iname \"libpng*.dylib\" 2>\/dev\/null`  \r\n\r\nFor me, this was an issue with Mono Framework keeping another version around for me to link with:\r\n\r\n`\/Library\/Frameworks\/Mono.framework\/Versions\/5.4.1\/lib\/libpng.dylib\r\n\/Library\/Frameworks\/Mono.framework\/Versions\/5.4.1\/lib\/libpng14.dylib\r\n\/Library\/Frameworks\/Mono.framework\/Versions\/5.4.1\/lib\/libpng14.14.dylib`\r\n\r\nWhich was causing a similar error, except with linking 1.4 instead of 1.6. Removing Mono Framework was a quick solution to get back up and seeing images.\r\n\r\nHopefully that helps anyone else that comes across this issue."],"labels":["module:3rdParty"]},{"title":"Get data from zip in lua","body":"- cocos2d-x version: 3.15\r\n\r\nI want to get resource file from zip, but it looks like it is impossible in lua or js. I think that we really need port of `getFileDataFromZip` in those languages.\r\n\r\nOr did I understood purpose of this function wrong?","comments":["You can refer to https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/14341 and modify it by yourself to read data from zip file. We will add it in future."],"labels":["type:request","script:lua"]},{"title":"Crash when AudioEngine::end() is called from AppDelegate.cpp","body":"- cocos2d-x version: v3.15\r\n- devices test on: Windows win32\r\n- developing environments\r\n   - NDK version: -\r\n   - Xcode version: -\r\n   - VS version: VS2017\r\n   - browser type and version: -\r\n\r\nSteps to Reproduce:\r\n\r\n1. Use the experimental audio engine (enable the USE_AUDIO_ENGINE define in AppDelegate.cpp).\r\n2. Close the game window manually (like clicking the X icon on the window).\r\n\r\nWhen AudioEngine::end() deletes the audio engine implementation instance via \"delete _audioEngineImpl;\", that calls the destructor \"AudioEngineImpl::~AudioEngineImpl\".  In that destructor it tries to do the following:\r\n\r\nif (_scheduler != nullptr)\r\n{\r\n    _scheduler->unschedule(CC_SCHEDULE_SELECTOR(AudioEngineImpl::update), this);\r\n}\r\n\r\nThe issue is that the _scheduler points to an instance that was freed when Director was freed, which happens before the AudioEngineImpl destructor is called.  Since AudioEngineImpl _scheduler is still pointing to a memory location that is no longer valid, it causes a crash in Scheduler::unschedule, since it tries to access freed memory.\r\n\r\nThe reason this happens is because Director::end() is called to do a cleanup from Application::run(), and it cleans up all memory associated with the Director instance before the AudioEngineImpl destructor is called.  \r\n\r\nThe destructor AppDelegate::~AppDelegate() is perhaps not the best place to call experimental::AudioEngine::end().  This exists in the C++ code template that is generated.  Where is the best place to put the experimental::AudioEngine::end() call?\r\n","comments":["Any work around for this?","What has worked for me is to remove the call to end() from the AppDelegate destructor, and place it in the code where I exit my application. Before calling end() on the instance of the Director, call end() on the AudioEngine.\r\n\r\nFor example, in a menu item callback function:\r\n\r\n```\r\n\r\nvoid MainMenu::exitGameCallback(cocos2d::Ref* pSender)\r\n{\r\n    experimental::AudioEngine::end();\r\n\r\n    Director::getInstance()->end();\r\n\r\n#if (CC_TARGET_PLATFORM == CC_PLATFORM_IOS)\r\n    exit(0);\r\n#endif\r\n}\r\n```\r\n","I did the following:\r\n```\r\n_scheduler = Director::getInstance()->getScheduler();\r\n_scheduler->retain();\r\n```\r\n\r\nAnd:\r\n\r\n```\r\nif (_scheduler != nullptr)\r\n{\r\n  _scheduler->unschedule(CC_SCHEDULE_SELECTOR(AudioEngineImpl::update), this);\r\n  _scheduler->release();\r\n  _scheduler = nullptr;\r\n}\r\n```","One way to bypass this bug is to Retain Director in ApplicationDidFinishLaunchingFunction and release it after AudioEngine::end() call. "],"labels":["module:audio"]},{"title":"Fixes TMX map parsing problems","body":"Now, TMX map can parse rotation of object correctly.","comments":["could you please add a test case?","@MartinLutherSu  Great job!","@minggo Why still isn't merged?","Because i don't know how to reproduce it.\r\n@drelaptop could you please take a look too?","@v1993 not test case or test descriptions to tell us this is a right bug-fix\r\n\r\nI will try to test it later","link https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/11540 , which added a simple `rotation` property parse"],"labels":["critical"]},{"title":"[UI] Label shadow with blur","body":"Hi,\r\nIt looks like `Label::enableShadow()` method accepts `blurRadius` parameter to adjust shadow blur strength.\r\nBut there is no implementation for now and this parameter is just suppressed in `CCLabel.cpp`.\r\nIs there any news on this topic?","comments":["https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/v3\/cocos\/2d\/CCLabel.cpp#L1106\r\n\r\nSame here, this feature hasn't been implemented. In cocos2d-iphone I've used it a lot. \r\nNow in my game I can't.\r\n\r\n@minggo @dumganhar @zilongshanren @CocosRobot @walzer @pandamicro @yinjimmy @drelaptop @slackmoehrle "],"labels":["type:request","module:ui"]},{"title":"\u3010iOS\u3011Keyboard events' deal cause screen confusion","body":"- cocos2d-x version: all version (3.2 3.7 3.9 test)\r\n- devices test on: iphone 6 ,iphone 6 P,iphone 6s ,iphone 6s P,iphone 7 ,iphone 7 P\r\n- developing environments\r\n   - Xcode version:Version 8.2.1 (8C1002)\r\n\r\nSteps to Reproduce:\r\n \r\n1. The project is landscape . (iOS project Device Orientation setting supports Landscape & Portrait)\r\n2. The project should have an EditBox on the screen.\r\n3. run the project on device\uff0cthen switch screen .\r\n4. you can open wechat or QQ \uff0cchat just show the keyboard.\r\n5. back the project\uff0cgreat probability cause screen confusion.\r\n\r\n\u64cd\u86cb\uff0c\u6211\u8fd8\u662f\u76f4\u63a5\u8bf4\u4e2d\u6587\u5f97\u4e86\u30022dx \u5728\u521d\u59cb\u5316 \u4e00\u4e2aEditBox \u8f93\u5165\u6846\u540e\uff0c\u5c31\u4e00\u76f4\u5728\u4fa6\u542c\u952e\u76d8\u4e8b\u4ef6\uff0c\u4fa6\u542c\u5c31\u7b97\u4e86\uff0c\u4f60\u8fd8\u4e00\u76f4\u5904\u7406 \u4f60\u4eec\u7684GLView \u5927\u5c0f\u548c\u4f4d\u7f6e\u3002\u6709\u65f6\u5019\u5bf9\u63a5\u7b2c\u4e09\u65b9SDK \uff0c\u7b2c\u4e09\u65b9\u6709\u8f93\u5165\u6846 \u952e\u76d8\u4e8b\u4ef6\u53d8\u5316\u4f60\u4eec\u4e5f\u5904\u7406\uff0c\u5207\u5230\u5fae\u4fe1\u3001QQ\u7b49\u804a\u5929 \u952e\u76d8\u4f60\u4eec\u4e5f\u5904\u7406\u3002\u6709\u7684\u7b2c\u4e09\u65b9\u53ef\u662f\u6709\u5f3a\u5236\u7ad6\u5c4f\u7684\u754c\u9762\uff0c\u8fd9\u65f6\u5019\u53ea\u8981 \u6a2a\u5c4f\u6e38\u620f\u914d\u7f6e\u4e86 \u7ad6\u5c4f\u652f\u6301\uff0c\u5c31\u6709\u5f88\u5927\u6982\u7387 \u51fa\u73b0 \u9519\u5c4f \u73b0\u8c61\u3002\r\n\r\n\u82b1\u4e86\u534a\u5929\u65f6\u95f4\u624d\u5b9a\u4f4d\u52302dx\u95ee\u9898\u3002\u89e3\u51b3\u65b9\u6848\u5c31\u662f \u4fee\u6539 CCEAGLView-ios.mm \uff08\u8001\u7248\u672c\u662fCCEAGLView.mm\uff09\u3002\r\n\u4fee\u6539\r\n-(void) doAnimationWhenKeyboardMoveWithDuration:(float)duration distance:(float)dis; \u51fd\u6570\u5b9e\u73b0switch \u7684\u7b2c\u4e00\u4e2acase\uff1a\r\n        case UIInterfaceOrientationPortrait:\r\n            if ([[[UIDevice currentDevice] systemVersion] floatValue] >= 8.0)\r\n            {\r\n                self.frame = CGRectMake(originalRect_.origin.x, originalRect_.origin.y - dis, self.frame.size.width, self.frame.size.height);\r\n            }else{\r\n                self.frame = CGRectMake(originalRect_.origin.x, originalRect_.origin.y - dis, originalRect_.size.width, originalRect_.size.height);\r\n            }\r\n            break;  \r\n\u6539\u597d\uff0c\u7ecf\u8fc7\u591a\u673a\u578b\u591a\u8f6e\u6d4b\u8bd5 fix\u3002\u7a0d\u540e\u6211\u4f1a pull \u4e00\u4e2a\u8fc7\u6765\u3002","comments":["So should stop listening keyboard event instead of change the size?","Yes, i try to stop listening keyboard event, but it will effect 2dx\u2018s Editbox .Then, i just change the size. The best to , stop listening keyboard event for the right time. ","\u6700\u597d\u662f\u5728\u5408\u9002\u7684\u65f6\u673a \u79fb\u9664\u952e\u76d8\u76d1\u542c\uff0c \u6211\u5c1d\u8bd5\u8fc7 \u8fd9\u6837\u505a\u6cd5\uff0c\u4f46\u662f\u4f1a\u5f71\u54cd Editbox \u7684\u952e\u76d8\u4f38\u7f29\u4e0a\u4e0b\u4f4d\u7f6e\u3002\r\n\u6700\u540e\u6211\u53ea\u597d\u4fee\u6539\u4e86size\uff0c\u80fd\u89e3\u51b3\u95ee\u9898\uff0c\u4f46\u4e0d\u662f\u6700\u4f18\u7684\u65b9\u6848\u3002\r\n\u6211\u4e4b\u524d\u6709\u5728\u4f60\u4eecEditbox\u76d1\u542c\u4e8b\u4ef6\u56de\u8c03\u91cc\u9762\u5224\u65ad \u5f53\u524d\u4e8b\u4ef6\u662f\u5426\u662f Editbox\u4f20\u6765\u7684\uff0c\u6839\u636e\u7f16\u8f91\u72b6\u6001\u5224\u65ad\uff0c\u4f46\u662f\u4f1a\u5f71\u54cdEditbox\uff0c\u6240\u4ee5\u4e0d\u80fd\u4ee5\u7f16\u8f91\u72b6\u6001\u4f5c\u4e3a\u5224\u65ad\u4f9d\u636e\uff0c\u6700\u597d\u4f60\u4eec\u80fd\u52a0\u5165\u4e00\u4e2a\u65b0\u7684\u6807\u793a\uff0c\u6bd4\u5982tag \u4e4b\u7c7b\u7684\uff0c\u5224\u65ad\u4e00\u4e0b\u3002\r\n\uff08\u56e0\u4e3a\u6211\u4e0d\u662fcocos2d-x \u5f00\u53d1\u8005\uff0c\u662f\u4e00\u540d iOS SDK\u5f00\u53d1\uff0c\u5bf9\u4f60\u4eec\u5f15\u64ce\u4e0d\u662f\u5f88\u719f\u6089\uff0c\u6240\u4ee5\u4e5f\u6ca1\u6df1\u5165 \u7814\u7a76\u3002\uff09","thanks"],"labels":["platform:ios"]},{"title":"3.15  cc.Label  object can't use that \u3010var setString = label.setString.bind(label); setString('xxx\");\u3011","body":"3.15\r\n--------------------------------------------\r\nvar label = new cc.Label(....);\r\nvar setString = label.setString.bind(label); \r\nsetString('xxx\");\r\n--------------------------------------------\r\nerror:   ...\/script\/jsb_boot.js:1837:TypeError: 'prototype' property of fNOP is not an object\r\n","comments":["Did you use lua or js? I am confused about your given information.","js"],"labels":["script:jsb"]},{"title":"luajit performance issue","body":"More detail information can refer to [this Chinese forum ticket](http:\/\/forum.cocos.com\/t\/luajit\/45347).","comments":[],"labels":["script:lua"]},{"title":"[win32] luajit.exe can't be executed on 32bit windows.","body":"- cocos2d-x version: v3.14.1\r\n- devices test on: Windows 32bit\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version:\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n1. \r\n2. \r\n\r\nReported at http:\/\/forum.cocos.com\/t\/cocos2dx-3-14-1-pc-cocos-luacompile-64\/44897\r\n","comments":[],"labels":["script:lua"]},{"title":"main\/patch obb files in Android","body":"This is not a bug, but more a feature request. The implementation of the OBB file finder is not as expected. See https:\/\/developer.android.com\/google\/play\/expansion-files.html#ReadingTheFile \r\n\r\nYour implementation only returns a main.obb file, but an Android app can have two OBB files (main and patch). The second file is completely ignored, if it exists. And with your implementation the user has always to download the large main.obb instead of a much smaller patch.obb.","comments":["google play is blocked in China, we can not test it here. The OBB support is added by community","Okay, someone or I have to create a PR for this feature. I see."],"labels":["platform:android"]},{"title":"experimental::AudioEngine::remove Crash on IOS","body":"- cocos2d-x version: cocos2d-x-3.13.1\r\n- devices test on: All IOS devices\r\n- developing environments\r\n   - NDK version: N\/A\r\n   - Xcode version: 8.2.1\r\n   - VS version: N\/A\r\n   - browser type and version: N\/A\r\n\r\nFacing random crashes on LIVE game with stacktrace mentioned below.. cocos2d::experimental::AudioEngine::remove(int) + 2586436\r\nHere is the detailed stacktrace below. also attaching screenshot of fabric\r\nPlease help to fix the issue as this is causing severe damage to my Live game.\r\n\r\n> #0. Crashed: com.apple.main-thread\r\n0  SlotGame-mobile                0x100ab5ba4 std::__1::unordered_map<std::__1::basic_string<char,             std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::list<int, std::__1::allocator<int> >, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, std::__1::list<int, std::__1::allocator<int> > > > >::operator[](std::__1::basic_string<char, std::__1::char_traits<char>,     std::__1::allocator<char> > const&) + 2585268\r\n1  SlotGame-mobile                0x100ab6034 cocos2d::experimental::AudioEngine::remove(int) + 2586436\r\n2  SlotGame-mobile                0x1008b790c cocos2d::experimental::AudioEngineImpl::update(float) + 495644\r\n3  SlotGame-mobile                0x1008b9b80 cocos2d::Timer::update(float) + 504464\r\n4  SlotGame-mobile                0x1008bc6c0 cocos2d::Scheduler::update(float) + 515536\r\n5  SlotGame-mobile                0x1008f58ec cocos2d::Director::drawScene() + 749564\r\n6  SlotGame-mobile                0x1008f6ef4 cocos2d::DisplayLinkDirector::mainLoop() + 755204\r\n7  QuartzCore                     0x18a8f7f24 CA::Display::DisplayLinkItem::dispatch(unsigned long long) + 44\r\n8  QuartzCore                     0x18a8f7dd0 CA::Display::DisplayLink::dispatch_items(unsigned long long, unsigned long long, unsigned long long) + 444\r\n9  IOKit                          0x187916094 IODispatchCalloutFromCFMessage + 372\r\n10 CoreFoundation                 0x18763ee50 __CFMachPortPerform + 180\r\n11 CoreFoundation                 0x187657218 __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION__ + 56\r\n12 CoreFoundation                 0x1876569cc __CFRunLoopDoSource1 + 436\r\n13 CoreFoundation                 0x1876544b0 __CFRunLoopRun + 1840\r\n14 CoreFoundation                 0x1875822b8 CFRunLoopRunSpecific + 444\r\n15 GraphicsServices               0x189036198 GSEventRunModal + 180\r\n16 UIKit                          0x18d5c27fc -[UIApplication _run] + 684\r\n17 UIKit                          0x18d5bd534 UIApplicationMain + 208\r\n18 SlotGame-mobile                0x1000f4304 main (main.m:6)\r\n19 libdispatch.dylib              0x1865655b8 (Missing)\r\n\r\n<img width=\"1336\" alt=\"screen shot 2017-02-24 at 5 04 51 pm\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/6037560\/23402898\/6cbcfd5a-fdcf-11e6-8fa0-953695931694.png\">\r\n","comments":["@shaniamjad, did you invoke `AudioEngine` interfaces in different threads?","Could not be reproduced.\r\nI analyzed the logic in AudioEngine of iOS port, can't find out the which code could cause this crash.\r\nI will dig into more, but mark this issue to be resolved in `next` milestone.","@dumganhar Sorry for the late response.. I am not calling it in different thread.. I am also not able to reproduce this on my end but as i said i am getting lots of crashes related to AudioEndine on LIVE users.. So i am also not sure which could possibly cause this.. which is why i am seeking for advice OR some fix for it. Thanks","@shaniamjad, did you invoke `AudioEngine::stopAll()` or `AudioEngine::uncacheAll()` in your game code? If there is, how did you use these two interfaces?","@dumganhar I am facing similar issue on android. I am using cocos2d-x-3.13.1. Following is the crash log.\r\n\r\n> Crashed: gas.magic.slots|\r\n0  libcocos2dcpp.so               0xa196f738 std::__ndk1::hash<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > >::operator()(std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > const&) const [clone .isra.127] (string:1712)\r\n1  libcocos2dcpp.so               0xa196fcb7 std::__ndk1::__hash_iterator<std::__ndk1::__hash_node<std::__ndk1::__hash_value_type<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> >, std::__ndk1::list<int, std::__ndk1::allocator<int> > >, void*>*> std::__ndk1::__hash_table<std::__ndk1::__hash_value_type<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> >, std::__ndk1::list<int, std::__ndk1::allocator<int> > >, std::__ndk1::__unordered_map_hasher<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> >, std::__ndk1::__hash_value_type<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> >, std::__ndk1::list<int, std::__ndk1::allocator<int> > >, std::__ndk1::hash<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > >, true>, std::__ndk1::__unordered_map_equal<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> >, std::__ndk1::__hash_value_type<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> >, std::__ndk1::list<int, std::__ndk1::allocator<int> > >, std::__ndk1::equal_to<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > >, true>, std::__ndk1::allocator<std::__ndk1::__hash_value_type<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> >, std::__ndk1::list<int, std::__ndk1::allocator<int> > > > >::find<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > >(std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > const&) (unordered_map:384)\r\n2  libcocos2dcpp.so               0xa1970baf std::__ndk1::unordered_map<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> >, std::__ndk1::list<int, std::__ndk1::allocator<int> >, std::__ndk1::hash<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > >, std::__ndk1::equal_to<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > >, std::__ndk1::allocator<std::__ndk1::pair<std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > const, std::__ndk1::list<int, std::__ndk1::allocator<int> > > > >::operator[](std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > const&) (unordered_map:970)\r\n3  libcocos2dcpp.so               0xa1970c2b cocos2d::experimental::AudioEngine::remove(int) (AudioEngine.cpp:329)\r\n4  libcocos2dcpp.so               0xa1971f55 std::__ndk1::__function::__func<cocos2d::experimental::AudioEngineImpl::play2d(std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > const&, bool, float)::{lambda(cocos2d::experimental::IAudioPlayer::State)#1}, std::__ndk1::allocator<{lambda(cocos2d::experimental::IAudioPlayer::State)#1}>, void (cocos2d::experimental::IAudioPlayer::State)>::operator()(cocos2d::experimental::IAudioPlayer::State&&) (AudioEngine-inl.cpp:269)\r\n5  libcocos2dcpp.so               0xa1974e2f cocos2d::experimental::PcmAudioPlayer::prepare(std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > const&, cocos2d::experimental::PcmData const&)::{lambda(cocos2d::experimental::Track::State)#1}::operator()(cocos2d::experimental::Track::State) const::{lambda()#1}::operator()() const (functional:1756)\r\n6  libcocos2dcpp.so               0xa1a2ee5c cocos2d::Scheduler::update(float) (functional:1756)\r\n7  libcocos2dcpp.so               0xa1a1d648 cocos2d::Director::drawScene() (CCDirector.cpp:273)\r\n8  libcocos2dcpp.so               0xa1a1d688 cocos2d::DisplayLinkDirector::mainLoop() (CCDirector.cpp:1394)\r\n9  base.odex                      0xa2daef05 oatexec\r\n\r\nI am not using  AudioEngine::uncacheAll() and AudioEngine::stopAll() in my code. \r\n","@umair6, could you try to use the latest audio code (cocos\/audio\/android) on github v3 branch and test again? Thanks.","@dumganhar  I have already updated my code to latest. Will let you know if I see this crash again in latest code.","@dumganhar https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/18124 fixed issue for me on android side. ","@umair6 , thanks for your test. We will put the patch into v3.16.","@dumganhar , this issue is reproducing again and causing a lot of crashing.\r\n\r\nCrash log is as following:\r\n\r\n0  libcocos2dcpp.so               0x9d1a5aa8 std::__ndk1::__function::__func<cocos2d::experimental::PcmAudioPlayer::prepare(std::__ndk1::basic_string<char, std::__ndk1::char_traits<char>, std::__ndk1::allocator<char> > const&, cocos2d::experimental::PcmData const&)::$_0::operator()(cocos2d::experimental::Track::State) const::{lambda()#1}, std::__ndk1::allocator<{lambda()#1}>, void ()>::operator()() (functional:1896)\r\n1  libcocos2dcpp.so               0x9d29ec78 cocos2d::Scheduler::update(float) (functional:1896)\r\n2  libcocos2dcpp.so               0x9d284df8 cocos2d::Director::drawScene() (CCDirector.cpp:295)\r\n3  libcocos2dcpp.so               0x9d287d54 cocos2d::Director::mainLoop() (CCDirector.cpp:1486)\r\n4  base.odex                      0x9f3ba255 oatexec\r\n\r\n","Hi @dumganhar !\r\nAny update on this crash ?","did you try 3.16\uff1fhow did you use AudioEngine API\uff0cdid you use it in different thread which isn't cocos thread\uff1fdo you know how to reproduce it\uff1f","@dumganhar \r\nWe are using cocos2dx 3.15 but we have updated Audio module from\r\nlatest cocs2d-x v3 branch.\r\nNo , we are not using different threads and at the moment we are not sure about the reproduction steps but as per crashlytics dashboards a lot of users are still facing this crash on android side.\r\n\r\n\r\n\r\n\r\n\r\n\r\n","It must have some reproduce steps, perhaps, you could record some steps in your game and trace user behavior while game crashes.","@shaniamjad have you ever find a way to reproduce this issue?\r\n\r\nWe are getting a similar stacktrace on Crashlytics dashboard (iOS mostly) but I couldn't reproduce it yet.","No @renatoaf, I wasn't able to reproduce this on my side either. But  https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/18124 This fixed the issue as after this update crash no longer appeared on crashlytics for live users. So may be you try this patch as well. ","@shaniamjad #18124 seems to change Android audio engine only (specific android related-files), does this fixed your iOS issues as well, or did you update the whole audio code to 3.16 as @dumganhar suggested?\r\n\r\nThanks!"],"labels":["module:audio"]},{"title":"The log should be reorder","body":"- cocos2d-x version: 3.14\r\n\r\nSteps to Reproduce:\r\n\r\n1. Open some demo of cocos2d-x 3.14\r\n2. Check the log of console.\r\n\r\n```\r\n{\r\n\tgl.supports_OES_map_buffer: false\r\n\tgl.supports_vertex_array_object: true\r\n\tcocos2d.x.version: cocos2d-x-3.14\r\n\tgl.vendor: NVIDIA Corporation\r\n\tgl.supports_PVRTC: false\r\n\tgl.renderer: NVIDIA GeForce GT 750M OpenGL Engine\r\n\tcocos2d.x.compiled_with_profiler: false\r\n\tcocos2d.x.build_type: DEBUG\r\n\tcocos2d.x.compiled_with_gl_state_cache: true\r\n\tgl.max_texture_size: 16384\r\n\tgl.supports_ETC1: false\r\n\tgl.supports_BGRA8888: false\r\n\tgl.max_texture_units: 16\r\n\tgl.supports_OES_packed_depth_stencil: false\r\n\tgl.supports_ATITC: false\r\n\tgl.supports_discard_framebuffer: false\r\n\tgl.supports_NPOT: true\r\n\tgl.version: 2.1 NVIDIA-10.14.20 355.10.05.15f03\r\n\tgl.supports_S3TC: true\r\n\tgl.supports_OES_depth24: false\r\n}\r\n```\r\nThe log is too hard to read, I think it should be reordered\r\n\r\n","comments":["Yep, I guess we need to sort the keys by alphabetical order.","alphabetical order is acceptable.\r\n\r\nMaybe sort it by manual is better. \r\nalways put version of cocos2dx first\ud83d\ude0a.\r\n\r\n\r\n```\r\n        cocos2d.x.version: cocos2d-x-3.14\r\n\tcocos2d.x.build_type: DEBUG\r\n\tcocos2d.x.compiled_with_profiler: false\r\n\tcocos2d.x.compiled_with_gl_state_cache: true\r\n        gl.version: 2.1 NVIDIA-10.14.20 355.10.05.15f03\r\n        gl.vendor: NVIDIA Corporation\r\n\tgl.renderer: NVIDIA GeForce GT 750M OpenGL Engine\r\n\tgl.supports_PVRTC: false\r\n\tgl.supports_ETC1: false\r\n\tgl.supports_S3TC: true\r\n\tgl.supports_ATITC: false\r\n\tgl.supports_BGRA8888: false\r\n\tgl.max_texture_size: 16384\r\n\tgl.max_texture_units: 16\r\n\t.....\r\n```"],"labels":["type:request"]},{"title":"can't play audio from buffer?","body":"- cocos2d-x version: 3.10\r\n- devices test on: win32\r\n- developing environments\r\n   - VS version: community\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\nI want play audio file from buffer.\r\nbut now, audioengine just only support from filepath(exist on computer)\r\nI want resource's security.\r\nso, I packing resource file and unpacking when I use this\r\nand contain target file on BYTE buffer an use\r\n(now I use png file like this.\r\ncontain buffer, and make Image from buffer, get Texture2d from Image, and create sprite from Texture)\r\n\r\nbut I don't know how to use audio file.\r\n\r\n","comments":["Probably, a new interface called `AudioEngine::play2dWithData` needs to be added.","then, will add a function called play2dWithData in the future?","We will consider this feature.\r\nFor now, I think it's not difficult to achieve that by hacking `AudioEngine` source code. :)","thanks."],"labels":["module:audio"]},{"title":"iOS 10 issue with input lagging","body":"- cocos2d-x version: 3.14.1\r\n\r\nPlease read this forum thread: http:\/\/discuss.cocos2d-x.org\/t\/ios-10-issue-with-scroll-ontouch\/35210\r\n","comments":["A Developer in the forum said that this issue was fixed in iOS 10.3 beta."],"labels":["platform:ios"]},{"title":"AudioEngine alSourcePlay error code:a003","body":"- cocos2d-x version:3.9 (audio had upgrade to 3.15)\r\n- devices test on:iPhone 7\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version:8.2\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\nit can't produce often\r\n1. press home menu to background a while or goto siri \r\n2. music and sound is disappeared\r\n\r\n\r\nlog:\r\nE\/AudioPlayer (217): bool cocos2d::experimental::AudioPlayer::play2d():alSourcePlay error code:a003\r\nV\/AudioPlayer (69): ~AudioPlayer() (0x11672c250), id=2321\r\nV\/AudioPlayer (83): AudioPlayer::destroy begin, id=2321\r\nV\/AudioPlayer (128): Before alSourceStop\r\nE\/AudioPlayer (129): OpenAL error 0xA003 in \/Users\/semgilo\/Documents\/SVN\/Sanguo\/Code\/trunk\/Client\/frameworks\/cocos2d-x\/cocos\/audio\/apple\/AudioPlayer.mm destroy 129\r\n\r\nV\/AudioPlayer (130): Before alSourcei\r\nE\/AudioPlayer (131): OpenAL error 0xA003 in \/Users\/semgilo\/Documents\/SVN\/Sanguo\/Code\/trunk\/Client\/frameworks\/cocos2d-x\/cocos\/audio\/apple\/AudioPlayer.mm destroy 131\r\n\r\nV\/AudioPlayer (136): AudioPlayer::destroy end, id=2321\r\nV\/AudioPlayer (69): ~AudioPlayer() (0x11138a0a0), id=2320\r\nV\/AudioPlayer (83): AudioPlayer::destroy begin, id=2320\r\nV\/AudioPlayer (128): Before alSourceStop\r\nE\/AudioPlayer (129): OpenAL error 0xA003 in \/Users\/semgilo\/Documents\/SVN\/Sanguo\/Code\/trunk\/Client\/frameworks\/cocos2d-x\/cocos\/audio\/apple\/AudioPlayer.mm destroy 129\r\n\r\nV\/AudioPlayer (130): Before alSourcei\r\nE\/AudioPlayer (131): OpenAL error 0xA003 in \/Users\/semgilo\/Documents\/SVN\/Sanguo\/Code\/trunk\/Client\/frameworks\/cocos2d-x\/cocos\/audio\/apple\/AudioPlayer.mm destroy 131\r\n\r\nV\/AudioPlayer (136): AudioPlayer::destroy end, id=2320\r\nV\/AudioPlayer (147): AudioPlayer::play2d, _alSource: 2401\r\nE\/AudioPlayer (161): OpenAL error 0xA003 in \/Users\/semgilo\/Documents\/SVN\/Sanguo\/Code\/trunk\/Client\/frameworks\/cocos2d-x\/cocos\/audio\/apple\/AudioPlayer.mm play2d 161\r\n\r\nE\/AudioPlayer (162): OpenAL error 0xA003 in \/Users\/semgilo\/Documents\/SVN\/Sanguo\/Code\/trunk\/Client\/frameworks\/cocos2d-x\/cocos\/audio\/apple\/AudioPlayer.mm play2d 162\r\n\r\nE\/AudioPlayer (163): OpenAL error 0xA003 in \/Users\/semgilo\/Documents\/SVN\/Sanguo\/Code\/trunk\/Client\/frameworks\/cocos2d-x\/cocos\/audio\/apple\/AudioPlayer.mm play2d 163\r\n\r\nE\/AudioPlayer (164): OpenAL error 0xA003 in \/Users\/semgilo\/Documents\/SVN\/Sanguo\/Code\/trunk\/Client\/frameworks\/cocos2d-x\/cocos\/audio\/apple\/AudioPlayer.mm play2d 164\r\n\r\nE\/AudioPlayer (208): OpenAL error 0xA003 in \/Users\/semgilo\/Documents\/SVN\/Sanguo\/Code\/trunk\/Client\/frameworks\/cocos2d-x\/cocos\/audio\/apple\/AudioPlayer.mm play2d 208\r\n\r\nE\/AudioPlayer (217): bool cocos2d::experimental::AudioPlayer::play2d():alSourcePlay error code:a003\r\nV\/AudioPlayer (69): ~AudioPlayer() (0x1165be510), id=2322\r\nV\/AudioPlayer (83): AudioPlayer::destroy begin, id=2322\r\nV\/AudioPlayer (128): Before alSourceStop\r\nE\/AudioPlayer (129): OpenAL error 0xA003 in \/Users\/semgilo\/Documents\/SVN\/Sanguo\/Code\/trunk\/Client\/frameworks\/cocos2d-x\/cocos\/audio\/apple\/AudioPlayer.mm destroy 129\r\n","comments":["Thanks for your feedback.\r\nCould the test case in cpp-tests\/New AudioEngine Test reproduce this issue?","@dumganhar I will give it a try, and then to answer you","@dumganhar it also produced in lua-tests \r\niphone 6 \r\ncocos2dx 3.14\r\n\r\nhold down the home button utils the siri called, the issue will produced sometime\r\n","@semgilo, thank you. I will give it a try.","@dumganhar how about the result ","@semgilo , sorry, I'm really busy these days.\r\nI will test it when I have time.","@semgilo , I couldn't reproduce by lua-tests\/AudioEngineTest.\r\nThe audio is always playing.","@dumganhar it was reproduced easily , please do it more times   \r\n1.open app and play music\r\n2.hold home until siri openned\r\n3.say something\r\n4.hold home return app\r\n i found the other issue : sometime the app crashed when audio uncaching file  \r\ni got  many crash info \r\n<img width=\"849\" alt=\"30283beb-8455-4191-835f-6844d5f661ae\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/7121873\/23646808\/7c9b4870-034d-11e7-83c6-dc5fcba05069.png\">\r\n","@semgilo , I tried really lots of times without reproducing this issue.\r\nCould you upload a video of reproducing? I guess I have something missing.","@dumganhar i upload to youku  http:\/\/v.youku.com\/v_show\/id_XMjYxMjIwNjg4MA==.html","@semgilo , thanks for the video. I will check it again.","@semgilo , could you check the AppDelegate.cpp in your game  project?\r\nIf it has the following `SimpleAudioEngine` invocation, try to remove it since you're using AudioEngine and test again.\r\n```c++\r\n\/\/ This function will be called when the app is inactive. Note, when receiving a phone call it is invoked.\r\nvoid AppDelegate::applicationDidEnterBackground()\r\n{\r\n    Director::getInstance()->stopAnimation();\r\n\r\n\/\/    SimpleAudioEngine::getInstance()->pauseBackgroundMusic(); \/\/ Remove this line\r\n\/\/ Remove all SimpleAudioEngine invocations\r\n}\r\n\r\n\/\/ this function will be called when the app is active again\r\nvoid AppDelegate::applicationWillEnterForeground()\r\n{\r\n    Director::getInstance()->startAnimation();\r\n\r\n\/\/    SimpleAudioEngine::getInstance()->resumeBackgroundMusic(); \/\/ remove this line\r\n\/\/ Remove all SimpleAudioEngine invocations\r\n}\r\n```","It could be reproduced stably by the following steps:\r\n* Game code only uses `AudioEngine` interfaces\r\n* In AppDelegate.cpp, applicationDidEnterBackground & applicationWillEnterForeground invoke `SimpleAudioEngine` methods\r\n* Launch Lua-tests or your game\r\n* Press Home button to switch to background\r\n* Click game icon to enter foreground\r\n* Long press Home button to call Siri out\r\n* Press Home button to go back game again\r\n* No sound anymore\r\n\r\nThis issue is caused by using `SimpleAudioEngine` and `AudioEngine` both.","@semgilo, could my solution work for you?","I sent a PR (https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/17485) for this issue to avoid invoking any SimpleAudioEngine methods if game only uses AudioEngine.","@dumganhar it doesn't work for me,  i try it by \r\n\r\n`\/\/ This function will be called when the app is inactive. Note, when receiving a phone call it is invoked.\r\nvoid AppDelegate::applicationDidEnterBackground()\r\n{\r\n    Director::getInstance()->stopAnimation();\r\n\r\n\/\/    SimpleAudioEngine::getInstance()->pauseBackgroundMusic(); \/\/ Remove this line\r\n\/\/ Remove all SimpleAudioEngine invocations\r\n}\r\n\r\n\/\/ this function will be called when the app is active again\r\nvoid AppDelegate::applicationWillEnterForeground()\r\n{\r\n    Director::getInstance()->startAnimation();\r\n\r\n\/\/    SimpleAudioEngine::getInstance()->resumeBackgroundMusic(); \/\/ remove this line\r\n\/\/ Remove all SimpleAudioEngine invocations\r\n}`\r\n\r\ni got the result by the same operation \r\n`I\/AudioEngine-inl.mm (260): OpenAL was initialized successfully!\r\nV\/AudioCache (86): AudioCache() 0x15ffd23b8, id=1\r\nV\/AudioCache (144): readDataTask, cache id=1\r\nV\/AudioCache (196): Orignal total frames: 353664, adjust frames: 529, current total frames: 354193\r\nV\/AudioPlayer (147): AudioPlayer::play2d, _alSource: 2400\r\nV\/AudioCache (259): pcm buffer was loaded successfully, total frames: 354193, total read frames: 353664, adjust frames: 529, remainingFrames: 529\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003`","@semgilo , did you try with lua-tests in v3.14?","@dumganhar yes","@semgilo , could you define CD_DEBUG=2 in `cocos\/audio\/ios\/CocosDenshion.h`?\r\nAnd re-compile and test again?\r\n```c++\r\n#undef CD_DEBUG  \/\/ James: Add this line\r\n#define CD_DEBUG 2  \/\/ James: Add this line\r\n\r\n#if !defined(CD_DEBUG) || CD_DEBUG == 0\r\n#define CDLOG(...) do {} while (0)\r\n#define CDLOGINFO(...) do {} while (0)\r\n```\r\n\r\nI wanna check it's definitely not caused by SimpleAudioEngine in your environment.","@semgilo  i got the issue when it goto siri  100percent","Please try to test it according my previous post.\r\nIt's possible to output some log if it's an issue in SimpleAudioEngine.","these my modifications\r\nAppDelegate.cpp\r\n```C++\r\n\/\/ This function will be called when the app is inactive. Note, when receiving a phone call it is invoked.\r\nvoid AppDelegate::applicationDidEnterBackground()\r\n{\r\n    Director::getInstance()->stopAnimation();\r\n\r\n\/\/    SimpleAudioEngine::getInstance()->pauseBackgroundMusic();\r\n}\r\n\r\n\/\/ this function will be called when the app is active again\r\nvoid AppDelegate::applicationWillEnterForeground()\r\n{\r\n    Director::getInstance()->startAnimation();\r\n\r\n\/\/    SimpleAudioEngine::getInstance()->resumeBackgroundMusic();\r\n}\r\n```\r\n\r\n\r\nCocosDenshion.h\r\n```C++\r\n#import <OpenAL\/al.h>\r\n#import <OpenAL\/alc.h>\r\n#import <AudioToolbox\/AudioToolbox.h>\r\n#import <Foundation\/Foundation.h>\r\n#import \"audio\/ios\/CDConfig.h\"\r\n\r\n#undef CD_DEBUG  \/\/ James: Add this line\r\n#define CD_DEBUG 2  \/\/ James: Add this line\r\n\r\n#if !defined(CD_DEBUG) || CD_DEBUG == 0\r\n#define CDLOG(...) do {} while (0)\r\n#define CDLOGINFO(...) do {} while (0)`\r\n\r\n```\r\n","@semgilo \r\nHow about the log output after adding `#define CD_DEBUG 2`?","@dumganhar  @minggo \r\n\r\ni don't know the log what you expected \r\ni had modified with you posted code \r\nthe  issue still exist and l got the logs \r\n\r\n\r\nI\/AudioEngine-inl.mm (260): OpenAL was initialized successfully!\r\nV\/AudioCache (86): AudioCache() 0x10ae42748, id=1\r\nV\/AudioCache (144): readDataTask, cache id=1\r\nV\/AudioCache (196): Orignal total frames: 353664, adjust frames: 529, current total frames: 354193\r\nV\/AudioPlayer (147): AudioPlayer::play2d, _alSource: 2400\r\n\r\n\r\nV\/AudioCache (259): pcm buffer was loaded successfully, total frames: 354193, total read frames: 353664, adjust frames: 529, remainingFrames: 529\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a003\r\nE\/AudioEngine-inl.mm (491): float cocos2d::experimental::AudioEngineImpl::getCurrentTime(int), audio id:0,error code:a00","I sent another PR (https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/17492) to fix A003 error.","@dumganhar \r\n\u4eca\u5929\u6211\u4e5f\u53d1\u73b0\u4e86\u540c\u6837\u7684\u95ee\u9898\uff0c\r\n\u6211\u6d4b\u8bd5\u73af\u5883\u662f\r\n\r\n> iphone 5S\r\n  xcode8.0\r\n  Coco2dx 3.15\r\n\u4f7f\u7528\u7684\u662ffix bug\u4e4b\u540e\u7684\u4ee3\u7801\r\n\r\n\u6bd4\u5bf9\u4e0b\u9762\u4e24\u4e2a\u65e5\u5fd7\r\n\r\n\u6b63\u5e38\u7684\u65e5\u5fd7\r\nI\/AudioEngine-inl.mm (314): OpenAL was initialized successfully!\r\nD\/AudioEngine-inl.mm (147): UIApplicationWillResignActiveNotification\r\nD\/AudioEngine-inl.mm (157): UIApplicationDidBecomeActiveNotification\r\nD\/AudioEngine-inl.mm (147): UIApplicationWillResignActiveNotification\r\nD\/AudioEngine-inl.mm (112): AVAudioSessionInterruptionTypeBegan, application != UIApplicationStateActive, alcMakeContextCurrent(nullptr)\r\nD\/AudioEngine-inl.mm (157): UIApplicationDidBecomeActiveNotification\r\nD\/AudioEngine-inl.mm (173): Audio session is still interrupted, pause director!\r\nD\/AudioEngine-inl.mm (128): AVAudioSessionInterruptionTypeEnded, application == UIApplicationStateActive, alcMakeContextCurrent(s_ALContext)\r\nD\/AudioEngine-inl.mm (134): AVAudioSessionInterruptionTypeEnded, director was paused, try to resume it.\r\n\r\n\u5f02\u5e38\u7684\u65e5\u5fd7\uff1a\r\nD\/AudioEngine-inl.mm (147): UIApplicationWillResignActiveNotification\r\nD\/AudioEngine-inl.mm (112): AVAudioSessionInterruptionTypeBegan, application != UIApplicationStateActive, alcMakeContextCurrent(nullptr)\r\nD\/AudioEngine-inl.mm (112): AVAudioSessionInterruptionTypeBegan, application != UIApplicationStateActive, alcMakeConteD\/AudioEngine-inl.mm (157): UIApplicationDidBecomeActiveNotification\r\nD\/AudioEngine-inl.mm (173): Audio session is still interrupted, pause director!\r\n\r\nAVAudioSessionInterruptionTypeEnded\u6ca1\u6709\u88ab\u7cfb\u7edf\u89e6\u53d1\uff0c\u5bfc\u81f4Director\u88abpause\r\n```\r\nelse if (isAudioSessionInterrupted)\r\n {\r\n          ALOGD(\"Audio session is still interrupted, pause director!\");\r\n            Director::getInstance()->pause();\r\n}\r\n```\r\n\u6839\u636eios\u6587\u6863\u91cc\u8bf4\u660e\u7684\uff0cAVAudioSessionInterruptionTypeEnded\u5e76\u4e0d\u4e00\u5b9a\u4f1a\u88ab\u89e6\u53d1\r\n[Responding to Interruptions](https:\/\/developer.apple.com\/library\/content\/documentation\/Audio\/Conceptual\/AudioSessionProgrammingGuide\/HandlingAudioInterruptions\/HandlingAudioInterruptions.html#\/\/apple_ref\/doc\/uid\/TP40007875-CH4-SW5)\r\n\r\n> Note: There is no guarantee that a begin interruption will have a corresponding end interruption. Your app needs to be aware of a switch to a foreground running state or the user pressing a Play button. In either case, determine whether your app should reactivate its audio session.\r\n\r\n\u8fd9\u6837\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6e38\u620f\u754c\u9762\u88ab\u201c\u5361\u6b7b\u201d\u7684\u5047\u8c61\u3002\r\n\r\n\u91cd\u73b0\u7684\u6b65\u9aa4\u8ddf\u4e0a\u6587\u4e2d\u63d0\u5230\u7684\u6b65\u9aa4\u4e00\u6837\uff1a\r\n\r\n1. Game code only uses AudioEngine interfaces\r\n2. In AppDelegate.cpp, applicationDidEnterBackground & applicationWillEnterForeground invoke SimpleAudioEngine methods\r\n3. Launch Lua-tests or your game\r\n4. Press Home button to switch to background\r\n5. Click game icon to enter foreground\r\n6. Long press Home button to call Siri out\r\n7. Press Home button to go back game again\r\n8. No sound anymore\r\n\r\n\u552f\u4e00\u7279\u522b\u7684\u5730\u65b9\u5728\u7b2c5\u6b65foreground\u4e4b\u540e\uff0c\u5728game\u753b\u9762\u51fa\u6765\uff0c\u800c\u58f0\u97f3\u8fd8\u6ca1\u6b63\u5e38\u64ad\u653e\u7684\u65f6\u5019\uff0c\u9a6c\u4e0a\r\n\u6309\u7b2c6\u6b65\u64cd\u4f5c\uff0c\u5c31\u5f88\u53ef\u80fd\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\u3002","@huangke, thanks for your feedback, I will check it.\r\nReopened this issue.","same issue with itunes, game is paused with message \"Audio session is still interrupted, pause director!\"","https:\/\/developer.apple.com\/library\/content\/documentation\/Audio\/Conceptual\/AudioSessionProgrammingGuide\/AudioGuidelinesByAppType\/AudioGuidelinesByAppType.html#\/\/apple_ref\/doc\/uid\/TP40007875-CH11-SW1\r\nlooks like AVAudioSessionSilenceSecondaryAudioHint is not implemented","any news?","Try to merge this patch https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/18146 and test again.","@formatCvt , did you test #18146 patch?","@dumganhar Yes, i will give feedback this week","@dumganhar Sorry for my late reply. I've test this path with cocos 3.16. Generally its help - because game is not paused anymore. But it still not respect ios audio guideline.","@formatCvt \r\nWhere could I find ios Audio guideline?","@dumganhar here https:\/\/developer.apple.com\/library\/content\/documentation\/Audio\/Conceptual\/AudioSessionProgrammingGuide\/AudioGuidelinesByAppType\/AudioGuidelinesByAppType.html#\/\/apple_ref\/doc\/uid\/TP40007875-CH11-SW1 \r\n> Play app soundtrack audio when other audio is not playing, otherwise allow the previous audio to play.","I encountered the same issue with cocos2d-x v3.17.2.\r\nIs there any update?\r\n\r\nDoes Cocos Creator have the same issue?","I encountered `a003` error when my game was playing the same mp3 file.\r\n\r\nmy game is built with Cocos Creator 2.3.3.\r\n\r\n```\r\nE\/AudioCache (272): void cocos2d::AudioCache::readDataTask(unsigned int): attaching audio to buffer fail: a003\r\nD\/AudioEngine-inl.mm (541): AudioEngineImpl::_play2d, cache was destroyed or not ready!\r\nE\/AudioCache (272): void cocos2d::AudioCache::readDataTask(unsigned int): attaching audio to buffer fail: a003\r\nD\/AudioEngine-inl.mm (541): AudioEngineImpl::_play2d, cache was destroyed or not ready!\r\nD\/AudioEngine-inl.mm (142): notification UIApplicationWillResignActiveNotification\r\nD\/AudioEngine-inl.mm (164): UIApplicationWillResignActiveNotification\r\nD\/AudioEngine-inl.mm (166): UIApplicationWillResignActiveNotification, alcMakeContextCurrent(nullptr)\r\nD\/AudioEngine-inl.mm (148): notification UIApplicationDidBecomeActiveNotification\r\nD\/AudioEngine-inl.mm (182): UIApplicationDidBecomeActiveNotification\r\nD\/AudioEngine-inl.mm (184): UIApplicationDidBecomeActiveNotification, alcMakeContextCurrent(s_ALContext)\r\n```\r\n[mvp-beforeclass-review_l2scw8_big_e.mp3.zip](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/5828536\/mvp-beforeclass-review_l2scw8_big_e.mp3.zip)\r\n\r\nJust download the above file and remove '.zip' from it's file name. \r\n\r\n"],"labels":["platform:ios","module:audio"]},{"title":"The Strategy of playing more than 32 audios at the same time needs to be changed","body":"Please refer to https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/17233\r\n\r\n- cocos2d-x version: v3.14.1\r\n- devices test on: Android devices\r\n- developing environments\r\n   - NDK version: r10e\r\n   - Xcode version: N\/A\r\n   - VS version: N\/A\r\n   - browser type and version: N\/A\r\n\r\nSteps to Reproduce:\r\n\r\n1. Just AudioEngine::play2d(...) as many audios as possible\r\n2. The latest audio will not be played, there is an output log:\r\n```\r\nFail to play xxx.mp3 cause by limited max instance of AudioEngine.\r\n```\r\n\r\n### HOW TO DO:\r\n\r\nBasically, we need to modify the behavior of playing more than `MAX` instances (32).\r\nCurrently, we just ignore the latest audio added to AudioEngine, IMO, this strategy doesn't make sense. We probably could take a look at `SoundPool` implementation in Android, which removes the oldest audio added to `AudioEngine` and re-uses it for the latest one.","comments":["+1 \r\nI agree :D","Any chance to add this \"feature\"? I'm really struggling with this issue A LOT.","Ideally one would mix the internal data buffer(s) if necessary (or always?) into a single or few channel(s) of actual playback. It's possible this is only practical on desktop and high-end mobile devices."],"labels":["module:audio"]},{"title":"Label with TTF will cause Memory Leak","body":"- cocos2d-x version:3.12\r\n- devices test on:SAMSUNG Galaxy Grand2,Android4.3; Asus...and so on\r\n- developing environments\r\n   - NDK version:r9d\r\n   - Xcode version:8.1\r\n\r\nHi,there. \r\nI use engine version 3.12 and now I have some problems with Label::create() on android,\r\nif i use it like \r\nauto pLabel = Label::create(\"testlabel\",\"res\/cocostudio\/ui\/fonts\/msyh.ttf\",20);\r\nwhich will cause memory leak,every time i call the function like that way,it will increase memory 3~4M (the ttf file's size is 4.3M) after i calling pLabel->removeFromParent();\r\n\r\nbut, when i use like Label::create(\"testlabel\",\"\",20) everything is ok\r\n\r\nthe problem just happen on android,not happend on mac\r\n\r\nthanks a lot!","comments":["hi there, \r\n\r\nwhen can solve this problem?\r\n\r\nthis problem not only affects Label::create(,xx.ttf) in c++ , but also affects cocostudio's json files that  use ui::Text in js scripts, then it becomes so seriously\r\n\r\nin last our game test in market, game's memory will reach 1GB..... :(\r\n\r\nthanks a lot!","hi,there,\r\ni have found the reason of this problem.\r\n\r\nformer,we packed the ttf files in our own game.pak file,this will cause memory leak\r\nnow,we don't packed ttf files into game.pak,just let it in it's folder,this will be normal\r\n\r\nbut,i don't know the why it works like this","Interesting. \r\nBTW, how did you check memory usage?","@bluesheet  How do you detect the memory leak in Android?"],"labels":["platform:android"]},{"title":"Multiline Editbox on Mac Misbehaving","body":"- cocos2d-x version: 3.13.1\r\n- devices test on: Mac Sierra & El Capitan\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version: \r\n   - VS version:\r\n   - browser type and version:\r\n\r\nWe're seeing a problem with a multiline EditBox (setInputMode(ui::EditBox::InputMode::ANY)).  The EditBox is at the bottom of our scene and whenever we start typing in it the typing appears at the top, outside the bounds of the EditBox.  After leaving focus of the EditBox the text snaps to the correct position.  Single line EditBox seems to work as expected.  \r\n","comments":["Have you tried editbox tests in cpp-tests? How do it work?","The editbox cpp-test is misbehaving for me as well.  Here's a screenshot that should show some random letters in the bottom multiline editbox, but nothing appears.  (See the console log that is visible below it to see what I was typing.)\r\n\r\n\r\n<img width=\"859\" alt=\"screen shot 2017-02-17 at 5 56 55 am\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/5265252\/23067852\/f09d0faa-f4d5-11e6-972b-4cc9cf7add05.png\">\r\n","I tested in with latest codes, can show one line characters because the height only can show one line. I do it in like:\r\n\r\n* enable multiline(click the `Multiline` item on the right)\r\n* input multiline words"],"labels":["platform:mac"]},{"title":"Cocosjs : Blocked a frame with origin","body":"- cocos2d-x version:3.14\r\n- devices test on: PC Windows 8.\r\n- developing environments: Cocos2dx - js\r\n \r\n   - browser type and version: GoogleChrome Version 56.0.2924.87 (64-bit)\r\n\r\nSteps to Reproduce:\r\n\r\n1. This is my game in Facebook. It's work fine with Cocos v3.10. Then i tried update Cocos to v3.14.\r\n2. When run it on Facebook canvas i have an error:\r\n![sc1](https:\/\/cloud.githubusercontent.com\/assets\/11454982\/23018010\/0a6f2f88-f46f-11e6-9e67-79970bebadb9.PNG)\r\n Cause by: \r\n          cc.LayerColor=cc.Layer.extend({....\r\n        visit:function(){\r\n                 if(this._visible){\r\n                   var a=cc.renderer,b=this._renderCmd;\r\n                    b.visit(parent   &&   **parent._renderCmd**);\r\n\r\nError fond at :      parent._renderCmd\r\n3.When i run the game canvas on my domain, it's fine.  : \r\n      When i tried to console.log(\"**parent**\"), it's seem to be different.\r\n\r\n![sc2](https:\/\/cloud.githubusercontent.com\/assets\/11454982\/23018060\/3923c168-f46f-11e6-8ed2-1e7414dcc1cd.PNG)\r\n\r\nPlease help! Thanks you guys.","comments":["There is an issue with cc.LayerColor.prototype.visit, please add a parameter `parent` in the function definition\r\n\r\nhttps:\/\/github.com\/cocos2d\/cocos2d-html5\/blob\/develop\/cocos2d\/core\/layers\/CCLayer.js#L250\r\n\r\nwe will fix it later"],"labels":["platform:web"]},{"title":"JSAutoCompartment","body":"- cocos2d-x version:  3.14.1\r\n- devices test on:\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version:\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n1. \r\n2. \r\n\r\nCrashed: cocos.solitaire\r\nSIGSEGV SEGV_MAPERR 0x0000000000000004\r\n Raw Text\r\n0\tlibcocos2djs.so\t\r\nJSAutoCompartment::JSAutoCompartment(JSContext*, JSObject*)\r\n\r\n\r\nI don't have any crash info.\r\n","comments":["Any test case to reproduce it?","sorry, i don't know how to reproduce it, but i have a lot of crash log in the fabric.","I also encountered this problem "," I have a lot of crash log in the bugly. cocos2d-js version is 3.9.","the same problem appear in cocos2d-js 3.10.\r\nwe use bugly to detect the crash,we can provide log to help fix the issue","\r\n### #GLThread 2273(2273)\r\n    SIGSEGV(SEGV_MAPERR)\r\n    1 #00 pc 008e75a4 \/mnt\/asec\/com.xxx.xxx\/lib\/arm\/libcocos2djs.so (JSAutoCompartment::JSAutoCompartment(JSContext*, JSObject*)+8) [armeabi-v6]\r\n    2 java:\r\n    3 org.cocos2dx.lib.Cocos2dxRenderer.onDrawFrame(Cocos2dxRenderer.java:104)\r\n    4 android.opengl.GLSurfaceView$GLThread.guardedRun(GLSurfaceView.java:1522)\r\n    5 android.opengl.GLSurfaceView$GLThread.run(GLSurfaceView.java:1239)\r\n\r\n### # main(1)\r\n    1 android.os.MessageQueue.nativePollOnce(Native Method)\r\n    2 android.os.MessageQueue.next(MessageQueue.java:143)\r\n    3 android.os.Looper.loop(Looper.java:122)\r\n    4 android.app.ActivityThread.main(ActivityThread.java:5446)\r\n    5 java.lang.reflect.Method.invoke(Native Method)\r\n    6 java.lang.reflect.Method.invoke(Method.java:372)\r\n    7 com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:941)\r\n    8 com.android.internal.os.ZygoteInit.main(ZygoteInit.java:736)\r\n### # ReferenceQueueDaemon(2264)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Daemons$ReferenceQueueDaemon.run(Daemons.java:134)\r\n    3 java.lang.Thread.run(Thread.java:818)\r\n### # FinalizerDaemon(2265)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Object.wait(Object.java:422)\r\n    3 java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:101)\r\n    4 java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:72)\r\n    5 java.lang.Daemons$FinalizerDaemon.run(Daemons.java:174)\r\n    6 java.lang.Thread.run(Thread.java:818)\r\n### # FinalizerWatchdogDaemon(2266)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Daemons$FinalizerWatchdogDaemon.waitForObject(Daemons.java:240)\r\n    3 java.lang.Daemons$FinalizerWatchdogDaemon.run(Daemons.java:212)\r\n    4 java.lang.Thread.run(Thread.java:818)\r\n### # HeapTrimmerDaemon(2267)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Daemons$HeapTrimmerDaemon.run(Daemons.java:311)\r\n    3 java.lang.Thread.run(Thread.java:818)\r\n### # GCDaemon(2268)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Daemons$GCDaemon.run(Daemons.java:344)\r\n    3 java.lang.Thread.run(Thread.java:818)\r\n### # logWriteThread(2276)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 com.tencent.qalsdk.sdk.ae.e(MyLinkedBlockingDeque.java:456)\r\n    7 com.tencent.qalsdk.sdk.ae.k(MyLinkedBlockingDeque.java:645)\r\n    8 com.tencent.qalsdk.sdk.t.run(LogToFileHelper.java:437)\r\n### # logWriteThread(2302)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 com.tencent.qalsdk.sdk.ae.e(MyLinkedBlockingDeque.java:456)\r\n    7 com.tencent.qalsdk.sdk.ae.k(MyLinkedBlockingDeque.java:645)\r\n    8 com.tencent.qalsdk.sdk.t.run(LogToFileHelper.java:437)\r\n### # WifiManager(2309)\r\n    1 android.os.MessageQueue.nativePollOnce(Native Method)\r\n    2 android.os.MessageQueue.next(MessageQueue.java:143)\r\n    3 android.os.Looper.loop(Looper.java:122)\r\n    4 android.os.HandlerThread.run(HandlerThread.java:61)\r\n### # handlerRespMsgThread(2312)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingDeque.takeFirst(LinkedBlockingDeque.java:460)\r\n    7 java.util.concurrent.LinkedBlockingDeque.take(LinkedBlockingDeque.java:649)\r\n    8 com.tencent.qalsdk.sdk.g.run(CoreWrapper.java:505)\r\n### # Timeout-Checker(2315)\r\n    1 android.os.MessageQueue.nativePollOnce(Native Method)\r\n    2 android.os.MessageQueue.next(MessageQueue.java:143)\r\n    3 android.os.Looper.loop(Looper.java:122)\r\n    4 android.os.HandlerThread.run(HandlerThread.java:61)\r\n### # Thread-2324(2324)\r\n    1 com.tencent.imcore.internalJNI.ThreadEntry_run(Native Method)\r\n    2 com.tencent.imcore.ThreadEntry.run(Unknown Source)\r\n    3 com.tencent.imsdk.ad.run(Unknown Source)\r\n    4 java.lang.Thread.run(Thread.java:818)\r\n### # Thread-2325(2325)\r\n    1 com.tencent.imcore.internalJNI.ThreadEntry_run(Native Method)\r\n    2 com.tencent.imcore.ThreadEntry.run(Unknown Source)\r\n    3 com.tencent.imsdk.ad.run(Unknown Source)\r\n    4 java.lang.Thread.run(Thread.java:818)\r\n### # Thread-2326(2326)\r\n    1 com.tencent.imcore.internalJNI.ThreadEntry_run(Native Method)\r\n    2 com.tencent.imcore.ThreadEntry.run(Unknown Source)\r\n    3 com.tencent.imsdk.ad.run(Unknown Source)\r\n    4 java.lang.Thread.run(Thread.java:818)\r\n### # Thread-2327(2327)\r\n    1 com.tencent.imcore.internalJNI.ThreadEntry_run(Native Method)\r\n    2 com.tencent.imcore.ThreadEntry.run(Unknown Source)\r\n    3 com.tencent.imsdk.ad.run(Unknown Source)\r\n    4 java.lang.Thread.run(Thread.java:818)\r\n### # Thread-2328(2328)\r\n    1 com.tencent.imcore.internalJNI.ThreadEntry_run(Native Method)\r\n    2 com.tencent.imcore.ThreadEntry.run(Unknown Source)\r\n    3 com.tencent.imsdk.ad.run(Unknown Source)\r\n    4 java.lang.Thread.run(Thread.java:818)\r\n### # Controller Message Processing Thread(2329)\r\n    1 android.os.MessageQueue.nativePollOnce(Native Method)\r\n    2 android.os.MessageQueue.next(MessageQueue.java:143)\r\n    3 android.os.Looper.loop(Looper.java:122)\r\n    4 android.os.HandlerThread.run(HandlerThread.java:61)\r\n### # Controller sPushMessage Processing Thread(2330)\r\n    1 android.os.MessageQueue.nativePollOnce(Native Method)\r\n    2 android.os.MessageQueue.next(MessageQueue.java:143)\r\n    3 android.os.Looper.loop(Looper.java:122)\r\n    4 android.os.HandlerThread.run(HandlerThread.java:61)\r\n### # PushThreadProcess(2334)\r\n    1 android.os.MessageQueue.nativePollOnce(Native Method)\r\n    2 android.os.MessageQueue.next(MessageQueue.java:143)\r\n    3 android.os.Looper.loop(Looper.java:122)\r\n    4 android.os.HandlerThread.run(HandlerThread.java:61)\r\n### # BUGLY_THREAD(2345)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:197)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2055)\r\n    6 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1060)\r\n    7 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:776)\r\n    8 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    9 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    10 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    11 java.lang.Thread.run(Thread.java:818)\r\n### # BUGLY_THREAD(2346)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1055)\r\n    7 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:776)\r\n    8 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    9 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    10 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    11 java.lang.Thread.run(Thread.java:818)\r\n### # BUGLY_THREAD(2347)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1055)\r\n    7 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:776)\r\n    8 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    9 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    10 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    11 java.lang.Thread.run(Thread.java:818)\r\n### # FileObserver(2348)\r\n    1 android.os.FileObserver$ObserverThread.observe(Native Method)\r\n    2 android.os.FileObserver$ObserverThread.run(FileObserver.java:85)\r\n### # NetWorkThread(2355)\r\n    1 android.os.MessageQueue.nativePollOnce(Native Method)\r\n    2 android.os.MessageQueue.next(MessageQueue.java:143)\r\n    3 android.os.Looper.loop(Looper.java:122)\r\n    4 android.os.HandlerThread.run(HandlerThread.java:61)\r\n### # java.lang.ProcessManager(2359)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.ProcessManager.waitForMoreChildren(ProcessManager.java:140)\r\n    3 java.lang.ProcessManager.watchChildren(ProcessManager.java:105)\r\n    4 java.lang.ProcessManager.access$000(ProcessManager.java:40)\r\n    5 java.lang.ProcessManager$1.run(ProcessManager.java:58)\r\n### # AsyncTask #1(2368)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # AsyncTask #2(2369)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # AsyncTask #3(2372)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # RefQueueWorker@org.apache.http.impl.conn.tsccm.ConnPoolByRoute@21a93bcf(2373)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Object.wait(Object.java:422)\r\n    3 java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:101)\r\n    4 java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:72)\r\n    5 org.apache.http.impl.conn.tsccm.RefQueueWorker.run(RefQueueWorker.java:107)\r\n    6 java.lang.Thread.run(Thread.java:818)\r\n### # pool-4-thread-1(2374)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # AsyncTask #4(2385)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # CleanupReference(2386)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Object.wait(Object.java:422)\r\n    3 java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:101)\r\n    4 java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:72)\r\n    5 org.chromium.content.common.CleanupReference$1.run(CleanupReference.java:50)\r\n### # JavaBridge(2387)\r\n    1 android.os.MessageQueue.nativePollOnce(Native Method)\r\n    2 android.os.MessageQueue.next(MessageQueue.java:143)\r\n    3 android.os.Looper.loop(Looper.java:122)\r\n    4 android.os.HandlerThread.run(HandlerThread.java:61)\r\n### # pool-1-thread-1(2391)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # AsyncTask #5(2393)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # pool-1-thread-2(2396)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # Thread-2399(2399)\r\n    1 android.os.BinderProxy.transactNative(Native Method)\r\n    2 android.os.BinderProxy.transact(Binder.java:496)\r\n    3 android.app.ActivityManagerProxy.startService(ActivityManagerNative.java:3576)\r\n    4 android.app.ContextImpl.startServiceCommon(ContextImpl.java:1771)\r\n    5 android.app.ContextImpl.startService(ContextImpl.java:1753)\r\n    6 android.content.ContextWrapper.startService(ContextWrapper.java:516)\r\n    7 com.tencent.qalsdk.sdk.z.a(MsfServiceProxy.java:70)\r\n    8 com.tencent.qalsdk.sdk.aj.i(RemoteServiceProxy.java:289)\r\n    9 com.tencent.qalsdk.sdk.aj.c(RemoteServiceProxy.java:234)\r\n    10 com.tencent.qalsdk.sdk.ac.b(MsfServiceSdk.java:279)\r\n    11 com.tencent.qalsdk.sdk.e.a(CoreWrapper.java:705)\r\n    12 com.tencent.qalsdk.sdk.e.a(CoreWrapper.java:666)\r\n    13 com.tencent.qalsdk.QALSDKManager.sendMsg(QALSDKManager.java:235)\r\n    14 com.tencent.imsdk.IMMsfCoreProxy.request(Unknown Source)\r\n    15 com.tencent.imsdk.IMCoreAndroidEnv.sSORequest(Unknown Source)\r\n    16 com.tencent.imcore.internalJNI.SwigDirector_IEnv_sSORequest__SWIG_0(Unknown Source)\r\n    17 com.tencent.imcore.internalJNI.ThreadEntry_run(Native Method)\r\n    18 com.tencent.imcore.ThreadEntry.run(Unknown Source)\r\n    19 com.tencent.imsdk.ad.run(Unknown Source)\r\n    20 java.lang.Thread.run(Thread.java:818)\r\n### # Thread-2400(2400)\r\n    1 com.tencent.imcore.internalJNI.ThreadEntry_run(Native Method)\r\n    2 com.tencent.imcore.ThreadEntry.run(Unknown Source)\r\n    3 com.tencent.imsdk.ad.run(Unknown Source)\r\n    4 java.lang.Thread.run(Thread.java:818)\r\n    # pool-1-thread-3(2404)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # pool-1-thread-4(2405)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # pool-1-thread-5(2406)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # pool-1-thread-6(2407)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # pool-1-thread-7(2408)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # pool-1-thread-8(2409)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # pool-1-thread-9(2410)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # pool-1-thread-10(2411)\r\n    1 java.lang.Object.wait(Native Method)\r\n    2 java.lang.Thread.parkFor(Thread.java:1220)\r\n    3 sun.misc.Unsafe.park(Unsafe.java:299)\r\n    4 java.util.concurrent.locks.LockSupport.park(LockSupport.java:157)\r\n    5 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2016)\r\n    6 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:410)\r\n    7 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1035)\r\n    8 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1097)\r\n    9 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)\r\n    10 java.lang.Thread.run(Thread.java:818)\r\n### # Thread-2415(2415)\r\n    1 dalvik.system.VMStack.getThreadStackTrace(Native Method)\r\n    2 java.lang.Thread.getStackTrace(Thread.java:580)\r\n    3 java.lang.Thread.getAllStackTraces(Thread.java:522)\r\n    4 com.tencent.bugly.proguard.y.a(BUGLY:1099)\r\n    5 com.tencent.bugly.crashreport.crash.jni.a.packageCrashDatas(BUGLY:120)\r\n    6 com.tencent.bugly.crashreport.crash.jni.a.handleNativeException2(BUGLY:288)"],"labels":["script:jsb"]},{"title":"when load mp3 file(duration is over 15sec) and set currentTime, problem","body":"- cocos2d-x version: 3.10\r\n- devices test on: Window10\r\n- developing environments\r\n   - NDK version: r9d\r\n   - Xcode version:\r\n   - VS version: VS community\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n1. use cocos2d::experimental::audioengine\r\nload mp3 file(over 15sec duration)\r\n2. and set current time in this file and play,\r\ndidn't start current time, only start file's 0:00.\r\n","comments":["It is an old version. Why not try latest version?","oh, sorry, my version is 3.10\r\nI confuse 3.1 &3.10"],"labels":["module:audio"]},{"title":"Android crashing on first launch","body":"- cocos2d-x version: 3.13.1\r\n- devices test on: Nexus 7 (2012) with Android 5.1.1  and Samsung Galaxy Alpha with Android 5.0.2\r\n- developing environments\r\n   - NDK version: r13b\r\n   - Xcode version: 8.2.1\r\n\r\nOn first start of application, it crashes with the following log:\r\n\r\n02-13 17:53:11.909 122-122\/? I\/DEBUG: Revision: '0'\r\n02-13 17:53:11.909 122-122\/? I\/DEBUG: ABI: 'arm'\r\n02-13 17:53:11.909 122-122\/? I\/DEBUG: pid: 24807, tid: 25863, name: GLThread 1159  >>> com.protectfive.cocos2dx.sample <<<\r\n02-13 17:53:11.910 122-122\/? I\/DEBUG: signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 0x20\r\n02-13 17:53:11.939 122-122\/? I\/DEBUG: backtrace:\r\n02-13 17:53:11.940 122-122\/? I\/DEBUG:     #00 pc 00788130  \/data\/app\/com.protectfive.cocos2dx.sample-1\/lib\/arm\/libMyGame.so (cocos2d::GLProgram::reset()+48)\r\n02-13 17:53:11.940 122-122\/? I\/DEBUG:     #01 pc 00791948  \/data\/app\/com.protectfive.cocos2dx.sample-1\/lib\/arm\/libMyGame.so (cocos2d::GLProgramCache::reloadDefaultGLPrograms()+2652)\r\n02-13 17:53:11.940 122-122\/? I\/DEBUG:     #02 pc 0052d4e1  \/data\/app\/com.protectfive.cocos2dx.sample-1\/lib\/arm\/libMyGame.so (Java_org_cocos2dx_lib_Cocos2dxRenderer_nativeInit+184)\r\n\r\nThe following launches, the app is working fine.\r\n\r\nOn first launch, the app downloads an obb file (native Android Activity) from google play, and after validating the download, it starts the Cocos2dxActivity.\r\n\r\nI'm compiling the project with the following Android.mk file:\r\n\r\nAPP_STL := gnustl_static\r\nAPP_CPPFLAGS := -frtti -DCC_ENABLE_CHIPMUNK_INTEGRATION=1 -std=c++11 -fsigned-char\r\nAPP_LDFLAGS := -latomic\r\nAPP_ABI := armeabi-v7a arm64-v8a x86\r\nifeq ($(NDK_DEBUG),1)\r\n  APP_CPPFLAGS += -DCOCOS2D_DEBUG=1\r\n  APP_OPTIM := debug\r\nelse\r\n  APP_CPPFLAGS += -DNDEBUG\r\n  APP_OPTIM := release\r\nendif\r\n\r\nHow can I fix this problem? How can I find out what produces the crash?\r\n\r\nThanks!\r\n","comments":["> On first launch, the app downloads an obb file (native Android Activity) from google play, and after validating the download, it starts the Cocos2dxActivity.\r\n\r\nI think it is caused by it. Could you please tell me how did you do it in detail?","Hi,\r\nI've developed a native Activity which handles the download of the .obb file (zip extension changed) if it doesn't exists. After the download (first launch), or if the file exists (next launches), I start the verification of the file and if is correct, I start the AppActivity (Cocos2dxActivity). I've followed google developers instructions and samples (https:\/\/developer.android.com\/google\/play\/expansion-files.html) and this process is working fine. \r\nOn the first launch, when the app crashes (after the download) I've debugged the Cocos2dxActivity and it seems all correct. In the Cocos2dxHelper.init(this):\r\n\r\n154 Cocos2dxHelper.nativeSetApkPath(Cocos2dxHelper.getAssetsPath());\r\n155 Log.d(\"Cocos2dxHelper\", \"sAssetsPath: \" + Cocos2dxHelper.sAssetsPath.toString());\r\n\r\n181 try {\r\n182                Cocos2dxHelper.sOBBFile = APKExpansionSupport.getAPKExpansionZipFile(Cocos2dxActivity.getContext(), versionCode, 0);\r\n183                Log.d(\"Cocos2dxHelper\", \"sOBBFile: \" + Cocos2dxHelper.sOBBFile.toString());\r\n184 } catch (IOException e) {\r\n185                e.printStackTrace();\r\n186  }\r\n\r\nCocos2dxHelper.sAssetsPath contains the correct path to the obb file and Cocos2dxHelper.sOBBFile contains the ZipResourceFile.\r\n\r\nWith this debugging results, everything looks ok to me... I'm unable to figure out where the error is!\r\n\r\nAny help please?\r\n\r\nThanks.","Sorry, i don't have similar experience about using native activity to start cocos2d-x activity. May be you can post a ticket in the [forum](http:\/\/discuss.cocos2d-x.org\/), other developers may give some help.\r\n\r\n> \/data\/app\/com.protectfive.cocos2dx.sample-1\/lib\/arm\/libMyGame.so (cocos2d::GLProgram::reset()+48)\r\n\r\nDo you know the which line cause the issue?","Hi,\r\nI've found the solution to avoid the crash, although I don't understand what is causing it.\r\n\r\nBecause the download is managed with a service and updates the current Activity with a pendingIntent, if I start de Cocos2dxAcitivity without the intent flag Intent.FLAG_ACTIVITY_SINGLE_TOP, Android starts the Cocos2dxActivity in a new task and this is causing the crash.\r\n\r\nDo you have any explanation of what may be the cause of the crash?\r\n\r\n\r\n\r\n","Sorry, i have not idea about it. Could you please find which line cause the crash?","Hi,\r\nI don't know the exact line that causes the crash  due to the difficulty to debug or trace errors in the Android version of the cocos2dx app. Is there a way to develop and debug it with Android Studio?\r\n\r\nThe crash is occurring before the first's scene init method, after director->runWithScene(scene);\r\n\r\n","You can try this PR https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/15676. I will merge it in this version or next version."],"labels":["platform:android"]},{"title":"Crash: Restart Game Multithreading problem","body":"- cocos2d-x version: 3.6 and new\r\n- devices test on:\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version:\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\nPlease look at those following key points:\r\n```CPP\r\nvoid HttpClient::sendImmediate(HttpRequest* request)\r\n{\r\n    if(!request)\r\n    {\r\n        return;\r\n    }\r\n    request->retain();\r\n    \/\/ Create a HttpResponse object, the default setting is http access failed\r\n    HttpResponse *response = new (std::nothrow) HttpResponse(request);\r\n    auto t = std::thread(&HttpClient::networkThreadAlone, this, request, response);\r\n    t.detach();\r\n}\r\n```\r\nWhen running 'restart()', the JS engine will restart, because of the uneffective management of 't'.\r\n```CPP\r\nvoid Director::restartDirector()\r\n{\r\n    reset();\r\n    \/\/ Texture cache need to be reinitialized\r\n    initTextureCache();\r\n    \/\/ Reschedule for action manager\r\n    getScheduler()->scheduleUpdate(getActionManager(), Scheduler::PRIORITY_SYSTEM, false);\r\n    \/\/ release the objects\r\n    PoolManager::getInstance()->getCurrentPool()->clear();\r\n    \/\/ Real restart in script level\r\n#if CC_ENABLE_SCRIPT_BINDING\r\n    ScriptEvent scriptEvent(kRestartGame, NULL);\r\n    ScriptEngineManager::getInstance()->getScriptEngine()->sendEvent(&scriptEvent);\r\n#endif\r\n}\r\n```\r\n## Crash point\r\nThen the thread is waiting for the return of 'processResponse()', but, on the same time, the game has already restarted, and the running thread is out of control.\r\n\r\n```CPP\r\nvoid HttpClient::networkThreadAlone(HttpRequest* request, HttpResponse* response)\r\n{\r\n    char errorBuffer[ERROR_SIZE] = { 0 };\r\n    processResponse(response, errorBuffer);\r\n    auto scheduler = Director::getInstance()->getScheduler();\r\n    scheduler->performFunctionInCocosThread([response, request]{\r\n        const ccHttpRequestCallback& callback = request->getCallback();\r\n        Ref* pTarget = request->getTarget();\r\n        SEL_HttpResponse pSelector = request->getSelector();\r\n        if (callback != nullptr)\r\n        {\r\n            callback(s_HttpClient, response);\r\n        }\r\n        else if (pTarget && pSelector)\r\n        {\r\n            (pTarget->*pSelector)(s_HttpClient, response);\r\n        }\r\n        response->release();\r\n        \/\/ do not release in other thread\r\n        request->release();\r\n    });\r\n}\r\n```\r\nWhen the network is relaticely poor, thread will cause that 'SAFE_REMOVE_OBJECT' release crash after the game 'restart()'.\r\n\r\n```CPP\r\nMinXmlHttpRequest::~MinXmlHttpRequest()\r\n{\r\n#define SAFE_REMOVE_OBJECT(callback) if (callback != NULL)\\\r\n    {\\\r\n        JS::RemoveObjectRoot(_cx, &callback);\\\r\n    }\r\n    SAFE_REMOVE_OBJECT(_onreadystateCallback);\r\n    SAFE_REMOVE_OBJECT(_onloadstartCallback);\r\n    SAFE_REMOVE_OBJECT(_onloadendCallback);\r\n    SAFE_REMOVE_OBJECT(_onloadCallback);\r\n    SAFE_REMOVE_OBJECT(_onerrorCallback);\r\n    SAFE_REMOVE_OBJECT(_onabortCallback);\r\n    SAFE_REMOVE_OBJECT(_ontimeoutCallback);\r\n    if (_httpRequest)\r\n    {\r\n        \/\/ We don't need to release _httpRequest here since it will be released in the http callback.\r\n\/\/        _httpRequest->release();\r\n    }\r\n    CC_SAFE_FREE(_data);\r\n    CC_SAFE_RELEASE_NULL(_scheduler);\r\n}\r\n```\r\nAfter all, should all the thread be managed and be closed effctively?\r\n","comments":["cooooooooooooooool!","@minggo please at","the restart() function is added to for JSB to just re-load js-script, please don't use it in multi thread environment.","Firstly of all, I don't use the Multi-Threading environment, and it's the part of network request to use it. Then if I want to solve the problem, I have to modify your network layer. Therefore, do you have any better  solution for the problem? HttpClient is cocos network function, not mine","Could you please provide a test case?","All right, please wait for a moment.","```js\r\n\r\nvar HelloWorldLayer = cc.Layer.extend({\r\n    sprite:null,\r\n    ctor:function () {\r\n        \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\r\n        \/\/ 1. super init first\r\n        this._super();\r\n\r\n        \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\r\n        \/\/ 2. add a menu item with \"X\" image, which is clicked to quit the program\r\n        \/\/    you may modify it.\r\n        \/\/ ask the window size\r\n        var size = cc.winSize;\r\n\r\n        \/\/ add a \"close\" icon to exit the progress. it's an autorelease object\r\n        var closeItem = new cc.MenuItemImage(\r\n            res.CloseNormal_png,\r\n            res.CloseSelected_png,\r\n            function () {\r\n                cc.director.restart();\r\n            }, this);\r\n        closeItem.attr({\r\n            x: size.width - 20,\r\n            y: 20,\r\n            anchorX: 0.5,\r\n            anchorY: 0.5\r\n        });\r\n\r\n        var menu = new cc.Menu(closeItem);\r\n        menu.x = 0;\r\n        menu.y = 0;\r\n        this.addChild(menu, 1);\r\n\r\n        \/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\r\n        \/\/ 3. add your codes below...\r\n        \/\/ add a label shows \"Hello World\"\r\n        \/\/ create and initialize a label\r\n        var helloLabel = new cc.LabelTTF(\"Hello World\", \"Arial\", 38);\r\n        \/\/ position the label on the center of the screen\r\n        helloLabel.x = size.width \/ 2;\r\n        helloLabel.y = 0;\r\n        \/\/ add the label as a child to this layer\r\n        this.addChild(helloLabel, 5);\r\n\r\n        \/\/ add \"HelloWorld\" splash screen\"\r\n        this.sprite = new cc.Sprite(res.HelloWorld_png);\r\n        this.sprite.attr({\r\n            x: size.width \/ 2,\r\n            y: size.height \/ 2,\r\n            scale: 0.5,\r\n            rotation: 180\r\n        });\r\n        this.addChild(this.sprite, 0);\r\n\r\n        this.sprite.runAction(\r\n            cc.sequence(\r\n                cc.rotateTo(2, 0),\r\n                cc.scaleTo(2, 1, 1)\r\n            )\r\n        );\r\n        helloLabel.runAction(\r\n            cc.spawn(\r\n                cc.moveBy(2.5, cc.p(0, size.height - 40)),\r\n                cc.tintTo(2.5,255,125,0)\r\n            )\r\n        );\r\n\r\n        const LEGAL_PROTOCAL_HEAD_REGEX = \/https?:\\\/\\\/\/;\r\n        const HTTP_PROTOCAL_HEAD = 'http:\/\/';\r\n\r\n        var sendRequest = function (host, method, param, cb, isIgnoreErr) {\r\n            if (!host.match(LEGAL_PROTOCAL_HEAD_REGEX)) {\r\n                host = HTTP_PROTOCAL_HEAD + host;\r\n            }\r\n\r\n            var xhr = cc.loader.getXMLHttpRequest();\r\n            xhr.timeout = 10000;\r\n\r\n            var isErr = false;\r\n\r\n            xhr.onloadend = function () {\r\n                if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {\r\n                    return cb(null, xhr.responseText);\r\n                }\r\n                !isErr && cb({code: 311, data: \"\"});\r\n            };\r\n            xhr.ontimeout = function () {\r\n                cb({code: 312, data: \"\"});\r\n            };\r\n            xhr.onerror = function () {\r\n                isErr = true;\r\n                cb({code: 313, data: \"\"});\r\n            };\r\n\r\n            switch (method) {\r\n                case 'GET':\r\n                    xhr.open(method, host + '?' + param, true);\r\n                    xhr.send();\r\n                    break;\r\n                case 'POST':\r\n                    xhr.open(method, host);\r\n                    xhr.send(param);\r\n                    break;\r\n                default :\r\n                    cc.error('not supported method :' + method);\r\n                    cb && cb({code: 310, data: \"\"});\r\n                    break;\r\n            }\r\n        };\r\n\r\n        sendRequest(\"www.google.com\", \"POST\", \"\", function (data) {\r\n                    cc.log(data.code);\r\n                    cc.log(1);\r\n        });\r\n\r\n        sendRequest(\"www.google.com\", \"POST\", \"\", function (data) {\r\n            if (!data) {\r\n                return;\r\n            }\r\n                    \r\n            if (data.code !== 312) {\r\n                return;\r\n            }\r\n            \r\n            cc.director.restart();\r\n        });\r\n\r\n        sendRequest(\"www.google.com\", \"POST\", \"\", function () {\r\n        });\r\n        return true;\r\n    }\r\n});\r\n\r\nvar HelloWorldScene = cc.Scene.extend({\r\n    onEnter:function () {\r\n        this._super();\r\n        var layer = new HelloWorldLayer();\r\n        this.addChild(layer);\r\n    }\r\n});\r\n```\r\n![image](https:\/\/cloud.githubusercontent.com\/assets\/1875780\/23115320\/11389e86-f77f-11e6-80a1-d08da975abdb.png)\r\n\r\nAn important theme to notice: In my network environment, Google is not accessible, and it will timeout.\r\n","What's more, if there is no trigger, please wait a little longer, thank you. @minggo ","It's very helpful to me","Jesus...it's very helpful to me","Wow,dude,it's quite **helpful** to me.","God...It's very **helpful** to me","Oh, it's **very** helpful to me","OH GOD.  IT\u2018S VERY HELPFUL TO ME.....","I have been waiting for 2 days, how should I deal with this problem? @minggo ","Basically, we should not use `.detach()`  stuff in our code, it will cause this issue.\r\nIf director is restarting and HttpClient should exit and join network thread to make a safety destruction.","CCDirector add reset event.\r\n```c++\r\nvoid Director::reset()\r\n{    \r\n    if (_runningScene)\r\n    {\r\n        _runningScene->onExit();\r\n        _runningScene->cleanup();\r\n        _runningScene->release();\r\n    }\r\n    \r\n    _runningScene = nullptr;\r\n    _nextScene = nullptr;\r\n\r\n    _eventDispatcher->dispatchEvent(_eventResetDirector);\r\n    \r\n    \/\/ cleanup scheduler\r\n    getScheduler()->unscheduleAll();\r\n    \r\n    \/\/ Remove all events\r\n    if (_eventDispatcher)\r\n    {\r\n        _eventDispatcher->removeAllEventListeners();\r\n    }\r\n    \r\n    \/\/ remove all objects, but don't release it.\r\n    \/\/ runWithScene might be executed after 'end'.\r\n    _scenesStack.clear();\r\n    \r\n    stopAnimation();\r\n    \r\n    CC_SAFE_RELEASE_NULL(_FPSLabel);\r\n    CC_SAFE_RELEASE_NULL(_drawnBatchesLabel);\r\n    CC_SAFE_RELEASE_NULL(_drawnVerticesLabel);\r\n    \r\n    \/\/ purge bitmap cache\r\n    FontFNT::purgeCachedData();\r\n    FontAtlasCache::purgeCachedData();\r\n    \r\n    FontFreeType::shutdownFreeType();\r\n    \r\n    \/\/ purge all managed caches\r\n    \r\n#if defined(__GNUC__) && ((__GNUC__ >= 4) || ((__GNUC__ == 3) && (__GNUC_MINOR__ >= 1)))\r\n#pragma GCC diagnostic ignored \"-Wdeprecated-declarations\"\r\n#elif _MSC_VER >= 1400 \/\/vs 2005 or higher\r\n#pragma warning (push)\r\n#pragma warning (disable: 4996)\r\n#endif\r\n\/\/it will crash clang static analyzer so hide it if __clang_analyzer__ defined\r\n#ifndef __clang_analyzer__\r\n    DrawPrimitives::free();\r\n#endif\r\n#if defined(__GNUC__) && ((__GNUC__ >= 4) || ((__GNUC__ == 3) && (__GNUC_MINOR__ >= 1)))\r\n#pragma GCC diagnostic warning \"-Wdeprecated-declarations\"\r\n#elif _MSC_VER >= 1400 \/\/vs 2005 or higher\r\n#pragma warning (pop)\r\n#endif\r\n    AnimationCache::destroyInstance();\r\n    SpriteFrameCache::destroyInstance();\r\n    GLProgramCache::destroyInstance();\r\n    GLProgramStateCache::destroyInstance();\r\n    FileUtils::destroyInstance();\r\n    AsyncTaskPool::destoryInstance();\r\n    \r\n    \/\/ cocos2d-x specific data structures\r\n    UserDefault::destroyInstance();\r\n    \r\n    GL::restartInvalidateStateCache();\r\n    \r\n    destroyTextureCache();\r\n}\r\n```\r\n\r\nMinXmlHttpRequest release js callback before js vm restart.\r\n```c++\r\nMinXmlHttpRequest::MinXmlHttpRequest()\r\n{\r\n    _scheduler = cocos2d::Director::getInstance()->getScheduler();\r\n    _scheduler->retain();\r\n\r\n    _resetListener = cocos2d::Director::getInstance()->getEventDispatcher()->addCustomEventListener(cocos2d::Director::EVENT_RESET, [=](cocos2d::EventCustom* event){\r\n        this->releaseJsCallback();\r\n    });\r\n}\r\n\r\nMinXmlHttpRequest::~MinXmlHttpRequest()\r\n{\r\n    this->releaseJsCallback();\r\n\r\n    CC_SAFE_FREE(_data);\r\n    CC_SAFE_RELEASE_NULL(_scheduler);\r\n    \r\n    cocos2d::Director::getInstance()->getEventDispatcher()->removeEventListener(_resetListener);\r\n}\r\n\r\nvoid MinXmlHttpRequest::releaseJsCallback()\r\n{\r\n    if(_isReset) {\r\n        return;\r\n    }\r\n    \r\n    _isReset = true;\r\n    \r\n#define SAFE_REMOVE_OBJECT(callback) if (callback != NULL)\\\r\n{\\\r\nJS::RemoveObjectRoot(_cx, &callback);\\\r\n}\r\n\r\n    SAFE_REMOVE_OBJECT(_onreadystateCallback);\r\n    SAFE_REMOVE_OBJECT(_onloadstartCallback);\r\n    SAFE_REMOVE_OBJECT(_onloadendCallback);\r\n    SAFE_REMOVE_OBJECT(_onloadCallback);\r\n    SAFE_REMOVE_OBJECT(_onerrorCallback);\r\n    SAFE_REMOVE_OBJECT(_onabortCallback);\r\n    SAFE_REMOVE_OBJECT(_ontimeoutCallback);\r\n}\r\n```\r\n","any update?"],"labels":["module:network"]},{"title":"Crash when using debug prebuilt libs","body":"do:\r\n1. cocos gen-libs -c -p win32 -m debug\r\n2. cocos gen-templates\r\n3. cocos new project -p com.company.project -l cpp -t binary\r\n\r\nthen open-compile-run project in vs2015\r\nproject will crash on first cocos function call with std::string parameter\r\nVS show this parameter in that cocos function as \"Error reading characters of string\"\r\n\r\neverything ok when using release version of prebuilt libs\r\n\r\n- cocos2d-x version: 3.14.1\r\n- devices test on: PC, win7 64\r\n- developing environments\r\n   - VS version: 2015","comments":["Could you upload more detailed log about the crash?","i don't know where cocos crash log is\r\nhere some screenshots\r\n\r\ncrash happened on first call with string parameter\r\n![screenshot - 13 02 2017 22_42_40](https:\/\/cloud.githubusercontent.com\/assets\/15831256\/22902653\/6ecd05c8-f23e-11e6-8b81-ccae0df768bf.png)\r\n\r\nexception thrown in setViewName function and VS can't show string characters\r\n![screenshot - 13 02 2017 22_45_04](https:\/\/cloud.githubusercontent.com\/assets\/15831256\/22902710\/a0fd215e-f23e-11e6-9966-21bb5b376b3d.png)\r\n\r\n","Have the same issue and dont know how to handle it. Just did what said in this tutorial http:\/\/www.cocos2d-x.org\/docs\/editors_and_tools\/cocosCLTool\/ . ","@natural-law, please take a look at this issue. Thanks.","@SASkievua Please don't use command `cocos gen-templates` anymore. In fact, it's a internal command for Cocos Studio usage. I'll remove the command later! @slackmoehrle Could you please update the documents to remove the binary-templates related information?\r\n\r\n Sorry for the confusion!","@natural-law thanks for your replay! \r\nbut how we are supposed to create new projects with precompiled libraries without corresponding template?\r\nthere are no template for precompiled libraries in downloaded cocos2dx package "],"labels":["platform:win32"]},{"title":"WebSocket doesn't connect on 3G","body":"WebSocket consistently doesn't work on some connections. I can replicate the following behavior 100% of the time on my Vodafone (India) 3G connection. It works on my WIFI connection. On the same connection 3.9 works, tests on websockets.org also work. So, this seems to have been recently introduced somewhere between 3.9 and 3.14. \r\n\r\nlws_client_connect in WebSocket.cpp:619 returns NULL. \r\n\r\n- cocos2d-x version: 3.14.1\r\n- devices test on: ipad mini\r\n- developing environments\r\n   - Xcode version: 8.1\r\n\r\nSteps to Reproduce:\r\n\r\n1. Run cocos2d-tests project on any device connected over 3G.\r\n2. WebSocket Test fails. It simply can't connect. \r\n\r\n@dumganhar : Tagging you for faster resolution, as most of the commits are by you. ","comments":["Thanks for the issue report. I will check it and let you know what I get.","@jarsj , I tested it with cpp-tests\/WebSocketTest of v3.14.1 and found that it worked well on my iPhone 6 with 4G network.","@dumganhar Yep. For me\r\n\r\nVersion | Vodafone 3G | Airtel 3G | WiFI\r\n------- | -------------- | -------- | -----\r\n3.14.1 | No | Yes | Yes\r\n3.9 | Yes | Yes | Yes\r\n\r\nDo you have a strategy to debug this or you want me to paste some logs ? As I said the function lws_client_connect returns NULL. I tried looking at the websockets source code but couldn't even find where this function is defined. \r\n\r\nI can create a simple screencast if you want (It doesn't work on simulator either on Mac connected via Vodafone 3G). \r\n\r\n","I am testing facebook's SocketRocket on the same connection and post results. ","Probably, it's a bug in libwebsockets.\r\nv3.9 uses libwebsockets1.3 while v3.14.1 uses libwebsockets1.6.0.\r\n\r\nIf you wanna debug inside libwebsockets, you could go to https:\/\/github.com\/warmcat\/libwebsockets\/releases\/tag\/v1.6.0-chrome48-firefox42 to get the source code.\r\n\r\nBTW, Recently, we have upgraded `libwebsockets` to `v2.1.0` version.\r\nAnd refactored some code of WebSocket to make it support `wss` connection.\r\nThe latest code is at: https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/v3\/cocos\/network\/WebSocket.cpp\r\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/v3\/cocos\/network\/WebSocket.h\r\n\r\nThe prebuilt libraries are in `openssl` & `websockets` folder at the repo\r\nhttps:\/\/github.com\/cocos2d\/cocos2d-x-3rd-party-libs-bin.\r\n\r\nCould you please use the WebSocketTest in v3 branch to test it again?\r\nI guess it should work since v3 branch is using the latest version of libwebsockets.\r\n\r\n","Have tried the above solution, not working for android native build. There are errors in WebSocket.cpp and libwebsockets.a(ssl.c.o).","What's the errors?\n\n\u53d1\u81ea\u6211\u7684 iPhone\n\n> \u5728 2017\u5e742\u67089\u65e5\uff0c18:20\uff0cDivyesh Chitroda <notifications@github.com> \u5199\u9053\uff1a\n> \n> Have tried the above solution, not working for android native build. There are errors in WebSocket.cpp and libwebsockets.a(ssl.c.o).\n> \n> \u2014\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub, or mute the thread.\n> \n","I have posted the issue #https:\/\/github.com\/cocos2d\/cocos2d-x-3rd-party-libs-bin\/issues\/272","Hi @dumganhar, Latest V3 doesn't work as well. I cloned a fresh copy and ran cocos2d-tests. Here is the output from \"WebSocket Test\". Note, I enabled DEBUG, PARSER, etc by uncommenting line 417, but nothing changed in the log output. \r\n\r\nAlso note that I also integrated facebook's SocketRocket, which works on the same connection.\r\n\r\nI will now try to add libwebsocket source and add breakpoints in the src, which might shed some light. (https:\/\/github.com\/warmcat\/libwebsockets\/releases\/tag\/v2.1.0). Let me know if you have an easy way, or an existing repo, to do that. \r\n\r\n\r\n```\r\nD\/WebSocket.cpp (673): [WebSocket::init] _host: echo.websocket.org, _port: 80, _path: \/\r\nD\/WebSocket.cpp (673): [WebSocket::init] _host: echo.websocket.org, _port: 80, _path: \/\r\nD\/WebSocket.cpp (673): [WebSocket::init] _host: invalid.url.com, _port: 80, _path: \/\r\nD\/WebSocket.cpp (441): WebSocket thread start, helper instance: 0x185188b0\r\nD\/WebSocket.cpp (161): NOTICE: Initial logging level 1023\r\n\r\nD\/WebSocket.cpp (161): NOTICE: Libwebsockets version: 2.1.0 james@James-Chen.local-v3.4-139-gbdcf7f8\r\n\r\nD\/WebSocket.cpp (161): NOTICE: IPV6 compiled in and enabled\r\n\r\nD\/WebSocket.cpp (161): NOTICE: libev support not compiled in\r\n\r\nD\/WebSocket.cpp (161): NOTICE: libuv support not compiled in\r\n\r\nD\/WebSocket.cpp (161): NOTICE:  Threads: 1 each 256 fds\r\n\r\nD\/WebSocket.cpp (161): NOTICE:  mem: platform fd map:  1024 bytes\r\n\r\nD\/WebSocket.cpp (161): NOTICE:  Compiled with OpenSSL support\r\n\r\nD\/WebSocket.cpp (161): NOTICE:  mem: per-conn:          376 bytes + protocol rx buf\r\n\r\nD\/WebSocket.cpp (161): NOTICE: Creating Vhost 'default' port -1, 1 protocols, IPv6 on\r\n\r\nD\/WebSocket.cpp (161): NOTICE: lws_protocol_init\r\n\r\nD\/WebSocket.cpp (1373): WebSocket (0x165037e0) Unhandled websocket event: 32\r\nD\/WebSocket.cpp (1373): WebSocket (0x165037e0) Unhandled websocket event: 29\r\nD\/WebSocket.cpp (1373): WebSocket (0x165037e0) Unhandled websocket event: 33\r\nD\/WebSocket.cpp (1266): WebSocket (0x165037e0) onConnectionError ...\r\nD\/WebSocket.cpp (1294): WebSocket (0x165037e0) onConnectionClosed ...\r\nD\/WebSocket.cpp (1330): WebSocket (0x165037e0) onConnectionClosed DONE!\r\nD\/WebSocket.cpp (1266): WebSocket (0x165037e0) onConnectionError ...\r\nD\/WebSocket.cpp (1373): WebSocket (0x18518140) Unhandled websocket event: 32\r\nD\/WebSocket.cpp (1373): WebSocket (0x18518140) Unhandled websocket event: 29\r\nD\/WebSocket.cpp (1373): WebSocket (0x18518140) Unhandled websocket event: 33\r\nD\/WebSocket.cpp (1266): WebSocket (0x18518140) onConnectionError ...\r\nD\/WebSocket.cpp (1294): WebSocket (0x18518140) onConnectionClosed ...\r\nD\/WebSocket.cpp (1330): WebSocket (0x18518140) onConnectionClosed DONE!\r\nD\/WebSocket.cpp (1266): WebSocket (0x18518140) onConnectionError ...\r\nError was fired, error code: 1\r\nwebsocket instance (0x165037e0) closed.\r\nD\/WebSocket.cpp (572): In the destructor of WebSocket (0x165037e0)\r\nError was fired, error code: 1\r\nwebsocket instance (0x18518140) closed.\r\nD\/WebSocket.cpp (572): In the destructor of WebSocket (0x18518140)\r\nD\/WebSocket.cpp (1373): WebSocket (0x185187d0) Unhandled websocket event: 32\r\nD\/WebSocket.cpp (1373): WebSocket (0x185187d0) Unhandled websocket event: 29\r\nD\/WebSocket.cpp (1373): WebSocket (0x185187d0) Unhandled websocket event: 24\r\nD\/WebSocket.cpp (161): NOTICE: redirect ads='lyrics.url.com', port=80, path='\/'\r\n\r\nD\/WebSocket.cpp (1373): WebSocket (0x185187d0) Unhandled websocket event: 33\r\nD\/WebSocket.cpp (1373): WebSocket (0x185187d0) Unhandled websocket event: 32\r\nD\/WebSocket.cpp (1373): WebSocket (0x185187d0) Unhandled websocket event: 29\r\nD\/WebSocket.cpp (161): ERR: Redirect failed\r\n\r\nD\/WebSocket.cpp (1266): WebSocket (0x185187d0) onConnectionError ...\r\nD\/WebSocket.cpp (1373): WebSocket (0x185187d0) Unhandled websocket event: 33\r\nD\/WebSocket.cpp (1294): WebSocket (0x185187d0) onConnectionClosed ...\r\nD\/WebSocket.cpp (1330): WebSocket (0x185187d0) onConnectionClosed DONE!\r\nError was fired, error code: 1\r\nwebsocket instance (0x185187d0) closed.\r\nD\/WebSocket.cpp (572): In the destructor of WebSocket (0x185187d0)\r\nD\/WebSocket.cpp (592): before join ws thread\r\nD\/WebSocket.cpp (161): NOTICE: lws_context_destroy\r\n\r\nD\/WebSocket.cpp (451): WebSocket thread exit, helper instance: 0x185188b0\r\nD\/WebSocket.cpp (594): after join ws thread\r\n\r\n```","Figured out why the logging didn't change. I am now building debug library for websockets and will update with more detailed logging. ","I hit a wall trying to compile websockets for debug mode. @dumganhar Is it possible for you or someone from cocos2d team to generate a libwebsockets.a (debug) version. It might give more info.","The issue seems to be restricted to IOS (both simulator and multiple devices). Same network and 3.14.1 works for android. ","@jarsj have you compiled libwebsocket or using pre-compiled binaries (for android)?","@jarsj, we use https:\/\/github.com\/cocos2d\/cocos2d-x-3rd-party-libs-src repo to build a library of  libwebsockets.\r\n\r\n```\r\ncd build\r\n.\/build.sh -p=ios --libs=websockets\r\n```\r\nIf you wanna debug the library in xcode. Just copy the `lws_config.h` which is generated by `cmake`, the source code in `libs` folder of `libwebsockets`, remove some unused source code in `libs` folder,  remove prebuilt library dependence in xcode, then add source code of `libwebsockets ` to xcode, debug it in xcode.\r\n\r\nIf you're not using a wss connection, it's better to build a non-ssl-support version of `libwebsockets` which will make your debugging work easier.\r\n\r\nFor above log output, It just say that an error has been triggered while connection, I have no idea about that since I'm also not familiar with the internal implementation of `libwebsockets`. :(\r\n\r\n","Building websockets is failing. I think the 3rd-party uses zlib-1.2.8, which is no longer available on the given URL. \r\n\r\n```\r\npatching file CMakeLists.txt\r\nmv libwebsockets-git websockets && touch websockets\r\ncurl -f -L -- \"http:\/\/zlib.net\/zlib-1.2.8.tar.gz\" > \"..\/..\/contrib\/tarballs\/zlib-1.2.8.tar.gz\"\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0curl: (22) The requested URL returned error: 404 Not Found\r\nmake: *** [..\/..\/contrib\/tarballs\/zlib-1.2.8.tar.gz] Error 22\r\nmake: *** Deleting file `..\/..\/contrib\/tarballs\/zlib-1.2.8.tar.gz'\r\n```","@div5yesh I am using cocos2d-tests, that uses precompiled binaries. As far as I know, this is an IOS specific issue, so I am currently not investigating android. ","@dumganhar I was able to replicate the error on multiple Vodafone 3G connections in my area and atleast one starbucks public WiFI. I also found that libwebsockets guys don't test on IOS, only on Mac. \r\n\r\nFor now I have modified WebSocket.h\/cpp to use Facebook's SocketRocket for IOS, which internally uses CFNetwork and other cocoa goodies. It uses libwebsockets for everything else as before. It has been working fine for now. If more people need this I can probably put together a PR, the current code is very hacky to fit my needs. \r\n\r\nI am fine if you want to close this. ","@jarsj, good to know you have resolve it at the end.\r\nBut since it's an issue of libwebsockets, could you create an issue for libwebsockets official? Thank you.","iOS won't activate 3G network sometimes if you don't use CFNetwork API. A workaround might be requsting a url using CFNetwork API before connecting with libwebsockets.","Where could I find this information\uff1f\n\n\u53d1\u81ea\u6211\u7684 iPhone\n\n> \u5728 2017\u5e747\u67081\u65e5\uff0c02:05\uff0chszhsh <notifications@github.com> \u5199\u9053\uff1a\n> \n> iOS won't active 3G network sometimes if you don't use CFNetwork API. A workaround might be requsting a url using CFNetwork API before connecting with libwebsockets.\n> \n> \u2014\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub, or mute the thread.\n> \n","@dumganhar FYI\r\nhttps:\/\/developer.apple.com\/library\/content\/documentation\/NetworkingInternetWeb\/Conceptual\/NetworkingOverview\/CommonPitfalls\/CommonPitfalls.html#\/\/apple_ref\/doc\/uid\/CH73-SW4\r\n\r\nAvoid POSIX Sockets and CFSocket on iOS Where Possible\r\nThe main disadvantages are:\r\nSockets have many complexities that are handled for you by higher-level APIs. Thus, you will have to write more code, which usually means more bugs.\r\nIn iOS, using sockets directly using POSIX functions or CFSocket does not automatically activate the device\u2019s cellular modem or on-demand VPN.","@hszhsh, Yep, but apple didn't mention how to active device's cellular modem manually. :(\r\nI played with `SocketRocket` today, found that it works perfectly.\r\nAny suggestion if we switch to `SocketRocket` for websocket implementation for iOS\/macOS platforms?\r\n\r\nCurrently, I found the following benefits:\r\n\r\n* The API of SocketRocket is easy for use, it's all asynchronous API. \r\n* No need to deal with `thread communications`, it's wrapped inside SocketRocket.\r\n* Network status change will not make connection closed, it just seems there isn't any status change.\r\n* Locking screen will trigger an error while `libwebsockets` or `bsd socket` will not.\r\n* Don't depend on `openssl` library which is a little big.\r\n* Don't need to use a local `CA root` certificate (curl ca file is over 2MB) for `wss` connection\r\n* Don't trigger signal pipe while closing `wss` connection\r\n* Easy to integrate `SocketRocket` to current `WebSocket` implementation\r\n","@jarsj Hey can you share your solution to SocketRocket? \r\nI am having exact same issue.\r\n@dumganhar Any update from your side?","@smitpatel88 HI,  [libwebsocket has recently been upgraded to v2.4.2. ](https:\/\/github.com\/cocos2d\/cocos2d-x-3rd-party-libs-bin\/releases) please try to update it in your project. ","@PatriceJiang \r\nI tried updatiing libwebsocket but getting error LLVM 9.0 (Use of undeclared identifier)\r\nI changed whole websocket folder and added libuv folder, in xcode added path for libuv\r\nis anything else need to be done?","Did you tried to add  `libuv_a.a` to `libcocos2d XXX > Build Phases > Link Binary with libraries ..`?","Yes, it has multiple `libuv_a.a` \r\nTried with single also but same errors coming.","could you pls upload some screenshots? ","Getting error because of Thread & system_error class.\r\n","you can try it on a new project of a recent v3 branch. it seems a setting issue. ","Did you test with 3.17? I am trying on 3.16\r\nIt will be very difficult for me to test on latest v3 branch.","so i created fresh project with latest branch and replaced webscoket with latest and added libUv but sadly same error is coming on 3g network on iOS. Please help me\r\n\r\n```\r\n2018-08-31 11:38:38.503 Game Name[1938:428444] Received response from request to url http:\/\/game_url_with_port\r\nD\/WebSocket.cpp (416): WebSocket thread start, helper instance: 0x149702830\r\nD\/WebSocket.cpp (880): scheme: ws, host: game.domain, port: NUMBER, path: \/socket.io\/1\/websocket\/?EIO=2&transport=websocket&sid=S1G_BY8seWkY1_eIAAAB\r\nD\/WebSocket.cpp (168): NOTICE: Creating Vhost 'default' port -1, 1 protocols, IPv6 on\r\n\r\nD\/WebSocket.cpp (168): NOTICE: created client ssl context for default\r\n\r\nD\/WebSocket.cpp (168): NOTICE: lws_client_connect_2: 0x149159dc0: address game.domain\r\n\r\nD\/WebSocket.cpp (1329): WebSocket (0x149572770) Unhandled websocket event: 32\r\nD\/WebSocket.cpp (1329): WebSocket (0x149572770) Unhandled websocket event: 29\r\nD\/WebSocket.cpp (168): NOTICE: Connect failed errno=65\r\n\r\nD\/WebSocket.cpp (1204): WebSocket (0x149572770) onConnectionError, state: 0 ...\r\nD\/WebSocket.cpp (1233): WebSocket (0x149572770) onConnectionClosed, state: 2 ...\r\nD\/WebSocket.cpp (1263): onConnectionClosed, WebSocket (0x149572770) is closing by server.\r\nD\/WebSocket.cpp (1286): WebSocket (0x149572770) onConnectionClosed DONE!\r\nD\/WebSocket.cpp (1329): WebSocket (0x149572770) Unhandled websocket event: 50\r\nD\/WebSocket.cpp (1329): WebSocket (0x149572770) Unhandled websocket event: 45\r\nD\/WebSocket.cpp (1329): WebSocket (0x149572770) Unhandled websocket event: 33\r\nD\/WebSocket.cpp (1233): WebSocket (0x149572770) onConnectionClosed, state: 3 ...\r\nD\/WebSocket.cpp (1204): WebSocket (0x149572770) onConnectionError, state: 3 ...\r\nWebsocket error received: 1\r\nGameClass::onClose called\r\n\r\n```\r\n","Checkout this demo https:\/\/github.com\/PatriceJiang\/libwebsocket_libuv_demo, and modify it with\r\n- define USE_LIBUV 0\r\n- replace ws:\/\/invalid.url.com with your own URL\r\n\r\nThis is a raw websockets project, i need to know whether it is a libwebsockets issue. ","How to use this in Xcode? There is no xcode project.\r\nWe are facing issue with iOS only. On Android project is working fine with 3g\/4g connection."],"labels":["module:network"]},{"title":"[JSB] cc.eventManager:  event.getUserData() returns undefined for multiple listeners","body":"After upgrading cocos2d-x to the latest code in branch v3, the event manager doesn't work correctly.\r\n\r\n**The problem**:  If two listeners are registered for the same event, the second listener callback to be called will always get `undefined` from `event.getUserData()`\r\n\r\n**The reason**: In function `js_EventListenerCustom_create` (jsb_event_dispatcher_manual.cpp), the JS object for the event is removed by the statement `removeJSObject(cx, event);`. So in the next callback, the JS object for the event is recreated and the `_userData` property is missing.","comments":[],"labels":["script:jsb"]},{"title":"cocos2d::Label wrong texture offset after update font size","body":"- cocos2d-x version: 3.14.1\r\n\r\nHello.\r\nI'm trying to reduce the number of draw calls in my UI, and add all bitmap fonts with sprites in one UI atlas. When you initialize the font with constructor and don't change font size it works fine, but when you change font size, his texture coordinates back to the zero position. After hour analysis of engine code I found the problem. If you change the font size of the texture coordinates will melt Vec2 :: ZERO.\r\n\r\n```\r\nvoid Label::setBMFontSizeInternal(float fontSize)\r\n{\r\n    if(_currentLabelType == LabelType::BMFONT){\r\n        this->setBMFontFilePath(_bmFontPath, Vec2::ZERO, fontSize);\r\n        _contentDirty = true;\r\n    }\r\n}\r\n```\r\nIn my case the solution was to change the function that creates the Label.\r\nYour function:\r\n```\r\nLabel* Label::createWithBMFont(const std::string& bmfontFilePath, const std::string& text,const TextHAlignment& hAlignment \/* = TextHAlignment::LEFT *\/, int maxLineWidth \/* = 0 *\/, const Vec2& imageOffset \/* = Vec2::ZERO *\/)\r\n{\r\n    auto ret = new (std::nothrow) Label(hAlignment);\r\n    if (ret && ret->setBMFontFilePath(bmfontFilePath,imageOffset))\r\n    ...\r\n```\r\nto:\r\n```\r\nLabel* Label::createWithBMFont(const std::string& bmfontFilePath, const std::string& text,const TextHAlignment& hAlignment \/* = TextHAlignment::LEFT *\/, int maxLineWidth \/* = 0 *\/, const Vec2& imageOffset \/* = Vec2::ZERO *\/, float fontSize)\r\n{\r\n    auto ret = new (std::nothrow) Label(hAlignment);\r\n   if (ret && ret->setBMFontFilePath(bmfontFilePath,imageOffset, fontSize))\r\n   ...\r\n```\r\nCan you solve this problem. My function only fix font size on initialization, but when you change it on runtime it work wrong.\r\n","comments":[],"labels":["module:renderer"]},{"title":"Invalid write of size 4 in cocos2d::BitmapDC::getBitmap(...)","body":"- cocos2d-x version: 3.14.1\r\n- devices test on: Lenovo B590, Arch Linux\r\n\r\nWhen running my app on Linux using valgrind I get \"Invalid write of size 4\" error.\r\n\r\nCCDevice-linux.cpp:264: `*(int*) &_data[(iY + iX) * 4 + 0] = iTemp;`\r\n\r\nThe `_data` array is indexed using negative index. This is because `iY` is negative. `iY` is negative because `yoffset` is negative. And `yoffset` is negative because `computeLineStartY(...)` uses `face->size->metrics.ascender` for computing line height and font `ascender` is not guaranteed to be bigger than `horiBearingY`, which is later subtracted from `ascender` to get `yoffset`. In my case `face->size->metrics.ascender` is 2240 and `face->glyph->horiBearingY` is 2304, which leads to `yoffset` of -1.\r\n\r\nfontfile: \"\/usr\/share\/fonts\/OTF\/NimbusSans-Regular.otf\".\r\ntext: \"Quit\"\r\n","comments":["@lonedev, thanks for the report. Do you have any ideas to fix this issue?","As a quick workaround rows with negative iY could be skipped using simple `if (iY < 0) continue;`. It won't solve the problem of text being cropped from above, but at least the code won't be writing outside array bounds. A proper solution would probably require `computeLineStartY(...)` method to use bounding box of text glyphs, perhaps obtained using `FT_Glyph_Get_CBox(...)`. Or the target bitmap (the one in `_data`) could be made a little bigger to accomodate parts of the glyph reaching above ascender. My knowledge on freetype2 library and cocos2d is not very deep though, so there may be some better solution."],"labels":["platform:linux"]},{"title":"Get device's RAM memory or device's spare RAM memory","body":"- cocos2d-x version: 3.13\r\n\r\nIs there a way to get the device's RAM memory?\r\n\r\nOur game consumes up to 1Gb of RAM memory with animations, sounds, movements, etc and we would like to check if the device can handle them to load the animations or not...\r\n\r\n\r\nThanks.\r\n","comments":["I don't believe we have anything built in. \r\n\r\non iOS, this has good results: http:\/\/stackoverflow.com\/questions\/5012886\/determining-the-available-amount-of-ram-on-an-ios-device\r\n\r\nAndroid looks to have ways too: http:\/\/stackoverflow.com\/questions\/7374246\/how-to-get-total-ram-size-of-a-device\r\n"],"labels":["type:request"]},{"title":"js-tests application: SpiderMonkey crashes after EGL Context Lost","body":"\r\n- cocos2d-js version: 3.10\r\n- devices test on: Galaxy Tab A, LG G4 Beat \r\n- developing environments\r\n   - NDK version: r10e\r\n   - Xcode version:\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nAfter a long debug process, I noticed that it happens always after glsurface calls onSurfaceCreated on the second time, (and a new GLThread is created, I print the GLThread ID, and notice that it changes).\r\n\r\nAfter it happens, the application crashes at the first call to SpiderMonkey function, in my case, at AppDelegate.cpp:\r\n\r\nvoid AppDelegate::applicationWillEnterForeground() {\r\n    ....\r\n    \/\/ Crash HERE!\r\n    director->getEventDispatcher()->dispatchCustomEvent(\"game_on_show\");\r\n}\r\n\r\nFrom Android Documentation: https:\/\/developer.android.com\/reference\/android\/opengl\/GLSurfaceView.Renderer.html\r\n\r\n> EGL Context Lost\r\nThere are situations where the EGL rendering context will be lost. This typically happens when device wakes up after going to sleep. When the EGL context is lost, all OpenGL resources (such as textures) that are associated with that context will be automatically deleted. In order to keep rendering correctly, a renderer must recreate any lost resources that it still needs. The onSurfaceCreated(GL10, EGLConfig) method is a convenient place to do this.\r\n\r\nSteps to Reproduce:\r\nThe issue is also reproduce randomly!\r\nBut the easiest way to force the crash:\r\nSomehow those steps forcing the GLThread to recreate:\r\n1. Launch from \"Open\" button at Play Store\r\n2. Minimize app (pause)\r\n3. Relaunch (resume) it again from the icon\r\n\r\nUpdate:\r\nI compiled the js-tests, same issue apear there.","comments":["can fix it according to https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/16520","Thanks,\r\nHowever, I'm using cocos 3.10, and the generated template project already includes \r\n\r\n> android:configChanges=\"orientation|keyboardHidden|screenSize\"\r\n\r\nIt doesn't help.","Have the same issue on 3.14. This issue is also present in the JSTests app and all cocos2d-x JS apps. And it has nothing to do with android:configChanges.","I also have another way to easily recreate the crash.\r\n\r\nLaunch the app using the following command:\r\ncocos run -p android\r\nwhen app is launched, press the home button in order to send it to background. Then launch the app from the launcher screen and it will crash (also it may just print \"JS: too much recursion\" error on the logcat and stop executing JS code in all event handlers).\r\nTried on Samsung Galaxy S5 (Android 6.0)","Thanks for reopen the issue!\r\n\r\nI did some further investigations, and found in android API:\r\n\r\n        \/\/ Test to fix the resume background bug\r\n        if (Build.VERSION.SDK_INT >= 11) {\r\n            glSurfaceView.setPreserveEGLContextOnPause(true);\r\n        }\r\n\r\nIt didn't fixed or reduced the issue also.","Little bit more info on this. SpiderMonkey stops working every time when the app activity is recreated by the system after it was destroyed.\r\n\r\nSo when we launch app using `cocos run` command, it launches the app using the following command:\r\n`adb shell am start -n \"com.example.myapp\/org.cocos2dx.javascript.AppActivity\"`\r\n\r\nIf this type of launch is used, Android will destroy activity immediately after the app will be moved to background, but the process will continue to exist.\r\n\r\nBut if we will start the app from the launcher (home) screen, the main activity will not be destroyed on moving to background. \r\n\r\n","Maybe it's a dirty hack but I found a workaround. Just add the attribute `android:launchMode=\"singleTask\"` to the activity in AndroidManifest.xml, so now it is:\r\n\r\n```\r\n<activity android:name=\"org.cocos2dx.javascript.AppActivity\"\r\n            android:label=\"@string\/app_name\"\r\n            android:launchMode=\"singleTask\"\r\n            android:screenOrientation=\"portrait\"\r\n            android:theme=\"@style\/AppTheme\"\r\n            android:configChanges=\"orientation|keyboardHidden|screenSize\">\r\n      <intent-filter>\r\n            <action android:name=\"android.intent.action.MAIN\" \/>\r\n            <category android:name=\"android.intent.category.LAUNCHER\" \/>\r\n      <\/intent-filter>\r\n<\/activity>\r\n```\r\n\r\nAfter this Android will no longer kill the main activity and it is just resumed after process moved back from the background.","@dmrntpv I don't think that preventing activity from being killed can be a proper fix. Android can kill any activity in the foreground, and it should be able to restore itself from `savedInstanceState`. Debugging menu usually has \"kill background activities\" option to test for that behaviour.","@dmrntpv this does not work when you go into developer settings and turn on 'do not keep activities'","@golergka, @aaron7090, I'm absolutely agree, this is only a temporary workaround while we're waiting for the proper solution from the developers.","I do recommend Cocos puts this issue as high priority. It effects all the android devices used CocosJS and resuming from background is such a common thing that will make countless abnormal behavior for all the users. I don't know whether Cocos with the lower version has the same issue. If no, I will abandon v3.14 and degrade to that version. @minggo @ricardoquesada . BTW, as i know Cocos Creator use cocos2dx on native compiled apk, don't it have the same problem?","Someone has any ideas about that issue? @minggo @ricardoquesada \r\n","@fuyifan @alonlevylll No idea (and I'm no longer working on cocos2d).","Thanks,\r\nI think I have the full picture of that issue and I would like to know your opinion about the next steps.\r\nSo the reason is simple a new EGL thread is created (managed by Android).\r\n\r\n- **Cocos2d-x** seems to handle this perfectly, and loading all textures again into the new EGL instance.\r\n\r\n- **SpiderMonkey** crashes on the first call because it is compiled as single threaded, and doesn't support the new EGL thread.\r\n\r\nSo my idea would be to compile spidermonkey as JS_THREADSAFE, and wrap all calls with JS_SetContextThread and JS_ClearContextThread.\r\n\r\nBefore start test it I would like to know the reasons you not using the JS_THREADSAFE flag,\r\nis it performance? complexity? hard to integrate? library weigh too much?\r\n\r\nThanks\r\n","As i know, JS codes are invoked in GL thread too. @pandamicro any idea?","> Before start test it I would like to know the reasons you not using the JS_THREADSAFE flag,\r\n> is it performance? complexity? hard to integrate? library weigh too much?\r\n\r\nIt's due to performance reason, as in the design we don't want user to user spidermonkey cross thread.\r\n\r\n> So my idea would be to compile spidermonkey as JS_THREADSAFE, and wrap all calls with JS_SetContextThread and JS_ClearContextThread.\r\n\r\nYou can try that, we recently upgraded spidermonkey to v52 in Creator's native engine which is planned for next month, but it will take longer to integrate it in Cocos2d-x","I uses v3 latest codes: 4be6eb532567f747ec2ad62e84893123e236e9f4 to test, what i did are:\r\n\r\n- use cocos run -p android to build and run js-tests\r\n- click Home button to make js-tests into background\r\n- click js-tests app icon to run js-tests again\r\n- no crash, but there is OpenGL ES rendering error, so can not response any input\r\n\r\n\r\nThere is not error if i did like this\r\n- click js-tests icon to run js-tests\r\n- click Home button to let js-tests go to background\r\n- click js-tests icon to run js-tests again\r\n- everything works correctly\r\n\r\nSo it seems there is an error when the app is installed and run through USB, but no crash. After the first time, there is not problem.","Hello! :) Any updates @minggo?","No, i have not idea with this issue, i think it is something about JSB. @dumganhar any idea?","added some useful info, I think the difference between \r\n```\r\nuse cocos run -p android to build and run js-tests\r\nclick Home button to make js-tests into background\r\n```\r\nand\r\n```\r\nclick js-tests icon to run js-tests\r\nclick Home button to let js-tests go to background\r\n```\r\nwas caused by a android issue, refer to https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/19010#issuecomment-418249866\r\n\r\n---\r\nsimilar with @dmrdev said, we have a workaround was merged at https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/19010\r\n> Maybe it's a dirty hack but I found a workaround. Just add the attribute android:launchMode=\"singleTask\" to the activity in AndroidManifest.xml, so now it is:\r\n\r\n```\r\n            android:launchMode=\"singleTask\"\r\n            android:taskAffinity=\"\"  \r\n```"],"labels":["script:jsb","platform:android"]},{"title":"Background sprite not resizing on UI button","body":"- cocos2d-x version: 3.14.1\r\n- devices test on: win32, xiaomi redmi 1s, moto g 2\r\n- developing environments:\r\n   - NDK version: 12b\r\n   - VS version: 2015 community\r\n\r\nSteps to Reproduce:\r\n\r\nI've copied code from [cocos2d-X wiki](http:\/\/www.cocos2d-x.org\/wiki\/Widget) to generate a Text Button scale9 render. Resizing using setSize() worked fine with 3.13.1 but with 3.14.1, I get a deprecated warning , advising me to use setContentSize(), but doing so button's background sprite stopped resizing. Now it only changes it's location based on ContentSize.\r\n\r\n","comments":["maybe you should call setScale9Enable(true) before you use setContentSize! i guess","@saint-knight As I've copied code from the example given in the link, I call setScale9Enable(true) before calling setContentSize(). My code is as follows:\r\n\r\n\r\n```\r\nauto okButton = ui::Button::create();\r\n\r\nokButton->setTouchEnabled(true);\r\nokButton->setScale9Enabled(true);\r\nokButton->loadTextures(\"background.png\", \"background.png\", \"background.png\", ui::Widget::TextureResType::PLIST);\r\nokButton->setTitleFontName(\"font.fnt\");\r\nokButton->setTitleText(\"OK\");\r\n\/\/This code used to resize background.png. \r\n\/\/okButton->setSize(Size(okButton->getContentSize().width*4.0f, okButton->getContentSize().height*1.2f));\r\n\/\/This code moves background.png to the left and OK text has no background at all (background.png doesn't resize)\r\nokButton->setContentSize(Size(okButton->getContentSize().width*4.0f, okButton->getContentSize().height*1.2f));\r\n\r\n```","@ricardoquesada @minggo , could it be that pull request https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/16891 had broken it?","@ishmar could you please provide a test case to reproduce the issue? @ricardoquesada could you please take a look?","Hi @minggo, @ricardoquesada \r\n\r\nI've attached Classes & Resource folder inside that zip to reproduce the issue. Just create a new project using something like:\r\n\r\n`cocos new -p com.testing.issue17255  -d C:\\Ishmar -l cpp test3141\r\n`\r\nand replace Classes & Resource folder.\r\n\r\nThis is the result of executing this code with v3.13.1 (desired result):\r\n\r\n![button_test_3 13 1](https:\/\/cloud.githubusercontent.com\/assets\/20006414\/22620918\/3c09854a-eb17-11e6-9f5e-b6637f56421c.png)\r\n\r\nAnd this is the result of executing this code with v3.14.1 (wrong result):\r\n\r\n![button_test_3 14 1](https:\/\/cloud.githubusercontent.com\/assets\/20006414\/22620925\/5cb66f24-eb17-11e6-9db0-f3ac8270791b.png)\r\n\r\nCreating the test case I've noticed that it only fails if I use a PLIST. You'll find most of code and comments on HelloWorldScene.cpp starting on line 56.\r\n\r\nAlso, at the time of writing this post, I've noticed that number of vertices is different in both screenshots. Not sure which may be the reason as it's the same code....\r\n\r\nThanks in advance\r\n[test3141.zip](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/752499\/test3141.zip)\r\n","Hey \r\nWorks for me to scale down the button width and height to desired width and height. The trick is to find the scaling factors. Here is the code:\r\n\r\n``\r\n\r\n\r\n    \r\n    const std::string fname = \"HelloWorld.png\";\r\n    auto button = Button::create(fname, fname,fname);\r\n    \/\/ set position\r\n    button->setPosition(Vec2(visibleSize.width\/2 + origin.x, visibleSize.height\/2 + origin.y));\r\n   \r\n    \/\/ compute scaling factors\r\n    float factor = visibleSize.width \/ 4.0f;\r\n    float xscale = factor \/ button->getContentSize().width;\r\n    float yscale = factor \/ button->getContentSize().height;\r\n\r\n    \/\/ resize button with x and y scale\r\n    button->setScale(xscale, yscale);\r\n``"],"labels":["module:ui"]},{"title":"Mac fullscreen works incorrectly when Retina display is scaled from Preferences","body":"- cocos2d-x version: v3.14.1\r\n- devices test on: MAC\r\n- developing environments\r\n   MacOSx\r\n\r\nSteps to Reproduce:\r\n\r\n1. Go to system preferences->displays-> set resolution to scaled\r\n2. Select more Space\r\nhttps:\/\/www.dropbox.com\/s\/dg78y8lm6m85zkz\/Screen%20Shot%202017-01-23%20at%203.04.50%20PM.png?dl=0\r\n\r\n3. Run Mac build ***Fullscreen*** on xcode\r\n4. Incorrect results (scaling is wrong)","comments":["If you select Larger Text (the first option) the issue happens as well, only with the three options in the middle does the scaling seem right\r\n\r\nEdit:\r\n\r\nI was just about to look into this issue myself but it appears to be working fine now, the only thing that changed (that might have some effect on this) is that I plugged in an external 1080P monitor today, other then that I haven't made any changed though I did experience this bug as well yesterday."],"labels":["platform:mac"]},{"title":"Android crash on start when compiling for armeabi","body":"- cocos2d-x version: 3.13.1\r\n- devices test on: Samsung Galaxy Alpha\r\n- developing environments\r\n   - NDK version: r13b\r\n   - Xcode version: 8.2.1\r\n   - Android Studio version: 2.2.3\r\n\r\nI'm getting this crash on game start:\r\n\r\n********** Crash dump: **********\r\nBuild fingerprint: 'samsung\/sltexx\/slte:5.0.2\/LRX22G\/G850FXXU2COI3:user\/release-keys'\r\npid: 1855, tid: 3046, name: GLThread 4983  >>> com.example.mygame <<<\r\nsignal 6 (SIGABRT), code -6 (SI_TKILL), fault addr --------\r\nStack frame #00 pc 00039f70  \/system\/lib\/libc.so (tgkill+12)\r\nStack frame #01 pc 00017589  \/system\/lib\/libc.so (pthread_kill+52)\r\nStack frame #02 pc 0001819b  \/system\/lib\/libc.so (raise+10)\r\nStack frame #03 pc 00014ae5  \/system\/lib\/libc.so (__libc_android_abort+36)\r\nStack frame #04 pc 00012aac  \/system\/lib\/libc.so (abort+4)\r\nStack frame #05 pc 00a31567  \/data\/app\/com.example.mygame-1\/lib\/arm\/libMyGame.so (__gnu_cxx::__verbose_terminate_handler()+226)\r\nStack frame #06 pc 009ffd8d  \/data\/app\/com.example.mygame-1\/lib\/arm\/libMyGame.so (__cxxabiv1::__terminate(void (*)())+4)\r\nStack frame #07 pc 009ffe01  \/data\/app\/com.example.mygame-1\/lib\/arm\/libMyGame.so (std::terminate()+8)\r\nStack frame #08 pc 009fff5b  \/data\/app\/com.example.mygame-1\/lib\/arm\/libMyGame.so (__cxa_rethrow+46)\r\nStack frame #09 pc 0054898c  \/data\/app\/com.example.mygame-1\/lib\/arm\/libMyGame.so (std::_Hashtable<std::string, std::pair<std::string const, cocos2d::Value>, std::allocator<std::pair<std::string const, cocos2d::Value> >, std::__detail::_Select1st, std::equal_to<std::string>, std::hash<std::string>, std::__detail::_Mod_range_hashing, std::__detail::_Default_ranged_hash, std::__detail::_Prime_rehash_policy, std::__detail::_Hashtable_traits<true, false, true> >::operator=(std::_Hashtable<std::s\r\nStack frame #10 pc 0054873c  \/data\/app\/com.example.mygame-1\/lib\/arm\/libMyGame.so (std::unordered_map<std::string, cocos2d::Value, std::hash<std::string>, std::equal_to<std::string>, std::allocator<std::pair<std::string const, cocos2d::Value> > >::operator=(std::unordered_map<std::string, cocos2d::Value, std::hash<std::string>, std::equal_to<std::string>, std::allocator<std::pair<std::string const, cocos2d::Value> > > const&)+32)\r\nStack frame #11 pc 006abd2c  \/data\/app\/com.example.mygame-1\/lib\/arm\/libMyGame.so (cocos2d::Value::Value(std::unordered_map<std::string, cocos2d::Value, std::hash<std::string>, std::equal_to<std::string>, std::allocator<std::pair<std::string const, cocos2d::Value> > > const&)+268)\r\nStack frame #12 pc 0063fb80  \/data\/app\/com.example.mygame-1\/lib\/arm\/libMyGame.so (cocos2d::Configuration::getInfo() const+52)\r\nStack frame #13 pc 0065c748  \/data\/app\/com.example.mygame-1\/lib\/arm\/libMyGame.so (cocos2d::Director::setOpenGLView(cocos2d::GLView*)+224)\r\nStack frame #14 pc 0048470d  \/data\/app\/com.example.mygame-1\/lib\/arm\/libMyGame.so (Java_org_cocos2dx_lib_Cocos2dxRenderer_nativeInit+156)\r\nStack frame #15 pc 00147e41  \/data\/dalvik-cache\/arm\/data@app@com.example.mygame-1@base.apk@classes.dex\r\nCrash dump is completed\r\n\r\nI'm unable to track or discover where the error is.\r\n\r\nThanks in advance!!\r\n\r\n\r\n\r\n","comments":["I've discovered that the crash happens when compiling for:\r\nAPP_ABI := armeabi\r\n\r\nIf I compile it for APP_ABI := armeabi-v7a the crash is not occuring.\r\n\r\nAny idea of what is causing the error?\r\n\r\nThanks.\r\n","Could you please help to reproduce the issue?"],"labels":["platform:android"]},{"title":"AudioEngine::play2d always returns a valid ID even if audio format is not supported","body":"- cocos2d-x version: 3.14 (and previous releases)\r\n- devices test on: N\/A (although tested on Win32 and Android 7)\r\n- developing environments\r\n   - NDK version: N\/A\r\n   - Xcode version: N\/A\r\n   - VS version: 2015\r\n   - browser type and version: N\/A\r\n\r\nSteps to Reproduce:\r\n\r\nWhen AudioEngine::play2d is called, it always returns a valid ID even if the audio file format is not supported on that platform (such as AAC\/M4A format on Windows).   If the audio format is not supported, the audio player instance is removed, then the sound finishedCallback is never actually called.\r\n\r\nIf the game code gets a valid ID from play2d, then it expects the sound finished callback to be triggered, but if the sound was not actually played, then the game will be stuck waiting for an event that will never happen.\r\n\r\nIf AudioEngine::play2d instead returned AudioEngine::INVALID_AUDIO_ID if an unsupported audio format is used, then that would solve the problem completely.\r\n","comments":["@rh101, thanks for your feedback, I will check this issue.\r\nMark it in the v3.15. :)","@dumganhar I appreciate that, thank you!","@rh101 \r\nThis issue isn't as easy as it seems to be, mark it in `next` milestone.\r\nI will continue to investigate.","@dumganhar For me personally this is not an issue any more, since your work on the OGG playback has solved the issue of using OGG files, which seem to work with all platforms, so I'm using that format again. If I'm the only one who has mentioned this specific issue, and no-one else cares about it, then there is no rush at all to get it sorted."],"labels":["module:audio"]},{"title":"Laggy framerate on iPhone 7","body":"- cocos2d-x version: 3.13\r\n- devices test on: iPhone 7 and iPhone 6\r\n- Xcode version: 8.21\r\n\r\nI tested our cocos2d-x v3.13 game on iPhone 7 device. It Sometimes passes 50 fps, while other iOS devices (including iPhone 6 or below) ran very smoothly. I tried everything in my code but no result.\r\nIt seems iPhone 7 runs other processes which eats much cpu. when i run QuickPlayer to record video on iPhone 7 the game made more smoothly.\r\nCan anything be done about this issue? \r\n","comments":["> when i run QuickPlayer to record video on iPhone 7 the game made more smoothly.\r\n\r\nWhat does it mean? Run QuickPlayer will make game more smoothly?","I mean, when you launch quick time on the mac then select File->New Movie Recording and drop down on the record button then select iOS device to record game screen. It seems QuickTime kills some other processes which drop downs game performance. About 5 times the game made faster.\r\n\r\nThanks for quick reply.\r\n","Good to know. Thanks.","If you have iPhone 7 and are interesting with the problem, i can send you game invite on test flight.","I have made a new template using cocos2d-x 3.14. create a scene and add parallax with 3 sprite iPhone 7 still lagging :|","@jabson \r\n\r\n> I have made a new template using cocos2d-x 3.14. create a scene and add parallax with 3 sprite iPhone 7 still lagging :|\r\n\r\nCould you send me the demo project based on template?","There is test project with moving 3 sprites.\r\nThere is not lag on iPhone 6 or 6s. if you run on iPhone 7 it mades laggy. cocos2d-x version is 3.14. also try to change MoveSpeed in HelloWorldScene.\r\n\r\nSorry for late answer.\r\n\r\nhttps:\/\/drive.google.com\/file\/d\/0B0tGqNGLqq29Z0tUV3daN2JnZmc\/view"],"labels":["platform:ios"]},{"title":"Android 7.1 Landscape Screen Orientation Issues","body":"- cocos2d-x version: 3.10\r\n- devices test on: Google Pixel, Nexus 6P\r\n- developing environments\r\n   - NDK version: 10e\r\n\r\nWe have a game that is in landscape mode. The game works fine on Android 4.X, 5.X, 6.X and even 7.0 but for some reason on 7.1 devices it gets confused about the orientation and tries to set itself as portrait which breaks the game's layout and makes it unplayable. We have the following in our android manifest:\r\n\r\n`android:screenOrientation=\"sensorLandscape\"\r\n              android:theme=\"@android:style\/Theme.NoTitleBar.Fullscreen\"\r\n              android:configChanges=\"orientation\">`\r\n\r\nsince we want the game to be adapt to either landscape orientations. \r\n\r\nSteps to reproduce\r\n\r\n1.) Have device running Android 7.1 in portrait mode\r\n2.) Open the game\r\n3.) Turn device to landscape; game will remain in incorrect orientation\r\n","comments":["Is this fixed in cocos2dx 3.14? I see this in the change log: \r\n\r\n`Android: adapt to Android pixel`\r\n\r\nHowever, this orientation issue affects any device running android 7.1","I used solution from this post:\r\nhttp:\/\/discuss.cocos2d-x.org\/t\/resolution-problem-while-launching-game-through-push-notification-from-lock-screen\/22254\/2","@tapblaze 3.14 doesn't fix the log. I tried cpp-empty-test on Nexus5x with Android 7.1.1, no error happen.","First of all, game should run in landscape orientation.\r\n\r\nSteps to reproduce:\r\n1. Launch game - everything should be okay at this point.\r\n2. Send game to background, rotate device to portrait orientation\r\n3. Optionally: launch another application in portrait orientation\r\n4. Restore\/switch to our game, game screen may rotate again to wrong orientation. (Swap of width and height will occur). \r\n\r\nHope it will help","> Restore\/switch to our game, game screen may rotate again to wrong orientation. (Swap of width and height will occur)\r\n\r\nDid you mean it will not hundred percent reproduce\uff1f","I mean i don't sure about accurate of steps to reproduce. Because it's from feedback reports from our users. I'm have not device with Android 7.1 to test it by my self. The issue 100% exists.","Yes, over a dozen players have complained about this and we worked with a few beta testers to confirm that the fix @SBJoker used resolved the issue finally. ","After using @SBJoker's solution, problem still exit.\r\n","1. You can fix it without changing engine by implementing `applicationScreenSizeChanged()` in your game. Example:\r\n```\r\n\/**\r\n@brief  This function will be called when the application screen size is changed.\r\n@param new width\r\n@param new height\r\n*\/\r\nvoid AppDelegate::applicationScreenSizeChanged(int newWidth, int newHeight) {\r\n    if (newWidth > 0 && newHeight > 0) {\r\n        auto director = Director::getInstance();\r\n        auto glview = director->getOpenGLView();\r\n        if (glview) {\r\n            Size frameSize = glview->getFrameSize();\r\n            if (!frameSize.equals(Size(newWidth, newHeight))) {\r\n                \/\/ Frame size changed\r\n                glview->setFrameSize(newWidth, newHeight);\r\n                ResolutionPolicy resolutionPolicy = glview->getResolutionPolicy();\r\n                if (resolutionPolicy == ResolutionPolicy::UNKNOWN)\r\n                    resolutionPolicy = ResolutionPolicy::NO_BORDER;\r\n                \/\/ Set the design resolution\r\n                glview->setDesignResolutionSize(designResolutionSize.width, designResolutionSize.height, resolutionPolicy);\r\n                \/\/ if the frame's height is larger than the height of medium size.\r\n                if (newHeight > mediumResolutionSize.height)\r\n                {\r\n                    director->setContentScaleFactor(MIN(largeResolutionSize.height\/designResolutionSize.height, largeResolutionSize.width\/designResolutionSize.width));\r\n                }\r\n                \/\/ if the frame's height is larger than the height of small size.\r\n                else if (newHeight > smallResolutionSize.height)\r\n                {\r\n                    director->setContentScaleFactor(MIN(mediumResolutionSize.height\/designResolutionSize.height, mediumResolutionSize.width\/designResolutionSize.width));\r\n                }\r\n                \/\/ if the frame's height is smaller than the height of medium size.\r\n                else\r\n                {\r\n                    director->setContentScaleFactor(MIN(smallResolutionSize.height\/designResolutionSize.height, smallResolutionSize.width\/designResolutionSize.width));\r\n                }\r\n                \/\/ Send change orientation event (scenes should change elements position, size etc)\r\n                director->getEventDispatcher()->dispatchCustomEvent(\"ChangeOrientation\");\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n2. I can't reproduce this bug on Android 9","This issue is still here. When getting photo from image picker, for example, in onActivityResult I had to add:\r\n\r\n```\r\ngetGLSurfaceView().postDelayed(new Runnable() {\r\n                            @Override\r\n                            public void run() {\r\n                                setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE);\r\n                            }\r\n                        }, 1000);\r\n```\r\n\r\nThis hack forces the app to get to landscape again. It doesn't work if I don't add the delay.","add a link https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/15367 , both are similar"],"labels":["platform:android"]},{"title":"[Linux] AudioEngine does not erase audio instance (id) after playback","body":"- cocos2d-x version: 3.14\r\n- devices test on: Debian (Jessie)\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version:\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n1. Play > 32 sound effects and let them finish playing on their own\r\n2. Any sound effect after will \"Fail to play %s cause by limited max instance of AudioEngine\"\r\n\r\nPotential fix:\r\nI'm not too familiar with the code base I only skimmed through it.\r\n\r\nIn AudioEngine-linux.cpp AudioEngineImpl::onSoundFinished(...) the corresponding id is not removed from the AudioEngine. Simply calling AudioEngine::remove(id) seemed like fixed this issue.\r\n","comments":["It's hard to maintain so many platforms.\r\nSince linux also supports `OpenAL`, I will do a refactor to make linux, win32, mac and ios share the same code base which uses `OpenAL`. :)\r\nI mean, replace FMOD with `OpenAL` for linux.","In version 3.15 has not yet been fixed, can you tell me if you have any corrections for the next version?\r\nThank you."],"labels":["platform:linux","module:audio"]},{"title":"label without outline&shadow is blending with scene or previous activity not the background of cocos ui panel","body":"- cocos2d-x version: 3.13.1\r\n- devices test on: android phones \r\n- developing environments\r\n   - NDK version: 13\r\n\r\nSteps to Reproduce:\r\ni am using ui::EditBox\r\nin editing mode everything works fine but when editing ends it shows the color of background view that is behind `Cocos2dxglsurfaceview` at its edges if I make background view's color red: than it will show red around edges.\r\nOne more observation, even if I just render label to CCRenderTexture with fully transparent background, I still can see artifacts around letters.\r\n\r\n![sketch](https:\/\/cloud.githubusercontent.com\/assets\/17469425\/21797727\/9e431238-d732-11e6-911e-7720abc6ac79.png)\r\n\r\n","comments":["#15313 ","@zilongshanren you could simply reproduce it by adding an activity other than cocos2dx like splash  and over it a transparent cocos2dx activity you can see the splash activity color around text label.","@waqas19921 it is better to provide the test case. You can do it based on cpp-empty-test and share your branch. If you don't use git, you can provides the codes without engine.\r\n\r\nThanks."],"labels":["platform:android"]},{"title":"`setSurfaceVelocity` not works on iOS device","body":"Things work fine on Mac.\r\nHowever, on a real device, calling `setSurfaceVelocity` shows no effects.\r\n\r\n- cocos2d-x version: 3.13.1\r\n- devices test on: iPhone 6, iOS 10.2\r\n- developing environments\r\n   - Xcode version: 8.2.1\r\n\r\nSteps to Reproduce:\r\n````\r\nauto contactListener = EventListenerPhysicsContact::create();\r\ncontactListener->onContactPreSolve  = \r\n[=](cocos2d::PhysicsContact &contact, cocos2d::PhysicsContactPreSolve &solve)\r\n{\r\n    solve.setSurfaceVelocity(Vec2(1000, 1000));\r\n    return true;\r\n};\r\nDirector::getInstance()->getEventDispatcher()\r\n    ->addEventListenerWithSceneGraphPriority(contactListener, this);\r\n````\r\n","comments":[],"labels":["platform:ios"]},{"title":"Use highp in shaders by default","body":"Currently, the default float precision is mediump, and it will cause problems which are difficult to fix, such as this one https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/17046. And i also met similar issue in Chinese forum. I think we should change to use highp by default.\r\n\r\n@ricardoquesada what's your opinion?","comments":["@minggo \r\nwhat about doing something like:\r\nif phone is \"fast enough\", use `highp`, otherwise, keep using `mediump` ?\r\n\r\nis there a way to figure out the GPU speed of the phone?","> is there a way to figure out the GPU speed of the phone?\r\n\r\nI am not sure. I will do some research.","Consider Apple's recommendations:\r\nhttps:\/\/developer.apple.com\/library\/content\/documentation\/3DDrawing\/Conceptual\/OpenGLES_ProgrammingGuide\/BestPracticesforShaders\/BestPracticesforShaders.html\r\n\r\n- Default to high precision\r\n- Colors in the 0.0 to 1.0 range can usually be represented using low precision variables.\r\n- Position data should usually be stored as high precision.\r\n- Normals and vectors used in lighting calculations can usually be stored as medium precision.","@stevetranby the guide makes sense. I think we can follow the guide.","I think we should follow the guide to increase float precision. Cocos2d-x is serving for 2D games so it is not GPU bound in most case."],"labels":["critical","module:renderer"]},{"title":"there is not a release invoking in some block inside LuaMinXmlHttpRequest::_sendRequest","body":"lua_xml_http_request.cpp:201 and lua_xml_http_request.cpp:229 need invoke self:release() before return.\r\n\r\n","comments":[],"labels":["script:lua"]},{"title":"i want to disable association function of  Input method,but it will cause a crash of ios.","body":"- cocos2d-x version:3.13.1\r\n- devices test on:itouch5\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version:4.6\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n1. void GLViewImpl::setIMEKeyboardState(bool open)\r\n{\r\n    CCEAGLView *eaglview = (CCEAGLView*) _eaglview;\r\n\r\n    if (open)\r\n    {\r\n        [eaglview becomeFirstResponder];\r\n        [eaglview setAutocorrectionType:UITextAutocorrectionTypeNo];\/\/(this new line)\r\n    }\r\n    else\r\n    {\r\n        [eaglview resignFirstResponder];\r\n    }\r\n}\r\n","comments":["Sorry, i don't quite understand the `Steps to Reproduce`. Could you please describe it in more detail? Thanks.","ok.\r\nReproduce\r\n1.set a uitextfield for inptut\r\n2.input some words and click association you will find no word input.\r\n3.then add this line [eaglview setAutocorrectionType:UITextAutocorrectionTypeNo];\r\n4.repeat 1,2 you will got a crash.","> input some words and click association you will find no word input.\r\n\r\nWord is input and shown. You can run `cpp-tests -> Node: UI -> GUI Dynamic Create Test -> TextField Test`.","use this component UICCTextField or run Node:textInput test and click association will got nothing.","> click association\r\n\r\nWhat did you mean? I can get input in `Node:textInput` if i click the words input.","click association function ,no word input.","input some  word , you will get the association words then click it,you will find  no  word input.","@minggo ","Did you mean the small triangle? I can get input.","Oh, i got it. Yep, i can get the associated words, though just show squares because it doesn't show Chinese words.","But there is not associated words if inputing English words. I am using latest codes and iPhone6.","you can use ipad. ","@minggo ","or with simulator 5s","this issue doesn't exist on iPhone6?","i test it  on IPhone6,also can Reproduce.","could you please record a video to show it? did you try latest codes?","cocos2dx version 3.13.1 ,i dont know why your iPhone 6 cant Reproduce.but on ipad it will show associated words,you can use ipad test."," Yep, i can reproduce it if i removing 3rd party keyboard.","But why add this line `[eaglview setAutocorrectionType:UITextAutocorrectionTypeNo]`?","Ok, it is used to disable association. But i don't meet crash doing as you said. You can try latest codes.","ok\uff0cbut is latest codes version  3.13.1???i got a breakpoint when that line added.","ios simulator 5s","The latest codes version is v3.14, or you can use github latest codes.","ok i will try more.","the same perform at version 3.14.","crash in v3.14?","yes\r\n","how many times did you repeat? i repeated it more than 10 times, but not crash","...,step\r\n1.GLViewlmpl.mm add this code.\r\nvoid GLViewImpl::setIMEKeyboardState(bool open)\r\n{\r\nCCEAGLView eaglview = (CCEAGLView) _eaglview;\r\n\r\nif (open)\r\n{\r\n[eaglview becomeFirstResponder];\r\n[eaglview setAutocorrectionType:UITextAutocorrectionTypeNo];\/\/(this new line)\r\n}\r\nelse\r\n{\r\n[eaglview resignFirstResponder];\r\n}\r\n}\r\n2.run node textinput\r\n3.click textinput \r\nthen you got.","I added the codes as you said, no crash. May be it is something about 3rd party keyboard. What keyboard did you use?","3rd party keyboard ?5s's simulator keyborad...what you mean.\r\ni change a pc and test it on mac mini ,use 5s's simualtor ,got the same perform.","Check the `Settings -> General settings -> Keyboard -> Keyboard` on your device. I use Chinese OS version, i translated the names myself, but you can find if you have other keyboards.","i test it on itouch 5.(if i  add that lines.)\r\nall the node input test will get this\r\nresult\uff1a\r\nFlashback\r\nmy build tools xcode.\r\nand no 3d party input."],"labels":["platform:ios","module:ui"]},{"title":"cocos-js apk carsh problem!Help","body":"- cocos2d-js version:3.6\r\n\r\nSteps to Reproduce:\r\n\r\n1. I build an anroid apk file, but it run to an android mobile to carsh.I watch device logcat, found the message  \"Permission Denied:checkComponentPermission() owningUid:10122\", how can i deal it?\r\n","comments":["What's `checkComponentPermission()`? cocos2d-x doesn't have the interface.","It's android interface,I build to apk,it carsh and I saw that logcat,but i found other problem to make the app carsh, cc.Tableview  , it run with Brower is ok, but build apk run into mobile, it carsh, \r\n\r\nthe code:\r\n\r\nthis.tableView = new cc.TableView(this, cc.size(contentSize.width, 413));\r\n        this.tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);  \/\/\u8bbe\u7f6etable \u65b9\u5411\r\n        \/\/this.tableView.setAnchorPoint(cc.p(0.5,0))\r\n        this.tableView.x = -contentSize.width \/ 2;\r\n        this.tableView.y = -contentSize.height \/ 2 + 20;\r\n        this.tableView.setDelegate(this);\r\n        this.tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);\r\n        this.addChild(this.tableView);\r\n        this.tableView.reloadData();\r\n\r\nI found it's carsh in this.addChild(this.tableView); this code,i did not how to fix it,this problem cost one week.","Could you please provide a test case to reproduce it? Thanks.","\/**\r\n * Created by junfeng on 2016\/12\/7.\r\n *\/\r\n\r\nvar CustomTableViewCell = cc.TableViewCell.extend({\r\n    draw:function (ctx) {\r\n        this._super(ctx);\r\n    }\r\n});\r\n\r\nvar RankItem = cc.Layer.extend({\r\n    ctor : function () {\r\n        this._super();\r\n        this.init();\r\n    },\r\n\r\n    tableView : null,\r\n    itemSize : cc.size(0,0),\r\n\r\n    init : function () {\r\n        var bg = new cc.Sprite(rank_img_res.rank_bg);\r\n        this.addChild(bg);\r\n        var contentSize = bg.getContentSize()\r\n        this.setContentSize(contentSize);\r\n\r\n        var rankItemBg = new cc.Sprite(rank_img_res.rankitem_bg);\r\n        this.itemSize = rankItemBg.getContentSize();\r\n\r\n        this.tableView = new cc.TableView(this, cc.size(contentSize.width, 413));\r\n        this.tableView.setDirection(cc.SCROLLVIEW_DIRECTION_VERTICAL);  \/\/\u8bbe\u7f6etable \u65b9\u5411\r\n        \/\/this.tableView.setAnchorPoint(cc.p(0.5,0))\r\n        this.tableView.x = -contentSize.width \/ 2;\r\n        this.tableView.y = -contentSize.height \/ 2 + 20;\r\n        this.tableView.setDelegate(this);\r\n        this.tableView.setVerticalFillOrder(cc.TABLEVIEW_FILL_TOPDOWN);\r\n        this.addChild(this.tableView);\r\n        this.tableView.reloadData();  \/\/\u52a0\u8f7dtable\r\n\r\n        \/**this.requestData(1);*\/\r\n    },\r\n\r\n    scrollViewDidScroll:function (view) {\r\n    },\r\n\r\n    scrollViewDidZoom:function (view) {\r\n    },\r\n\r\n    \/\/\u6bcf\u4e2acell \u89e6\u6478\u4e8b\u4ef6\r\n    tableCellTouched:function (table, cell) {\r\n    },\r\n\r\n    \/\/\u8bbe\u7f6e\u7f16\u53f7\u4e3a idx \u7684cell\u7684\u5927\u5c0f\r\n    tableCellSizeForIndex:function (table, idx) {\r\n        return this.itemSize;\r\n    },\r\n\r\n    \/\/ \u7531\u4e8etableview\u662f\u52a8\u6001\u83b7\u53d6\u6570\u636e\u7684\uff0c\u8be5\u65b9\u6cd5\u5728\u521d\u59cb\u5316\u65f6\u4f1a\u88ab\u8c03\u7528\u4e00\u6b21\uff0c\u4e4b\u540e\u5728\u6bcf\u4e2a\u9690\u85cf\u7684cell\u663e\u793a\u51fa\u6765\u7684\u65f6\u5019\u90fd\u4f1a\u8c03\u7528\r\n    tableCellAtIndex:function (table, idx) {\r\n        var cell = table.dequeueCell();\r\n        if (cell) {\r\n            cell.removeAllChildrenWithCleanup(true);\r\n        }else {\r\n            cell = new CustomTableViewCell();\r\n        }\r\n        var itemBG = new cc.Sprite(rank_img_res.rankitem_bg);\r\n        itemBG.setAnchorPoint(cc.p(0,0));\r\n        itemBG.setPosition(cc.p(10,0));\r\n        cell.addChild(itemBG);\r\n\r\n        return cell;\r\n    },\r\n\r\n    numberOfCellsInTableView:function (table) {    \/\/ \u8bbe\u7f6e tabelview  \u7684cell \u4e2a\u6570\r\n        return 20;\r\n    },\r\n\r\n    setType : function (nType) {\r\n\r\n    },\r\n\r\n    requestData : function(nType) {\r\n        \/**Http.inst().getWithUrl(\"http:\/\/int.dpool.sina.com.cn\/iplookup\/iplookup.php?format=js&ip=&qq-pf-to=pcqq.c2c\", function(response){\r\n            cc.log(\"\u8fd4\u56de\u6570\u636e\" + response);\r\n            cc.log(\"\u8fd4\u56de\u6570\u636e\" + response);\r\n        });*\/\r\n    }\r\n});\r\n\r\nRankItem.create = function() {\r\n    var item = new RankItem();\r\n    return item;\r\n};","@jasonlxz thanks, how can i use it? Could you please tell me how to do it step by step? Thanks."],"labels":["script:jsb"]},{"title":"timeout is not working for LuaMinXmlHttpRequest","body":"Timeout is not working for LuaMinXmlHttpRequest class.\r\nseems like _httpRequest->setTimeoutForConnect() should be called in LuaMinXmlHttpRequest:setTimeout method","comments":["I think the property of timeout should inside HttpRequest, but now it is only inside HttpClient.","+1 for timeout property should be in `HttpRequest` class since HttpClient is a singleton."],"labels":["script:lua"]},{"title":"[android] Cocos2dxActivity is re-created which will cause crash","body":"It's a bug of android: Please refer to \r\nhttp:\/\/stackoverflow.com\/questions\/16283079\/re-launch-of-activity-on-home-button-but-only-the-first-time\/16447508#\r\n\r\n- cocos2d-x version: v3.13.1\r\n- devices test on: All android devices\r\n- developing environments\r\n   - NDK version: r10e\r\n   - Xcode version:\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n1. Click 'Run' button in the Installer to run a cocos game.\r\n2. Press 'Home' button to make game enter background\r\n3. Click game icon in desktop to go back to game\r\n4. Crash appear.\r\n","comments":["            android:launchMode=\"singleTask\"\r\n\u8fd9\u4e2a\u5e94\u8be5\u5bf9\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u6709\u5e2e\u52a9\u3002","Hi, solution from @yangzhu6263736 works for me, thank you!","Hello,\r\nWhat is the status of this issue?\r\nIt seems there is several other issues describing the same problem ([this one](https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/16687) for example).\r\nShould we wait for some common solution in the framework?\r\n"],"labels":["platform:android"]},{"title":"[win32] AudioEngine doesn't support to play wav file","body":"- cocos2d-x version: v3.14\r\n- devices test on: Windows 10\r\n- developing environments\r\n   - NDK version: N\/A\r\n   - Xcode version: N\/A\r\n   - VS version: VS2013\r\n   - browser type and version: N\/A\r\n\r\nSteps to Reproduce:\r\n\r\n1. Just use AudioEngine::play2d(\"test.wav\");\r\n2. No sound output.\r\n","comments":[],"labels":["module:audio"]},{"title":"Frame rate is not accurate if it is set to 60 or higher on Android","body":"Current implementation of FPS controller codes are\r\n```java\r\npublic void onDrawFrame(final GL10 gl) {\r\n        \/*\r\n         * No need to use algorithm in default(60 FPS) situation,\r\n         * since onDrawFrame() was called by system 60 times per second by default.\r\n         *\/\r\n        if (sAnimationInterval <= 1.0 \/ 60 * Cocos2dxRenderer.NANOSECONDSPERSECOND) {\r\n            \/\/ when FPS is set to 60 or higher, not FPS controlling\r\n            Cocos2dxRenderer.nativeRender();\r\n        } else {\r\n            \/\/ fps control codes\r\n        }\r\n    }\r\n```\r\nThere is not doc says `onDrawFrame` is invoked 60 per second. So if onDrawFrame is invoked more than 60 per second and `sAnimationInterval < 1.0 \/ 60 * Cocos2dxRenderer.NANOSECONDSPERSECOND`, then there is not FPS controlling, which may make real FPS is more than 60.","comments":["`onDrawFrame` is invoked 60 per second when vsync is enabled.","@minggo how do you recommend we fix this ? or is cocos team already working on it","I think we can just remove the codes of `if` statement to have a try. I will work on it after releasing v3.14.","ok will this have any effect on my game play if I release to android or should I wait for new update ? @ricardoquesada any recommendations? ","I think it will not affect your game too much, it just prevent to run too fast on devices that has high performance and invoke `onDrawFrame` more than 60 per second.","> devices that has high performance and invoke onDrawFrame more than 60 per second\r\n\r\nI haven't found such a device myself.","okay, but isn't that a good thing that it doesn't let it go more than 60 fps ? I thought thats how it was supposed to be ?","because if it goes more than 60 fps it could not be good for game play if you built it for 60 fps","http:\/\/discuss.cocos2d-x.org\/t\/too-many-fps-in-android-device\/8629\/6  something like this could possibly happen","Yep, that's why i create this issue.","Hey @minggo I found out some new info on this,  the issue seems to be with samsung galaxy ace devices running 2.3 as the user from the cocos2dx was using and in this article below that I found.\r\n\r\nhttp:\/\/gamedev.stackexchange.com\/questions\/90317\/capping-framerate-independently-of-logic-updates-in-single-threaded-android-game\r\n\r\nafter looking around more I found this article below, and it also was with android 2.3 and it says that this was fixed with \"project butter\" that android did in android version 4.1 when they fixed vsync to not go more than 60 fps.  \r\n\r\nhttp:\/\/stackoverflow.com\/questions\/17652975\/android-2-3-how-to-reduce-fps-to-60-vsync\r\n\r\n So this issue is only on devices lower than 4.1 and android already stopped supporting 2.3 so I think it is safe to close this issue now let me know what you think ?\r\n","https:\/\/nayaneshguptetechstuff.wordpress.com\/2014\/07\/01\/what-is-vsyc-in-android\/ this article also references it"],"labels":["platform:android"]},{"title":"Unneeded consecutive return statements","body":"For the following files, `cppcheck` is reporting duplicate consecutive return statements:\r\n\r\n```\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_3d_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_audioengine_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_cocosbuilder_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_cocosdenshion_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_controller_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_csloader_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_experimental_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_experimental_video_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_experimental_webview_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_extension_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_navmesh_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_physics_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_spine_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_studio_auto.cpp\r\ncocos\/scripting\/lua-bindings\/auto\/lua_cocos2dx_ui_auto.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/3d\/lua_cocos2dx_3d_manual.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/audioengine\/lua_cocos2dx_audioengine_manual.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/cocos2d\/lua_cocos2dx_deprecated.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/cocos2d\/lua_cocos2dx_experimental_manual.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/cocos2d\/lua_cocos2dx_manual.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/cocos2d\/lua_cocos2dx_physics_manual.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/cocostudio\/lua_cocos2dx_coco_studio_manual.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/cocostudio\/lua_cocos2dx_csloader_manual.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/extension\/lua_cocos2dx_extension_manual.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/navmesh\/lua_cocos2dx_navmesh_manual.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/spine\/lua_cocos2dx_spine_manual.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/ui\/lua_cocos2dx_experimental_video_manual.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/ui\/lua_cocos2dx_experimental_webview_manual.cpp\r\ncocos\/scripting\/lua-bindings\/manual\/video\/lua_cocos2dx_experimental_video_manual.cpp\r\nplugin\/luabindings\/auto\/lua_cocos2dx_pluginx_auto.cpp\r\nplugin\/luabindings\/manual\/lua_pluginx_manual_callback.cpp\r\nplugin\/luabindings\/manual\/lua_pluginx_manual_protocols.cpp\r\n```\r\n\r\nSome of the consecutive `return` statements pointed by `cppcheck` could be false positives due to them being in the body of an if-else branch, but for the most part it seems like the automatic update of the lua bindings generated many unneeded `return` statements.\r\n\r\nSee attached file for more details: [cppcheck_consecutive_statements.txt](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/596152\/cppcheck_consecutive_statements.txt)","comments":["We can improve manual binding codes. About auto generated binding codes, we should improve the [binding  generator](https:\/\/github.com\/cocos2d\/bindings-generator), which is not so easy.\n"],"labels":["script:lua"]},{"title":"cocos2d-x download file failed sometimes","body":"- cocos2d-x version:3.7.1\r\n- devices test on:windows\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version:\r\n   - VS version:\r\n   - browser type and version: chrome  52.0.2743.116\r\n\r\nSteps to Reproduce:\r\n\r\nsee detail here,http:\/\/forum.cocos.com\/t\/cocos2d-x-h5\/41263\/1. There is no question of file server @pandamicro @malvim  @minggo Can you give me some idea! ","comments":[],"labels":["platform:web"]},{"title":"ClippingNode broken on Canvas if position changes","body":"- cocos2d-x version: JS 3.13\r\n- devices test on: web\r\n- developing environments\r\n   - NDK version: n\/a\r\n   - Xcode version: n\/a\r\n   - VS version: n\/a\r\n   - browser type and version: Chrome, IE\r\n\r\nSteps to Reproduce:\r\n\r\n1. Add the following code into app.js ctor method\r\n\r\n\r\n```\r\n        var bgWhite = new cc.LayerColor( cc.color.WHITE, 200, 200 );\r\n        \/\/ WILL WORK IF THESE ARE BOTH SET TO 0\r\n        bgWhite.x = 110;\r\n        bgWhite.y = 110;\r\n\r\n        var maskLayer = new cc.ClippingNode( new cc.LayerColor(cc.color.WHITE, 200, 200));\r\n        maskLayer.x = bgWhite.x;\r\n        maskLayer.y = bgWhite.y;\r\n\r\n        this.addChild(bgWhite);\r\n        this.addChild(maskLayer);\r\n\r\n        var item = new cc.LayerColor( cc.color.RED, 100, 100 );\r\n        item.x = -200;\r\n        item.y = -200;\r\n        this.item = item;\r\n        maskLayer.addChild(item);\r\n\r\n\r\n        var move1 = cc.MoveTo.create( 1, cc.p(400, 400));\r\n        var move2 = cc.MoveTo.create( 1, cc.p(-200, -200));\r\n        var sequence = new cc.Sequence(move1, move2);\r\n        var repeat = cc.RepeatForever.create( sequence );\r\n        item.runAction(repeat);\r\n```\r\n2.  change project.json renderMode property to 1 (canvas) and 2 (WebGL)\r\nresults are different in each render mode\r\n\r\n\r\n","comments":["Note, I was able to \"fix\" this issue on Canvas by creating a variable for the node that is passed in to the ClippingNode constructor, and setting the position of that node to the preferred x and y.\nIt seems I'll have to set some conditional blocks based on whether it's WebGL or Canvas.... would still prefer to have this fixed behind the scenes if it's possible. \n\n```\n        var testNode = new cc.LayerColor(cc.color.WHITE, 200, 200);\n        testNode.x = bgWhite.x;\n        testNode.y = bgWhite.y;\n\n        var maskLayer = new cc.ClippingNode( testNode );\n        maskLayer.boundingBox().x = bgWhite.x;\n        maskLayer.boundingBox().y = bgWhite.y;\n```\n"],"labels":["platform:web"]},{"title":"Ability to change default AudioEngine mode","body":"This is a requirement. https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/10735 implements it on iOS in SimpleAudioEngine. Since we now focus on new AudioEngine, so we should implement it in new AudioEngine.","comments":[],"labels":["type:request"]},{"title":"[Bug]JS_IdToValue","body":"- cocos2d-x version:3.13\r\n- devices test on:ios 9.3\u6a21\u62df\u5668\r\n- developing environments\r\n   - NDK version:\r\n   - Xcode version:\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n1. \u8c03\u7528jsval_to_ccdictionary\u53cajsval_to_ccvaluemap\u51fd\u6570\u65f6\uff0c\u5982\u679ckey\u662f'10'\u8fd9\u6837\u7684\u7eaf\u6570\u5b57\u65f6\u8f6c\u6362\u5931\u8d25\r\n","comments":["I noticed this line in `jsval_to_ccdictionary`\n\n``` c++\n        if (!key.isString()) {\n            continue; \/\/ ignore integer properties\n        }\n```\n\nIt seems that integer key isn't supported since `__Dictionary` could not use `string` or `integer` as key at the same time.\nIs it better to convert integer key to string key and store it to `__Dictionary`?\n","This kind of map or dictionary was fixed to use string, because in C++, you can't mixup int key and string key together, we also provide `jsval_to_ccvaluemapintkey`\n","> Is it better to convert integer key to string key and store it to __Dictionary?\n\nSeems better this way, we can also convert them in conversion functions\n"],"labels":["script:jsb"]},{"title":"cocos2d-x jsb RichText","body":"- cocos2d-x version:3.7.1\r\n- devices test on:iphone5s\r\n- developing environments mac osx\r\n   - NDK version:\r\n   - Xcode version:6.1\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\n1. RichText has no methods setTextVerticalAlignment ,setTextHorizontalAlignment  like h5 framework! I have this needs,Please Help!\r\n","comments":["@zilongshanren , could you please check this issue? thanks.\n","@dumganhar \nOh...my \n\ncocos2d-x version 3.7 is a very old version.\n\nI have just looked at the latest code of RichText, it also doesn't have setTextHorizontalAlignment like h5 framework...\n"],"labels":["type:request"]},{"title":"cocos2d-x CCActionInterval cann't be extended ","body":"- cocos2d-x version:3.7.1\r\n- devices test on:ios 8.0\r\n- developing environments mac osx\r\n   - NDK version:\r\n   - Xcode version:6.4\r\n   - VS version:\r\n   - browser type and version:\r\n\r\nSteps to Reproduce:\r\n\r\nquestion same to \r\nhttp:\/\/discuss.cocos2d-x.org\/t\/cocos2d-js-beta-jsb-android-project-cc-actioninterval-extend-is-not-function\/15380\r\n\r\nsee detain here\r\nhttp:\/\/forum.cocos.com\/t\/cocos2d-x-3-7-1-js-actioninterval\/40922\r\n\r\nI hope this can resolved at soon!!!","comments":["@pandamicro is it fixed?\n","@pandamicro  cannot fixed?\n","nobody can fix \uff1f\n","Actions like moveTo can be extended, but ActionInterval is currently not supported because it's set as AbstractClass in the jsb configuration, but I think it's ok to make it extendable. @minggo is ActionInterval an abstract class or it can be constructed ? If it's abstract, then it's not possible to make it extendable in JSB, as we can not create an instance of it in native scope\n","ActionInterval is an abstract class.\n","Can we make it a normal class or is there any important consideration ?\n","Hope hope hope!\n","I am making h5  to app, Only the question left ! I think you can! @minggo  @pandamicro  \u2019\n","Sorry, ActionInterval is not an abstract class right now, but i think it should be. But i don't know why need to extend it? I think you can just inherit from it and add your own functions.\n"],"labels":["script:jsb"]},{"title":"Mesh generates access violation in Vertexbuffer on second Draw() call","body":"- cocos2d-x version:  3.13.1\n- devices test on: Windows 10\n- developing environments\n  - VS version: 2013 Community\n\nSteps to Reproduce:\n1. Create a mesh inside a class derived from Node, with an override Draw()\n2. Retain the mesh\n3. Add the instance of the derived class into a Scene with AddChild\n4. Try to access mesh->getVertexBuffer() inside the second call to overriden Draw()\n\nThis will throw an access violation. Other attributes of mesh remain correct, including the indexBuffer, but not the vertexBuffer.\n\nA more extensive explanation can be found in this forum post: [http:\/\/discuss.cocos2d-x.org\/t\/custom-draw-not-working-on-mesh-object\/32748](url)\nThe code is based on this one found in the wiki: [http:\/\/www.cocos2d-x.org\/wiki\/3D_Graphics#Building-a-Mesh](url)\n\nA minimal example of the offending code is attached here:\n[MeshProblem.zip](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/538839\/MeshProblem.zip)\n\nIf you need something else, just ask.\n","comments":["For a glance, I didn't find any problem in your code.\nI guess some `Ref` object is released while it should not. I will check it.\n","I think I've found something. If the meshvertexdata object inside CCMesh.cpp::create is retained, the VBO containing the vertices doesn't get destroyed between draw calls. \n\n``` c++\nMesh* Mesh::create(const std::vector<float>& vertices, int perVertexSizeInFloat, const IndexArray& indices, const std::vector<MeshVertexAttrib>& attribs)\n{\n    MeshData meshdata;\n    meshdata.attribs = attribs;\n    meshdata.vertex = vertices;\n    meshdata.subMeshIndices.push_back(indices);\n    meshdata.subMeshIds.push_back(\"\");\n    auto meshvertexdata = MeshVertexData::create(meshdata);\n    auto indexData = meshvertexdata->getMeshIndexDataByIndex(0);\n    CC_SAFE_RETAIN(meshvertexdata); \/\/ <-- TEMPORAL FIX, CHECK FOR LEAKS (SHOULD BE RELEASED LATER?)\n    return create(\"\", indexData);\n}\n```\n\ngDEBugger shows that both vertex and index buffers are OK, and no crash is generated on overrided draw calls.\n\nHowever I'm not able to obtain a working example of a manually created mesh that draws something onto the screen, to be sure of the fix. I'm using:\n\n``` c++\nvoid Mapa3D::draw(Renderer* renderer, const Mat4 &transform, uint32_t flags)\n{\n        auto programstate = mesh->getGLProgramState();\n        auto& meshCommand = mesh->getMeshCommand();\n        GLuint textureID = mesh->getTexture() ? mesh->getTexture()->getName() : 0;\n        meshCommand.init(_globalZOrder\n            , textureID\n            , programstate\n            , RenderState::StateBlock::_defaultState\n            , mesh->getVertexBuffer() \n            , mesh->getIndexBuffer()\n            , mesh->getPrimitiveType()\n            , mesh->getIndexFormat()\n            , mesh->getIndexCount()\n            , transform\n            , flags);\n        renderer->addCommand(&meshCommand);\n}\n```\n\nThe command passes to the renderer pool, because the GL draw call counter is increased, but nothing is shown.\n\nHope this helps to find the bug.\n"],"labels":["module:renderer"]},{"title":"mp3extractor: unable to resync. signalling end of stream  crashed on android 3.2","body":"- cocos2d-x version:3.10\n- devices test on: DELL T03G android 3.2\n- developing environments\n  - NDK version:r10c\n  - Xcode version:\n  - VS version:\n  - browser type and version:\n\nSteps to Reproduce:\n1. Just run the app with background music(loop)\n","comments":["How did you play background music? `experimental::AudioEngine`or `SimpleAudioEngine`?\n","Here is my code(JSB):\n\n _self.bgAudioId = jsb.AudioEngine.play2d(_self.res.bgSound, true, _self.bgVolume);\n    _self.bgDuration = 0;\n    _self.bgTimerId = _self.schedule(function () {\n\n```\n    if (_self.bgAudioId == null || _self.bgDuration <= 0) {\n        _self.bgDuration = jsb.AudioEngine.getDuration(_self.bgAudioId);\n\n        return;\n    }\n    var currentTime = jsb.AudioEngine.getCurrentTime(_self.bgAudioId);\n\n    if (_self.bgDuration - currentTime <= 0.1) {\n        jsb.AudioEngine.setCurrentTime(_self.bgAudioId, 0);\n    }\n}, 0.05);\n```\n\nBecause the loop option can not play audio again at once, so I have to check its current time and reset it. \n","Does it only happen on Android 3.2 device?\nCould you please try this test case in cocos2d-x 3.13.1 since we have refactored much of Audio code in 3.13.1? I wanna know whether it also happens in v3.13.1.\n","OK, but would test it later. I am busying on releasing new version of our app...\n","\ud83d\udc4c\uff0cthanks.\n","@liuyi, what's state of this issue now?"],"labels":["platform:android"]},{"title":"Activity issues after launch app first time, from play store, ... and reopening from icon on Android","body":"- cocos2d-x version: 3.13( with minor fixes from 3.13.1 and 3.14)\n  (included, we were already in this situation: _https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/16525\/commits\/eeac95c40f7a81c0158f44dc275c27f009cbd915_)\n- devices test on: Huawei p8, OnePlus 2\n- developing environments\n  - NDK version: r10e\n\nSteps to Reproduce:\n1.  Integrate something able to start new activity from your app (we are currently using sdkbox iap, play, appodeal that starts new activity),\n2.  Run\/Compile,Install,Start your app\n3.  When app start start new activity (ex in my case. play video for appodeal, show achievements, ...)\n4.  Return to device home without close app\n5.  Re-open app using icon\n6.  Note that activity has been stopped\n\nThe problem seems to be related to android issues reported in this answer: _http:\/\/stackoverflow.com\/a\/16447508_\n\nI managed to solve with answer workaround, but unfortunately i'm totally inexperienced in android activities. Note that with these steps the issue will only be present first time you install and launch the app, if you restart this doesn't happen. There are others methods for this to happen as for example launch the app from play store, return on device home without close, clicking app icon.\n","comments":["This also causes some other issues as well, that are still present even with the fix you linked. When it creates the second activity, it creates a new instance of `mEditBoxHelper` in `Cocos2dxActivity`. The problem with this is when it creates a new instance of that object, it clears out the static list `mEditBoxArray` in `Cocos2dxEditBoxHelper`. If you have an EditBox on screen and do the same steps you've described above, it no longer has those EditBox's in `mEditBoxArray` and cannot open the keyboard or accept input.\n"],"labels":["platform:android"]},{"title":"Strange log at startup when running on Mac OS X","body":"- cocos2d-x version: v3.13.1 and latest codes\n- devices test on: MacOS Sierra(10.12)\n- developing environments\n  - Xcode version: Xcode 8\n\nSteps to Reproduce:\n1. run cpp-empty-test on Mac\n2. will see the message at startup\n\n```\n2016-10-12 10:06:41.767496 cpp-empty-test Mac[29468:15584648] [General] ERROR: Setting <private> as the first responder for window <private>, but it is in a different window ((null))! This would eventually crash when the view is freed. The first responder will be set to nil.\n<private>\n```\n\nHaven't met any crash, but i may be a potential issue.\n","comments":["Happens when running the whole cpp-tests, not just empty.\n\n```\n2016-10-12 10:07:06.055058 cpp-tests Mac[20988:1902238] [General] ERROR:\n Setting <private> as the first responder for window private, but it is in a \ndifferent window ((null))! This would eventually crash when the view is freed. \nThe first responder will be set to nil. \n<private>\n```\n"],"labels":["platform:mac"]},{"title":"lua-empty-test link faild","body":"- cocos2d-x version: v3\n- devices test on: windows\n- developing environments\n  - NDK version:\n  - Xcode version:\n  - VS version:2015\n  - browser type and version:\n\nSteps to Reproduce:\n1. build lua-empty-test\n\nChange CCLuaEngine.cpp line 39-43 to just use lua51.lib is ok\n","comments":["What's the accurate cocos2d-x version? `v3` is not a version.\n","Is this still a problem? If so, could you answer the question above? @yiquanshui "],"labels":["script:lua","platform:win32"]},{"title":"Last jpeg lib causes crash on devices with NVIDIA Tegra","body":"- cocos2d-x version: 3.13.1\n- devices test on: Asus Eee Pad Transformer TF101\n\nIt seems that the last jpeg lib use NEON instructions for armeabi-v7a build. NVIDIA Tegra doesn't support NEON instructions, but supports armeabi-v7a. \nSo it causes SIGILL after first using of jpeg lib.\n\nAfter replacing armeabi-v7a jpeg lib with armeabi everything works fine.\n","comments":["@ricardoquesada i didn't find we did special for armeabi-v7a building, so may be the jpeg itself used neon for armeabi-v7a architecture?\n","@ondesly did you https:\/\/github.com\/cocos2d\/cocos2d-x-3rd-party-libs-src to rebuild jpeg lib? What special behavior did you do?","@minggo I just removed libjpeg.a in armeabi-v7a and copied it from armeabi.","Got it, so your app is built with armeabi-v7a? I am not sure if it is a good choice to do like this in cocos2d-x because it is just to avoid the issues and there is not much NVIDIA Tegra devices."],"labels":["platform:android"]},{"title":"[TileMap]Even each tileset only have one image,still can't show correctly.(withTestCase)","body":"- cocos2d-x version:3.13.1\n- devices test on: chrome \n- developing environments\n  - NDK version:\n  - Xcode version:\n  - VS version:\n  - browser type and version:chrome  53.0.2785.143\n  - Tiled Map Editor 0.17.0\n\nSteps to Reproduce:\n1. try to load tiled map attached here:[tilemap.zip](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/519080\/tilemap.zip)\n   \n   use this code : \n   \n      `var map = new cc.TMXTiledMap(res.map_tmx);`\n      `this.addChild(map, 2, TAG_TILE_MAP);`\n2. run the game in browser.\n\nNOTE: in this map , each tileset only have one image. but have 8 tilesets.\n\n[tilemap.zip](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/519080\/tilemap.zip)\n","comments":["Is there an limitation \"one layer only use one image\"?\nOr, \"one layer only use one tilesize\"?\n\nI split the metal,rock,wall in different layer, and then, seems better.\n","finally  set every tielset's tilewidth and tileheight to 64 as the map set , get correct result.\n","yeah there's definitely a one tileset per layer limitation in the cocos2d tilemap renderer\n"],"labels":["platform:web"]},{"title":"Missing cc.clone in JSB","body":"cocos2d-html has an implementation of `cc.clone` like:\n\n``` js\n\/**\n * Create a new object and copy all properties in an exist object to the new object\n * @function\n * @param {object|Array} obj The source object\n * @return {Array|object} The created object\n *\/\ncc.clone = function (obj) {\n    \/\/ Cloning is better if the new object is having the same prototype chain\n    \/\/ as the copied obj (or otherwise, the cloned object is certainly going to\n    \/\/ have a different hidden class). Play with C1\/C2 of the\n    \/\/ PerformanceVirtualMachineTests suite to see how this makes an impact\n    \/\/ under extreme conditions.\n    \/\/\n    \/\/ Object.create(Object.getPrototypeOf(obj)) doesn't work well because the\n    \/\/ prototype lacks a link to the constructor (Carakan, V8) so the new\n    \/\/ object wouldn't have the hidden class that's associated with the\n    \/\/ constructor (also, for whatever reasons, utilizing\n    \/\/ Object.create(Object.getPrototypeOf(obj)) + Object.defineProperty is even\n    \/\/ slower than the original in V8). Therefore, we call the constructor, but\n    \/\/ there is a big caveat - it is possible that the this.init() in the\n    \/\/ constructor would throw with no argument. It is also possible that a\n    \/\/ derived class forgets to set \"constructor\" on the prototype. We ignore\n    \/\/ these possibities for and the ultimate solution is a standardized\n    \/\/ Object.clone(<object>).\n    var newObj = (obj.constructor) ? new obj.constructor : {};\n\n    \/\/ Assuming that the constuctor above initialized all properies on obj, the\n    \/\/ following keyed assignments won't turn newObj into dictionary mode\n    \/\/ because they're not *appending new properties* but *assigning existing\n    \/\/ ones* (note that appending indexed properties is another story). See\n    \/\/ CCClass.js for a link to the devils when the assumption fails.\n    for (var key in obj) {\n        var copy = obj[key];\n        \/\/ Beware that typeof null == \"object\" !\n        if (((typeof copy) === \"object\") && copy &&\n            !(copy instanceof cc.Node) && !(copy instanceof HTMLElement)) {\n            newObj[key] = cc.clone(copy);\n        } else {\n            newObj[key] = copy;\n        }\n    }\n    return newObj;\n};\n```\n\nBut it's missing in JSB.\n\n@pandamicro , could you please check this?\n","comments":["I use this version of cc.clone without check for `HTMLElement`:\r\n\r\n```javascript\r\n\/**\r\n * Create a new object and copy all properties in an exist object to the new object\r\n * @function\r\n * @param {object|Array} obj The source object or array\r\n * @return {Array|object} The created object\r\n *\/\r\nclone = function (obj) {\r\n    \/\/ Cloning is better if the new object is having the same prototype chain\r\n    \/\/ as the copied obj (or otherwise, the cloned object is certainly going to\r\n    \/\/ have a different hidden class). Play with C1\/C2 of the\r\n    \/\/ PerformanceVirtualMachineTests suite to see how this makes an impact\r\n    \/\/ under extreme conditions.\r\n    \/\/\r\n    \/\/ Object.create(Object.getPrototypeOf(obj)) doesn't work well because the\r\n    \/\/ prototype lacks a link to the constructor (Carakan, V8) so the new\r\n    \/\/ object wouldn't have the hidden class that's associated with the\r\n    \/\/ constructor (also, for whatever reasons, utilizing\r\n    \/\/ Object.create(Object.getPrototypeOf(obj)) + Object.defineProperty is even\r\n    \/\/ slower than the original in V8). Therefore, we call the constructor, but\r\n    \/\/ there is a big caveat - it is possible that the this.init() in the\r\n    \/\/ constructor would throw with no argument. It is also possible that a\r\n    \/\/ derived class forgets to set \"constructor\" on the prototype. We ignore\r\n    \/\/ these possibities for and the ultimate solution is a standardized\r\n    \/\/ Object.clone(<object>).\r\n    var newObj = (obj.constructor) ? new obj.constructor : {};\r\n\r\n    \/\/ Assuming that the constuctor above initialized all properies on obj, the\r\n    \/\/ following keyed assignments won't turn newObj into dictionary mode\r\n    \/\/ because they're not *appending new properties* but *assigning existing\r\n    \/\/ ones* (note that appending indexed properties is another story). See\r\n    \/\/ CCClass.js for a link to the devils when the assumption fails.\r\n    for (var key in obj) {\r\n        var copy = obj[key];\r\n        \/\/ Beware that typeof null == \"object\" !\r\n        if (((typeof copy) === \"object\") && copy && !(copy instanceof cc.Node)) {\r\n            newObj[key] = clone(copy);\r\n        } else {\r\n            newObj[key] = copy;\r\n        }\r\n    }\r\n\r\n    return newObj;\r\n};\r\n```\r\n\r\nIt works fine on web and native."],"labels":["script:jsb"]},{"title":"changing transform on a sprite child affect its sprite parent","body":"- cocos2d-x version: 3.10, javascript\n- devices test on: PC \n- developing environments\n  - brower type and version: chrome\n\nSteps to Reproduce:\n1.   create a sprite, the parent. \n2.  attach a new sprite (the child) to the parent.\n3. change rotation or scale in the child (setRotation, setScale). the parent is also affected.\n\nI was expecting that the modifications affect only the child, but they somehow are affecting the parent too. \n","comments":["@cesarpachon it should not have this issue. How to reproduce it, could you please provide a test case? Thanks.\n"],"labels":["critical","platform:web"]},{"title":"can't unschedule when the schedule interval time is 0.005f ","body":"- cocos2d-x version:3.13.1\n- devices test on:iOS\n- developing environments\n  - NDK version:\n  - Xcode version:\n  - VS version:\n  - brower type and version:\n\nSteps to Reproduce:\n1. \n2. \n","comments":["Could you please provide a test case?\n"],"labels":["platform:ios"]},{"title":"cocos2d-x js-test IOS--Sprite3D","body":"- cocos2d-x version:3.13.1\n- devices test on:ios simulator iphone5s\/9.3\n- developing environments\n  - NDK version:\n  - Xcode version:7.3.1\n  - VS version:\n  - brower type and version:\n\nSteps to Reproduce:\n1. play js-test (Sprite 3D test)\n2. play every case and next to cubemap and skybox test.\n3. tap next.\n4. game will crash in Sprite3D::getMesh-->_meshes.at(0);\n\ntrigger this assert:\nCCASSERT( index >= 0 && index < size(), \"index out of range in getObjectAtIndex()\");\n","comments":["![outofrang](https:\/\/cloud.githubusercontent.com\/assets\/5636068\/19120555\/b165d036-8b55-11e6-8c1c-f896a4e28b48.png)\n","I think the function at(index) should return  nullptr here if size is 0 .\nmay be use  template partitial specialization will solve this issue.\nexample: \n\n``` c++\ntemplate<class T>\nclass Vector<T*>\n{\n      T* at(ssize_t index) const\n    {\n        if(size() < 0)\n        {\n                return nullptr;\n        }\n        \/\/or may be return nullptr for case : ( index < 0 || index > size()) is better?\n        CCASSERT( index >= 0 && index < size(), \"index out of range in getObjectAtIndex()\");\n        return _data[index];\n    }\n}\n```\n","What I was thinking while designing `cocos2d::Vector` is that `Vector` should be super fast and the bound check should be in `assert`.\nYes, what you thinking is also correct, but I'm thinking that it would probably make it a little slower.\nI guess user code should do the `bound check` instead of in `Vector` template.\n\nBest practice might be\n\n``` c++\n...\nVector<Node*> myVec;\n...\nif (!myVec.empty()) {\n     \/\/ do some thing with `at` method\n    auto ele = myVec.at(0);\n}\n...\n```\n\nIf we apply the patch you said. Users have to write some code like this:\n\n``` c++\nVector<Node*> myVec;\n...\nauto ele = myVec.at(0);\nif (ele != nullptr) {\n\/\/ BALABALA\n}\n...\n```\n\nAnd the complication of user code is really the same. But I like the first way.\n","yes, that make sense.\nso, the mistake is  : \n`Mesh* getMesh() const { return _meshes.at(0); }`\nwe should check _meshes's size before return.\n\nor, if you guys want keep this code simple, you should write like this:\n`Mesh* getMesh() const { return _meshes.s_at(0); }`\nand the vector should add s_at() for safe version.\n","and , maybe _meshes should not be empty here, right? \nso, maybe some thing else also wrong in this test case.\n","@zloop1982 , I think there should be something wrong in test case.\nFor me , I don't like adding a new method `s_at`. \n","yes, if we don't add `s_at`, we shouldn't write code like this:\n`Mesh* getMesh() const { return _meshes.at(0); }`\n","Agree, could you submit a pull request for it? Thanks.\n","ok, I will do it later.\n","Already submitted #16711\nonly for Mesh\\* getMesh()\n"],"labels":["script:jsb"]},{"title":"cocos2d-x js-test IOS","body":"- cocos2d-x version:3.13.1\n- devices test on: ios simulator ---iphone5s\/ios9.3\n- developing environments\n  - NDK version:\n  - Xcode version:7.3.1\n  - VS version:\n  - brower type and version:\n\nSteps to Reproduce:\n1. run  js-test IOS.\n2. play chipmunk test and tap screen to create many Collisions.\n3. play chipmunk test to Chipmunk Collision Test{using setDefaultCollisionHandler}(debug on).\n4. tap next arrow.\n5. game will crash in :\n\nbool ScriptingCore::forceGC(JSContext *cx, uint32_t argc, jsval *vp)\n{\n    JSRuntime *rt = JS_GetRuntime(cx);\n    JS_GC(rt);\/\/<<====crash here.\n    return true;\n}\n","comments":["![gc-screenshoot](https:\/\/cloud.githubusercontent.com\/assets\/5636068\/19120342\/0e62da14-8b55-11e6-8b26-95a2799ef0a4.png)\n"],"labels":["script:jsb"]},{"title":"[jsb] XHR 'timeout' property not affects HttpClient timeout","body":"- cocos2d-x version: 3.13.1\n- not work on all native platforms\n\nCode example:\n\n```\nvar xhr = cc.loader.getXMLHttpRequest();\nxhr.open(\"GET\", \"some address\", true);\nxhr.setRequestHeader(\"Content-Type\", \"application\/json;charset=UTF-8\");\nxhr.timeout = 5000;\n\nxhr.ontimeout = function ()\n{\n       throw new Error('Timeout');\n};\nxhr.onerror = function ()\n{\n       throw new Error('Error');\n};\nxhr.send(\"some data\");\n\n```\n\n`xhr.ontimeout` is not called after 5 seconds, `xhr.onerror` called after default `HttpClient` timeouts\n","comments":["I am not seeing this behavior on Windows 10, building win32 while on 3.13.1. Running your example code quickly yields an error after two frames, due to the HTTP client not being able to resolve \"some address\" via DNS.\n\nRunning a modified example seems to work fine, and logs a timeout appropriately, \n\n```\nvar xhr = cc.loader.getXMLHttpRequest();\nxhr.open(\"GET\", \"10.255.255.1\", true);\nxhr.setRequestHeader(\"Content-Type\", \"application\/json;charset=UTF-8\");\nxhr.timeout = 5000;\n\nxhr.ontimeout = function ()\n{\n    cc.log(\"TIMEOUT\");\n};\nxhr.onerror = function ()\n{\n    cc.log(\"ERROR\");\n};\nxhr.send(\"some data\");\n```\n\nHere 10.255.255.1 is a non-rotatable IP, and is guaranteed to timeout. Is there anything additional I need to do or set up to reproduce this error? \n"],"labels":["script:jsb"]},{"title":"cc.Scale9Sprite setColor is not work","body":"I found a bug. Please fix it!\n\nCocos2d-x JS 3.13.1\nChrome 53.0.2785.143\n\nSetting:\n    1. create new project with js.\n    2. app.js file's L.27 change\n        `this.sprite = new cc.Scale9Sprite(res.HelloWorld_png,null,cc.rect(10,10,10,10));`\n    3. Add L.28\n        `this.sprite.setColor(cc.color(250,20,30));`\n    4. Add modules \"extensions\" on project.json.\n    5. Run project.\n\nSprite color shift a dark color during changing browser size.\n\nI think UIScale9Sprite is recurring color control at redraw or update timing.\n","comments":[],"labels":["platform:web"]},{"title":"Memory leak in JSB when using repeat, repeatForever or easing functions on actions","body":"- cocos2d-x version: 3.11 and 3.13.1\n- devices test on: iPhone 6, iOS Simulator iOS 9.3\n- developing environments\n  - Xcode version: 7.3.1\n\nSteps to Reproduce:\nYou can see this by running the JS-Tests project, set breakpoints on these destructors:\nSequence::~Sequence \nRepeat::~Repeat\n\nGo to the Action Tests. Run the Sequence.repeat() test. After the three repeats, the destructors will only fire once even though there are two sequences and two repeat actions in the test. The one that fires corresponds to the direct creation of the repeat action: \n\nActionTests.js, line 2605\n`this._kathia.runAction(cc.repeat(cc.sequence(cc.blink(2, 3), cc.delayTime(2)), 3));`\n\nAs opposed to chaining the repeat function on the sequence action (which is where the leak occurs):\n\nActionTests.js, line 2610\n`this._tamara.runAction(move_seq.repeat(3));`\n\nCorresponding forum post here - http:\/\/discuss.cocos2d-x.org\/t\/memory-leak-in-jsb-when-using-repeat-repeatforever-or-easing-functions-on-actions\/32430\n","comments":["anybody has workaround for this issue?\n","@minggo This issue is real? Can you confirm that?"],"labels":["script:jsb"]},{"title":"AudioEngine bug - setCurrentTime error","body":"Test platform: windows 10\n1. Call audioEngine->play2d\n2. Immediately set current time audioEngine->setCurrentTime\n\nFor the first time: Invalid time setting\nThe second time: Will start playing a section from 0, then jump to the specified time\n\nanticipate result:\n  Start playing from the specified time\n","comments":["It seems that the current implementation of ```AudioEngine``` is really faulty.\r\nIt does not allow to perform any operations with audio right after ```play2d``` call.\r\nFor example this code will not work properly:\r\n```cpp\r\nint audioID = AudioEngine::play2d(\"music.ogg\");\r\nAudioEngine::pause(audioID); \/\/ [fail] This will not pause audio! Music will be played anyway!\r\nAudioEngine::setCurrentTime(audioID, 2.0f); \/\/ [fail] This will not affect current time! Music will be played from the position 0.\r\n```\r\nNow it's impossible for example to create paused audio to know its audioID or make gap-less switching between two tracks. Also large ogg file can't be played (I've tested on ~5MB file with playback duration ~3-4 min).\r\nI have just tested all this stuff with cocos2d-x version **3.13.1** on **Win32**.","@AIGRIND-LLC it's probably a hack, or otherwise should be internalized into the core engine behind the public API, but I believe you could setup a scheduled update function to wait for playability and then call your code.\r\n```\r\nint audioID = AudioEngine::play2d(\"music.ogg\");\r\n\/\/ pseudo-code: schedule update every frame forever\r\nthis->schedule(\"unique_id\", []() { \r\n  auto state = AudioEngine::getState(audioID);\r\n  if(state == AudioEngine::AudioState::PLAYING)\r\n  {\r\n    AudioEngine::pause(audioID); \r\n    AudioEngine::setCurrentTime(audioID, 2.0f); \r\n    this->unschedule(\"unique_id\");\r\n  }\r\n});\r\n```\r\n","@stevetranby I think due to different threads (scheduler and audio playback) this kind of approach won't work. The audio thread may already start to play track before scheduler calls the update function.","Well these ideas needs to exist then. \r\n\r\n- Accept an options dict that supports things like \"start this paused\", \"start this at XX time\",  \"start this with pitch == .7\", etc\r\n- The audio system should also have a \"started playing\" callback that fires as soon as the audio's state changes to PLAYING.","@stevetranby , good idea, I will consider to add those callbacks.\r\nYep, because audio playing is asynchronous, some callbacks of status are needed indeed."],"labels":["module:audio"]},{"title":"cocos2d-x 3.13.1 Android CURL not change","body":"- cocos2d-x version: 3.13.1\n  Android curl Library did not change after use GCC\n","comments":["What did you mean did `Android curl Library did not change after use GCC`?\n","create a new project\nopen \"$(call import-module,curl\/prebuilt\/android)' in cocos\/Android.mk\nadd \"LOCAL_STATIC_LIBRARIES += cocos_curl_static\" in cocos\/Android.mk\nit will be crush\n","how to solve this problem?\n"],"labels":["platform:android"]},{"title":"FileUtils::createDirectory() on MacOS fails to create directory (APP SANDBOX)","body":"- cocos2d-x version: 3.10 and supposedly to 3.13\n- devices test on: Mac Mini\n- developing environment:\n  - Xcode version: XCode 8.0\n  - OSX 10.11 El Capitan\n- mac app: APP SANDBOX ACTIVATED\n\nSteps to Reproduce:\n\nExecute Code: \nstd::string folder_path = \"\/Users\/[USER]\/Library\/Containers\/[APP_ID]\/Data\/Documents\/newfolder\/\"\nFileUtils::getInstance()->createDirectory(folder_path)\n--> Returns false\n--> Folder is not created\n\nAssumed reason:\n\nThe createDirectory function tries to create all subdirectories that don't exist. It begins with the root folder '\/' and checks existence by 'openDir' (Line 1132). 'openDir' FAILS (returns NULL) for '\/'. Therefore it is assumed that '\/' does not exist and the subsequent 'mkdir' for '\/' fails of course aborting the function by returning false.\n\nI guess that SANDBOX Apps are not allowed to READ '\/' because 'openDir' fails?\n","comments":["Should you use `getWritablePath()` to determine where the app can actually write to? I don't know that you can just make up a path due to the sandboxing.\n","The folder_path example above in my code is constructed like this: getWritablePath() + \"newfolder\/\". So I only work within the writable path.\n","It is fixed in https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/15452\n"],"labels":["platform:mac"]},{"title":"Win32: Third-party .dlls using different platform toolsets","body":"On win32, currently cocos2d-x and most .dlls use the setting for Platform Toolset v120_xp.\n\nSome 3rd-party .dlls however use different platforms toolsets, namely v100 used by sqlite3 and v110 used by libmpg123, libogg, libvorbis, libvorbisfile and libopenal.\n\nThis adds the requirement to manually include msvcr100.dll and msvcr110.dll when distributing the .exe of a game. Ideally all .dlls would use v120_xp simplifying the distribution.\n","comments":[],"labels":["platform:win32"]},{"title":"SimpleAudioEngine fails to playback 32bit wav files","body":"- cocos2d-x version:3.13\n- devices test on: iOS Simulator & Windows\n- developing environments\n  - Xcode version: 7.3.1\n  - VS version: 14.0.25425.01 Update 3\n\nSteps to Reproduce:\n1. Use any 32 bit .wav file\n2. `SimpleAudioEngine::getInstance()->playEffect(filePath, false, 1, 0, 1);`\n\nThe sound will not play. However converting with Audacity to a 16bit version works perfectly fine.\n\nIf I need to supply a test file let me know.\n","comments":["Could you upload a 32bit .wav for testing? Thanks.\n","I've put one in my dropbox. Not sure a great place to upload them.\n\nhttps:\/\/dl.dropboxusercontent.com\/u\/16766619\/punch.wav\n","@hunterwilliams ,  I could download the file you uploaded. Thank you.\n","@hunterwilliams , I tested, it's a bug of SimpleAudioEngine.\n\n``` objc\nvoid* CDloadWaveAudioData(CFURLRef inFileURL, ALsizei *outDataSize, ALenum *outDataFormat, ALsizei*    outSampleRate)\n{\n...\n    if ((theFileFormat.mBitsPerChannel != 8) && (theFileFormat.mBitsPerChannel != 16)) { \n\/\/ GOTO HERE, SINCE mBitsPerChannel is 32.\n        CDLOG(@\"MyGetOpenALAudioData - Unsupported Format, must be 8 or 16 bit PCM\\n\"); goto Exit;\n    }\n```\n\nI also tested with `AudioEngine` which uses openal to play audio. And it works ok.\nIt's better to switch to `AudioEngine` which is more powerful. :)\n","Ah I didn't manage to see that pop in the logs. Maybe suggest a documentation mention unless I missed it :)\n"],"labels":["platform:win32","platform:ios"]},{"title":"cocos command line tools allows to create project with package containing '-' character","body":"- cocos2d-x version: 3.13.1\n\ncocos allows to create project with package containing invalid character.\nexample: cocos new TestProj -l cpp -p com.test-site.game\n\nHere, com.test-site.game is an invalid package identifier. \nThis will result in build error because of invalid character in AndroidManifest.xml\n","comments":[],"labels":["platform:android"]},{"title":"Mac ,FPS drop from 60 to 30 on FullScreen .","body":"- cocos2d-x version: 3.11.1\n- devices test on: Macbook Retina 15 , MAC OSX\n- developing environments\n  - Xcode version: Version 7.3.1 \n\nThis Issue only on  `glview = GLViewImpl::createWithFullScreen(\"DCR\");`\nif i use this the game will run 60 fps `glview = GLViewImpl::createWithRect(\"DCR\", Rect(0, 0, 1136 ,640));`\nOn some mac devices the fps will drop from 60 to 30 . and go back to 60 again \nthe game drop even on the  loading that have only 1 sprite the logo.\nplease see the attached video . it will show the issue ,\n[video-1473507408.mp4.zip](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/465879\/video-1473507408.mp4.zip)\n","comments":["I watched the video. Interesting. But can you clarify a bit? Which line are you using that cases the drop? Also, by Mac devices do you you mean iphones and ipads or desktop OSX?\n","Only on desktop OSX , the drop happen only when the game is on FullScreen \n`glview = GLViewImpl::createWithFullScreen(\"DCR\");`\n","If the issue only appears on macOS desktop, it's probably an issue of GLFW in fullscreen.\n","@dumganhar  let me do more test on windows .\n","@Kotaiba, that will be better for us to check the issue. Thanks. :)\n","@dumganhar Same issue on windows but it drop to 20-30-60fps only on FullScreen.\n","@Kotaiba, interesting. I will try to reproduce it.\n","@Kotaiba , I tried cpp-empty-test on my MacBook Pro (Retina, 15-inch, Early 2013). And I could not reproduce it. Could you test cpp-empty-test?\n","@dumganhar  cpp-empty-test  worked fine . but try to run cpp-tests on fullscreen and open basic-shaders it sometimes happen see the attached image . i am using MacBook Pro (Retina, 15-inch, Mid 2014)\n<img width=\"1440\" alt=\"screen shot 2016-09-13 at 11 43 20 am 1\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/3635272\/18467126\/5e0b1a5a-79a7-11e6-9725-ac56c8b9356d.png\">\n\nquestion: why when i set the fps to 120 it stay on 60 ? \n","Yep, I reproduced it by Shader test.\nAnd even though I set fps to 120, it still kept 30 fps on my Mac.\nProbably, while in full screen of `Frag shader test`, GPU is too busy. And V-Sync takes effect and makes CPU to wait GPU to finish its operation. My description may be wrong.\nI asked @dabingnn who is an expert of Rendering for help. And he said fps jump from 60 to 30 in fullscreen is reasonable while GPU is too busy.\n\n@ricardoquesada , do you have any idea about this?\n","@dumganhar i mean when i set the fps to 120 it stay at 60 not on this issue ,in general .but on some windows devices it go up to 120 and other it stay on 60 .?\n","@Kotaiba , sorry, I have no idea about that now.\nMaybe @ricardoquesada could help. :)\n","For me, cpp-tests was working at 60FPS in most of the tests. Some run at 15, specially the shader ones.\nI guess it is because in full screen it has \"more pixels\" to fill ? But it created a 1440x900 screen which is not that big, specially compared to iPhones and other 6\" devices.\nMy guess is that it could be a bug either in GLFW or in the Mac OpenGL driver... or perhaps we are setting it incorrectly? I've just debugged it and I couldn't find anything strange in our code.\n","Hey,\n@ricardoquesada @dumganhar  I had the same issue, when running fullscreen on xcode. Fps would bounce between 30-60.\n\nInstead go to debug folder and run .app file. It gives much better fps for me its 58-60.\n\nThanks\n","Debug folder did't solve it for me . and i tied to export it from Archive same issue .\nIt's weird how good the game running as popup ,and how bad its on fullscreen the hole game is lagging not only on the shaders .even on the loading. \n\nif you run cpp-tests on fullscreen you can see the fps is not as stable as the popup not only on the shader test .\n","@Kotaiba  You are right... i tested it on a 2 year old macbook and it was lagging pretty bad.\n","@minggo  Hi, Previously my game was supposed to launch on android 6months ago. But our team realised that android had too many performance and audio issues.\n\nSo we planned to go desktop first.\n\nMac performance is much better than android but it is not as good as iphone version.\n\nHere is a Vid of A empty scene in full screen mac!\n\nhttps:\/\/www.dropbox.com\/s\/dfl5bzg5baplxh0\/macLag.mov?dl=0\n\nthe fps spikes alot in an empty scene.\n\nMy game runs 60 fps with 200 drawcalls and 600+ nodes spawned at all time on IPHONE.\nMac should be able to generate 180+ fps with no problem.\n\nMac Spec for the test.\nMacbook pro 15-inch mid 2015\n2.5ghz i7\nGraphic card AMD r9 370x\n\nOSX version 10.11.6\n\nWhat can I do to get a better performance from mac Full Screen version?\n\nAny help would be greatly appreciated thanks :D\n","I was reading the developer log of Banished and the developer mentioned a similar FPS drop issue in the [entry of June 23, 2016](http:\/\/www.shiningrocksoftware.com\/2016-06-23-passing-values\/) while working on the Mac OS X port of the game. The last line of the log summarizes the root cause of the problem:\n\n> ... don\u2019t pass uniform arrays and large structs to a function by value in GLSL.\n\nI think this might be the cause for the FPS drop in Cocos2D-X too -- a quick search of the `inout` keyword under the cocos directory returns empty:\n\n```\n$ cd ${COCOS_GIT_ROOT}\/cocos\n$ find . -type f -exec fgrep 'inout' {} + \n```\n","Why did you find `inout`?\n","That's the change the Banished developer made to the `SkinPosition` function to fix the FPS drop in the Mac OS X port. That same keyword, which strictly speaking is a parameter qualifier, also appears in the [OpenGL ES Shading Language](https:\/\/www.khronos.org\/files\/opengles_shading_language.pdf). And there are [online references](http:\/\/www.shaderific.com\/glsl-qualifiers\/) that state that using this `inout` qualifier will make the parameter to be passed by reference in GLSL. In other words, the lack of that `inout` qualifier means that we are not passing anything by reference in GLSL and this could account for the FPS drop that we are experiencing. That's why I looked looked for it in the source code.\n\nWe are also lacking that `inout` qualifier in the Mandelbrot shader -- in fact, we don't have it in any of the shaders in cpp-tests:\n\n```\n$ cd ${COCOS_GIT_ROOT}\/tests\/cpp-tests\/Resources\n$ find . -type f -exec fgrep 'inout' {} +    # returns nothing\n```\n\nPerhaps by modifying the Mandelbrot shader to include that `inout` qualifier we might be able to test if this is issue can be fixed by including that qualifier somewhere else in the shaders where possible.\n\nI might be wrong, I'm not an expert on GLSL and I don't know if this can be done, but I thought this might be worth looking into.\n\nUpdate: Clarification.\n","@minggo hey, will this be looked into for 3.14 release or later?\n","It will be in later version.\n","Okay thanks :)\n","I've been upgrading to 3.13.1 this week and I am currently wrestling with the same issue. However, I'm seeing the 60 --> 30 --> 60 bounce in windowed mode too.\n","@RustyMoyher is it only on Mac or both Mac and PC ?.\n","@Kotaiba Nope, only on Mac. Just finished testing in various Win 10 and Win 7 and in windowed and fullscreen modes: ran 60 fps without issue.\n","@minggo  any update about the fix ?","Sorry, not yet. Because Mac is not a release platform, so i put it in low priority.","@Kotaiba I tested cpp-tests, the `Mandelbrot` shader test will drop to 30 fps. And other test cases don't have the issue. Did you mean the Mandelbrot shader test is an issue?","@minggo  No the issue happen on my game 90% of the time when the game is on full screen, not only on the shaders .see the attached video it will show the issue clearly .\r\n[IMG_2350.zip](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/860776\/IMG_2350.zip)\r\n\r\n","Can not download it currently because of network speed. How can i reproduce it?","the Mandelbrot shader test ,is one way to reproduce it .","try to set on-off button to switch between fullscreen inside the shader test ,you will see how the fps limit it self to 30 ,and jump back to 60 on popup mode.","Yep, Mandelbrot shader test can reproduce it. But because it uses a specific shader and other shaders don't have the issue. So it is not a good test case. I wonder if it is shader related or not.","I have 4 scenes on my game and the issue happen in all of them ,the scene on the video that i attached got spine animation and only few sprites. ","@kaishiqi Have you seen this? https:\/\/github.com\/glfw\/glfw\/issues\/772\r\n\r\nThe fun technical dive on this issue can be found here: http:\/\/stackoverflow.com\/questions\/27758027\/sprite-kit-serious-fps-issue-in-full-screen-mode-on-os-x","@RustyMoyher thanks for the link. Interesting issue. I think we should wait glfw to fix the issue, or you guys can modify the glfw source code to have the patch which i don't think it is a elegant way to fix it.","I don't think the bug I linked to was with glfw. It a bug with macOS.","Yep, you are right. I mean if we want to work around, we should modify glfw source codes, but it is not a good way.","@minggo will this get fixed?","@Kotaiba were you able to fix this?","@Bilalmirza  no , this is not cocos2d bug . \r\nFor me i made 3 sizes for mac and the user can change between them and full screen is not one of them .  view->setWindowed(1136 ,640); ","@Kotaiba thanks! "],"labels":["platform:mac"]},{"title":"This line should be removed","body":"https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/v3\/tools\/simulator\/frameworks\/runtime-src\/proj.android\/jni\/Application.mk#L12\n","comments":["Is that line dead?\n","No, but in release build I think this macro should not be present.\n","@gekailin i think you are right, why not send a PR for it?\n"],"labels":["platform:android"]},{"title":"setAnimationInterval bug in win32 ","body":"- cocos2d-x version: 3.11.1\n- devices test on: win32  (4-devices)\n  \n  case 1 :\n  `director->setAnimationInterval(1.0 \/ 60);`  the game frame will be - between 61 and 57, and there is lag in the game -on some devices it will run  between 60 and 59.\n  case 2:\n  `director->setAnimationInterval(1.0 \/ 61.5);`  the game frame will be - between 60 and 59, runs perfect (same device that got lag on 1.0\/60 the lag will be solved on this devices) ,and will run between 61.5 and 60 on some devices .\n\nSo for me to solve the lag on some devices i run the game at 61.5 fps to get 60 fps ,but it will run 61.5 on other devices .\n","comments":["The better metric is time per frame. Unreal, Unity, et al show frame stats as ms spent on CPU\/GPU for rendering and other aspects and then calculate frame rate based on that (1000\/frame_time_in_ms). \n\nThe point is that if you're measuring FPS based on the visible label that's set by cocos2d it's not that accurate.\n\nIf you're seeing actual lag (skipped animation frames, jerky movement, etc), that's a different story.\n"],"labels":["platform:win32"]},{"title":"Node::Draw not smooth on complex, wider lines","body":"Drawing thicker lines show sawtooth and other artifacts. Tested on win32. Haven't tested it on other platforms. See screen captures (taken from a modified cpp-test)\n- Original, with no line width:\n  ![image](https:\/\/cloud.githubusercontent.com\/assets\/20006414\/18253919\/056008ca-7399-11e6-9f32-ef4681fb2df2.png)\n- With line width:\n  ![cardinalspline](https:\/\/cloud.githubusercontent.com\/assets\/20006414\/18253837\/4c5ade9a-7398-11e6-9076-aa30c6d40995.png)\n- Original, with no line width:\n  ![image](https:\/\/cloud.githubusercontent.com\/assets\/20006414\/18253929\/14813d38-7399-11e6-993e-6d002003f03e.png)\n- With line width:\n  ![catmullrom](https:\/\/cloud.githubusercontent.com\/assets\/20006414\/18253838\/4e441e7e-7398-11e6-925c-3c9230f09b8b.png)\n- cocos2d-x version: 3.11.1\n- devices test on: win32 \n- developing environments\n  - NDK version: -\n  - Xcode version: -\n  - VS version: VS 2015 update 3 community \n  - brower type and version: -\n\nSteps to Reproduce:\n\nEdit ActionsTest.cpp\n- ActionCatmullRom::onEnter()\n\nModify drawing parameters of both nodes adding these lines:\n\nNew Line 1997: drawNode1->setLineWidth(16);\n\nNew Line 2025: drawNode2->setLineWidth(32);\n- ActionCardinalSpline::onEnter()\n\nModify drawing parameters of both nodes adding these lines:\n\nNew Line 2083: drawNode1->setLineWidth(40);\nNew Line 2103: drawNode2->setLineWidth(40);\n","comments":[],"labels":["platform:win32"]},{"title":"libfmod not found when I run cpp-tests","body":"When I run cpp-tests I got the error `error while loading shared libraries: libfmod.so.6: cannot open shared object file: No such file or directory`\n\nConfiguration :\n- cocos2d-x version: 3.13\n- devices test on: Linux Ubuntu 14.04 i686\n\nSteps to Reproduce:\n1. Clone the cocos repository,\n2. python download-deps.py\n2. git submodule update --init\n2. .\/install-deps-linux.sh\n2. Build tests files\n3. Run cpp-tests\n\nTo fix this error, I copied libfmod and lifmodL into `\/usr\/local\/lib` folder and updated lib cache with `ldconfig`.\n\nSuggestion : download-deps.py or install-deps-linux.sh should automatically install libfmod ?\n","comments":["Yes, I know this problem and it will be fixed when #16410 is merged. Basically, fmod is going to be replaced by openal.\n","yes, as @Janonard  said.\nIn the meantime, you have to install fmod manually.\n","So what is the status? can I go ahead and use #16410? \n","Possible duplicate of: https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/15137"],"labels":["platform:linux"]},{"title":"New app crash on Android","body":"- cocos2d-x version: 3.13\n- devices test on: virtual android x86\n- developing environments\n  - NDK version: 10e\n  - Xcode version: n\/a\n  - VS version: Community 2015\n  - brower type and version: n\/a\n\nSteps to Reproduce:\n1. cocos new cocostest -p com.cocostest -l cpp\n2. cocos run -p android --app-abi x86 -m debug\n3. App starts up fine, all seems OK\n4. Wait a little while (maybe 10 seconds or so), the app crashes\n","comments":["Try to compile with NDK r10c, recently also encountered similar crashes with ndk r10e after updating cocos2d-x.\n","@codespear , I tested  it with cocos2d-x 3.13 & ndk-10e & x86 simulator, and I didn't find the crash you said.\nBTW, the `screenSize` section in `AndroidManifest.xml` should be deleted since we reverted to use API 10 in v3.13.\n\nCould you check that which API version you're using?\nAnd could you provide the logcat output?\n","@dabingnn , I am using platform 4.4.2 (API 19).  \nGet the logcat output from [dropbox](https:\/\/www.dropbox.com\/s\/mgas9t1eoi7jjtw\/log.zip?dl=0).\n","@codespear, it's probably a bug of our x86 optimized code.\nYou could try to disable `__SSE__` optimization in Application.mk by adding\n\n```\nAPP_CPPFLAGS += -U__SSE__\n```\n\nLet me know whether this workaround works for you.\n","@dumganhar I tried it and it still crashed.  When I get a bit of time I will try other variations of the SDK and NDK. \n","I reproduced crash with NDK 10c, sticking to API 19.\nNot sure how important this is but I am also using an Atom  x86 emulator.\n\n**Good news** is that there is no crash with NDK 10c and API level 22.\n"],"labels":["platform:android"]},{"title":"Scaled Sprite drop down framerate, it comes from cocos2dx 3.6(or earlier) not be fixed yet.(test in 3.10)","body":"Testing on IOS and Android, JSB APP\n# See screenshot:\n\nThe brown background is a Sprite. It's texture is a small png file and scale to fit width of window.\n**The scale more bigger the framerate is more slowly.**\n**More Sprite being scaled, the framerate is more slowly**\nsimple code:\nvar landBg = new cc.Sprite(\"#land_bg.png\");\nvar landBg.scaleX = 1024 \/ _self.landBg.width;\nthis.addChild(landBg);\n\nJS: _self.landBg.scaleX :5.688889026641846\n![sp1](https:\/\/cloud.githubusercontent.com\/assets\/848803\/18202923\/0be48720-7146-11e6-9f5c-1d95f27490e4.png)\n\nscaled but set visible to false:\n![s2](https:\/\/cloud.githubusercontent.com\/assets\/848803\/18202921\/0b25db54-7146-11e6-95e9-c804f0d8b770.png)\n\nno scale and visible is true.\n![image](https:\/\/cloud.githubusercontent.com\/assets\/848803\/18202904\/f05a4788-7145-11e6-97b6-24f41a2d0659.png)\n\nthis is the picture use to test:\n![land_bg](https:\/\/cloud.githubusercontent.com\/assets\/848803\/18203092\/1ad037ce-7147-11e6-9581-d2a858f5f35f.png)\n","comments":["@minggo @pandamicro  Could you guys have a look this issue?\n\nI am sure this is an render bug, and only need serval minutes to do a simple test.\nIn this testing, I set framerate to 30fps.\n","@liuyi \nSo do you think it's the problem of scaled sprite?\nCould you test it by only adding a single scaled sprite and check out the frame rate?\n","OK  I can write a test sample tonight.\n","Tested on IPAD3  cocos2dx version:3.10\n\n**Can not reproduce this problem when test with simple case.**\n1\\Create 50 scaled Sprites,\nscale them to (w:1024 ,h:768)  frame rate about:30-38fps \n\n2\\Create 50 normal Sprites, but has the same display area with scaled Sprites. \n(w:1024 ,h:768) frame rate about:28-38fps \n\n3\\Their almost have the same frame rate.\n\n4\\ But the scaled image make my game frame rate down. I will check it again.\n\n5\\ I think the labels should be removed for now.\n\n6\\ Thanks! Here is my testing sample code.\n\n[ScaleDropDownFrameRateSample.zip](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/463716\/ScaleDropDownFrameRateSample.zip)\n"],"labels":["script:jsb"]},{"title":"JSB  special action can not work, see simple code:","body":"COCOS2DX 3.10 IOS \n\n``` javascript\ntoySp.runAction(\n                    cc.sequence(\n                        cc.delayTime(Math.random() * 2),\n                        cc.sequence(\n                            \/\/  cc.spawn(\n                            cc.moveTo(toyIdleDuration, toySp.x, toySp.oy + 10).easing(cc.easeSineOut()),\n                            \/\/  ),\n                            \/\/ cc.spawn(\n                            cc.moveTo(toyIdleDuration, toySp.x, toySp.oy).easing(cc.easeSineOut())\n                            \/\/)\n                        ).repeatForever()));\n```\n\nLOG:\n\n```\n[Action update]. override me\n[Action update]. override me\n[Action update]. override me\n[Action update]. override me\n```\n\ntoySp  should move up and down, but it don't move 1 pixel.\n","comments":["replacement method:\n\n``` javascript\ntoySp.runAction(\n                    cc.sequence(\n                        cc.delayTime(Math.random() * 2),\n                        cc.callFunc(function (sp) {\n                            sp.runAction(cc.sequence(\n                                \/\/  cc.spawn(\n                                cc.moveTo(toyIdleDuration, toySp.x, toySp.oy + 10).easing(cc.easeSineOut()),\n                                \/\/  ),\n                                \/\/ cc.spawn(\n                                cc.moveTo(toyIdleDuration, toySp.x, toySp.oy).easing(cc.easeSineOut())\n                                \/\/)\n                            ).repeatForever());\n                        },toySp)\n                    ));\n```\n"],"labels":["script:jsb"]},{"title":"Could cocos2dx team will fix\/optimize some little bugs in cocos2d-x(JSB)? ","body":"I found some little bugs on cocos2dx(JSB) code, or missing some function.\nsuch as:\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/16448\n\nOr some components need be optimized, like below:\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/16447 \n\nSo,\nIs Cocos2dx(JSB) is so important that you guys don't care fix these issues?\nOr\nYou guys want all the cocos2d-js user move to CREATOR, so don't want fix these little bugs in cocos2d(JSB)?  \n\nOr don't want to improve these components in cocos2d-x, specially cocos2d-x(jsb)?\n","comments":["@pandamicro please take a look.\n"],"labels":["script:jsb"]},{"title":"cc.TextFieldTTF &cc.LabelTTF  need more optimization. Create a instance of TextFieldTTF need 50ms. ","body":"cocos2dx 3.10 JSB\ntest on ipad 3\n\nsimple code:\nvar t=Date.now();\nvar txt=new cc.TextFieldTTF();\nconsole.log(\">>>>>>>>>>>>>> txt:\"+(Date.now()-t));   \/\/echo 50-53ms\n\nHope text components can be more efficient. \n","comments":["Here is some points need optimized in my opinion.\n\n1\\ The way load csb, it cost too much time. The simple scene cost 179ms \n![scene](https:\/\/cloud.githubusercontent.com\/assets\/848803\/18114136\/5fd8c368-6f67-11e6-8ef5-c516ab6badac.png)\n\nI knew cocos studio is not support now, but if we can make the parser more faster it would be cool!\n\n2\\ TextField components, see my screenshot at below:\n![test-ios-ipad3](https:\/\/cloud.githubusercontent.com\/assets\/848803\/18114210\/07cd07f0-6f68-11e6-86b0-587577c6754d.png)\n\nAll the textField are too slowly..\n"],"labels":["script:jsb"]},{"title":"cocos2d-js editBox.touchDownAction is not function","body":"- cocos2d-x version: 3.11.1\n- devices test on: Chrome Web browswer, Samsung Galaxy S5\n\nSteps to Reproduce:\n1. i want make the editbox is automatically be focus and open keyboard (in mobile device)\n2. try method touchDownAction\n\nvar editBox = new cc.EditBox(...);\n\neditBox.touchDownAction(editBox, cc.CONTROL_EVENT_TOUCH_UP_INSIDE);\n\nit not work on Web browser\n\nin mobile device show error message \"editBox.touchDownAction is not function\"\n","comments":["Hi, touchDownAction have been added in latest version, but unfortunately, it's empty implemented, the reason is that we simply can't open the keyboard automatically without user interaction, it's forbidden by most browsers. It's by design and I don't think it's possible to have a walk around here.\n\nref: https:\/\/www.quora.com\/Mobile-Safari-iPhone-or-iPad-with-JavaScript-how-can-I-launch-the-on-screen-keyboard\n","because i see in some game eg. Clash of Clans, they use this technique to make input chat more interactive.\njust click on a button and then keyboard opening with input box\ni just want to make my game like so\nand currently i'm testing on Android phone\n"],"labels":["platform:web"]},{"title":"bugs in function void Bone3D::updateLocalMat()","body":"- cocos2d-x version: cocos2d-x v3.10+\n- devices test on: all platform\n- developing environments\n  - NDK version:\n  - Xcode version:\n  - VS version:\n  - brower type and version:\n\nthe code in this function\n\n``` cpp\n                float invTotal = 1.f \/ total;\n                for (const auto& it : _blendStates)\n                {\n                    float weight = (it.weight * invTotal);\n                    translate += it.localTranslate * weight;\n                    scale.x += it.localScale.x * weight;\n                    scale.y += it.localScale.y * weight;\n                    scale.z += it.localScale.z * weight;\n                    if (!quat.isZero())\n                    {\n                        Quaternion& q = _blendStates[0].localRot;\n                        if (q.x * quat.x + q.y * quat.y + q.z * quat.z + q.w * quat.w < 0)\n                            weight = -weight;\n                    }\n                    quat = Quaternion(it.localRot.x * weight + quat.x, it.localRot.y * weight + quat.y, it.localRot.z * weight + quat.z, it.localRot.w * weight + quat.w);\n                }\n                quat.normalize();\n```\n\nthe interpolation for rotation and weight handling seems wrong.\n","comments":[],"labels":["type:bug"]},{"title":"Random Crash At Launch - cocos2d::RenderState::StateBlock::setBlend(bool) ","body":"Hello\n\nWe are getting this very rare crash at launch across many android devices and all android versions. This error has been occurring in all cocos2d-x versions v3.x including the latest one.  We tried everything to solve the crash but failed. We can cause the crash by rapidly closing and launching the app, crash occurs randomly.\n## \n\nsignal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 00000010\n#00  pc 00ae0c2c  ***\/lib\/libcocos2dcpp.so (cocos2d::RenderState::StateBlock::setBlend(bool))\n#01  pc 00aee5dc  ***\/lib\/libcocos2dcpp.so\n#02  pc 00a9e6d0  ***\/lib\/libcocos2dcpp.so (cocos2d::Director::setGLDefaultValues()+24)\n#03  pc 00a9f824  **_\/lib\/libcocos2dcpp.so (cocos2d::Director::setOpenGLView(cocos2d::GLView_)+112)\n#04  pc 009ef22b  ***\/lib\/libcocos2dcpp.so (Java_org_cocos2dx_lib_Cocos2dxRenderer_nativeInit+230)\n## \n#00 -> \/renderer\/CCRenderState.cpp:732 -> _blendEnabled = enabled;\n#01 -> \/renderer\/ccGLStateCache.cpp:120 -> RenderState::StateBlock::_defaultState->setBlend(true);\n#02 -> \/base\/CCDirector.cpp:682\n#04 -> \/base\/CCDirector.cpp:404\n## \n\nVersion:  cocos2d-x-3.12\n\nThe crash is caused by RenderState::StateBlock::_defaultState being nullptr. Other crashes happen if a control for nullptr is added for the crash line. \n\nDo you have any ideas about this problem?\n\nThanks\n","comments":["@ermanhaskan could you please also paste the java log info? And what's the API level you build with?\n","---\n\nBuild fingerprint: 'samsung\/j1nlteub\/j1nlte:4.4.4\/KTU84P\/J100MUUBU0APD1:user\/release-keys'\nRevision: '0'\npid: 8596, tid: 8615, name: Thread-568  >>> XXX <<<\nsignal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 00000010\n\n..\n\nbacktrace:\n    #00  pc 00ae0c2c  \/mnt\/asec\/XXX-1\/lib\/libcocos2dcpp.so (cocos2d::RenderState::StateBlock::setBlend(bool))\n    #01  pc 00aee5dc  \/mnt\/asec\/XXX-1\/lib\/libcocos2dcpp.so\n    #02  pc 00a9e6d0  \/mnt\/asec\/XXX-1\/lib\/libcocos2dcpp.so (cocos2d::Director::setGLDefaultValues()+24)\n    #03  pc 00a9f824  \/mnt\/asec\/XXX-1\/lib\/libcocos2dcpp.so (cocos2d::Director::setOpenGLView(cocos2d::GLView_)+112)\n    #04  pc 009ef22b  \/mnt\/asec\/XXX-1\/lib\/libcocos2dcpp.so (Java_org_cocos2dx_lib_Cocos2dxRenderer_nativeInit+230)\n    #05  pc 0001e50c  \/system\/lib\/libdvm.so (dvmPlatformInvoke+112)\n    #06  pc 00041f27  \/system\/lib\/libdvm.so (dvmCallJNIMethod(unsigned int const_, JValue_, Method const_, Thread_)+398)\n    #07  pc 00043919  \/system\/lib\/libdvm.so (dvmResolveNativeMethod(unsigned int const_, JValue_, Method const_, Thread_)+184)\n    #08  pc 0006e920  \/system\/lib\/libdvm.so\n    #09  pc 0002497c  \/system\/lib\/libdvm.so (dvmMterpStd(Thread_)+76)\n    #10  pc 00022028  \/system\/lib\/libdvm.so (dvmInterpret(Thread_, Method const_, JValue_)+184)\n    #11  pc 00051f3b  \/system\/lib\/libdvm.so (dvmCallMethodV(Thread_, Method const_, Object_, bool, JValue_, std::__va_list)+338)\n    #12  pc 00051f5f  \/system\/lib\/libdvm.so (dvmCallMethod(Thread_, Method const_, Object_, JValue*, ...)+20)\n    #13  pc 0007f4cb  \/system\/lib\/libdvm.so\n    #14  pc 0000d220  \/system\/lib\/libc.so (__thread_entry+72)\n    #15  pc 0000d3bc  \/system\/lib\/libc.so (pthread_create+240)\n","compileSdkVersion 24\nbuildToolsVersion '24.0.0'\nminSdkVersion 11\ntargetSdkVersion 24\n","@ermanhaskan will you please change `AndroidMenifest.xml` to\n\n```\nandroid:configChanges=\"orientation\", \"screenSize\">\n```\n\nto have a try? More information about `android:configChanges` can be found [here](https:\/\/developer.android.com\/guide\/topics\/manifest\/activity-element.html).\n","@ermanhaskan ,\ntry this:\n\n```\nandroid:configChanges=\"orientation|screenSize\"\n```\n","yep, @dumganhar 's version is right\n","I was using \n\nandroid:configChanges=\"orientation|screenLayout|smallestScreenSize|screenSize|keyboardHidden\"\n\nSomehow I can't cause the crash even using old configChanges in my devices right now. I will use your version of configChanges in the last update and post the result here. Thanks.\n","Unfortunately we are still experiencing the crash using: android:configChanges=\"orientation|screenSize\"\n","Just received this error on cocos2dx 3.13\n\nbacktrace:\n #00  pc 00a41ca8  \/data\/app-lib\/com.test.test-63\/libcocos2dcpp.so (cocos2d::RenderState::StateBlock::setBlend(bool))\n #01  pc 00a4df14  \/data\/app-lib\/com.test.test-63\/libcocos2dcpp.so\n #02  pc 00a0929c  \/data\/app-lib\/com.test.test-63\/libcocos2dcpp.so (cocos2d::Director::setGLDefaultValues()+12)\n #03  pc 00a0932c  \/data\/app-lib\/com.test.test-63\/libcocos2dcpp.so (cocos2d::Director::setOpenGLView(cocos2d::GLView_)+112)\n #04  pc 009647b1  \/data\/app-lib\/com.test.test-63\/libcocos2dcpp.so (Java_org_cocos2dx_lib_Cocos2dxRenderer_nativeInit+96)\n #05  pc 0001e80c  \/system\/lib\/libdvm.so (dvmPlatformInvoke+112)\n #06  pc 0004f24b  \/system\/lib\/libdvm.so (dvmCallJNIMethod(unsigned int const_, JValue_, Method const_, Thread_)+398)\n #07  pc 00050ed9  \/system\/lib\/libdvm.so (dvmResolveNativeMethod(unsigned int const_, JValue_, Method const_, Thread_)+256)\n #08  pc 00027c20  \/system\/lib\/libdvm.so\n #09  pc 0002ec5c  \/system\/lib\/libdvm.so (dvmMterpStd(Thread_)+76)\n #10  pc 0002c2c0  \/system\/lib\/libdvm.so (dvmInterpret(Thread_, Method const_, JValue_)+184)\n #11  pc 00061759  \/system\/lib\/libdvm.so (dvmCallMethodV(Thread_, Method const_, Object_, bool, JValue_, std::__va_list)+336)\n #12  pc 0006177d  \/system\/lib\/libdvm.so (dvmCallMethod(Thread_, Method const_, Object_, JValue*, ...)+20)\n #13  pc 0005646b  \/system\/lib\/libdvm.so\n #14  pc 0000d280  \/system\/lib\/libc.so (__thread_entry+72)\n #15  pc 0000d418  \/system\/lib\/libc.so (pthread_create+240)\n","We're also seeing the exact same crash in CC2DX 3.11, 3.13 and 3.13.1\n","@dhuang11 do you have a test case to reproduce it easily? And what's your environments:\n- devices to test on\n- NDK version\n- what API version did you build with\n\nmore detail information is better.\n","We are seeing this crash on a number of Android devices. There doesn't appear to be a clear pattern.\n\nWe build using NDKr10e and with API version 23.\n\nIn house, we are able to reproduce this fairly easily on an Amazon Kindle Fire HDX. If we launch the app and close it a few times.\n","@dhuang11 did it also crash at `cocos2d::RenderState::StateBlock::setBlend()`?\n","Yes exact same stack trace - cocos2d::RenderState::StateBlock::setBlend() crash with the same call stack prior to that crash\n","Our game is linked to Crashlytics - here is a shared link to this crash:\nhttp:\/\/crashes.to\/s\/5d886e5ff64\n\nIt is our #1 crash according to Crashlytics and it is happening a larger proportion on Amazon kindle devices\n","Will you please use stand NDK toolchain to have a try?\n","I\/DEBUG   (  259):  \nI\/DEBUG   (  259): Build fingerprint: 'Amazon\/thor\/thor:4.4.3\/KTU84M\/13.4.5.5_user_455004220:user\/release-keys'\nI\/DEBUG   (  259): Revision: '0'\nI\/DEBUG   (  259): pid: 24581, tid: 24650, name: Thread-407  >>> com.boqugames.poker <<<\nI\/DEBUG   (  259): signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 00000024\nI\/DEBUG   (  259):     r0 00000000  r1 00000001  r2 00000001  r3 00110e31\nI\/DEBUG   (  259):     r4 64186600  r5 00000303  r6 00000001  r7 62b47f30\nI\/DEBUG   (  259):     r8 64588ad8  r9 62b47f28  sl 6261ca78  fp 64588aec\nI\/DEBUG   (  259):     ip 00000080  sp 64588a58  lr 63e0cfd3  pc 63e06a5c  cpsr 200d0030\nI\/DEBUG   (  259):     d0  0000000000000000  d1  0000000000000000\nI\/DEBUG   (  259):     d2  645f64656b636170  d3  6574735f68747065\nI\/DEBUG   (  259):     d4  4037000000000000  d5  4026000000000000\nI\/DEBUG   (  259):     d6  4037000000000000  d7  0000001700000000\nI\/DEBUG   (  259):     d8  00000780000004b0  d9  0000000000000000\nI\/DEBUG   (  259):     d10 0000000000000000  d11 0000000000000000\nI\/DEBUG   (  259):     d12 0000000000000000  d13 0000000000000000\nI\/DEBUG   (  259):     d14 0000000000000000  d15 0000000000000000\nI\/DEBUG   (  259):     d16 705f53454f5f4c47  d17 65645f64656b6361\nI\/DEBUG   (  259):     d18 5f726f6c6f635f54  d19 665f726566667562\nI\/DEBUG   (  259):     d20 5f4c472074616f6c  d21 6f6c6f635f545845\nI\/DEBUG   (  259):     d22 7265666675625f72  d23 6c665f666c61685f\nI\/DEBUG   (  259):     d24 ff0082f014000000  d25 ff007bf013960000\nI\/DEBUG   (  259):     d26 ff00821f154a0000  d27 ff007ce413000000\nI\/DEBUG   (  259):     d28 ff0080a015e00000  d29 ff007fc013000000\nI\/DEBUG   (  259):     d30 0000000000000000  d31 0000000000000000\nI\/DEBUG   (  259):     scr 60000012\nI\/DEBUG   (  259): \nI\/DEBUG   (  259): backtrace:\nI\/DEBUG   (  259):     #00  pc 005b0a5c  \/data\/app-lib\/com.boqugames.poker-1\/libpoker.so (cocos2d::RenderState::StateBlock::invalidate(long)+19)\nI\/DEBUG   (  259):     #01  pc 005b6fcf  \/data\/app-lib\/com.boqugames.poker-1\/libpoker.so\nI\/DEBUG   (  259):     #02  pc 00598873  \/data\/app-lib\/com.boqugames.poker-1\/libpoker.so (cocos2d::Director::setGLDefaultValues()+6)\nI\/DEBUG   (  259):     #03  pc 005988d9  \/data\/app-lib\/com.boqugames.poker-1\/libpoker.so (cocos2d::Director::setOpenGLView(cocos2d::GLView_)+76)\nI\/DEBUG   (  259):     #04  pc 0049a83b  \/data\/app-lib\/com.boqugames.poker-1\/libpoker.so (Java_org_cocos2dx_lib_Cocos2dxRenderer_nativeInit+86)\nI\/DEBUG   (  259):     #05  pc 0002068c  \/system\/lib\/libdvm.so (dvmPlatformInvoke+112)\nI\/DEBUG   (  259):     #06  pc 000524d1  \/system\/lib\/libdvm.so (dvmCallJNIMethod(unsigned int const, JValue, Method const_, Thread_)+412)\nI\/DEBUG   (  259):     #07  pc 00054263  \/system\/lib\/libdvm.so (dvmResolveNativeMethod(unsigned int const, JValue, Method const_, Thread_)+226)\nI\/DEBUG   (  259):     #08  pc 00029b20  \/system\/lib\/libdvm.so\nI\/DEBUG   (  259):     #09  pc 00030fb8  \/system\/lib\/libdvm.so (dvmMterpStd(Thread_)+76)\nI\/DEBUG   (  259):     #10  pc 0002e5fc  \/system\/lib\/libdvm.so (dvmInterpret(Thread, Method const, JValue_)+184)\nI\/DEBUG   (  259):     #11  pc 00065999  \/system\/lib\/libdvm.so (dvmCallMethodV(Thread, Method const, Object, bool, JValue, std::__va_list)+336)\nI\/DEBUG   (  259):     #12  pc 000659bd  \/system\/lib\/libdvm.so (dvmCallMethod(Thread, Method const, Object, JValue, ...)+20)\nI\/DEBUG   (  259):     #13  pc 00059c8f  \/system\/lib\/libdvm.so\nI\/DEBUG   (  259):     #14  pc 0000d260  \/system\/lib\/libc.so (__thread_entry+72)\nI\/DEBUG   (  259):     #15  pc 0000d3f8  \/system\/lib\/libc.so (pthread_create+240)\nI\/DEBUG   (  259): \nI\/DEBUG   (  259): stack:\nI\/DEBUG   (  259):          64588a18  00000001  \nI\/DEBUG   (  259):          64588a1c  00000001  \nI\/DEBUG   (  259):          64588a20  62b47f30  \nI\/DEBUG   (  259):          64588a24  64588ad8  [stack:24650]\nI\/DEBUG   (  259):          64588a28  62b47f28  \nI\/DEBUG   (  259):          64588a2c  6261ca78  \nI\/DEBUG   (  259):          64588a30  64588aec  [stack:24650]\nI\/DEBUG   (  259):          64588a34  5fdb93d7  \/system\/vendor\/lib\/egl\/libGLESv2_adreno.so (core_glBlendFunc+10)\nI\/DEBUG   (  259):          64588a38  00000007  \nI\/DEBUG   (  259):          64588a3c  00000001  \nI\/DEBUG   (  259):          64588a40  00000303  \nI\/DEBUG   (  259):          64588a44  5fd98b83  \/system\/vendor\/lib\/egl\/libGLESv2_adreno.so (glBlendFunc+22)\nI\/DEBUG   (  259):          64588a48  00110e31  \nI\/DEBUG   (  259):          64588a4c  64186600  \nI\/DEBUG   (  259):          64588a50  df0027ad  \nI\/DEBUG   (  259):          64588a54  00000000  \nI\/DEBUG   (  259):     #00  64588a58  65a28cd0  \nI\/DEBUG   (  259):          ........  ........\nI\/DEBUG   (  259):     #01  64588a58  65a28cd0  \nI\/DEBUG   (  259):          64588a5c  65bdef70  \nI\/DEBUG   (  259):          64588a60  65bdef70  \nI\/DEBUG   (  259):          64588a64  63dee877  \/data\/app-lib\/com.boqugames.poker-1\/libpoker.so (cocos2d::Director::setGLDefaultValues()+10)\nI\/DEBUG   (  259):     #02  64588a68  65a28cd0  \nI\/DEBUG   (  259):          64588a6c  63dee8dd  \/data\/app-lib\/com.boqugames.poker-1\/libpoker.so (cocos2d::Director::setOpenGLView(cocos2d::GLView_)+80)\n","@dhuang11  @ermanhaskan hi there, did you solve this bug?? it look like i'm encoutering the same bug as you two","@nbtthief  I found no solutions to this problem :\/","also happen in 3.9","#00 pc 00738c68 libcocos2dlua.so setBlend (F:\\GameStudio\\Client\\frameworks\\runtime-src\\proj.android..\/..\/cocos2d-x\/cocos\/\/.\/renderer\/CCRenderState.cpp:731-732) [armeabi-v5te]\r\n2 #1 pc 007408f1 libcocos2dlua.so SetBlending (F:\\GameStudio\\Client\\frameworks\\runtime-src\\proj.android..\/..\/cocos2d-x\/cocos\/\/.\/renderer\/ccGLStateCache.cpp:120) [armeabi-v5te]\r\n3 #2 pc 007409ab libcocos2dlua.so blendFunc (F:\\GameStudio\\Client\\frameworks\\runtime-src\\proj.android..\/..\/cocos2d-x\/cocos\/\/.\/renderer\/ccGLStateCache.cpp:133) [armeabi-v5te]\r\n4 #3 pc 0071e0a7 libcocos2dlua.so setAlphaBlending (F:\\GameStudio\\Client\\frameworks\\runtime-src\\proj.android..\/..\/cocos2d-x\/cocos\/\/.\/base\/CCDirector.cpp:703) [armeabi-v5te]\r\n5 #4 pc 0071ed07 libcocos2dlua.so setGLDefaultValues (F:\\GameStudio\\Client\\frameworks\\runtime-src\\proj.android..\/..\/cocos2d-x\/cocos\/\/.\/base\/CCDirector.cpp:256) [armeabi-v5te]\r\n6 #5 pc 0071ed6f libcocos2dlua.so setOpenGLView (F:\\GameStudio\\Client\\frameworks\\runtime-src\\proj.android..\/..\/cocos2d-x\/cocos\/\/.\/base\/CCDirector.cpp:396) [armeabi-v5te]\r\n7 #6 pc 004e8469 libcocos2dlua.so Java_org_cocos2dx_lib_Cocos2dxRenderer_nativeInit (F:\\GameStudio\\Client\\frameworks\\runtime-src\\proj.android..\/..\/cocos2d-x\/cocos\/\/platform\/android\/javaactivity-android.cpp:70) [armeabi-v5te]\r\n8 #7 pc 000204cc \/system\/lib\/libdvm.so (dvmPlatformInvoke+112) [armeabi-v7a]\r\n9 #8 pc 00051157 \/system\/lib\/libdvm.so (dvmCallJNIMethod(unsigned int const*, JValue*, Method const*, Thread*)+398) [armeabi-v7a]\r\n10 #9 pc 00052b41 \/system\/lib\/libdvm.so (dvmResolveNativeMethod(unsigned int const*, JValue*, Method const*, Thread*)+184) [armeabi-v7a]\r\n11 #10 pc 00029960 \/system\/lib\/libdvm.so [armeabi-v7a]\r\n12 #11 pc 00030dec \/system\/lib\/libdvm.so (dvmMterpStd(Thread*)+76) [armeabi-v7a]\r\n13 #12 pc 0002e484 \/system\/lib\/libdvm.so (dvmInterpret(Thread*, Method const*, JValue*)+184) [armeabi-v7a]\r\n14 #13 pc 000635b9 \/system\/lib\/libdvm.so (dvmCallMethodV(Thread*, Method const*, Object*, bool, JValue*, std::__va_list)+336) [armeabi-v7a]\r\n15 #14 pc 000635dd \/system\/lib\/libdvm.so (dvmCallMethod(Thread*, Method const*, Object*, JValue*, ...)+20) [armeabi-v7a]\r\n16 #15 pc 000582bb \/system\/lib\/libdvm.so [armeabi-v7a]\r\n17 #16 pc 0000d2d0 \/system\/lib\/libc.so (__thread_entry+72) [armeabi-v7a]\r\n18 #17 pc 0000d468 \/system\/lib\/libc.so (pthread_create+240) [armeabi-v7a]\r\n19 java:\r\n20 org.cocos2dx.lib.Cocos2dxRenderer.nativeInit(Native Method)\r\n21 org.cocos2dx.lib.Cocos2dxRenderer.onSurfaceCreated(Cocos2dxRenderer.java:72)\r\n22 android.opengl.GLSurfaceView$GLThread.guardedRun(GLSurfaceView.java:1501)\r\n23 android.opengl.GLSurfaceView$GLThread.run(GLSurfaceView.java:1240)","Has anyone had any more progress on this or has anyone found a cause?\r\nThis issue is affecting an in-production app quite badly (1000 crashes+ per day) but no developer can reproduce it. The stack trace is the same as reported above\r\n\r\n<img width=\"628\" alt=\"screen shot 2017-03-12 at 01 21 34\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/1477129\/23828200\/48bac81e-06c2-11e7-939c-010216608343.png\">\r\n\r\nThere seems to be no pattern to devices affected either except that they typically are in a low free-Ram state\r\n\r\n<img width=\"681\" alt=\"screen shot 2017-03-12 at 01 22 49\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/1477129\/23828206\/7da1c258-06c2-11e7-9979-aa5b7b4ee1f8.png\">\r\n\r\nI'll keep trying to hunt down a reproducible device but on a Google Pixel aggressively restarting\/foregrounding the app does not cause any similar issues.\r\n","Still looking for any further information on this or if anyone found a cause...\r\nStill #1 crash bug for an app in production together with variants of this and setBlend()","I am also facing this issue in my game. ","Any fix for this? Getting this on 3.16","@ermanhaskan @Guy-kun @hgwzyyx were you able to fix this problem?\r\n\r\nThanks"],"labels":["platform:android","module:renderer"]},{"title":"Update SpiderMonkey to Firefox v48","body":"Since Cocos Runtime was dead, how about updating JS VM(SpiderMonkey) to the latest version in Firefox v48.?\nCurrently, we're using a very very old version, firefox v32. It's a version about two years ago.\n","comments":["@pandamicro what's your opinion?\n","My team recently investigated this issue while looking at https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/16327. We came across the following bugzilla report, https:\/\/bugzilla.mozilla.org\/show_bug.cgi?id=1257185, which states that building without JIT has been broken since Spidermonkey v38. Seeing as this bug as been open since 2016-03-16 without Mozilla commenting on it, I assume it is not a priority for Mozilla. \n\nOne of my team members attempted to get Spidermonkey building without JIT, and found it a difficult task to approach. It seems doable, however our team wasn't looking to spend the time to do it at this moment. \n","@DavidDeSimone why you need to build without JIT? As i know, JIT can be disabled in codes. Am i wrong?\n","I would defer to @pandamicro here. When we researched disabling JIT, the only documentation and suggestions we could find on the internet (and in Mozilla's documentation) involved setting various JIT-disabling flags during the build process. These flags are currently set in the build process of the version of Spidermonkey used in cocos for iOS. \n\nHowever you mentioning disabling JIT at run time would explain the following two lines in ScriptingCore.cpp, which my team did not understand when we came across them.\n\n```\nJS::RuntimeOptionsRef(_rt).setIon(true);\nJS::RuntimeOptionsRef(_rt).setBaseline(true);\n```\n\nThese functions appear to enable\/disable JIT (both IonMonkey and the Baseline JIT) at run time (however they are being set to true for both JIT and non-JIT platforms). I cannot find any documentation anywhere on these functions, besides references in scattered bug reports in Mozilla's bug tracker. I would appreciate any insight that pandamicro or another contributor has into this. \n\nMy team is definitely interested in an upgraded spidermonkey, so we would appreciate any technical insight into this problem. \n","Disabling JIT is indeed only for iOS, because Apple has forbidden it. As we disabled it for iOS build, Runtime setting with `JS::RuntimeOptionsRef` won't have any effect on iOS, it won't trigger problem for compilation neither.\n\n@dumganhar I totally agree with updating Spidermonkey to latest version, big benefit. But we still have a very important task to do before it:\n\nWe need a generic abstract layer of JSB API, now we are using SpiderMonkey API directly, but it's too unstable, APIs change more or less during each version update, this has affected :\n1. Our own bindings code and bindings generator\n2. User project which have their own bindings\n3. AnySDK and SDKBOX bindings\n4. Creator bindings\n\nCurrently, AnySDK has to maintain at least 6 versions of bindings code, because they need to support all versions of Cocos2d-x, this is a nightmare for their team.\n\nFor the above reason, we can not give user or our partner team more versions of bindings code, to avoid future changes in bindings API, we need to define our own script bindings API in the abstract layer.\n\nA generic abstract layer is for making our Bindings code absolutely independent from Spidermonkey APIs. The perfect result is that it defines a generic script binding APIs, for no matter which version of Spidermonkey, no matter which script engine we are using (Spidermonkey, V8, even for Lua).\n\nRicardo and I have already done some work in JS new memory model research and have been merged in v3.11, but it's not complete as this wasn't the first target of our task.\n\nSo only after the abstract layer is done, we can upgrade Spidermonkey to the latest version.\n\n@dumganhar @DavidDeSimone @minggo \n","@pandamicro sounds reasonable to me. But i think we need to a plan of it or we can not upgrade SpiderMonkey forever.\n","Yes, the most important thing now is to define an API set that is similar to the current one and can delegate all functionalities. \n\nI think we should first assign someone to design the API set, then have a discussion on it.\n\nFor reference, I know we have an user tried to do the same, they are using C++ macro to define unified types and functions for JS & Lua engine, @linshun should have some of their implementation details.\n","Also, we talked about [jxcore](https:\/\/github.com\/jxcore\/jxcore) long before, they have unified V8, Spidermonkey and Chakra for all important platforms, but the maintenance seems suspended from April.\n","> We need a generic abstract layer of JSB API, now we are using SpiderMonkey API directly, but\n> it's too unstable, APIs change more or less during each version update, this has affected :\n\nyes yes yes.\nIn fact, once we have that API, we could use another engine if needed.\nAs far as I know, Apple opened the JavaScriptCore API, and it is framework now. Is that correct? If so, we could use it and there is no need to ship our own VM for iOS.\n","> In fact, once we have that API, we could use another engine if needed.\n> As far as I know, Apple opened the JavaScriptCore API, and it is framework now. Is that correct? If so, we could use it and there is no need to ship our own VM for iOS.\n\nExactly, seems v8 is also smaller than spidermonkey on Android, so it's also beneficial for iOS\/Android package size\n\nBesides, as Apple opens JavaScriptCore API, I suppose they are gonna keep its backward compatibility, so maybe it's good to take JavaScriptCore API as our example.\n","Hi All,\r\n\r\nI see spidermonkey was updated to v52 in here -> https:\/\/github.com\/cocos-creator\/cocos2d-x-lite\/pull\/675. Curious to understand why can't those changes be applied to cocos2d itself?\r\n\r\nThanks","Tagging @pandamicro and @minggo to understand your thoughts. Thank you."],"labels":["script:jsb"]},{"title":"MessageBox problem on Android.","body":"There are MessageBox issues on Android.\n\nPlease see this thread: http:\/\/discuss.cocos2d-x.org\/t\/messagebox-problem-in-android\/31496\n","comments":[],"labels":["platform:android"]},{"title":"Missing closure-compiler jar file","body":"- cocos2d-x version: cocos2d-x-3.13\n- developing environment: linux\n\nSteps to Reproduce:\n1. Install cocos2d-x (clone, clone submodules, `.\/setup.py`, `exec bash`)\n2. Create new JS project: `cocos new -l js test`\n   3: `cd test`\n3. Try to compile it: `cocos compile -p web -m release`\n\nResult:\n\n```\nBuildfile: \/tmp\/test\/publish\/html5\/build.xml\n\nBUILD FAILED\n\/tmp\/test\/publish\/html5\/build.xml:5: taskdef class com.google.javascript.jscomp.ant.CompileTask cannot be found\n using the classloader AntClassLoader[]\n\nTotal time: 0 seconds\nError running command, return code: 1.\n```\n\nLooking at `build.xml` I can find this line:\n\n```\n    <taskdef name=\"jscomp\" classname=\"com.google.javascript.jscomp.ant.CompileTask\"\n             classpath=\"\/home\/ntrrgc\/Programas\/cocos2d-x\/tools\/cocos2d-console\/plugins\/plugin_compile\/build_web\/bin\/compiler-1.7.jar\"\/>\n```\n\nIt fails because `tools\/cocos2d-console\/plugins\/plugin_compile\/build_web\/bin\/compiler-1.7.jar` does not exist in the cocos2d-x directory (the `build_web\/bin` directory does not exist at all). \n\nI guess that file is the closure compiler, which should be automatically downloaded at some point. Am I missing something?\n","comments":["@natural-law could you please take a look? Thanks.\n","@ntrrgc I just checked the logic. The files in `build_web\/bin` should be downloaded before invoking `ant -f \/tmp\/test\/publish\/html5\/build.xml` if the files are missed. I've no idea why it's not downloaded correctly.\n\nYou can try to download the files manually by invoking `download-bin.py` in the path `cocos2d-x\/tools\/cocos2d-console`.\n"],"labels":["platform:web","platform:linux"]},{"title":"vs2013 compile cocos2d-x2.x error C2659: \u201c=\u201d: ","body":"- cocos2d-x version:cocos2d-x2.2.2\n- devices test on:windows8.1 win32\n- developing environments\n  - NDK version:64bit-r9d\n  - Xcode version:\n  - VS version: vs2013-64bit\n  - brower type and version:\n\nSteps to Reproduce:\n1. 1>e:\\cocos2dx\\cocos2d-x-2.2.2\\cocos2dx\\platform\\win32\\cceglview.cpp(111): error C2659: \u201c=\u201d: \u4f5c\u4e3a\u5de6\u64cd\u4f5c\u6570\n   1>e:\\cocos2dx\\cocos2d-x-2.2.2\\cocos2dx\\platform\\win32\\cceglview.cpp(112): error C2659: \u201c=\u201d: \u4f5c\u4e3a\u5de6\u64cd\u4f5c\u6570\n2. \n","comments":[],"labels":["platform:win32"]},{"title":"Node run action crash randomly with RepeatForever of a Sequence ","body":"- cocos2d-x version: 3.9\n- devices test on: Nexus 5\n- developing environments\n  - NDK version: Android ndk > 11\n\nI have integrated Cocos in an Android app. I use a NDK Helper which create a sequence from a function like in sample [http:\/\/cocos2d-x.org\/docs\/programmers-guide\/actions\/](url)\n\n``` java\n\/\/ target created before and sel a function\nCallFunc *caller = CallFunc::create(sel);\nauto action = Sequence::create(caller, nullptr);\ntarget->runAction(action);\n```\n\nWhen I send to many time this part above (1 called every 16 ms), my app crash with this dump \n\n```\n********** Crash dump: **********\nBuild fingerprint: 'google\/hammerhead\/hammerhead:6.0.1\/MOB30Y\/3067468:user\/release-keys'\npid: 10858, tid: 10965, name: Timer-0  >>> com.example.cocos:cocosProcess <<<\nsignal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 0x3\nStack frame #00 pc 0056239c  \/data\/app\/com.example.cocos-1\/lib\/arm\/liblCocos2dcpp.so (_ZN7cocos2d9Scheduler28unscheduleAllWithMinPriorityEi+404): Routine cocos2d::Scheduler::unscheduleAllWithMinPriority(int) at \/home\/kevin\/Projects\/Sample\/com\/example\/cocos\/..\/cocos2d\/cocos\/.\/base\/CCScheduler.cpp:622 (discriminator 3)\nStack frame #01 pc 005621fc  \/data\/app\/com.example.cocos-1\/lib\/arm\/libCocos2dcpp.so (_ZN7cocos2d9Scheduler13unscheduleAllEv+24): Routine cocos2d::Scheduler::unscheduleAll() at \/home\/kevin\/Projects\/Sample\/com\/example\/cocos\/..\/cocos2d\/cocos\/.\/base\/CCScheduler.cpp:584\nStack frame #02 pc 0055ae40  \/data\/app\/com.example.cocos-1\/lib\/arm\/libCocos2dcpp.so (_ZN7cocos2d9SchedulerD2Ev+48): Routine cocos2d::Scheduler::~Scheduler() at \/home\/kevin\/Projects\/Sample\/com\/example\/cocos\/..\/cocos2d\/cocos\/.\/base\/CCScheduler.cpp:266\nStack frame #03 pc 0067ca78  \/data\/app\/com.example.cocos-1\/lib\/arm\/libCocos2dcpp.so (_ZN7cocos2d13ActionManager9addActionEPNS_6ActionEPNS_4NodeEb+6572): Routine cocos2d::ActionManager::addAction(cocos2d::Action*, cocos2d::Node*, bool) at \/home\/kevin\/Projects\/Sample\/com\/example\/cocos\/..\/cocos2d\/cocos\/.\/2d\/CCActionManager.cpp:195\nStack frame #04 pc 004687fc  \/data\/app\/com.example.cocos-1\/lib\/arm\/libCocos2dcpp.so (_ZN7cocos2d4Node9runActionEPNS_6ActionE+224): Routine cocos2d::Node::runAction(cocos2d::Action*) at \/home\/kevin\/Projects\/Sample\/com\/example\/cocos\/..\/cocos2d\/cocos\/.\/2d\/CCNode.cpp:1399\nStack frame #05 pc 003c0e58  \/data\/app\/com.example.cocos-1\/lib\/arm\/libCocos2dcpp.so (_ZN9NDKHelper13handleMessageEP6json_tS1_+404): Routine NDKHelper::handleMessage(json_t*, json_t*) at \/home\/kevin\/Projects\/Sample\/com\/example\/cocos\/jni\/..\/..\/NDKHelper\/NDKHelper.cpp:164\nStack frame #06 pc 003c10bc  \/data\/app\/com.example.cocos-1\/lib\/arm\/libCocos2dcpp.so (Java_org_cocos2dx_cpp_easyndk_AndroidNDKHelper_CPPNativeCallHandler+372): Routine Java_org_cocos2dx_cpp_easyndk_AndroidNDKHelper_CPPNativeCallHandler at \/home\/kevin\/Projects\/Sample\/com\/example\/cocos\/jni\/..\/..\/NDKHelper\/NDKHelper.cpp:228\nStack frame #07 pc 00d82fd1  \/data\/app\/com.example.cocos-1\/oat\/arm\/base.odex (offset 0x8ae000) (void org.cocos2dx.cpp.easyndk.AndroidNDKHelper.CPPNativeCallHandler(java.lang.String)+92)\nStack frame #08 pc 00d8363b  \/data\/app\/com.example.cocos-1\/oat\/arm\/base.odex (offset 0x8ae000) (void org.cocos2dx.cpp.easyndk.AndroidNDKHelper.SendMessageWithParameters(java.lang.String, org.json.JSONObject)+326)\nStack frame #09 pc 012b4293  \/data\/app\/com.example.cocos-1\/oat\/arm\/base.odex (offset 0x8ae000) (void com.example.cocos.CocosPresenter.sendData()+926)\nStack frame #10 pc 012b3ec9  \/data\/app\/com.example.cocos-1\/oat\/arm\/base.odex (offset 0x8ae000) (void com.example.cocos.CocosPresenter.access$000(com.example.cocos.CocosPresenter)+76)\nStack frame #11 pc 00c81517  \/data\/app\/com.example.cocos-1\/oat\/arm\/base.odex (offset 0x8ae000) (void com.example.cocos.CocosPresenter$1.run()+114)\nStack frame #12 pc 72fea1d7  \/data\/dalvik-cache\/arm\/system@framework@boot.oat (offset 0x1ec9000)\n\n```\n\nI try with different frequency like 1 every seconds and I have the same problem.\n\nI guess the error provide from the autorelease from a node.\nAny help for this problem ?\n\nThanks\n","comments":["Could you please provide a test case for it?\n","@minggo I have the same issue on iOS, but with more details.\n\nIn CCActionInterval.cpp\n\n``` cpp\nvoid RepeatForever::startWithTarget(Node* target)\n{\n    ActionInterval::startWithTarget(target);\n    _innerAction->startWithTarget(target); \/\/ stop here with EXC_BAD_ACCESS (code=1, address=0x3a)\n}\n```\n\n<img width=\"462\" alt=\"screen shot 2016-09-05 at 10 47 27\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/1276307\/18242367\/4093f016-7356-11e6-9913-6151b1a5795d.png\">\nObject is not null (_innerAction, target, etc...)\n\nThe code is : \n\n``` cpp\n_moveUp = MoveTo::create(timeUp, Vec2(_width \/ 2,  top));\n_moveDown = MoveTo::create(timeDown, Vec2(_width \/ 2,  _bottomBorder + MARGIN_LINES));\nauto callBackUp = CallFunc::create([&]() {\n        _actionLabel->setString(\"up\");\n});\nauto callBackDown = CallFunc::create([&]() {\n    _actionLabel->setString(\"down\");\n});\nseq = Sequence::create(callBackDown, _moveDown, callBackUp, _moveUp, NULL);\n_sprite->runAction(RepeatForever::create(seq));\n```\n","@minggo up ?\n","@kmenager sorry, i am busy these days. @slackmoehrle could you please help to reproduce it? Thanks.\n","@minggo @slackmoehrle \nI try to debug this code, but I have a random crash which is really hard to debug. The main  sigsegv error is SEGV_MAPERR. Generally, it happen because the scheduler destructor is called (I guess the garbage collector is the main reason)\n\n```\nsignal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 0x3\nRoutine cocos2d::Scheduler::unscheduleAllWithMinPriority(int) at \/cocos2d\/cocos\/.\/base\/CCScheduler.cpp:622 (discriminator 3)\nRoutine cocos2d::Scheduler::unscheduleAll() at \/cocos2d\/cocos\/.\/base\/CCScheduler.cpp:584\nRoutine cocos2d::Scheduler::~Scheduler() at \/cocos2d\/cocos\/.\/base\/CCScheduler.cpp:266\nRoutine cocos2d::ActionManager::addAction(cocos2d::Action*, cocos2d::Node*, bool) at \/cocos2d\/cocos\/.\/2d\/CCActionManager.cpp:195\nRoutine cocos2d::Node::runAction(cocos2d::Action*) at .\/cocos2d\/cocos\/.\/2d\/CCNode.cpp:1420\nRoutine NDKHelper::handleMessage(json_t*, json_t*) at \/NDKHelper\/NDKHelper.cpp:162\n```\n\nI use this lib [NDKHelper](https:\/\/github.com\/alfonsocejudo\/EasyNDK-for-cocos2dx3) with the method\n\n``` cpp\nvoid NDKHelper::handleMessage(json_t *methodName, json_t *methodParams)\n{\n    if (methodName == NULL) {\n        return;\n    }\n\n    const char *methodNameStr = json_string_value(methodName);\n\n    for (unsigned int i = 0; i < NDKHelper::selectorList.size(); ++i) {\n        if (NDKHelper::selectorList[i].getName().compare(methodNameStr) == 0) {\n            Value value = NDKHelper::getValueFromJson(methodParams);\n\n            FuncNV sel = NDKHelper::selectorList[i].getSelector();\n            Node *target = NDKHelper::selectorList[i].getTarget();\n\n            CallFuncNV *caller = CallFuncNV::create(sel);\n            caller->setValue(value);\n            caller->retain();\n            if (target) {\n                target->runAction(caller);\n                caller->release();\n            }\n            break;\n        }\n    }\n}\n```\n\nI try with the last cocos version 3.13 on different Android device and still have the same issue.\n"],"labels":["platform:android"]},{"title":"Replace fmod on Linux with SDL Audio or something similar","body":"Users have stated that we are not truly open-source on Linux because we require `fmod`. This isn't free and they have no other options. During our weekly meeting @ricardoquesada suggested that we could offer SDL Audio as an alternative and let users turn on `fmod` if they choose to. @linshun agreed. The timing of this change is TBD.\n\n@slackmoehrle is happy to test when ready.\n","comments":["yes, other alternatives are:\n- use ALSA driver directly\n- or use [PulseAudio](https:\/\/en.wikipedia.org\/wiki\/PulseAudio)\n","Can refer to #16410. The PR use OpenAL for linux.\n","I don't really know how powerful\/fast\/etc. those alternatives are, but from my point of view, OpenAL has a big advantage: It's a cross-platform library. The implementation for Windows only uses OpenAL, MPEG, and Vorbis, which are available for Windows as well as for Linux. Due to this fact, I could simply copy the source files and it worked. All tests were positive, the C++ test and the Lua test. Another option would be to merge those implementations into one which would make maintaining the engine way easier. I could do that for Linux and Windows if you like this idea.\n","@Janonard you are right. @dumganhar i think you can take a look too. I think it is better that we can use OpenAL as possible, then it is easy to main the codes.\n","> Another option would be to merge those implementations into one which would make maintaining the engine way easier. I could do that for Linux and Windows if you like this idea.\n\nYep, it is better.\n","Agree this.\n\nWe only need OpenSLES for Android & OpenAL for other platforms. Easily maintaining our engine is really important. \n\nBTW, we also need to improve New Audio Engine since I think the logic isn't very clear for developer to understand, we need to do more encapsulation, abstraction and documentation.\n","OpenAL-soft has a OpenSLES driver built-in:\r\n\r\nhttps:\/\/github.com\/kcat\/openal-soft\/blob\/2f1f7f4c6aaf54f9361865d508d82cdf027368bf\/Alc\/backends\/opensl.c","In particular, this blocks a Debian package from being created.\r\n\r\nAnd creates problems that we can't solve properly because no source, e.g.:\r\n\r\n- porting fmod: https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/18001\r\n- binary file build option quirks: https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/15137#issuecomment-338345077","It also may create big problems with licensing target product.","Is there any progress in this direction?","Any progress?","@dumganhar Actual, OpenAL also can be use at android platform, recently, I have done it, and seems ok.","Any document about it?","Just compile openal, mpg123, ogg for android arm, then copy win32 implementation to android, and do some changes for log & file stream adapt.","I think OpenAL uses some system functions provided by Android, and i don't know if it has issue on some devices or some Android versions. It is not provided by Android, and also not Android documentation mention it, so it has big risk.","you can see it's backends has a opensl.c for android.","So, at android platform, OpenAL based on OpenSL. use it, we only needs maintains one audio engine framework.","Sounds good.","@minggo @dumganhar Recently, I finish this, you can see the patch: https:\/\/github.com\/halx99\/x-studio365\/tree\/master\/cocos2d-x-patch","@halx99 It is great.\r\n@drelaptop please take a look. It is good if we can use OpenAL for all platforms.","OK, this week I will try to test and confirm OpenAL works or not on android platform. If works well, I can do replace recently.","@drelaptop By the way,  I have test with ndkr14b + gcc, it work fine. maybe you need test ndkr16 + clang.","@drelaptop I create 2 pr, you can simple to apply it to test it.\r\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/18958\r\nhttps:\/\/github.com\/cocos2d\/cocos2d-x-3rd-party-libs-bin\/pull\/317\r\n\r\nI have test on ndk-r17 + clang, it also work fine.","you are so efficient, I will check it at once.","Please read my comments about Android  OpenAL and mpg123\r\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/18961#issuecomment-407562295\r\nI think that we **should not** add new **LGPL** *.so libraries to Android!\r\n\r\nI am fine with OpenAL and mpg123 for Linux (it is better than fmod :)  )","@slackmoehrle could you help us check the License issue in your free time? ","@halx99 , can I ask if it's any progress with Linux migration?\r\nBTW, @crazyhappygame , as windows part already uses OpenAL isn't it straightforward?","I am fine with OpenAL and mpg123 for Linux (it is better than fmod :) )\r\n\r\n(nothing changed for Android I think that we should not add new LGPL *.so libraries to Android!)\r\n\r\n","I have test on ubuntu 18.04, the OpenAL works fine.","Could you please clarify how to build with OpenAL for Linux target?\n","Actually, LGPL.*.so allow free to use, and the apple os platform intrgrate OpenAL ad system framework, so, I think all platform, OpenAL is a good choice for audio framework backend. ","And, in our project practice, OpenAL works well at android platform, and solve a deadlock bug on some android device when quickly stop\/play music, see: https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/18000","> Could you please clarify how to build with OpenAL for Linux target?\n>\n\n@HALX99 , do you build Cocos2d unpatched or with your patch?\nif the latter then where's the latest patch located?\n","I have build with cocos2d-x-3.17","@halx99 could you create PR for Linux only?","I will create when I have time","that will be better, if we do https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/16307 after this issue solved.","https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/18000, this is another reason why I recommand we also should use openal at android platform."],"labels":["type:request","module:audio"]},{"title":"Encapsule Audio Engine implementation for the platforms using OpenAL","body":"Currently, new AudioEngine uses the following technique:\n- Android: OpenSLES\n- Windows \/ Mac \/ iOS: OpenAL\n- Linux: fmod  --> could be replaced with `OpenAL` too.\n- Tizen: platform depended SDK\n\nExcept Android and Tizen, other platforms could all use OpenAL.\nBut now, we have separated folder for platforms using OpenAL, the bad thing is although they all use OpenAL , the source code are so different. :(\n\nPerhaps, we need to encapsule this and only need `cocos\/audio\/openal` for these platforms that use OpenAL. In this way, it will be better for maintaining and better for adding new features.\n\nSome folder structure may be like this:\n\n```\ncocos\/audio\/openal\/AudioEngine-impl.cpp\ncocos\/audio\/openal\/AudioEngine-impl.h\ncocos\/audio\/openal\/PlatformSpecific.h\ncocos\/audio\/openal\/PlatformSpecific-win32.cpp\ncocos\/audio\/openal\/PlatformSpecific-osx.cpp\ncocos\/audio\/openal\/PlatformSpecific-ios.cpp\ncocos\/audio\/openal\/PlatformSpecific-linux.cpp\ncocos\/audio\/openal\/PlatformSpecific-winrt.cpp\n```\n#### Why Should We Need Specific?\n\nAlthough they all use OpenAL to play sound, they should use platform dependence code to decode compressed file (.mp3\/.ogg\/.caf) into pcm buffer.\n\nAny idea? @ricardoquesada @minggo .\n","comments":["@dumganhar i think you can refer to [EditBox](https:\/\/github.com\/cocos2d\/cocos2d-x\/tree\/v3\/cocos\/ui\/UIEditBox), please use the same rule as others.\n","Good point. :)\n","I think the original design: ```AudioDecoderManager + AudioDecoder```  is good for multi-platforms diff implement to decode mp3,ogg,etc..","@dumganhar By the way, the previously implement of Audio Engine doesn't support .ogg at Apple platforms, If you Refactor the audio engine, you can think to simply import vorbis libs to Apple xcode project."],"labels":["module:audio"]},{"title":"[Cocos2d-js] How to release JSScheduleWrapper? memory keeps grow up.","body":"- cocos2d-x version: cocos2d-x-3.9\n- devices test on: Mac Mini\n- developing environments\n  - NDK version: N\/A\n  - Xcode version: Version 7.2 (7C68)\n  - VS version: N\/A\n  - brower type and version: N\/A\n\nThis is a cocos2d-js issue.\nCreate an empty cocos2d-js project, and copy these code, run and wait:\n\n```\nvar HelloWorld = cc.Layer.extend({\n    ctor:function () {\n        this._super();\n        this.scheduleUpdate();\n    },\n    update: function () {\n        var node = new cc.Node();\n        this.addChild(node);\n        this.scheduleOnce(function () {\n            node.removeFromParent();\n        });\n    }\n});\n```\n\nAnd the memory keeps grow up because of _JSScheduleWrapper_.\n![before](https:\/\/cloud.githubusercontent.com\/assets\/8469299\/17316464\/a292495e-58a6-11e6-9d3d-d2db3b46b734.png)\n\n![after](https:\/\/cloud.githubusercontent.com\/assets\/8469299\/17316448\/79589fac-58a6-11e6-9161-9d79686b1088.png)\n","comments":["Hi, @minggo I can confirm this issue, the main reason is that we hold JSSchedulerWrapper instance with `_schedFunc_target_ht` and `_schedObj_target_ht`,  they prevent it from being released and deallocated, I will fix it in v3.13\n\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/cocos2d-x-3.9\/cocos\/scripting\/js-bindings\/manual\/cocos2d_specifics.hpp#L41\n","@pandamicro thanks. And please attach the PR to this issue when it is fixed.\n","Hi, @iNeverSleeeeep I have been tracking down the issue, now I find the real problem.\n\nSo, your test case shows a extreme use case that haven't been well handled by JSB, as you call scheduleOnce with the layer itself, and the layer is always in the node tree, then all ScheduleWrapper it created won't be deleted, along with the JS target and function wrapped in the ScheduleWrapper, that's the reason why the memory keep going up.\n\nIn the current system, ScheduleWrappers will be deleted from `_schedFunc_target_ht` and `_schedObj_target_ht` when the related node is removed from the node tree (in Node cleanup). See:\n\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/cocos2d-x-3.9\/cocos\/scripting\/js-bindings\/manual\/ScriptingCore.cpp#L1010\n\nLogically, we should check ScheduleWrapper in Scheduler, but that doesn't sound very proper for Cocos2d-x logic, we haven't figure out a elegant approach to fix this yet. However, your test case is not a common usage in real game, remove ScheduleWrappers when node is removed can usually be tolerated.\n\nAny thoughts ?\n\nAlso, @dumganhar for reference\n","\u5bf9\u4e0d\u8d77\u73b0\u5728\u624d\u770b\u5230\u8fd9\u4e2a\u3002\u6211\u60f3\u7528\u4e2d\u6587\u56de\u590d\u56e0\u4e3a\u6211\u7684\u82f1\u6587\u8f83\u5dee\uff0c\u5f88\u96be\u8868\u8fbe\u6211\u7684\u610f\u601d\uff0c\u5e0c\u671b\u4f60\u7406\u89e3\u3002\r\n\u4e0a\u9762\u90a3\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u53ef\u80fd\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u4e0d\u4f1a\u6709\u5f88\u5927\u5f71\u54cd\uff0c\u6211\u662f\u89c9\u5f97\u6211\u4eec\u9879\u76ee\u6709\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\u65f6\u6d4b\u51fa\u7684\u8fd9\u4e2a\u95ee\u9898\u3002\r\n\u6211\u73b0\u5728\u7684\u9879\u76ee\u4e0d\u7528cocos2d-js\u4e86\uff0c\u4e0a\u4e00\u4e2a\u4f7f\u7528js\u7684\u9879\u76ee\u5df2\u7ecf\u4e0a\u7ebf\u3002\r\n\u4e2a\u4eba\u8ba4\u4e3aspidermonkey\u5728GC\u65b9\u9762\u6709\u5f88\u5927\u7684\u95ee\u9898\uff08\u5361\u987f\u660e\u663e\uff09\uff0c\u662f\u5426\u6709\u5185\u5b58\u6cc4\u6f0f\u5e76\u4e0d\u662f\u5f88\u786e\u5b9a\uff08\u4f7f\u7528xcode leaks\u53ef\u4ee5\u770b\u5230\u5185\u5b58\u6cc4\u6f0f\uff09\u3002\u5e0c\u671bcocos creator\u80fd\u6ce8\u610f\u5230\u8fd9\u4e9b: )\u3002","I have same problem with memory growing up without scheduleOne inside update function\r\n1. Create simple js project with cocos2d-x-3.13.1\r\n2. Add code in app.js\r\n`var HelloWorld = cc.Layer.extend({\r\n            ctor: function () {\r\n                this._super();\r\n                this.scheduleUpdate();\r\n            },\r\n            update: function () {\r\n                cc.log(\"update called\");\r\n            }\r\n        });`\r\n3. Run application on iPhone 5 device.\r\n4. Memory keeps grow up.\r\n\r\n![screen shot 2017-01-25 at 5 53 20 pm](https:\/\/cloud.githubusercontent.com\/assets\/15194799\/22297998\/ac2724a6-e327-11e6-8ad6-ee462eb4aa26.png)\r\n\r\nBut if update function is empty, memory isn't grow up.\r\n","@ibaranskyi  I run your test case, the memory is growing up! This issue can be confirmed! Anybody can fix it?!\r\n\r\n2019.06.24  @\u8fd9\u4e2a\u95ee\u9898\u5728cocos2d-x-3.17.2\u4e2d\u4ecd\u7136\u5b58\u5728\u3002\u5927\u4f6c\u4eec\uff0c\u600e\u4e48\u4fee\u590d\uff1f@pandamicro\r\n\r\n1.Create simple js project with cocos2d-x-3.17.2\r\n2.Add code in app.js\r\nvar HelloWorld = cc.Layer.extend({ ctor: function () { this._super(); this.scheduleUpdate(); }, update: function () { cc.log(\"update called\"); } });\r\n3.Run application\uff08Xcode10.2.1\uff09 on iPhone 6s device.\r\n4.Memory keeps grow up."],"labels":["script:jsb"]},{"title":"Cocos2d-x Prevent mouse click location triggered when offscreen","body":"- cocos2d-x version: Cocos2d-x 3.12 javascript for web ( HTML5) \n- devices test on: Chrome \n- developing environments\n  - NDK version:\n  - Xcode version:\n  - VS version:\n  - WEB  <------------ This is missing \n    Steps to Reproduce:\n1. I have web cocos2d-x js test , i set it to be in the index.html :  \n   \n   <canvas id=\"gameCanvas\" width=\"800\" height=\"450\"><\/canvas>\n\nThen in main.js i set it to be : \n\n```\ncc.view.setDesignResolutionSize(960, 640, cc.ResolutionPolicy.SHOW_ALL);\n```\n\nbut when i click out side the game canvas the sprite moving off screen , how can i prevent it without doing manual screen calculation or this is the only why ?\n\nhere is a picture : \nhttp:\/\/discuss.cocos2d-x.org\/t\/how-to-prevent-click-location-trigger-when-offscreen\/31081\n","comments":["thanks, i added an item `browser type and version` in issue template\n","hola. si programo en JS puedo compilar para todas las plataformas?\n\nHi. if I program in JS I can compile for all platforms ?\n","@Ronalc yes you can... \nUse the forum for questions: http:\/\/discuss.cocos2d-x.org and **Don't ask questions not related to the issue.**\n"],"labels":["critical","platform:web"]},{"title":"[android] Optimize preload of AudioEngine","body":"Goal:\n- Support to play audio without audio is totally decoded, it means that decode some frames, buffering them and send them to OpenSLES to play. Decoding & playing will be simultaneous.\n- One strategy for preloading & playing audio, it will only uses `PcmAudioPlayer` to play audio, `UrlAudioPlayer` will be deprecated and only be used in devices which don't support decoding by OpenSLES API.\n","comments":[],"labels":["platform:android","module:audio"]},{"title":"Got wrong result when render sprite which in transformed node to cc.RenderTexture   ","body":"I wrote a pixel hit test function , it works well utils today. !_!\n1. Sprite A { scaleX:2.5,scaleY:2.5}  in scene; \n2. Sprite B {scaleX:0.5,scaleY:0.5}  is included in Sprite A,(B is A's child node). \n3. Render Sprite B to cc.RenderTexure R.\n4. Add R to scene, R 's size is the same as  the origin size of Sprite B.\n\nI don't know if it's right logic. I thought  R's size should be the same as the display size of Sprite B.\nIf Sprite B's size is {width:30,height:30},  \nR's size should be 30X0.5X2.5  , but I got 30X0.5.\n\nIf this is a correctly result, can somebody tell me how to render Sprite B, make it looks like the same as render from scene?\n\nHere is my code:\n\n``` javascript\nvar hitTextInPixel=function(glX,glY,target){\n\n\n        \/\/\u8fd9\u91cc\u6ca1\u6709\u4f7f\u7528node.x node.y\u7684\u65b9\u5f0f\u662f\u56e0\u4e3a\u5728\u7ed8\u672c\u91cc\u8986\u76d6\u4e86.y \u5f97\u5230\u7684y\u5750\u6807\u4e0d\u662fGL\u5750\u6807\n        var bounds=target.getBoundingBoxToWorld();\n\n        var originPos=target.getPosition();\n\n        var pos=target.parent.convertToWorldSpace(originPos);\n        target.setPosition(pos);\n\n        target.getDisplaySize()\n\n\n        var winSize=cc.winSize;\n        var pixelSize=cc.director.getWinSizeInPixels();\n        var renderTexture=new cc.RenderTexture(bounds.width,bounds.height);\n        renderTexture.setKeepMatrix(true);\n\n        renderTexture.setVirtualViewport(cc.p(bounds.x,bounds.y),cc.rect(0,0,winSize.width,winSize.height),cc.rect(0,0,pixelSize.width,pixelSize.height));\n        renderTexture.beginWithClear(0,0,0,0);\n\n        target.visit();\n\n        renderTexture.end();\n        if(cc.JsbHelper){\n            cc.JsbHelper.directorRender();\n        }else if(cc.director.render){\n            cc.director.render();\n        }else {\n            return true;\n        }\n\n\n        target.setPosition(originPos);\n\n\n\n\n\n\n\n        var w=1;\n        var h=1;\n\n        var bytes=new Uint8Array(w*h*4);\n\n        if( renderTexture.readPixels){\n            renderTexture.readPixels(glX-bounds.x,glY-bounds.y,w,h,gl.RGBA,gl.UNSIGNED_BYTE,bytes);\n\n            return bytes[3]>0;\n        }else{\n            return true;\n        }\n\n\n\n    };\n```\n","comments":["Resolved this issue with custom JSB function.\nAfter read source code of Node, found \nvoid Node::visit(Renderer\\* renderer, const Mat4 &parentTransform, uint32_t parentFlags)\ncan resolve this issue, but JS can not get Renderer.\n\nSo I have to write a custom JSB function to extern node. such as:\n\n``` javascript\nextern JSObject *jsb_cocos2d_Node_prototype;\nbool js_cocos2dx_Node_visitWithParentTransform(JSContext *cx, uint32_t argc, jsval *vp)\n{\n    bool ok = true;\n    cocos2d::Node* cobj = nullptr;\n\n    JS::CallArgs args = JS::CallArgsFromVp(argc, vp);\n    JS::RootedObject obj(cx);\n    obj.set(args.thisv().toObjectOrNull());\n    js_proxy_t *proxy = jsb_get_js_proxy(obj);\n    cobj = (cocos2d::Node *)(proxy ? proxy->ptr : nullptr);\n    JSB_PRECONDITION2( cobj, cx, false, \"js_cocos2dx_Node_visit : Invalid Native Object\");\n\n        auto renderer = cocos2d::Director::getInstance()->getRenderer();\n        cocos2d::Mat4 parentTransform=cobj->getParent()->getNodeToWorldTransform();\n        cobj->visit(renderer,parentTransform , true);\n        return true;\n\n\n\n}\n```\n\nIs there any one know how to resolve this problem in  pure JS API? Because I can't upgrade app except hot-update JS files.\n","@pandamicro do you have any idea? Can invoke `Node::visit()` in JSB?\n"],"labels":["script:jsb"]},{"title":"Different behavior of AudioEngine on different platfroms","body":"Currently, audio pause\/resume logic on iOS will be controlled automatically.\nBoth `SimpleAudioEngine` & `New AudioEngine` on iOS achieve in that way, but other platforms are not implemented. So developers have to invoke `AudioEngine::pauseAll\/resumeAll` in the Applegate.cpp, some code like:\n\n``` c++\n\/\/ This function will be called when the app is inactive. Note, when receiving a phone call it is invoked.\nvoid AppDelegate::applicationDidEnterBackground() {\n    Director::getInstance()->stopAnimation();\n\n    \/\/ if you use SimpleAudioEngine, it must be paused\n    SimpleAudioEngine::getInstance()->pauseBackgroundMusic();\n    SimpleAudioEngine::getInstance()->pauseAllEffects();\n    \/\/ if using new audio engine\n    AudioEngine::pauseAll();\n}\n\n\/\/ this function will be called when the app is active again\nvoid AppDelegate::applicationWillEnterForeground() {\n    Director::getInstance()->startAnimation();\n\n    \/\/ if you use SimpleAudioEngine, it must resume here\n    SimpleAudioEngine::getInstance()->resumeBackgroundMusic();\n    SimpleAudioEngine::getInstance()->resumeAllEffects();\n   \/\/ if using new audio engine\n   AudioEngine::resumeAll();\n}\n```\n\nDevelopers are confused, they complain that why should we invoke these method for Android while their games run perfectly on iOS.\n\nAny thoughts about this? Should we implement the same automatic `pause\/resume` strategy for all platforms?\n","comments":["@dumganhar does invoke these functions on iOS have any side-effect? If not, i think there is not problem.\n","No side effects. But our template comments the code of pause & resume music.\nOn iOS, developers could leave the template code as it is there, everything will work correctly on iOS\/Mac, but it's broken on other platforms.\n","So we should uncomment these codes in template. \n","But there is still a problem. Currently, we have two audio engines, One is `SimpleAudioEngine`, other is `cocos2d::experimental::AudioEngine`. \nWould you add pauseAll & resumeAll for both of them?\n","But if we change the behavior on Android, it may break compatibility too. So i think we should just modify the template, add more comments. And i think we should use AudioEngine internally in SimpleAudioEngine, then deprecated SimpleAudioEngine.\n","Yep, should this change be in 3.13? If so, please set the Milestone, thanks.\n","done\n"],"labels":["module:audio"]},{"title":"cocos2dx-v3.12-lua Sprite:playAnimationOnce(animation, args) blinks","body":"cocos2dx-v3.12\nlua project\ncocos\/framework\/extends\/SpriteEx.lua\nfunction Sprite:playAnimationOnce(animation, args)\n\n```\nlocal showDelay = args.showDelay or 0\nif showDelay then\n    self:setVisible(false)\n    actions[#actions + 1] = cc.DelayTime:create(showDelay)\n    actions[#actions + 1] = cc.Show:create()\nend\n```\n\nshowDelay is always not-nil, it'll make sprite setVisible(false) always, then the sprite would blink once.\n\nIf I want Role to do an Attack animation, the sequence would be like:\nBlink -> Attack\nThat was so ugly.\n\nchange `local showDelay = args.showDelay or 0` to `local showDelay = args.showDelay` would be OK.\n","comments":[],"labels":["script:lua"]},{"title":"FPS isn't stable on OSX","body":"### How to Reproduce?\n\nJust pull the latest code of v3 branch, run `cpp-empty-test Mac` in Xcode.\nYou will see the fps label at left-bottom of window displayed between 54fps to 58fps.\n\n@minggo has checked that it also exists in v3.12.\n","comments":["@dumganhar I change the FPS limit of mac as win32, and the FPS is stable\nCCApplication-mac.mm\n\n```\ncurTime = getCurrentMillSecond();\nif (curTime - lastTime > _animationInterval)\n{\n    lastTime = curTime - (curTime % _animationInterval);\n\n    director->mainLoop();\n    glview->pollEvents();\n}\nelse\n{\n    usleep(1000);\n}\n```\n"],"labels":["platform:mac"]},{"title":" cc.ProgressTimer not moving with parent node","body":"when content of cc.ProgressTimer is spriteFrame, \nchange position of cc.ProgressTimer's parent node, the cc.ProgressTimer is still keep it's position in screen.\n\nsince version: v3.12 only in web platform. #\n","comments":["@pandamicro , could you please check this issue? Thanks.\n","@dumganhar i think @pandamicro takes charge of web engine. @pandamicro could you please take a look?\n","This also happens when using just C++. Reversing bf996c5bac5862827aff7675b606b2f7244ee8f8 fixes the issue. That commit touches a lot of code so I couldn't find an easy fix.\n\nEdit: Just remembered the web platform is completely separate. This is a separate issue.\n","Took another look. ProgressTimer now sets it's GLProgramState by getting it from the Sprite (`setGLProgramState(sp->getGLProgramState())`). By default, the Sprite will use a **noMVP** shader, which won't work with the way the ProgressTimer is drawn.\n\nYou can fix it by going back to using:\n`setGLProgramState(GLProgramState::getOrCreateWithGLProgramName(GLProgram::SHADER_NAME_POSITION_TEXTURE_COLOR))`\n\nor apply the model transform to the verts yourself. Sorry I don't have time for a PR, xueyu, but that will fix it temporarily.\n\nEdit: Just remembered the web platform is completely separate. This is a separate issue.\n"],"labels":["platform:web"]},{"title":"UILayoutComponent refactor","body":"Currently UILayoutComponent contains booleans and separate values to represent type and value for position\/size. Also it have separate values for margins for some reason.\n\nIt would be much simpler to leave only next values and calculate layout based on them:\n\n```\nHorizontalEdge _horizontalEdge;\nPositionType _positionTypeX;\nfloat _positionX;\nSizeType _sizeTypeWidth;\nfloat _width;\n\nVerticalEdge _verticalEdge;\nPositionType _positionTypeY;\nfloat _positionY;\nSizeType _sizeTypeHeight;\nfloat _height;\n```\n\nWhere:\n\n```\nenum class PositionType {\n    ABSOLUTE,\n    PERCENT\n}\n\nenum class SizeType {\n     ABSOLUTE,\n     PERCENT,\n     RELATIVE_TO_PARENT\n}\n```\n\nAnd that will cover all possible situations much simpler, including fixed margins that currently is not possible. \n\nThough to write it correctly it will require to break backward compatibility...\n","comments":["In this case (without values aggregates) it would take more CPU time to calculate interim values and have to break backward compatibility, am i right?\n","Currently there are also no values cache and position\/size recalculated each time in `refreshLayout`. But it recalculated based on margins, which also calculated frequently. I think calculating margins isn't really necessary. So with my approach it may be even more performant.\n\nBut it really will break backward compatibility, that is a big issue.\n\nI have read current sources and really can't understand how some parameters effect on the result. Also looks like sometimes order in which functions called is important. May be things not so bad as i think, but currently it's really quite hard to follow this code.\n","Will need research, while these values are used also by 3rd party components like Cocos Studio, JS etc. \n","@Shulepov break compatibility is not acceptable in v3, it may be considered in v4.\n"],"labels":["type:request"]},{"title":"UIWdiget: new size type - RelativeToParent","body":"Currently UIWidget has two size types - _absolute_ and _percent_. And these two types suitable for almost all situations. But i want to request another type: _relative to parent._ In that case size calculated as: \"parent_size - value\". It can be used when we want to make **fixed spacings** from left\/right or top\/bottom.\n","comments":[],"labels":["type:request"]},{"title":"UILayout clipping not working with BG_COLOR_GRADIENT on broswer but native is ok [cocos2d-jsb]","body":"` this.layout = new ccui.Layout();\n        this.layout.setContentSize(cc.size(180, 150));\n\n```\n    var layoutRect = this.layout.getContentSize();\n    this.layout.x = 100;\n    this.layout.y = 100;\n    this.addChild(this.layout);\n\n    this.button = new ccui.Button();\n    this.button.setTouchEnabled(true);\n    this.button.loadTextures(\"ccs-res\/cocosui\/animationbuttonnormal.png\", \"ccs-res\/cocosui\/animationbuttonpressed.png\", \"\");\n    this.button.x = this.button.width \/ 2;\n    this.button.y = layoutRect.height - this.button.height \/ 2;\n    this.layout.addChild(this.button);\n\n    this.textButton = new ccui.Button();\n    this.textButton.setTouchEnabled(true);\n    this.textButton.loadTextures(\"ccs-res\/cocosui\/backtotopnormal.png\", \"ccs-res\/cocosui\/backtotoppressed.png\", \"\");\n    this.textButton.setTitleText(\"Text Button\");\n    this.textButton.x = layoutRect.width \/ 2;\n    this.textButton.y = layoutRect.height \/ 2 + 70;\n    this.layout.addChild(this.textButton);\n\n    this.button_scale9 = new ccui.Button();\n    this.button_scale9.setTouchEnabled(true);\n    this.button_scale9.setScale9Enabled(true);\n    this.button_scale9.loadTextures(\"ccs-res\/cocosui\/button.png\", \"ccs-res\/cocosui\/buttonHighlighted.png\", \"\");\n    this.button_scale9.width = 100;\n    this.button_scale9.height = 32;\n    this.button_scale9.x = layoutRect.width - this.button_scale9.width \/ 2;\n    this.button_scale9.y = this.button_scale9.height \/ 2;\n    this.layout.addChild(this.button_scale9);\n\n    cc.log(\"layout clipping : \" + this.layout.getClippingType() + \"\/\" + this.layout.isClippingEnabled());\n\n    this.layout.setBackGroundColorType(ccui.Layout.BG_COLOR_GRADIENT);\n    this.layout.setBackGroundColor(cc.color(64, 64, 64), cc.color.RED);\n    this.layout.setClippingEnabled(true);`\n```\n\nbroswer : \n![h5](https:\/\/cloud.githubusercontent.com\/assets\/7367421\/16865167\/4e2801de-4a95-11e6-8b5e-4c4eaa7770e8.png)\n\nnative : \n![cpp](https:\/\/cloud.githubusercontent.com\/assets\/7367421\/16865192\/81ad7138-4a95-11e6-9964-9a557b3b0148.png)\n","comments":[],"labels":["platform:web"]},{"title":"UIWebView setScalesPageToFit() is not working for android.","body":"webView->setScalesPageToFit(true);\nthis works fine for ios but not for android.\nPlease help \nThanks.\n","comments":["How did you solve this issue?\r\n\r\nI am having same problem?","I am having same problem too.  I use cocos2dx 3.15 .  Work well on iOS , but crash on Android. "],"labels":["type:bug","platform:android"]},{"title":"ccui.PageView issue in 3.10 for android (JSB)","body":"Hi I would like to use pageView of ccui for android build. it was working fine for HTML5, but when I am trying to build for native android devices using eclipse.\npageView.scrollToPage(index);\nand\npageView.getCurPageIndex();\n\nGiving me errors. these 2 methods not supported by JSB.\n\nwhen I downgrade the framework to 3.9 then its working fine. I also tried with 3.11.1 If I use it then the pageView is working fine but, after moving to last page, and coming back to first page it won't come back first page it stops at 2nd page only. Please look into this issue. and let us know whats the problem.\n","comments":["thanks. can you post the the code to reproduce it? thanks.\n","\/\/\/\/\/  Thanks for your reply and  Sorry for late reply..  here is my code Tried in 3.10  it throws error,\n\/\/ In 3.11.1, 3.12 it works bur it won't come back to initial index of pageView.\n\n\/\/In 3.9 works fine\n\n this.player1 = new cc.Sprite(res.player1Btn);\n        this.player2 = new cc.Sprite(res.player2Btn);\n this.navBtnLeft = new cc.MenuItemImage(res.nevBtnPng, res.nevBtnSelPng, function () {\n            this.navLeft()\n        }, this);\n        this.navBtnRight = new cc.MenuItemImage(res.nevBtnPng, res.nevBtnSelPng, function () {\n            this.navRight()\n        }, this);\n\nthis.shopView = new ccui.PageView();\n        this.shopView.setTouchEnabled(true);\n\n```\n    this.page1 = new ccui.Layout();\n    this.page1.setSize(this.player1.getContentSize());\n    this.page1.addChild(this.player1);\n\n    this.page2 = new ccui.Layout();\n    this.page2.setSize(this.player2.getContentSize());\n    this.page2.addChild(this.player2);\n\n    this.shopView.setSize(cc.size(cc.winSize.width * 0.75, this.page1._getHeight()));\n    this.player1.setPosition(this.shopView.getSize().width * 0.5, this.shopView.getSize().height * 0.5);\n    this.player2.setPosition(this.shopView.getSize().width * 0.5, this.shopView.getSize().height * 0.5);\n\n    this.shopView.addPage(this.page1);\n    this.shopView.addPage(this.page2);\n\n    this.addChild(this.shopView, 6);\n    this.shopView.scrollToPage(0);\n    this.shopView.setCustomScrollThreshold(0.5); \n```\n\ncc.log(\" ******************************\"+this.shopView.getCurPageIndex()); \/\/ Here I am getting error in 3.10\n\n\/***\\* And these below functions are left arrow and right arrow button functionalitities\n navLeft: function ()\n    {\n\n```\n    var pgId = this.shopView.getCurPageIndex();\nthis.shopView.scrollToPage(parseInt(pgId) - 1);\n\n},\nnavRight: function ()\n{\n      var pgId = this.shopView.getCurPageIndex();\n    this.shopView.scrollToPage(parseInt(pgId) + 1);\n\n},\n```\n\n-Thanks \n","Hi,\nThanks for reply, I have posted the code on\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/16088 .. Please look into it\nand help me to solve this issue.\n\nThanks\nHemanth\n\nOn Tue, Jul 12, 2016 at 2:56 AM, Ricardo Quesada notifications@github.com\nwrote:\n\n> thanks. can you post the the code to reproduce it? thanks.\n> \n> \u2014\n> You are receiving this because you authored the thread.\n> Reply to this email directly, view it on GitHub\n> https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/16088#issuecomment-231870380,\n> or mute the thread\n> https:\/\/github.com\/notifications\/unsubscribe\/ATc3ZhmZNhe04-LfDR2aRDK3OG3enbT_ks5qUrUegaJpZM4JJMuN\n> .\n"],"labels":["script:jsb"]},{"title":"UIWebView evaluateJS not working.","body":"In UIWebView I am loading html. html is loading properly.\n\nI need to add class on element run time by finding element by class name.\n\nwe are trying below code but it not working.\n\nstd::string jsCode = \"document.getElementsByClassName('test').forEach(function(element){element.classList.add('helloClass')});\"\n\nwebView->evaluateJS(jsCode);\n\n but it not find any element.\neven if I debug for only document it return \"\".\n","comments":["please, add more context like:\n- what cocos2d-x version you are using\n- and whether or not you are using our cocos2d html5 implementation or our JS bindigns\n","@ricardoquesada  I am using cocos2d-x V3.11. I am not using cocos2d html5. I using cocos2d-x cpp and UIWebView class.\n","@anjandaffo thanks.\nI could be wrong, but as far as I know our JavaScript bindings don't support DOM functionality. Only JavaScript is supported.\n\n@minggo am I right? \n","@ricardoquesada  Can you suggest any alternate solution. I need to add class on div runtime.\n","@anjandaffo  yeah... I don't think we support `<div>` and other HTML \/ DOM \/ CSS components. As far as I know we support JavaScript and certain features like WebSockets that we manually added.\n\nBut I'm not 100% sure about what we manually added, and what not.\n\n@minggo who is our JavaScript guy? Who knows exactly what \"HTML\" features we implemented in JSB?\n","@ricardoquesada UI provide UIWebView widget. @zilongshanren takes charge of UI system. @zilongshanren please take a look. Thanks.\n","Hello,\r\nany update on this? is DOM supported?"],"labels":["script:jsb"]},{"title":"A bug in CCLuaJavaBridge.cpp","body":"Recently I found that when I called a method in java whose return type was String and got `null` as a result through luajavabridge, the app crushed. Though I can return an empty string instead of `null`, but it's legal in java to return `null` when return type is String.\n\nI firstly thought that might be a bug in JNI, but finally I fixed it in CCLuaJavaBridge.cpp:\nthe original code\n\n```\nbool LuaJavaBridge::CallInfo::execute(void)\n{\n...\n        case TypeString: {\n            m_retjs = (jstring)m_env->CallStaticObjectMethod(m_classID, m_methodID);\n            const char *stringBuff = m_env->GetStringUTFChars(m_retjs, 0);\n            m_ret.stringValue = new string(stringBuff);\n            m_env->ReleaseStringUTFChars(m_retjs, stringBuff);\n            break;\n        }\n...\n}\n...\nint LuaJavaBridge::CallInfo::pushReturnValue(lua_State *L)\n{\n...\n    case TypeString:\n      lua_pushstring(L, m_ret.stringValue->c_str());\n      return 1;\n...\n}\n```\n\nthe code fixed\n\n```\nbool LuaJavaBridge::CallInfo::execute(void)\n{\n...\n  case TypeString: {\n    m_retjs = (jstring)m_env->CallStaticObjectMethod(m_classID, m_methodID);\n    const char *stringBuff = m_env->GetStringUTFChars(m_retjs, 0);\n    if(stringBuff != NULL){\n        m_ret.stringValue = new string(stringBuff);\n    }\n    m_env->ReleaseStringUTFChars(m_retjs, stringBuff);\n    break;\n  }\n...\n}\n...\nint LuaJavaBridge::CallInfo::pushReturnValue(lua_State *L)\n{\n...\n    case TypeString:\n      if(m_ret.stringValue != NULL){\n          lua_pushstring(L, m_ret.stringValue->c_str());\n      }else{\n          lua_pushnil(L);\n      }\n      return 1;\n...\n}\n...\n```\n\nP.S. function `LuaJavaBridge::CallInfo::executeWithArgs` should be modified as well\n","comments":["thanks!\n\n@minggo who can take a look at this patch? \n","@dualface Could you please take a look?\n","thanks, JaryGuo.\n","@JaryGuo could you please send a pull request?\n","Ok\n"],"labels":["script:lua"]},{"title":"AudioEngine::preload should support to pass a url vector as parameter","body":"Now we only support:\n\n``` c++\nvoid AudioEngine::preload(const std::string& filePath, std::function<void(bool isSuccess)> callback)\n```\n\nIf there're lots of effect files need to be preloaded, developer has to invoke `preload` function many times, and must pay more attention to `callback` function.\n\nProbably, a new interface like:\n\n``` c++\nvoid AudioEngine::preload(const std::vector<std::string>& filePaths, const std::function<void(const std::string& url, bool isSucceed)>& callback); \n```\n\nAny thoughts?\n\n@minggo \n","comments":["Sounds good.\n","@dumganhar \nI think would be very useful also to preload all files from a folder (recursively or not).\n\nSomething like that:\n`void AudioEngine::preload(const std::string& folderPath, std::function<void(bool isSuccess)> callback, bool recursive = false);`\n","I think the best way is that creating a audioManager according to your needs.\nFor example, here is a API in  my custom  audioManager (JSB)\n\n \/**\n     \\* @desc \u5728\u6e38\u620f\u4e2d\u4e0d\u8981\u76f4\u63a5\u4f7f\u7528\u6b64\u63a5\u53e3\u64ad\u653e\u58f0\u97f3 \u800c\u662f\u6839\u636e\u529f\u80fd\u9009\u62e9\u4f7f\u7528playVoiceByTag,playEffectSound,playBgSound .\u505c\u6b62\u67d0\u4e00\u4e2a\u58f0\u97f3,\u5219\u6839\u636e\u64ad\u653e\u8fd4\u56de\u7684INDEX \u64cd\u4f5c\n     \\* @param path\n     \\* @param loopOrTimes {boolean| number}\n     \\* @param volume 0-1;\n     \\* @param opts  {object<sole.<boolean>,restart.<boolean>,onended.<function>,tweenVolume.<boolean>>}\n     \\* sole:\u5982\u679c\u4e3a\u771f,\u5219\u8fd9\u4e2a\u58f0\u97f3\u540c\u65f6\u53ea\u80fd\u64ad\u653e\u4e00\u4e2a,restart\n     \\* \u5982\u679c\u8bbe\u7f6e\u4e3a\u771f,\u5219\u5728sole\u4e3a\u771f\u7684\u60c5\u51b5\u4e0b\n     \\* \u5f53\u524d\u58f0\u97f3\u4ece\u5934\u64ad\u653e, onended \u5f53\u58f0\u97f3\u64ad\u653e\u5b8c\u6bd5\u4f1a\u6267\u884c\u7684\u52a8\u4f5c,\u4e3a\u7b80\u5316\u64cd\u4f5c,\u4e0d\u652f\u6301\u591a\u4e2a\u56de\u8c03.\u4e00\u4e2a\u58f0\u97f3\u53ea\u652f\u6301\u4e00\u4e2a\u56de\u8c03. tweenVolume \u5982\u679c\u4e3a\u771f\u5219,\u5bf9\u58f0\u97f3\u505a\u6de1\u5165\u5904\u7406\n     \\* @returns {*|int}\n     *\/\n    AudioManager.prototype.playSound = function (path, loopOrTimes, volume, opts) {\n\n```\n};\n```\n\n   A base audio class don't need too much extra function, because is not everyone has the same requirements as you.\n\nThanks.\n","@liuyi if i understand correctly, you disagreed @Drakon-Cocos 's requirement, not this issue. Right? If so, i agree with you.\n","@minggo  Yes, I have different  opinion\u3002 Just keep it simple!\n","@liuyi\nI think that folder preloading is simple as concept.\nToday I didn't found a multi platform way to list files inside a folder.\nTherefore each time I add a sound or an image to the project I have to code the associated URL for preloading.\nThis is time consuming and errore prone.\nAnyway it is just my opinion. \n","@Drakon-Cocos  \nPreload lots of sounds maybe need a lot of memory, especially in some low devices(such as smart TV)\n\n1\u3001Put whole sounds to a folder in res folder.\n2\u3001Create \u201cresource.js\u201d  automatically\uff0cadd all the sounds to the resource.js. You can write a tool by node.js  or python etc.\n3\u3001 Write a wrapper function  to  preload these sounds in \"resource.js\".\n\nresource.js  example:\n\n\"voice\": {\n        \"zh\": {\n            \"home\": {\n                \"addVip\": \"res\/voice\/zh\/home\/addVip.mp3\",\n                \"click_buy_level_1_1\": \"res\/voice\/zh\/home\/click_buy_level_1_1.mp3\",\n                \"download_error\": \"res\/voice\/zh\/home\/download_error.mp3\",\n\n```\n        },\n        \"splash\": {\n            \"didi_luanch_01\": \"res\/voice\/zh\/splash\/didi_luanch_01.mp3\",\n            \"didi_luanch_02\": \"res\/voice\/zh\/splash\/didi_luanch_02.mp3\"\n        },\n        \"system\": {\n            \"auto_login_failed\": \"res\/voice\/zh\/system\/auto_login_failed.mp3\",\n            \"guest_welcome\": \"res\/voice\/zh\/system\/guest_welcome.mp3\",\n            \"login_success\": \"res\/voice\/zh\/system\/login_success.mp3\"\n        }\n    }\n```\n\nI think this way is faster than scanning folder.\n\nHere is a nodeJS code snippets, I use it generate resource list:\n\n`\nappKit.generateRes = function (dir, obj, parentDir, exucludes) {\n\n```\nexucludes = exucludes || [];\nvar state = fs.statSync(dir);\n\nif (state.isDirectory() == false) {\n    console.log(\"Input a directory please.\");\n    return;\n}\n\/\/get all scripts in this folder.\nvar files = fs.readdirSync(dir);\n\/\/ console.log(files);\nvar len = files.length;\nvar parentDir = (parentDir == null || parentDir == \"\") ? dir : parentDir + \"\/\" + dir;\nvar childDir, file;\n\nvar needDeleteKeys = [];\nfor (var i = 0; i < len; i++) {\n    file = files[i];\n    childDir = (parentDir != null && parentDir != \"\") ? parentDir + \"\/\" + files[i] : files[i];\n\n    var state = fs.statSync(childDir);\n    if (state.isDirectory()) {\n        var childObj = obj[file] = {};\n        appKit.generalRes(childDir, childObj, null, exucludes);\n    } else {\n        if (exucludes.indexOf(file) < 0) {\n            \/\/\/ var fileName=file.\n            \/\/console.log(typeof(file));\n            var fileName = file.substring(0, file.lastIndexOf(\".\"));\n            if (obj[fileName] == null) {\n                obj[fileName] = childDir;\n            } else {\n                \/\/\u7ed9\u91cd\u590d\u7684\u6587\u4ef6\u91cd\u65b0\u547d\u540d\u952e\u540d\u3002\n                var old_fileSrc = obj[fileName];\n                \/\/console.log(\"=====>>>>\"+fileName)\n                \/\/ console.log(old_fileSrc)\n                \/\/console.log(\"XX\")\n                if (typeof(old_fileSrc) == \"object\") {\n                    \/\/this is a folder,change the name of new file.\n                    var currentFileName = file.replace(\/\\.\/g, \"_\");\n                    obj[currentFileName] = childDir;\n                } else {\n                    var old_fileName = old_fileSrc.substring(old_fileSrc.lastIndexOf(\"\/\") + 1);\n                    var new_fileName = old_fileName.replace(\/\\.\/g, \"_\");\n                    obj[new_fileName] = old_fileSrc;\n\n                    needDeleteKeys.push(fileName);\n\n                    var currentFileName = file.replace(\/\\.\/g, \"_\");\n                    obj[currentFileName] = childDir;\n                }\n\n            }\n\n        }\n    }\n}\/\/end for\n\nfor (var k = 0; k < needDeleteKeys.length; k++) {\n    delete obj[needDeleteKeys[k]];\n}\n```\n\n};`\n","Agree with @liuyi, i think it better to keep AudioManager simple. Adding multiple files can be done inside for-loop.\n\nPreloading sounds from directories have one big disadvantage - obtaining files list may be very slow on some platforms (e.g. on Android).\n"],"labels":["module:audio"]},{"title":"limited max instance of AudioEngine","body":"Getting this error on Ubuntu 16.04\n\n```\nFail to play audio\/CannonShot.mp3 cause by limited max instance of AudioEngine\n```\n","comments":["How many effects did you play?\n","@damorton , any updates? Could you provide more information?\n"],"labels":["platform:linux"]},{"title":"JSB did not bind eventcontroller\uff0cwhy? ","body":"JSB did not bind eventcontroller, why?\nand cc.log is invaild at android platform. who knows why? thanks!\n","comments":["@pandamicro Could you please take a look?\n","Thanks for your reply!  The problem cc.log is reason for android device setting.\nand now, there is just one problem left, why js binding of EventController did not do.\nI see lua binding of EventController is vaild at android and ios platform. \n"],"labels":["script:jsb"]},{"title":"cocos2d-x v3.10 run on iphone5(Release) CocosBuilderTest's cccontrolbutton click the button callback unresponsive","body":"","comments":["@minggo \n","I will have a try.\n","Does it only happen on iPhone5? I tested with iPhone6, it worked ok.\n","yes, only on IPhone5 and on XCode 7.3 , must be release, debug mode have no problem\n","Sorry, i don't have iPhone5.\n","ipad 1 have same issue\n","@minggo I have this issues too,How to fix it? I don't know ,help\n","I will try to find a device to test.\n","I have fix it , it's xcode problem\n\n2016-07-04 9:28 GMT+08:00 minggo notifications@github.com:\n\n> I will try to find a device to test.\n> \n> \u2014\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub\n> https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/15953#issuecomment-230188238,\n> or mute the thread\n> https:\/\/github.com\/notifications\/unsubscribe\/ADn8z5nbWOcezIdOsAELSbgUZGyQLhfvks5qSGHOgaJpZM4I9gPj\n> .\n","@gdbobu how did you fix it?\n","@ @williamchong007  try using xcode 7.0 build release\n","I have done with it,it's xcode's bug\n\n2016-09-12 11:18 GMT+08:00 nimabi8984 notifications@github.com:\n\n> @ @williamchong007 https:\/\/github.com\/williamchong007 try using xcode\n> 7.0 build release\n> \n> \u2014\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/15953#issuecomment-246234627,\n> or mute the thread\n> https:\/\/github.com\/notifications\/unsubscribe-auth\/ADn8z7tFNR8be8uO6GqxOMVaDoQlDwkGks5qpMSCgaJpZM4I9gPj\n> .\n"],"labels":["platform:ios"]},{"title":"[v 3.11] crash on Android 2.3","body":"Hi,\nI have this crash on Android 2.3, though it's working fine on more recent android versions:\n\n> D\/dalvikvm( 3020): Trying to load lib \/mnt\/asec\/org.domain.APP-1\/lib\/libcocos2dcpp.so 0x405182e0\n> I\/DEBUG   ( 1307): **\\* **\\* **\\* **\\* **\\* **\\* **\\* **\\* **\\* **\\* **\\* **\\* **\\* **\\* **\\* ***\n> I\/DEBUG   ( 1307): Build fingerprint: 'samsung\/GT-S5360\/GT-S5360:2.3.6\/GINGERBREAD\/XXLI2:user\/release-keys'\n> I\/DEBUG   ( 1307): pid: 3020, tid: 3020  >>> org.domain.APP <<<\n> I\/DEBUG   ( 1307): signal 4 (SIGILL), code 1 (ILL_ILLOPC), fault addr 8114a578\n> I\/DEBUG   ( 1307):  r0 814e0e60  r1 813d7a11  r2 814d2000  r3 0000cec8\n> I\/DEBUG   ( 1307):  r4 814e0e60  r5 00000051  r6 00000004  r7 00000000\n> I\/DEBUG   ( 1307):  r8 80218200  r9 0000cec8  10 4428fbe8  fp bec067d0\n> I\/DEBUG   ( 1307):  ip 814d1b60  sp bec063e8  lr 81418707  pc 8114a578  cpsr 20000030\n> I\/DEBUG   ( 1307):  d0  3f8000003f800000  d1  3ff0000040000000\n> I\/DEBUG   ( 1307):  d2  4d86be24424d2b93  d3  00540ff04a2c7880\n> I\/DEBUG   ( 1307):  d4  3fbc71c7002b1e20  d5  3fcef049fb9094d1\n> I\/DEBUG   ( 1307):  d6  401c000000000000  d7  3ff0000000000000\n> I\/DEBUG   ( 1307):  d8  0000000000000000  d9  0000000000000000\n> I\/DEBUG   ( 1307):  d10 0000000000000000  d11 0000000000000000\n> I\/DEBUG   ( 1307):  d12 0000000000000000  d13 0000000000000000\n> I\/DEBUG   ( 1307):  d14 0000000000000000  d15 0000000000000000\n> I\/DEBUG   ( 1307):  scr 60000012\n> I\/DEBUG   ( 1307): \n> I\/DEBUG   ( 1307):          #00  pc 0014a578  \/mnt\/asec\/org.domain.APP-1\/lib\/libcocos2dcpp.so\n> I\/DEBUG   ( 1307):          #01  lr 81418707  \/mnt\/asec\/org.domain.APP-1\/lib\/libcocos2dcpp.so\n> I\/DEBUG   ( 1307): \n> I\/DEBUG   ( 1307): code around pc:\n> I\/DEBUG   ( 1307): 8114a558 00301bf9 00301bec 4c07b510 4620447c \n> I\/DEBUG   ( 1307): 8114a568 ffcaf28c 4a064905 44794620 447a6809 \n> I\/DEBUG   ( 1307): 8114a578 4010e8bd ba12f289 003968f8 00385b3a \n> I\/DEBUG   ( 1307): 8114a588 00387a86 4c0eb538 447c4d0e 4620447d \n> I\/DEBUG   ( 1307): 8114a598 ffb2f28c 4620490c 462a4c0c 68094479 \n> I\/DEBUG   ( 1307): \n> I\/DEBUG   ( 1307): code around lr:\n> I\/DEBUG   ( 1307): 814186e4 9908418b 600a1c30 1c39604b bdf0b003 \n> I\/DEBUG   ( 1307): 814186f4 1c05b570 682c1c0e 19a11c2a 4b031c20 \n> I\/DEBUG   ( 1307): 81418704 28004798 1c20d1f7 46c0bd70 ffff0fc0 \n> I\/DEBUG   ( 1307): 81418714 1c05b570 682c1c0e 1ba11c2a 4b031c20 \n> I\/DEBUG   ( 1307): 81418724 28004798 1c20d1f7 46c0bd70 ffff0fc0 \n> I\/DEBUG   ( 1307): \n> I\/DEBUG   ( 1307): stack:\n> I\/DEBUG   ( 1307):     bec063a8  4428fbe8  \n> I\/DEBUG   ( 1307):     bec063ac  813d752f  \/mnt\/asec\/org.domain.APP-1\/lib\/libcocos2dcpp.so\n> I\/DEBUG   ( 1307):     bec063b0  afd116bc  \/system\/lib\/libc.so\n> I\/DEBUG   ( 1307):     bec063b4  814e0e40  \n> I\/DEBUG   ( 1307):     bec063b8  814e0e54  \n> I\/DEBUG   ( 1307):     bec063bc  813d39b1  \/mnt\/asec\/org.domain.APP-1\/lib\/libcocos2dcpp.so\n> I\/DEBUG   ( 1307):     bec063c0  00000000  \n> I\/DEBUG   ( 1307):     bec063c4  80218200  \/system\/lib\/libdvm.so\n> I\/DEBUG   ( 1307):     bec063c8  0000cec8  \n> I\/DEBUG   ( 1307):     bec063cc  4428fbe8  \n> I\/DEBUG   ( 1307):     bec063d0  bec067d0  \n> I\/DEBUG   ( 1307):     bec063d4  814e0e60  \n> I\/DEBUG   ( 1307):     bec063d8  00000051  \n> I\/DEBUG   ( 1307):     bec063dc  00000004  \n> I\/DEBUG   ( 1307):     bec063e0  df002777  \n> I\/DEBUG   ( 1307):     bec063e4  e3a070ad  \n> I\/DEBUG   ( 1307): #00 bec063e8  814b8f40  \n> I\/DEBUG   ( 1307):     bec063ec  b00037f5  \/system\/bin\/linker\n> I\/DEBUG   ( 1307):     bec063f0  b000e1cc  \n> I\/DEBUG   ( 1307):     bec063f4  b000e1c8  \n> I\/DEBUG   ( 1307):     bec063f8  00002751  \n> I\/DEBUG   ( 1307):     bec063fc  b00038a9  \/system\/bin\/linker\n> I\/DEBUG   ( 1307):     bec06400  004ee000  \n> I\/DEBUG   ( 1307):     bec06404  afd00000  \/system\/lib\/libc.so\n> I\/DEBUG   ( 1307):     bec06408  00000020  \n> I\/DEBUG   ( 1307):     bec0640c  b000e0e8  \n> I\/DEBUG   ( 1307):     bec06410  814d0038  \n> I\/DEBUG   ( 1307):     bec06414  b000e0e8  \n> I\/DEBUG   ( 1307):     bec06418  00002751  \n> I\/DEBUG   ( 1307):     bec0641c  b0004f93  \/system\/bin\/linker\n> I\/DEBUG   ( 1307):     bec06420  00000020  \n> I\/DEBUG   ( 1307):     bec06424  b000e174  \n> I\/DEBUG   ( 1307):     bec06428  b000e0e8  \n> I\/DEBUG   ( 1307):     bec0642c  00000008  \n\nhow to troubleshout this ?\n","comments":["Please, add more info like:\n- device model\n- when does it crash? what code do you have to run in order to crash it? \n\nThe more info you add, the easier for us to reproduce it and fix it.\n\nthanks.\n","@ricardoquesada It's a Samsung GT-S5360. running Android 2.3.6\n\nIt's crashing when launching the app, nothing special about it, except it is using SDKBOX\/Facebook.\n","@frranck \nwhich app are you running? does it crash with the \"test-cpp\" app that is part of cocos2d-x? \n\nif we can't reproduce the bug, we won't be able to fix it.\n","@ricardoquesada sorry this is very weird but I ran into some problems compiling the tests:\n\n> [armeabi] Compile++ thumb: cpp_tests_shared <= DownloaderTest.cpp\n> jni\/..\/..\/Classes\/ChipmunkTest\/ChipmunkTest.cpp: In destructor 'virtual ChipmunkTest::~ChipmunkTest()':\n> jni\/..\/..\/Classes\/ChipmunkTest\/ChipmunkTest.cpp:101:25: error: 'cpHastySpaceFree' was not declared in this scope\n>   cpHastySpaceFree(_space);\n>                          ^\n> jni\/..\/..\/Classes\/ChipmunkTest\/ChipmunkTest.cpp: In member function 'void ChipmunkTest::initPhysics()':\n> jni\/..\/..\/Classes\/ChipmunkTest\/ChipmunkTest.cpp:117:27: error: 'cpHastySpaceNew' was not declared in this scope\n>   _space = cpHastySpaceNew();\n","@frranck did you have chipmunk in `external`?\n","@minggo thanks, I was missing the dependancies. \nI'm now running into a problem with an \"undefined reference to 'bsd_signal'\", I guess It's because I'm using android-ndk-r11c, which version should I use ?\n","I also use r11c, and don't have a problem. Which project did you build?\n","@minggo I'm trying to build cpp-tests \n","@frranck any update?\n","@minggo No, I pull the latest cocos2d-x version and still can't compile the tests;\nI'm running \"python android-build.py -p 23 cpp-tests\" and get this error:\n\n```\n\n[armeabi] SharedLibrary  : libcpp_tests.so\n\/Users\/franck\/cocos\/cocos2d-x\/tests\/cpp-tests\/proj.android\/..\/..\/..\/external\/websockets\/prebuilt\/android\/armeabi\/libwebsockets.a(lws-plat-unix.c.o):lws-plat-unix.c:function lws_plat_context_early_init: error: undefined reference to 'bsd_signal'\n\/Users\/franck\/cocos\/cocos2d-x\/tests\/cpp-tests\/proj.android\/..\/..\/..\/external\/websockets\/prebuilt\/android\/armeabi\/libwebsockets.a(lws-plat-unix.c.o):lws-plat-unix.c:function lws_plat_context_early_init: error: undefined reference to 'bsd_signal'\nclang++: error: linker command failed with exit code 1 (use -v to see invocation)\nmake: *** [obj\/local\/armeabi\/libcpp_tests.so] Error 1\nError running command, return code: 2.\n\n```\n","@frranck did you updated 3rd party libraries by using `.\/download-deps.py`?\n","@minggo Yes I did that, and just did it again: same problem. :(\n","I just synchronized to v3, and run `.\/android-build.py -p 23 cpp-tests`, there is not problem. I have not idea with the issue, but i think you can do the following and try again\n- remove `tests\/cpp-tests\/proj.android\/libs` and `tests\/cpp-tests\/proj.android\/obj`\n- remove all 3rd party libraries in `external` and run `.\/download-deps.py` again\n","@minggo Just did the whole process you described and I still get the exact same error.\n","@frranck Sorry, i have no idea, the problem may be the deps is not correct, but you use `.\/download-deps.py` to update it, so there should not problem.\n","@minggo that's weird, the 'undefined reference to 'bsd_signal' is mentioned [here](https:\/\/github.com\/rust-lang\/libc\/issues\/236) \n\nIf you run: \n\n> nm cocos\/cocos2d-x\/external\/websockets\/prebuilt\/android\/*\/libwebsockets.a | grep -i bsd\n\nDo you see that bsd_signal is used ?\n\n> ```\n>      U bsd_signal\n>      U bsd_signal\n>      U bsd_signal\n> ```\n","But i also use NDK r11c and don't have any problem.\n","@minggo OK so I gave up with the tests, and tried [a new project ](http:\/\/www.cocos2d-x.org\/wiki\/How_to_Start_A_New_Cocos2D-X_Game)\nI can compile it but I've got a crash when running the app on a Samsung GT-S5360. running Android 2.3.6:\n\n> V\/AudioFlinger( 1311): TrackBase::reset\n> W\/dalvikvm( 5376): VFY: unable to resolve virtual method 248: Landroid\/view\/View;.setSystemUiVisibility (I)V\n> D\/dalvikvm( 5376): VFY: replacing opcode 0x6e at 0x0010\n> D\/dalvikvm( 5376): Trying to load lib \/mnt\/asec\/com.MyCompany.MyGame-1\/lib\/libMyGame.so 0x40517e50\n> D\/AndroidRuntime( 5376): Shutting down VM\n> W\/dalvikvm( 5376): threadid=1: thread exiting with uncaught exception (group=0x40018578)\n> E\/AndroidRuntime( 5301): FATAL EXCEPTION: main\n> E\/AndroidRuntime( 5301): java.lang.UnsatisfiedLinkError: Cannot load library: reloc_library[1312]:  1310 cannot locate '  abs'...\n> E\/AndroidRuntime( 5301): \n> E\/AndroidRuntime( 5301):    at java.lang.Runtime.loadLibrary(Runtime.java:434)\n> E\/AndroidRuntime( 5301):    at java.lang.System.loadLibrary(System.java:554)\n> E\/AndroidRuntime( 5301):    at org.cocos2dx.lib.Cocos2dxActivity.onLoadNativeLibraries(Cocos2dxActivity.java:248)\n> E\/AndroidRuntime( 5301):    at org.cocos2dx.lib.Cocos2dxActivity.onCreate(Cocos2dxActivity.java:264)\n> E\/AndroidRuntime( 5301):    at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1047)\n> E\/AndroidRuntime( 5301):    at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:1615)\n> E\/AndroidRuntime( 5301):    at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:1667)\n> E\/AndroidRuntime( 5301):    at android.app.ActivityThread.access$1500(ActivityThread.java:117)\n> E\/AndroidRuntime( 5301):    at android.app.ActivityThread$H.handleMessage(ActivityThread.java:935)\n> E\/AndroidRuntime( 5301):    at android.os.Handler.dispatchMessage(Handler.java:99)\n> E\/AndroidRuntime( 5301):    at android.os.Looper.loop(Looper.java:130)\n> E\/AndroidRuntime( 5301):    at android.app.ActivityThread.main(ActivityThread.java:3687)\n> E\/AndroidRuntime( 5301):    at java.lang.reflect.Method.invokeNative(Native Method)\n> E\/AndroidRuntime( 5301):    at java.lang.reflect.Method.invoke(Method.java:507)\n> E\/AndroidRuntime( 5301):    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:867)\n> E\/AndroidRuntime( 5301):    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:625)\n> E\/AndroidRuntime( 5301):    at dalvik.system.NativeStart.main(Native Method)\n> E\/        ( 1495): Dumpstate > \/data\/log\/dumpstate_app_error\n> V\/AudioFlinger( 1311): Audio hardware entering standby, mixer 0x6ef38, mSuspended 0\n> D\/AudioStreamOutALSA( 1311): AudioStreamOutALSA::standby--pause\n","@frranck does it crash on other devices? I will try to find a device with Android 2.3.6.\n","@minggo Yes It's working fine on a Moto G.\n","So it is device dependent, then it is more hard to fix.\n","@frranck about the `bsd_signal` error, i met it when i change the contents of `tests\/cpp-tests\/proj.android\/project.properties` to `target=19`. I think it is because some symbols are removed in new Android OS version.\n","@minggo cocos2d-x v2 used to work on that device... Can you try on any Android 2.3.x device ?\n","I'm facing same issue reported on first comment. I'm testing on a Samsung GT-S5830C v2.3.6-GINGERBREAD with NDK-r10c. With v3.7 and NDK-r9d everything was ok for android 2.3 devices.\n","> E\/AndroidRuntime( 5301): java.lang.UnsatisfiedLinkError: Cannot load library: reloc_library[1312]: 1310 cannot locate ' abs'...\n\n@frranck I think i know the issue. Because `abs` defined in Android API 19 and lower is \n\n``` c++\nstatic __inline__ int abs(int __n) {\n    return (__n < 0) ? -__n : __n;\n}\n```\n\nand defined in Android API 21 is \n\n``` c++\nextern int abs(int) __pure2;\n```\n\nSo if you build with Android API 20+, and run under Android 5.0(API 21), then it will have problem. If you want to fix your problem, then you can work around it by compiling with API 19 or lower. Of course, i will use `std::abs` instead of `abs` in cocos2d-x codes.\n","I send #16080 to fix it.\n","I'm still getting same error for samsung\/GT-S5830C\/GT-S5830C:2.3.6\/GINGERBREAD. \n\nIt could be a `setSystemUiVisibility` call? This method was added in API 11, and seems there is call when game starts. There is a `setSystemUiVisibility` in `Cocos2dxActivity` that was not executed and  error happens before `Cocos2dxActivity` code.\n\nEmpty test for v3.12 with ndkr11c:\n\n```\norg.cocos2dx.cpp_empty_test W\/dalvikvm: VFY: unable to resolve virtual method 249: Landroid\/view\/View;.setSystemUiVisibility (I)V\n07-11 10:16:53.757 4499-4499\/org.cocos2dx.cpp_empty_test D\/dalvikvm: VFY: replacing opcode 0x6e at 0x0010\n07-11 10:16:53.773 4499-4499\/org.cocos2dx.cpp_empty_test I\/ApplicationPackageManager: cscCountry is not German : ZTO\n07-11 10:16:53.804 4499-4499\/org.cocos2dx.cpp_empty_test D\/dalvikvm: Trying to load lib \/data\/data\/org.cocos2dx.cpp_empty_test\/lib\/libcpp_empty_test.so 0x4051af28\n07-11 10:16:54.351 2327-2327\/? I\/DEBUG: *** *** *** *** *** *** *** *** *** *** *** *** *** *** *** ***\n07-11 10:16:54.351 2327-2327\/? I\/DEBUG: Build fingerprint: 'samsung\/GT-S5830C\/GT-S5830C:2.3.6\/GINGERBREAD\/VJLK4:user\/release-keys'\n07-11 10:16:54.351 2327-2327\/? I\/DEBUG: pid: 4499, tid: 4499  >>> org.cocos2dx.cpp_empty_test <<<\n07-11 10:16:54.351 2327-2327\/? I\/DEBUG: signal 11 (SIGSEGV), code 1 (SEGV_MAPERR), fault addr 7d74c720\n07-11 10:16:54.351 2327-2327\/? I\/DEBUG:  r0 819d9fd4  r1 819da400  r2 7d74c6f8  r3 00000028\n07-11 10:16:54.351 2327-2327\/? I\/DEBUG:  r4 000fe5c6  r5 7d74c720  r6 819d9fd4  r7 beba6378\n07-11 10:16:54.351 2327-2327\/? I\/DEBUG:  r8 80218200  r9 0000cec8  10 44293c04  fp beba63f0\n07-11 10:16:54.351 2327-2327\/? I\/DEBUG:  ip 81a1fea4  sp beba6378  lr 817248ba  pc 819218b0  cpsr 00000030\n...\n07-11 10:16:58.437 1557-1584\/? W\/WindowManager: App freeze timeout expired.\n07-11 10:16:58.437 1557-1584\/? W\/WindowManager: Force clearing freeze: AppWindowToken{40b2ff88 token=HistoryRecord{4091c7a0 org.cocos2dx.cpp_empty_test\/.AppActivity}}\n07-11 10:16:58.453 1557-1584\/? D\/PowerManagerService: releaseWakeLock flags=0x1 tag=SCREEN_FROZEN\n```\n\nLog: [log.txt](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/357191\/log.txt)\n","setSystemVisibility is invoked like this\n\n``` java\nif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {\n\n            getWindow().getDecorView().setSystemUiVisibility(\n                    View.SYSTEM_UI_FLAG_LAYOUT_STABLE\n                            | View.SYSTEM_UI_FLAG_LAYOUT_HIDE_NAVIGATION\n                            | View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN\n                            | View.SYSTEM_UI_FLAG_HIDE_NAVIGATION \/\/ hide nav bar\n                            | View.SYSTEM_UI_FLAG_FULLSCREEN \/\/ hide status bar\n                            | View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY);\n        }\n```\n\nAs you can see, it is only executed when `Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT`. So i don't know why the codes are executed because your system is 2.3.6.\n","Yes, this code in Cocos2dActivity is not executed. I don't know why there is an error before Cocos2dActivity code being executed.\n","@minggo  just to confirm: #16080 fixed the compilation issue, but I still get the crash...\n","I tested with NDK-r9d and NDK-r10c. There are a lot of warnings and my game is very buggy with both, but I can generate apk file and run it. There is also `VFY: unable to resolve virtual method 9077: Landroid\/view\/View;.setSystemUiVisibility (I)V` message, so this message is not the problem. \n","@frranck what's the error message? Do you have the crash log?\n\n@lfmn83 yep, it is not a problem.\n","@minggo Sorry I got confused, there was no compilation issue, and I still get the \"cannot locate \n abs\" error with the \"MyCompany\/MyGame\" test example.\nBut it is using android-23, should I try android-19 ? What is the proper way to change this ?\n","@frranck did you apply my commit?\n","@minggo I did a git pull in cocos2d-x, isn't it in master already ?\n","@frranck yep, it is merged into v3 branch. It is strange, there is not codes using `abs` except bullet, did you use bullet?\n\nAnd are you sure your game used correct engine since new project will copy engine.\n","We update cocos2dx to today's latest git clone version( with #16080 fixed). + NDK R10E\nFound Crash on 2.3.6  SAMSUNG GT-S5830i\nAfter rollback to old version, the crash disappear.\n","try and try...\nbefore I gave up \nI switched the NDK from R10E to R9D\nit works.... no crash any more...\n\n@minggo  any comments?\n","@minggo Just created a new app, still get the \"abs\" crash. \n","I tried HTC Sense 2.3.7, no crash.\n","`bsd_signal` issue is fixed in #16267\n","Is there any crash in newest version? I will close this issue since i think they are fixed.\n","@minggo I don't have the phone to test at the moment, but I've never seen this fixed... Could anyone here test it ?\n","@minggo I just did the test with cocos2d-x-3.13.1 and it stills crashes. Could we please reopen this bug ?\n","@frranck could you please provide a test case? And please describe your environments:\r\n* NDK version\r\n* Android target version built with(value of --ap)\r\n* device test on and it Android OS versoin"],"labels":["platform:android"]},{"title":"What should be .gitignored?","body":"There are a lot of files generated by cocos2d-x that in general one would want to exclude from version control in their project, but it is really hard to know which files those are. This means any time you build your project there can be hundreds of generated files to check in, and it becomes very confusing. Not to mention, it can cause issues if developing in multiple environments. (http:\/\/stackoverflow.com\/questions\/36928128\/compiling-cocos2d-x-project-on-both-linux-and-osx)\n\nOne of the great things about cocos2d-x is that you don't necessarily need to have a deep understanding of iOS\/Android development. Unfortunately, if you don't understand what all the files and directories are for, it is very difficult to know what can be excluded.\n\nIn my opinion it would be great if a `.gitignore` file was generated when creating a new cocos project, as I assume a large majority of developers are using git as their VCS. Would this be possible?\n\nIf not, it would be great if there was at least a list somewhere in the documentation of all the files that should be excluded from version control.\n","comments":["You can use .gitignore file inside cocos2d-x root directory. It covers almost all build artifacts that should not be in your version control system.\n","Thanks for the reply. What you said appears to be partially correct. I'm not sure if it includes a lot of the android files though. Also, most of the files\/directories in the .gitignore are specific to this repo and irrelevant to an actual cocos2d-x project.\n\nAlthough this is helpful, I wouldn't really call it a solution. I still think it would be very beneficial to have an officially supported list of files to exclude. \n","I'm probably missing some files that should not be ignored, but here's the .gitignore I use for all my new cocos2d-x projects:\n\n```\n# Ignore everything under this directory\n*\n\n# But not these files:\n!\/.gitignore\n!\/Classes\/**\/*\n!\/Resources\/**\/*\n!\/CMakeLists.txt\n!\/proj.android\/jni\/Android.mk\n!\/proj.android\/jni\/Application.mk\n!\/proj.android\/AndroidManifest.xml\n!\/proj.android\/src\/org\/cocos2dx\/cpp\/AppActivity.java\n!\/proj.android-studio\/build.gradle\n!\/proj.win32\/*.sln\n!\/proj.win32\/*.vcxproj*\n!\/proj.win8.1-universal\/*.sln\n!\/proj.win10\/*.sln\n!\/proj.ios_mac\/*.xcodeproj\/project.pbxproj\n\n# Even if any of the above files are in subdirectories\n!*\/\n```\n"],"labels":["type:request"]},{"title":"[android] Video\/GameView region is wrong after unlocking screen","body":"Reported by @chuanweizhang2013\n### How to Reproduce ?\n- Engine version: 3.x\n- Platform: Android\n- Landscape game\n- Playing a video in game\n- Lock screen\n- Unlock screen before the video ends\n- Result: Show only 1\/4 region of video, and game view is probably 1\/4.\n\n![1787727740602657fb6799fdee32843c](https:\/\/cloud.githubusercontent.com\/assets\/493372\/16066329\/c687a1b6-32e4-11e6-9021-e4605a925f5c.jpg)\n","comments":["This could be related to the fact that launching a game while the screen is locked on Android (from adb) causes it to render in a similar way once the screen is unlocked.\n","Similar issue was reported at https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/15367"],"labels":["platform:android"]},{"title":"[v3.11,web, iOS]ccui.UIScrollView's childnode not display in cocos2d-html, but normally display in cocos2d-x jsb","body":"problem: \n\n>  The root node is UIPageView, and UIScrollView is its sub node. In v3.11, the content of UIScrollView not shown in web, but work normally in iOS by jsb.  \n> In v3.10, both normally display.\n\ncocos2d engine version: **v3.11**\nplatform: **web, iOS**\n","comments":[],"labels":["platform:web","platform:ios"]},{"title":"EXC_BAD_ACCESS with CC_USE_PHYSICS=0","body":"In an empty iOS project with `CC_USE_PHYSICS=0` there is an immediate exception at startup as shown. Reproduced with v3.11 in debug and release modes.\n\n![2a7816bc84_690x218](https:\/\/cloud.githubusercontent.com\/assets\/672750\/15568148\/2af1a66a-2322-11e6-9de5-0c809aaf23b0.png)\n\n![9ba3022e05_690x439](https:\/\/cloud.githubusercontent.com\/assets\/672750\/15568147\/2aedb474-2322-11e6-876f-71817e41c0ba.png)\n","comments":["Can i reproduce it with latest codes compiling with Xcode 8.\n","I couldn't reproduce it.\nI downloaded latest code as of today.\ndid `cocos new -lcpp test`\nedited `ccConfig` and disabled physics from there\nrun it on iPhone... worked Ok.\n\n@minggo what did you do to reproduce it?\n","@ricardoquesada it's a mistook, i wanted to say `i can't reproduce it`.\n"],"labels":["platform:ios"]},{"title":"[v3.9, iOS\/Android] EditBox wraps text and loses text's alignment","body":"problem: **EditBox wraps text and loses text's alignment.**\ncocos2d-x version: **v3.9**\nplatform: **iOS, Android**\n\nSample code:\n\n```\n_emailEditBox = cocos2d::ui::EditBox::create( emailEditBoxBackground->getOriginalSize(),\n                                              emailEditBoxBackground );\n_emailEditBox->setInputFlag( cocos2d::ui::EditBox::InputFlag::SENSITIVE );\n_emailEditBox->setInputMode( cocos2d::ui::EditBox::InputMode::EMAIL_ADDRESS );\n_emailEditBox->setReturnType( cocos2d::ui::EditBox::KeyboardReturnType::DONE );\n_emailEditBox->setFont( editBoxFontName.c_str(), editBoxFontSize );\n_emailEditBox->setFontColor( BROWN );\n_emailEditBox->setMaxLength( 50 );\n_emailEditBox->setDelegate( this );\n```\n\niOS:\nWhen I type it is fine:\n![lackoftrancating](https:\/\/cloud.githubusercontent.com\/assets\/5878299\/15504674\/02526494-21b8-11e6-9575-2ad75d49e60d.png)\nWhen I leave the editBox it will truncate the text a bit, but it also loses texts alignment:\n![lackoftrancating2](https:\/\/cloud.githubusercontent.com\/assets\/5878299\/15504679\/06f90a34-21b8-11e6-85eb-1db0dcacae84.png)\nWhen I change the text to shorter, it will still keep the wrong alignment.\n![lackoftrancating3](https:\/\/cloud.githubusercontent.com\/assets\/5878299\/15504685\/0bf3b534-21b8-11e6-8d6e-a42f276339d5.png)\n\nAndroid:\nWhen I type longer text it will wrap it (it shouldn't or it should be optional):\n![device-2016-05-24-133804](https:\/\/cloud.githubusercontent.com\/assets\/5878299\/15504652\/ed709b36-21b7-11e6-97e8-fb9a8230f778.png)\n\nWhen I reduce longer text it will use the wrong alignment:\n![device-2016-05-24-133928](https:\/\/cloud.githubusercontent.com\/assets\/5878299\/15504653\/ed754ef6-21b7-11e6-94a7-51d2a7c16c85.png)\n","comments":["@zilongshanren please take a look.\n","@rynkowsg \nThanks, I will try to fix this issue in the next release cycle.\n","@zilongshanren \nThanks. \n","I may have fixed this by changing the method setInactiveText() in EditBoxImplCommon like so...\n\n```\nvoid EditBoxImplCommon::setInactiveText(const char* pText)\n{\n    if(EditBox::InputFlag::PASSWORD == _editBoxInputFlag)\n    {\n        std::string passwordString;\n        for(size_t i = 0; i < strlen(pText); ++i)\n            passwordString.append(PASSWORD_CHAR);\n        _label->setString(passwordString);\n    }\n    else\n    {\n        _label->setString(pText);\n    }\n    \/\/ Clip the text width to fit to the text box\n    float fMaxWidth = _editBox->getContentSize().width;\n    float fMaxHeight = _editBox->getContentSize().height;\n    Size labelSize = _label->getContentSize();\n\/\/    CCLOG(\"_label->setDimensions\");\n\/\/    CCLOG(\"fMaxWidth: %f. fMaxHeight: %f.\", fMaxWidth, fMaxHeight);\n\/\/    CCLOG(\"labelSize.width: %f. labelSize.height: %f.\", labelSize.width, labelSize.height);\n    if(labelSize.width > fMaxWidth || labelSize.height > fMaxHeight)\n    {\n        if (labelSize.height > 0) {\n            _label->setDimensions(fMaxWidth, labelSize.height);\n        } else {\n            _label->setDimensions(fMaxWidth, fMaxHeight);\n        }\n\n    }\n}\n```\n"],"labels":["type:bug","platform:android","platform:ios"]},{"title":"VideoPlayer window becomes black block when come back from background","body":"Steps to reproduce:\n- run cpp-test enter VideoPlayer test\n- play a video and click Home key to enter background\n- make the app come to foreground and the window of VideoPlayer become black\n\nDevelopers reported it has problem since v3.4. I tested with latest codes, the issue still exists. If you understand Chinese, can refer to [this ticket](http:\/\/forum.cocos.com\/t\/cocos2dx-3-10-videoplayer\/36620).\n","comments":["This issue has been around for a long time, has it been fixed?"],"labels":["type:bug","platform:android"]},{"title":"[3.11] particles and SpriteFrames limitation","body":"Hi ,\n\nI try to use a particle flower with an image from a texture pack so i use :\n\nparticleFlower->setDisplayFrame(SpriteFrameCache::getInstance()->getSpriteFrameByName(\"myPackedImage.png\"));\n\nUnfortunatly on android cocos2d displays the whole texture and not only the part of it corresponding to \"myPackedImage.png\". I think this behaviour can be seen because android does not assert.\n\nThe file CCParticuleSystemQuad.cpp contains the following assert:\n\n```\nCCASSERT(spriteFrame->getOffsetInPixels().isZero(), \n         \"QuadParticle only supports SpriteFrames with no offsets\");\n```\n\nMy question is : are QuadParticules will support SpriteFrames with offsets in the future or will this limitation remain forerever in cocos2dx ?\n\nThanks you.\n","comments":["@ricardoquesada any idea?\n","@klemsFR sure, we add it into the roadmap. IIRC, when I implemented QuadParticle in cocos2d-iphone I found some issues in implementing sprite frames with offset > 0. But we can take a look at it again\n"],"labels":["type:request"]},{"title":"Full  gradle support","body":"","comments":["It seems currently only gradle-experimental can make Android Studio show jni sources, but it's still in active development and constantly changing.\nhttp:\/\/tools.android.com\/tech-docs\/new-build-system\/gradle-experimental\n","Yep. But debugging C\/C++ codes is needed.\n","@minggo this is a good starting point: http:\/\/stackoverflow.com\/questions\/34207158\/cocos2dx-based-project-in-android-studio-using-gradle-experimental-plugin\/34207874\n","Thanks @TheCodez for the link. I will take a look when i implement it.\n"],"labels":["platform:android"]},{"title":"[HTML5] Text in buttons are not centered vertically in Firefox","body":"This happens only with Firefox : texts in all buttons of my game are not centered vertically, they are a little bit too high. The bigger the font is, the more they are not centered. This happens only if I set a custom font, whatever the font is.\n\nI made a little code snippet to demonstrate :\n\n``` js\n    var TestLayer = cc.Layer.extend({\n\n        ctor: function () {\n            this._super();\n\n            var button = new ccui.Button();\n            button.setTitleText(\"CLICK\");\n            button.setTitleFontSize(36);\n            button.setTitleFontName(\"Cocogoose\");\n            button.loadTextureNormal(\"res\/images\/button_green_normal.png\");\n            button.x = cc.winSize.width \/ 2;\n            button.y = cc.winSize.height \/ 2;\n            this.addChild(button);\n        }\n    });\n\n    var TestScene = cc.Scene.extend({\n        ctor:function () {\n            this._super();\n        },\n        onEnter:function () {\n            this._super();\n            var test_layer = new TestLayer();\n            this.addChild(test_layer);\n        }\n    });\n```\n\nI tested with cocos-2d v3.10 and the upcoming v3.11. Same result.\nAnd here what the button looks like in different browsers:\n\n![montage](https:\/\/cloud.githubusercontent.com\/assets\/1941270\/14764049\/dca2a950-09a9-11e6-8fc1-702728cf5306.png)\n","comments":[],"labels":["type:bug","platform:web"]},{"title":"[HTML5] Add support for initWithXML into ccui.RichText","body":"Hi,\n\nThis method is very helpful on JSB, but it is not supported on HTML5. Could you add it on HTML5, please?\n\n![RichTextTest](http:\/\/discuss.cocos2d-x.org\/uploads\/default\/9207\/584d06fb9bb3064a.png)\n\nThanks and best!\n","comments":[],"labels":["platform:web"]},{"title":"Add log message to say that can not usage gradle to build native codes currently","body":"The issue comes from http:\/\/forum.cocos.com\/t\/mac-cocos-3-10-apk\/36065\/2\n","comments":[],"labels":["platform:android"]},{"title":"NaVMesh crash on v3.10","body":"when using NaVMesh feature on armeabi-v7a debug version on android, the program will crash.\narmeabi works correctly.\nthe release version for armeabi-v7a works.\n","comments":[],"labels":["type:bug","platform:android"]},{"title":"Problem while creating a cc.GLProgramm()","body":"So I encountered a problem while creating a cc.GLProgramm(). In the log there I found this:\n`Uncaught TypeError: locGL.createProgram is not a function\ncc.GLProgram.cc.Class.extend.initWithVertexShaderByteArray \n@ CCGLProgram.js:146cc.GLProgram.cc.Class.extend.initWithVertexShaderFilename \n@ CCGLProgram.js:200cc.Layer.extend.ctor @ layerBlur.js:7(anonymous function) \n@ CCClass.js:128Class \n@ CCClass.js:90cc.Scene.extend.onEnter \n@ menuScene.js:11(anonymous function) \n@ CCClass.js:128cc.Director.cc.Class.extend.setNextScene \n@ CCDirector.js:545cc.Director.cc.Class.extend.drawScene\n...`\nI did some debugging in the loaded Cocos-JS Library \"CCGLProgramm.js\" and obviously the function createProgramm is not defined in the Variable locGL, which is a reference to the glContext. Is this a real bug or is there any solution?\n","comments":[],"labels":["platform:web"]},{"title":"[JS] cc.labelTTF.create hangs","body":"The following code hangs on both 3.10 and current git (add it in the HelloWorld layer):\n`\nvar yourbug = cc.LabelTTF.create(\"already, yet\", \"Sans\", 21.621174113322585, \n                                        cc.size(83.3, 0), cc.TEXT_ALIGNMENT_CENTER,\n                                        cc.VERTICAL_ALIGNMENT_CENTER);\nyourbug.x = size.width \/ 4;\nyourbug.y = size.height \/ 4;\nthis.addChild(yourbug, 0);\n`\n\nThe code hangs with the function proto._checkWarp in CCLabelTTFCanvasRenderCmd.js that keeps being called and the array strArr getting bigger ang bigger. I am just not understanding enough of the code to propose a fix.\n","comments":[],"labels":["script:jsb"]},{"title":"AudioEngine to OpenAL sync issue on Win32","body":"In AudioEngine-win32.cpp, the AudioEngineImpl::update is scheduled to be called every 0.05 seconds.  This is done in AudioEngineImpl::play2d, via the following call:\n\n```\n    scheduler->schedule(schedule_selector(AudioEngineImpl::update), this, 0.05f, false);\n```\n\nThe AudioEngineImpl layer uses its own audio state, which becomes out of sync with the true state of the audio source being played via the OpenAL layer.\n\nThis causes a problem with any method that is called with an the audio ID provided by the play2d method. For example, calling AudioEngine::getCurrentTime(audioID) should return the current position of the audio source being played.  This works fine until OpenAL gets to the end of the audio source, where the OpenAL state of the audio becomes AL_STOPPED, yet the AudioEngine state for that specific audio file is still set to AudioState::PLAYING, since the AudioEngineImpl::update method has not yet been called to update this state (given it is only called every 0.05 seconds).\n\nThis results in an invalid value of 0.0 being returned by AudioEngine::getCurrentTime(audioID), since the AudioEngineImpl::update code has not yet been called to update the true status of this audioID.\n\nThere are several ways to fix this, and a few that I can think of at the moment are as follows:\n\n(1) Set the AudioEngineImpl::update function to be called called every frame instead of every 0.05 seconds.  \n\n(2) If updating every frame causes performance issues, then modify each method that performs actions against a specific audioID in order to check for the correct OpenAL state of that audio source.  This is not the preferred way to handle the issue, since the AudioEngine state and the OpenAL state will still be out of sync, which may cause other issues when using the AudioEngine. An example of this modification would be as follows:\n\n```\nfloat AudioEngineImpl::getCurrentTime(int audioID)\n{\n    float ret = 0.0f;\n    auto& player = _audioPlayers[audioID];\n    if(player._ready){\n        if (player._streamingSource) {\n            ret = player.getTime();\n        } else {\n            ALint sourceState;\n            alGetSourcei(player._alSource, AL_SOURCE_STATE, &sourceState);\n            \/\/ Check the OpenAL state of the source, and if it has finished, return the correct value\n            if (sourceState == AL_STOPPED)\n            {\n                ret = 1.0f;\n            }\n            else\n            {\n                alGetSourcef(player._alSource, AL_SEC_OFFSET, &ret);\n            }\n\n            auto error = alGetError();\n            if (error != AL_NO_ERROR) {\n                log(\"%s, audio id:%d,error code:%x\", __FUNCTION__,audioID,error);\n            }\n        }\n    }\n\n    return ret;\n}\n```\n\n(3) Perhaps a secondary and more efficient update method should be added to the implementation that is called per frame, and which simply checks the OpenAL state of any audio source currently playing, and sets the correct AudioEngine::AudioState for that audio source.  This would keep the states in sync.  The AudioEngineImpl::update function would then still be called every 0.05 seconds, and checks the current audio source state values (AudioEngine::AudioState), and removes them from the list if they are no longer in PLAYING state.  A new state would need to be added to the AudioEngine::AudioState enum, being \"STOPPED\" state.  Every method called against an audioID can then check for the AudioState of that audio source, instead of checking the OpenAL state (as suggested in (2) above).\n","comments":["@rh101, thanks for your feedback and advice. I'll check this problem and let u know my thought soon. :)\n","I think this issue exists in all cocos2d-x supported platforms which use OpenAL to play sounds.\nFor example, ios and Mac should have this problem too.\n"],"labels":["type:bug","module:audio"]},{"title":"ActionTimeline Skeletal animation can not be moved","body":"In js version(_v3.10_)\uff0cWhen a node is added first time\uff0cPosition effective\uff0cBehind the setting has no effect\u3002\n\nnow,   I can only call functions `setNodeDirty` of parent become effective~..\n\nPlease help me see~~\uff0cthanks\u3002\n","comments":[],"labels":["type:bug","platform:web"]},{"title":"cocos2d-js load Particle file Crash","body":"Hi,\n\n  \u3000\u3000In js version\uff0cI found the file with the texture data crash. Only with pictures  normal~\u3002\n\nStack display, `cc.unzipBase64AsArray`  In this function there will be problems\u3002\n\n  Environment\uff1awindow 7 chrome\n","comments":[],"labels":["type:bug","script:jsb"]},{"title":"change option from CHIPMUNK to BOX2D doesn't have any effect","body":"Hi,\n\nBefore created new project I change CMakeList regarding Physics Engine:\n\noption(USE_CHIPMUNK \"Use chipmunk for physics library\" OFF)\noption(USE_BOX2D \"Use box2d for physics library\" ON)\n\nnext I started work on new project but every preprocessor definitions are still set tu chipmunk \nattachment from grep: \n$ grep -rIn CC_ENABLE_CHIPMUNK_INTEGRATION .\/\\* --exclude *.cpp  --exclude *.h\n\n[chipmunkGrep.txt](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/211760\/chipmunkGrep.txt)\n\nproblem exist on cocos2d-x-3.10 and cocos2d-x-3.9\n\nAs a workaround I set preprocessor definition by sed command and rebuild project\n$ grep -rIl CC_ENABLE_CHIPMUNK_INTEGRATION .\/\\* --exclude *.cpp  --exclude *.h | xargs sed -i 's\/CC_ENABLE_CHIPMUNK_INTEGRATION\/CC_ENABLE_BOX2D_INTEGRATION\/g'\n\n\/\/ br Greg  :) \n","comments":["Oh, it is interesting to reuse configuration like that.\n","Hi, had the same problem in v3.11, I modified my\n`linux-build\/CMakeCache.txt` in my game project folder and seemed to work :)\n\n`CMakeCache.txt`:\n\n```\n\/\/Use box2d for physics library                                                                     \nUSE_BOX2D:BOOL=ON                                                                                                                                                                                                                   \n\n\/\/Use bullet for physics3d library                                                                  \nUSE_BULLET:BOOL=OFF                                                                                 \n\n\/\/Use chipmunk for physics library                                                                  \nUSE_CHIPMUNK:BOOL=OFF \n```\n","Hi Bartek,\n\nBTW even if set preprocesson to use BOX2D, I think cocos2dx still use Chipmunk. But I have to check it once again.  \n\n\/br Greg\n"],"labels":["type:bug"]},{"title":"lua \u6b63\u5e38\u8c03\u7528\u51fd\u6570\u4f1a\u62a5\u4e00\u4e2a\u9519\u8bef","body":"lua_cocos2dx_auto.cpp  \u6587\u4ef6\u91cc\u7684`lua_cocos2dx_GLProgramState_setUniformFloat`\u51fd\u6570,\u7b2c\u4e00\u4e2a\u53c2\u6570\u5373\u53ef\u4ee5\u662f\u6574\u6570\u4e5f\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\uff0c\u4f46\u5982\u679c\u7b2c\u4e00\u4e2a\u53c2\u6570\u5b57\u7b26\u4e32\uff0c\u5f53\u7a0b\u5e8f\u8fd0\u884c\u5230\n\n```\n ok &= luaval_to_int32(tolua_S, 2,(int *)&arg0, \"cc.GLProgramState:setUniformFloat\");\n```\n\n\u4f1a\u62a5\u4e00\u4e2a\u9519\u8bef\uff0cbreak\uff0c\u7136\u540e\u8fd0\u884c\u662f\u5b57\u7b26\u4e32\u60c5\u51b5\u4e0b\u7684\u4ee3\u7801\u3002\u8fd9\u662f\u6b63\u5e38\u7684\u8c03\u7528\u51fd\u6570\u8fc7\u7a0b\u3002\u5982\u679c\u6e38\u620f\u4e2d\u6bcf\u5e27\u90fd\u8c03\u7528`setUniformFloat`\uff0c\u6253\u5370\u51fa\u6765\u7684log\u5c06\u53d8\u7684\u975e\u5e38\u7684\u6076\u5fc3\u3002\u800c\u4e14\u6ca1\u5565\u95ee\u9898\u62a5\u4e00\u4e2aerror\u4e5f\u4e0d\u592a\u5408\u7406\u3002\u7c7b\u4f3c\u7684\u51fd\u6570\u633a\u591a\u7684\u3002\n","comments":["Yep, you are right. We should remove the log in `luaval_to_int32()`. And we should enhance the binding codes to make it more smart to check errors.\n","@minggo any plant about this?\n","@feijing566 sorry, we have other more important issues to fix, so there is not plan this issue right now. You are appreciated if you can send a PR for it.\n"],"labels":["script:lua"]},{"title":"Incorrect screen positioning and scale while launching app from the lock screen on Android","body":"Hi, I am using Cocos2d-x 3.8.1. My game runs only in the **landscape** mode\nI've implemented local notifications on Android similar to [https:\/\/github.com\/kobakei\/CCLocalNotification](https:\/\/github.com\/kobakei\/CCLocalNotification). But it is not so important.\n\nIf I exit the game via `Director::getInstance()->end();` then wait for notification to appear and launch the game via this notification from the lock screen \n\n<img src=\"https:\/\/cloud.githubusercontent.com\/assets\/16077404\/14272921\/648c11de-fb0f-11e5-969b-a541a210ef0e.jpg\" data-canonical-src=\"https:\/\/cloud.githubusercontent.com\/assets\/16077404\/14272921\/648c11de-fb0f-11e5-969b-a541a210ef0e.jpg\" width=\"240\" height=\"426\" \/>\n\nInstead of this image \n<img src=\"https:\/\/cloud.githubusercontent.com\/assets\/16077404\/14272923\/648cc444-fb0f-11e5-8d22-d807dc9c2fc9.jpg\" data-canonical-src=\"https:\/\/cloud.githubusercontent.com\/assets\/16077404\/14272923\/648cc444-fb0f-11e5-8d22-d807dc9c2fc9.jpg\" width=\"426\" height=\"240\" \/>\n\nI have this one\n<img src=\"https:\/\/cloud.githubusercontent.com\/assets\/16077404\/14272922\/648c2480-fb0f-11e5-88c8-25e39fa75f96.jpg\" data-canonical-src=\"https:\/\/cloud.githubusercontent.com\/assets\/16077404\/14272922\/648c2480-fb0f-11e5-88c8-25e39fa75f96.jpg\" width=\"426\" height=\"240\" \/>\n\nAdditional information:\n- if the game is in a device memory all works fine\n- If launch the game via local notification but not from the lock screen, all works fine\n- The issue is reproducible on a tablet if it is in the portrait mode and all works fine when you try to reproduce in the landscape mode\n\nI am ready to give any additional information.\n","comments":["This is discussed here: http:\/\/discuss.cocos2d-x.org\/t\/resolution-problem-while-launching-game-through-push-notification-from-lock-screen\/22254.\n\nThe solution from smitpatel88 works on some devices.\n","A bump to this because it happens on every device I've encountered and gives a pretty bad development experience: \r\nHaving to quickly unlock the device every time before your development tool pushes the app or ending up with the wrong orientation","@Guy-kun did you try the smitpatel88 solution? I understand that it gets overwritten upon upgrading, but if it solves your issue that would be enough data points to submit a PR with the solution's code.","@larsven solution helped me well.","> If I exit the game via Director::getInstance()->end(); then wait for notification to appear and launch the game via this notification from the lock screen\r\n\r\n@alexander-vi  Should reproduce it like this? And should reproduce on a tablet?","Hi devs!\r\nIs this issue fixed?","As far as I know it's not."],"labels":["type:bug","critical","platform:android"]},{"title":"Socket.io bottleneck \/ weird buffering","body":"Hi everybody,\n\nI set up a test project of cocos2d-JS with socket.io. In the cocos2d app I scheduled an update function (about every 16ms, with `this.scheduleUpdate()` ), and during every update cycle I tried to send a signal to the socket.io server via `socket.emit()`. When I set the server up to measure how many incoming signals there are per second, weird things happen:\n- in cocos2d-html5 (`cocos run -p web`) the received signals max out at around 60 signals per second. Everything looks fine.\n- when I compile a Linux binary (`cocos run -p linux`) the received signals max out at 20 per second BUT they are buffered from 60 per second. Meaning the app actually generates 60 socket.emit()s per second, but only send them out 20 at a time. Therefore 1 second of app runtime will generate 3 seconds of signals with 20 signals each. \n\nThis creates a huge lag in any live-multiplayer scenario. Can anybody reproduce this, please, or is this a well-known bug by any chance? It just seems arbitrary.\n\nThe only solution I found so far was to limit the cocos2d app to only ever send 20 emits per second.\n","comments":[],"labels":["platform:web"]},{"title":"Bug in nexus 5","body":"Hey! I have a vertex shader that defines 3 attributes. It works fine on iOS but when I try to compile in my Nexus 5 I get the following message once per draw call:\n\n```\n03-22 09:01:45.382  7447  7476 I Adreno-ES20: <validate_vertex_attrib_state:60>: validate_vertex_attrib_state: No vertex attrib is enabled in a draw call!\n```\n\nIt's worth saying that the drawing is done correctly.\n\nIf I remove any one of the attributes in the vertex shader the problem disappears.\nHere is my non-working vertex shader:\n\n```\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec2 normal;\nattribute vec2 path;\nattribute float miter;\n\nuniform mat4 modelToDesign;\nuniform float thickness;\nvarying float edge;\n\nvoid main() {\n  edge = sign(miter);\n  vec2 pointPos = path.xy + vec2(normal * thickness\/2.0 * miter);\n\n  gl_Position = CC_MVPMatrix * modelToDesign * vec4(pointPos, 0.0, 1.0);\n  gl_PointSize = 1.0;\n}\n```\n\nHere is my working vertex shader:\n\n```\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec3 normal;\nattribute vec2 path;\n\nuniform mat4 modelToDesign;\nuniform float thickness;\nvarying float edge;\n\nvoid main() {\n  edge = sign(normal.z);\n  vec2 pointPos = path.xy+ vec2(normal.xy * thickness\/2.0 * normal.z);\n\n  gl_Position = CC_MVPMatrix * modelToDesign * vec4(pointPos, 0.0, 1.0);\n  gl_PointSize = 1.0;\n}\n```\n\nI am using cocos2dx v3.10 cpp.\nI am loading the shaders with this two functions: \n- https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/0abe235323aaf03f457d5fa395ded1cd38c43713\/tests\/cpp-tests\/Classes\/ShaderTest\/ShaderTest.cpp#L54\n- https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/0abe235323aaf03f457d5fa395ded1cd38c43713\/tests\/cpp-tests\/Classes\/ShaderTest\/ShaderTest.cpp#L81\n\nAny ideas on why this is happening?\n","comments":["@andres-blanco Could you please paste some demo codes to reproduce this issue?\n","I have the same error on my Google Nexus 7 II.\r\ncocos2dx version: v3.16 branch\r\nandroid studio 2.3.3\r\ncompileSdkVersion 25\r\nbuildToolsVersion '26.0.0'\r\ndevice:Nexus 7 II android 6.0.1\r\n\r\nMy project used the Cocos Studio to export csb, it works well on cocos2d-x3.10\uff0cbut I test on 3.16 branch\uff0cIt's always ouput this log on Nexus 7 II. I have test on other phone,it is ok!\r\n\r\n```\r\n08-30 02:59:58.697 10975-10997\/? I\/Adreno-ES20: <validate_vertex_attrib_state:60>: validate_vertex_attrib_state: No vertex attrib is enabled in a draw call!\r\n```\r\nCreate a new lua project,test on Nexus 7 II,you will see it."],"labels":["type:bug","platform:android"]},{"title":"Shader uniform update with cc.GLProgram only works with HTML5","body":"Hi,\n\nI stumbled upon an inconsistency in the usage of Cocos2d between the HTML5 engine and Cocos2d-x with JS bindings. I'm using Cocos2d-x 3.10.\n\nAfter creating a shader and setting it to a cc.Node, you can update the uniforms it uses using `cc.GLProgram` and its `setUniformLocationWithXXX` functions. This works properly with HTML5, but won't work when the game is run with Cocos2d-x on native platforms (At least iOS\/OS X, not tested with other platforms but it's unlikely to work properly). \n\nTo workaround this issue, you have to use `getGLProgramState`, which is provided by JS bindings of Cocos2d-x. I got the idea by looking at [this thread](http:\/\/discuss.cocos2d-x.org\/t\/basic-shader-help\/16533\/13).\n## Steps to reproduce\n\nI made a **[repository with the source code](https:\/\/github.com\/4ian\/Cocos2d-shaders-test)** of Hello world, plus a shader with a uniform being updated. If you look at [the source code](https:\/\/github.com\/4ian\/Cocos2d-shaders-test\/blob\/master\/src\/app.js), you can see that to make it work on all platforms, I had to use this:\n\n``` js\n\/\/ 3rd gotcha: shader uniforms should be updated using getGLProgramState with Cocos2d-x.\n        \/\/ Calling setUniformLocationWithXXX only works with HTML5.\n        if (this.sprite.getGLProgramState) {\n            this.sprite.getGLProgramState().setUniformFloat(\"u_value\", Math.random());\n        } else {\n            this._shader.setUniformLocationWith1f(this._valueUniform, Math.random());\n        }\n```\n\nThe Readme in the repository should be enough to let you try the game. Let me know if something is unclear!\nI guess that setUniformLocationWith1f should either be updated to work on Cocos2d-x, or at least have a big **warning** added to the documentation. :wink: \n","comments":[],"labels":["type:bug","script:jsb"]},{"title":"Label createWithTTF (Arabic font is broken) ","body":"Hi, Arabic font is always broken on createWithTTF ,Arabic font only work on createWithSystemFont .\nplease look at the image how createWithTTF is broken and createWithSystemFont working fine \n![img_1121 copy](https:\/\/cloud.githubusercontent.com\/assets\/3635272\/14062097\/c544147a-f39b-11e5-87cb-6f79ac83076b.png)\n","comments":["Could provide some codes and the font file to reproduce it? And only this type of font can not work?\n","I tried many fonts and all of them got the same issue .\n\n```\n\/\/working fine \nauto lab=Label::createWithSystemFont(\"\u0639\u0631\u0628\u064a\",\"FrutigerLTArabic-65Bold.ttf\" ,size);\nthis->addChild(lab,2);\n```\n\n```\n\/\/Bug\nauto lab=Label::createWithTTF(\"\u0639\u0631\u0628\u064a\",\"FrutigerLTArabic-65Bold.ttf\" ,size);\nthis->addChild(lab,2);\n```\n\n[FrutigerLTArabic-65Bold.ttf.zip](https:\/\/github.com\/cocos2d\/cocos2d-x\/files\/209815\/FrutigerLTArabic-65Bold.ttf.zip)\n","Oh, what's the language. I think first you should make sure the string is utf-8 code, because labelTTF only support utf-8 string.\n","How can i convert the string to utf-8 code ? Can you share code .\n","Because you write the string the source file, so you'd better make the source file be utf-8.\n","Can you share a code how to do that ? \n","I mean you should save the .cpp file to utf-8 using an editor, such as sublime.\n","ah, in my code i get the text from plist ,so i should save the plist to utf-8  .\n","But you wrote that:\n\n```\n\/\/Bug\nauto lab=Label::createWithTTF(\"\u0639\u0631\u0628\u064a\",\"FrutigerLTArabic-65Bold.ttf\" ,size);\nthis->addChild(lab,2);\n```\n\n`(\"\u0639\u0631\u0628\u064a\"` is in a .cpp file. \n","yes ,I've tried both and both same result ,I use both codes on my game .\n","FrutigerLTArabic-65Bold.ttf.zip it is a .ttf file doesn't include Arabic language, it just includes english word.\n","Somehow the letters will not show but its arabic font . arabic letters will not show only english letter will show on arabic's fonts. but you can test its working fine .\n<img width=\"275\" alt=\"screen shot 2016-04-08 at 12 35 35 pm\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/3635272\/14380097\/7a94991e-fd86-11e5-9ddf-5d556f305f6e.png\">\n","Sorry, i have not idea with it. So let @zilongshanren to take a look.\n","Try using cocos2d-x 3.11, our TTF label problems were fixed there\n","@larsven the problem is not solved \n","<img width=\"245\" alt=\"screen shot 2016-07-17 at 4 28 25 pm\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/3635272\/16900904\/88948188-4c3b-11e6-8f5e-9d74b54ae40f.png\">\n","@Kotaiba \nI tested it and found that the label created by `createWithTTF` will be shown as same as which in `Sublime Text Editor`.  Please refer to the following screenshot:\n- `\u0639\u0631\u0628\u064a` in Sublime Text:\n  ![sublime](https:\/\/cloud.githubusercontent.com\/assets\/493372\/19335731\/032f2402-9138-11e6-87fb-d1eae95c81bd.png)\n- `\u0639\u0631\u0628\u064a` in Cocos2d-x:\n  <img width=\"960\" alt=\"font-test\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/493372\/19335735\/06fa7172-9138-11e6-8349-7a71b87c9b70.png\">\n","@Kotaiba , I don't understand `Arabic font`, could you confirm that which one in cocos2d-x is correct? If System font is correct, why it's wrong in Sublime Text? \n","@dumganhar the system font is correct one ,Sublime need to support Arabic in order for it to work . take a look at this post i think it will give you an idea . http:\/\/stackoverflow.com\/questions\/25603500\/arabic-language-with-sublime-text-editor\n","@Kotaiba, I found this article (https:\/\/www.freetype.org\/opentype\/index.html).\nRendering Arabic font is more complex than other languages, we probably need to use `the FreeType OpenType Layout extension` for drawing `Arabic` letters.\n","Any new about this ?","@minggo  @larsven  \u963f\u62c9\u4f2f\u8bed\u6587\u5b57\u6dfb\u52a0ttf\u5b57\u4f53\u540e\u663e\u793a\u4e0e\u7cfb\u7edf\u5b57\u4f53\u7ffb\u8f6c\u7684\u95ee\u9898 \u73b0\u5728\u6709\u89e3\u51b3\u65b9\u6848\u4e86\u6ca1\u6709\uff1f","If anyone wanna quick fix , you can use http:\/\/omar84.com\/docs\/taw\/arabic_writer.html . just get the Output and use it . only one issue you will face is the braking lines will be upside down in arabic . you can fix it by adding this inside \r\n`bool Label::multilineTextWrap(const std::function<int(const std::u16string&, int, int)>& nextTokenLen)`\r\n\r\n```\r\n----  nextTokenY -= (_lineHeight*_bmfontScale + lineSpacing);\/\/change this to ->\r\n\r\n   if (UserDefault::getInstance()->getBoolForKey(\"isArabic\")){\r\n                      nextTokenY += (_lineHeight*_bmfontScale + lineSpacing);\r\n                       this->setPositionY(getPositionY()-(_lineHeight*_bmfontScale + lineSpacing));\r\n                }else\r\n                    nextTokenY -= (_lineHeight*_bmfontScale + lineSpacing);\r\n```\r\n\r\nand you need to set UserDefault::getInstance()->getBoolForKey(\"isArabic\") true if arabic and false if not \r\n","The issue still exists. Is there any workaround other than manually writing a parser, and then using the Arabic text? ","As mentioned, createWithTTF does make Arabic display in the reverse way, but createWithSystemFont does work. However, I do not need the system font and I would require a custom font. ","@Kotaiba The Arabic Writer does not work for all cases. For example, let's say we have an Arabic Text - \"\u0627\u0644\u0644\u0639\u0628 \u0628\u062f\u0648\u0646 \u0627\u062a\u0635\u0627\u0644 \u0628\u0627\u0644\u0627\u0646\u062a\u0631\u0646\u062a\". After processing it in the Arabic Writer URL that you have provided above, we get \"\ufe96\ufee7\ufeae\ufe98\ufee7\ufefb\ufe8e\ufe91 \ufedd\ufe8e\ufebc\ufe97\ufe8d \ufee5\ufeed\ufeaa\ufe91 \ufe90\ufecc\ufee0\ufedf\ufe8d\". If we use that in Cocos2DX, we get a broken Arabic line of text.\r\nI have tried reversing the line of text, however, it does not display the real thing on the screen. \r\n\r\nWould you have any suggestions on what to do? ","Is there a solution?","i think if cocos2d-x add the harfbuzz lib with freetype the problem solved\r\nhttps:\/\/harfbuzz.github.io\/","Hi, I wrote a fix for custom TTF . It is working for Persian but it still has some issues for some Arabic only characters. I appreciate If anybody with knowledge about Arabic can help me to fix remaining issues.\r\nhttps:\/\/github.com\/MohammadFakhreddin\/cocos2dx-persian-arabic-support","The best solution to this problem that respond to all languages is use of harfbuzz.","Can you provide an example using this library?","> Can you provide an example using this library?\r\n\r\nhttps:\/\/github.com\/anoek\/ex-sdl-cairo-freetype-harfbuzz\/\r\n\r\ncocos2dx use freetype to get data from ttf file.and now need to reshape before rendering with harfbuzz","Thank you I will check your suggestion to see if it is compatible to all cocos2d platforms","> Thank you I will check your suggestion to see if it is compatible to all cocos2d platforms\r\n\r\nyes ,harfbuzz used  in firefox,Qt,chrome in all platfroms"],"labels":["type:bug"]},{"title":"luaval_to_ccvaluemap \u904d\u5386 hash table \u7684\u65f6\u5019\u5982\u679c key \u4e3a number \u5c31\u4f1a\u51fa\u73b0\u9519\u8bef","body":"example:\nlua table \u4e3a   local tbl = {}  tbl[2] = 100\n\u5f53\u5728c++\u4e2d\u4f7f\u7528  luaval_to_ccvaluemap  \u65f6\u4f1a\u5bfc\u81f4 \u9519\u8bef\n\uff0c\u770b\u4e86lua \u5b98\u65b9\u7684\u6587\u6863\u6709\u63d0\u5230\n![image](https:\/\/cloud.githubusercontent.com\/assets\/4037682\/14042097\/b4573cc2-f2b1-11e5-90a6-94ca95727b0c.png)\n\u5728\u4f7f\u7528 lua_next \u7684\u8fc7\u7a0b\u4e2d\u4e0d\u80fd\u5bf9\u975estring\u7c7b\u578b\u7684key\u4f7f\u7528 lua_tolstring \u5982\u679c\u4f7f\u7528\u4e86\u4f1a\u7834\u574f table \u7684index\u7ed3\u6784\u7684\u3002\n\n\u73b0\u5728\u7684\u4ee3\u7801\u53ea\u662f\u7b80\u5355\u7684\u5224\u65ad  lua_isstring \uff0c\u4f46\u662f\u5728lua 5.1\u7684\u6e90\u7801\u4e2d \nLUA_API int lua_isstring (lua_State _L, int idx) {\n  int t = lua_type(L, idx);\n  return (t == LUA_TSTRING || t == LUA_TNUMBER);\n}\n\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u90fd\u662f lua_isstring \u4e3a true \u7684\uff0c\u6240\u4ee5\u5e94\u8be5\u4fee\u6539\u539f\u5148\u7684\u4ee3\u7801\n\u4e3a\n`bool luaval_to_ccvaluemap(lua_State_ L, int lo, cocos2d::ValueMap\\* ret, const char\\* funcName)\n{\n    if ( nullptr == L || nullptr == ret)\n        return false;\n\n```\ntolua_Error tolua_err;\nbool ok = true;\nif (!tolua_istable(L, lo, 0, &tolua_err))\n{\n```\n# if COCOS2D_DEBUG >=1\n\n```\n    luaval_to_native_err(L,\"#ferror:\",&tolua_err,funcName);\n```\n# endif\n\n```\n    ok = false;\n}\n\nif (ok)\n{\n    std::string stringKey = \"\";\n    std::string stringValue = \"\";\n    bool boolVal = false;\n    ValueMap& dict = *ret;\n    lua_pushnil(L);                                             \/* first key L: lotable ..... nil *\/\n    while ( 0 != lua_next(L, lo ) )                             \/* L: lotable ..... key value *\/\n    {\n        if (lua_isnumber(L, -2))\n        {\n            int key =  lua_tonumber(L, -2);\n            std::stringstream ss;\n            ss << key;\n            ss >> stringKey;\n        }\n        else if ( !lua_isstring(L, -2) || !luaval_to_std_string(L, -2, &stringKey))\n        {\n            lua_pop(L, 1);                                      \/* removes 'value'; keep 'key' for next iteration*\/\n            continue;\n        }\n\n        {\n\n            if(lua_istable(L, -1))\n            {\n                lua_pushnumber(L,1);\n                lua_gettable(L,-2);\n\n                if (lua_isnil(L, -1) )                          \/** if table[1] = nil,we don't think it is a pure array *\/\n                {\n                    lua_pop(L,1);\n                    ValueMap dictVal;\n                    if (luaval_to_ccvaluemap(L, lua_gettop(L), &dictVal))\n                    {\n                        dict[stringKey] = Value(dictVal);\n                    }\n                }\n                else\n                {\n                    lua_pop(L,1);\n                    ValueVector arrVal;\n                    if (luaval_to_ccvaluevector(L, lua_gettop(L), &arrVal))\n                    {\n                        dict[stringKey] = Value(arrVal);\n                    }\n                }\n            }\n            else if(lua_type(L, -1) == LUA_TSTRING)\n            {\n                if(luaval_to_std_string(L, -1, &stringValue))\n                {\n                    dict[stringKey] = Value(stringValue);\n                }\n            }\n            else if(lua_type(L, -1) == LUA_TBOOLEAN)\n            {\n                if (luaval_to_boolean(L, -1, &boolVal))\n                {\n                    dict[stringKey] = Value(boolVal);\n                }\n            }\n            else if(lua_type(L, -1) == LUA_TNUMBER)\n            {\n                dict[stringKey] = Value(tolua_tonumber(L, -1, 0));\n            }\n            else\n            {\n                CCASSERT(false, \"not supported type\");\n            }\n        }\n\n        lua_pop(L, 1);                                          \/* L: lotable ..... key *\/\n    }\n}\n\nreturn ok;\n```\n\n}`\n","comments":["Could you please highlight your modification?\nThanks.\n","if (lua_isnumber(L, -2))\n        {\n            int key =  lua_tonumber(L, -2);\n            std::stringstream ss;\n            ss << key;\n            ss >> stringKey;\n        }\n        else if ( !lua_isstring(L, -2) || !luaval_to_std_string(L, -2, &stringKey))\n        {\n            lua_pop(L, 1);                                      \/\\* removes 'value'; keep 'key' for next iteration*\/\n            continue;\n        }\n","Thanks, i will check it.\n","@dualface Could you please take a look?\n","@xzben will you send a pull request?\n"],"labels":["type:bug","script:lua"]},{"title":"3.9's label with outline&shadow is blend with scene not the background of cocos ui panel","body":"3.9's label with outline&shadow is blend with scene not the background of cocos ui panel . does someone meet this ?\n3.9\u7248\u672c\u7684Label\u5f00\u4e86\u9634\u5f71\u548c\u63cf\u8fb9\u4e4b\u540e\u4f1a\u548c\u573a\u666f\u6df7\u5408\uff0c\u800c\u4e0d\u662f\u8ddfUI\u80cc\u666f\u6df7\u5408\uff0c\u5bfc\u81f4\u900f\u8fc7label\u53ef\u4ee5\u770b\u5230\u573a\u666f\u7684\u5185\u5bb9\u5728\u52a8\uff0c\u8bf7\u95ee\u5176\u4ed6\u7248\u672c\u6709\u4eba\u9047\u5230\u8fc7\u561b\uff1f\n\nin iPhone simulator & iPhone 6 device.\n","comments":["i have also this problem on android.","@yaxinhoo  \r\nCould you test the latest v3.14 version? ","i am using ui::EditBox\r\nin editing mode everything works fine but when editing ends it shows the color of background view  at its edges if I make background view's color red: than it will show red around edges.\r\nOne more observation, even if I just render label to `CCRenderTexture ` with fully transparent background, I still can see artifacts around letters.","i am using cocos2dx 3.13.1","@zilongshanren is there any major change in v3.14 so that this issue can be fixed.","@waqas19921 \r\nI can't fully got what you mean. Can you show me some pictures? ","here left text has no white edges as there is black view behind it\r\nwhile right text has some white edges as it has white view behind it\r\nlook by zooming it","![sketch](https:\/\/cloud.githubusercontent.com\/assets\/17469425\/21797075\/b8b4f270-d72e-11e6-95c9-bef9c537429e.png)\r\n","@zilongshanren Here above it is clear where background is white it disappears.","@waqas19921 \r\nI think this PR https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/17024\/files might fix your issue.\r\n\r\nplease give v3.14 a try.","i can not use new version as it takes too much time to setup and compile again.\r\n","@zilongshanren  thanks for your help i try that pull request now.","@zilongshanren  still same result i am using simple text no border no outline why it is mixing with a view behind `glsurfaceview`","I'm not sure, could you provide a sample code? ","@zilongshanren you could simply reproduce it by adding an activity other than cocos2dx like splash  and over it a transparent cocos2dx activity you can see the splash activity color around text label."],"labels":["type:bug"]},{"title":"cocos2d-x-3.10 JS compiled version (.jsc) leaks on iPad.","body":"Hi,\n\nSimple JS project with compiled files (jsc) and empty scheduleUpdate function leaks.\nIt leaks about 100K every 15 seconds.\n\nSteps to reproduce:\n1. Run Cocos.app. Create new JS project with \"Precompiled Library\".\n2. Open Terminal. change dir to the root of your new project where there are 'src' and 'res' folders.\n3. Compile cocos sources: \"cocos jscompile -s script -d lib\/script\".\n4. Compile the projects sources: \"cocos jscompile -s src -d lib\/src\"\n5. Open the project from Cocos.app in Xcode.\n6. Exclude \"JS Common\\script\" and \"Resources\\src\" from targets.\n7. Add new group. Add \"script\" and \"src\" from \"lib\" folder to new group. Make sure \"Create folder reference\" is selected. Click Add.\n8. Run the app on your device.\n9. Open Debug navigator and check the Memory during one minute.\n   --> Here the app must not leak. Stop the app.\n10. Open app.js and change HelloWorldScene:\n\n```\nvar HelloWorldScene = cc.Scene.extend({\n    update:function(dt) {},\n    onEnter:function () {\n        this._super();\n        var layer = new HelloWorldLayer();\n        this.addChild(layer);\n        this.scheduleUpdate();\n    }\n});\n```\n1. Run command from step 4 again to recompile changes.\n2. Open Xcode. Run the app. Check the memory.\n   --> Here the app must leak.\n\nRegards,\nValery.\n","comments":["@pandamicro I am not sure if it is a real bug caused by JSB new memory model. But i think you'd better take a look since it would be critical bug if it exists.\n"],"labels":["type:bug","critical"]},{"title":"[CocosJS v3.8.1] cc.spriteFrameCache removeSpriteFrame not Free memory !","body":"Hi team Cocos, I have a problem similar issues in this link:\nhttp:\/\/forum.cocos2d-objc.org\/t\/removing-sprite-sheet-plist-and-textures-pvr-not-freeing-up-memory\/13949\nMy game use very much of image, and i use a lot of plist file and big png file.\n","comments":[],"labels":["script:jsb"]},{"title":"Use GL_GENERATE_MIPMAP for OpenGL version less 3.0 v1.1","body":"glGenerateMipmap supports:\nOpenGL ES 2.0 or greater\nhttps:\/\/www.khronos.org\/opengles\/sdk\/docs\/man3\/html\/glGenerateMipmap.xhtml\nOpenGL 3.0 or greater\nhttps:\/\/www.opengl.org\/sdk\/docs\/man\/html\/glGenerateMipmap.xhtml\n\nAdd Configuration::supportsGenerateMipmap() for check it\nAdd Texture2D::setAutoGenerateMipmap for use old GL_GENERATE_MIPMAP (\nneed set before glTexImage2D ), and use it any initWithImage\n\nGL_GENERATE_MIPMAP -\nhttps:\/\/www.opengl.org\/wiki\/Common_Mistakes#Automatic_mipmap_generation\n\nnew version it: #13233 , for easy merge\n","comments":["@dabingnn it #11283\nremove it ?\n","Could you submit another pull quest and remove it in this one?\n","Thanks. \n","@ricardoquesada Could you please review it? \n","@dabingnn I added some comments.\n\nBut I didn't understand what issues this PR solves. Is it because OpenGL 2 doesn't support mipmap ?\n","@ricardoquesada I think @perminovVS means that OpenGL2 support mipmap, but it does not support generating mipmap automatically by `glGenerateMipmap`.\n","@ricardoquesada review now.\nglGenerateMipmap support OpenGL 3.0 or greater\nOpenGL 1 and 2 support GL_GENERATE_MIPMAP, but set it before glTexImage2D\n","ok. In order to make my life easier, could you tell what this patch is doing for cocos2d-x ?\nAre you fixing a bug ? If so, what is the best way to reproduce it?\nAre you adding a new feature? If so, what is the best way to test it ?\n\nAdding a description like the following will help:\n\" cocos2d-x is doing XXX, but is incorrect because if it is run on YYY the it won't have the expected result because it should do ZZZ instead.\"\n\nSorry to ask you this, but I understood what the OpenGL spec is saying, but I just don't understand how it is applicable in cocos2d-x.\nThanks!\n","@ricardoquesada yes, it fixing a bug\nIf run app in OpenGL version less 3.0 and call glGenerateMipmap, on some device, as a result black texture.\n","@minggo @ricardoquesada update pr for easy merge ?\n","@perminovVS could you please tell me which devices have the problem, i want to reproduce it issue. After confirm it and you fix the conflict, i will merge this PR.\n","@minggo This is a problem on a PC version OpenGL below 3.0.\n","Got it. I think it is not common that PC with OpenGL below 3.0. And cocos2d-x focus on mobile platform, so i don't want to merge the PR.\n","@minggo if i change it as optionaly ? Support old and new version ?\nIt problem only in 3d mode.\n","how did you make it as optional?\n"],"labels":["type:bug"]},{"title":"js bindings android Segmentation Fault Facebook Plugin","body":"This is the call from js code:\n\nplugin.FacebookAgent.getInstance().api(\"\/me\/apprequests\", plugin.FacebookAgent.HttpMethod.GET, function (code, response) {cc.log(JSON.stringify(response))}):\n\nIt crashes only in android and not in ios. In order to reproduce it do 3-5 subsequent .api calls.\nI'm using cocos2d-js 3.10 with NDK r10c.\n\nHere is the call stack for the seg fault:\n\n`js::jit::AutoFlushICache::AutoFlushICache() at 0x9fa91050  \njs::jit::BaselineCompiler::compile() at 0x9fa1d484  \njs::jit::BaselineCompile() at 0x9fa53014    \njs::jit::CanEnterBaselineMethod() at 0x9fa53224 \njs::RunScript() at 0x9fce23c8   \njs::Invoke() at 0x9fce258c  \njs::Invoke() at 0x9fce2fc0  \nJS_CallFunctionValue() at 0x9fbb5f98    \npluginx::JSFunctionWrapper::invoke() at jsb_pluginx_basic_conversions.cpp:81 0x9f86fc84 \n__lambda14::operator() at jsb_pluginx_manual_callback.cpp:952 0x9f87dc10    \nstd::_Function_handler<void(int, std::basic_string<char, std::char_traits<char>, std::allocator<char> >&), js_pluginx_FacebookAgent_api(JSContext*, uint32_t, jsval*)::__lambda14>::_M_invoke at functional:2,071 0x9f88259c    \nstd::function<void (int, std::string&)>::operator()(int, std::string&) const at functional:2,471 0x9f8cca5c \ncocos2d::plugin::Java_org_cocos2dx_plugin_UserFacebook_nativeRequestCallback() at FacebookAgent.cpp:43 0x9f8d0344   \n0xa1ec05c8  \n`\n","comments":["I also meet it, I feel cocos2d-js very unstable."],"labels":["script:jsb"]},{"title":"js_cocos2dx_Node_removeFromParentAndCleanup : wrong number of arguments","body":"Please help on this jsb bug.\nThis code \n\n```\ncb_close: function()\n    {\n        this.fadeexit();\n        this.runAction( cc.sequence(\n            cc.delayTime( 0.5 ),\n            cc.callFunc( this.removeFromParent.bind(this, true), this )) );\n    },\n```\n\nreturn an error message\njs_cocos2dx_Node_removeFromParentAndCleanup : wrong number of arguments\n","comments":["callFunc passes additional `sender` argument to removeFromParent function.\nUse cc.removeSelf() instead\n"],"labels":["script:jsb"]},{"title":"Use ClippingNode cut Scale9Sprite will crash","body":"in Scale9Sprite \"CC_SAFE_DELETE_ARRAY(_sliceIndices);\" crash\n","comments":["@sianzain \nCould you show me your test code? thanks.\n"],"labels":["type:bug"]},{"title":"a bug in LuaBasicConversions.cpp","body":"cocos2dx3.9\nin function luaval_to_mesh_vertex_attrib\nthe operation of \"vertexAttrib\" has a bug\nshould be \nret->vertexAttrib = (GLint)lua_tonumber(L,-1)\nbut the init code is\nret->type = (GLenum)lua_tonumber(L,-1)\n","comments":[],"labels":["script:lua"]},{"title":"DepthTest breaks on windowResize","body":"Tested on cocos 3.8 & 3.10, code in JS. Set `cc.director.setDepthTest(true)` works fine until the browser window gets resized or mobile orientation changes. \nWorkaround -> get window resize event and  set `cc.director.setDepthTest(true)` again, I don't think this is how it should work. \n","comments":["I can second this happening with Windows 10 builds too. \n"],"labels":["platform:web"]},{"title":"cc.textureCache.addImage() uses the wrong loader for images ","body":"In the function cc.textureCache.addImage() there is the code\n`var loadFunc = cc.loader._checkIsImageURL(url) ? cc.loader.load : cc.loader.loadImg;`\nIt checks if the url refers to an image and if it does it calls cc.loader.load. Seems like cc.loader.load and cc.loader.loadImg should be reversed.\n","comments":[],"labels":["script:jsb","platform:web"]},{"title":"cc.loader.loadImg() caches an empty image","body":"With no option specified, the function assumes a cross origin image. If that request fails, then it retries the request assuming that the image is not cross origin. The problem is it already returned the empty image to the calling routine (cc._imgLoader.load()) which caches it using the url. When the loadImg() succeeds the second time around,  loadImg() caches the newly loaded image as well but using the realUrl (which appears to be a fully qualified url) instead of the url so the image was loaded but not cached in such a way that it can be accessed. Everything seems to access it through the url which is now an empty image and all of the images disappear.\n","comments":[],"labels":["platform:web"]},{"title":"fixed screen flicker when playing video on android","body":"","comments":["@WenhaiLin \nplease take a look.\n"],"labels":["platform:android"]},{"title":"cc.PhysicsShapePolygon:create always return nil in lua","body":"I found the following functions always return nil in lua\ncc.PhysicsShapePolygon:create\ncc.PhysicsShapeCircle:create\nbut the following function is ok with the same args\ncc.PhysicsBody:createPolygon\ncc.PhysicsBody:createCircle\n\nI donot know why these happen.\n","comments":["@JimmyYouyy Could you paste some test code to reproduce the issue?\n","`local body = cc.PhysicsBody:createPolygon({cc.p(0,0), cc.p(0,50), cc.p(50,50), cc.p(50,0)}, 4)`return nil"],"labels":["script:lua"]},{"title":"ui::EditBox Android background\/foreground issue.","body":"I realized that after going to background in Android and coming back to foreground, EditBox doesn't show any characters previously entered but keeps them somehow. And it is not touchable.\n","comments":["@hgokturk \nWhat's the version of your cocos2d-x?\n\nCould I reproduce this issue 100%?\n","It happens both for 3.8 & 3.10. I'm sure it is reproducable. I can share editbox initialization codes and my appdelegate or anything else if needed.\n","@hgokturk \nplease show me the code...\n","AppDelegate.h\n\n```\nvoid AppDelegate::applicationDidEnterBackground() {\n    Director::getInstance()->stopAnimation();\n}\n\nvoid AppDelegate::applicationWillEnterForeground() {\n    Director::getInstance()->startAnimation();\n}\n```\n\nLoginRegisterScene.h\n\n```\n#pragma once\n\n#include \"cocos2d.h\"\n#include \"ui\/CocosGUI.h\"\n#include \"extensions\/cocos-ext.h\"\n\nclass LoginRegisterScene : public cocos2d::Layer, public cocos2d::extension::EditBoxDelegate\n{\npublic:\n    static cocos2d::Scene* createScene();\n\n    virtual bool init();\n\n    CREATE_FUNC(LoginRegisterScene);\n\n    void Login(cocos2d::Ref *sender);\n\n    virtual void editBoxEditingDidBegin(cocos2d::ui::EditBox* editBox);\n    virtual void editBoxEditingDidEnd(cocos2d::ui::EditBox* editBox);\n    virtual void editBoxTextChanged(cocos2d::ui::EditBox* editBox, const std::string& text);\n    virtual void editBoxReturn(cocos2d::ui::EditBox* editBox);\nprivate:\n    ...............................\n    cocos2d::ui::EditBox* username;\n    cocos2d::ui::EditBox* email;\n    cocos2d::ui::EditBox* password;\n    ...............................\n};\n```\n\nSample init in LoginRegisterScene.cpp\n\n```\nthis->username = ui::EditBox::create(Size(320 \/ Director::getInstance()->getContentScaleFactor(), 70 \/ Director::getInstance()->getContentScaleFactor()), ui::Scale9Sprite::create(pNormalSprite));\n\/\/this->username->setPosition(Vec2(visibleSize.width * 66 \/ 100 + origin.x, visibleSize.height * 63 \/ 100 + origin.y));\nthis->username->setPosition(Vec2(bgSprite->getContentSize().width * 66 \/ 100, bgSprite->getContentSize().height * 63 \/ 100));\nthis->username->setFontName(\"AmericanTypewriter\");\nthis->username->setFontSize(13);\nthis->username->setFontColor(Color3B::BLACK);\n\/\/username->setPlaceHolder(\"Kullan\u00c3\u201e\u00c2\u00b1c\u00c3\u201e\u00c2\u00b1 Ad\u00c3\u201e\u00c2\u00b1:\");\nthis->username->setPlaceholderFontColor(Color3B::WHITE);\nthis->username->setInputFlag(ui::EditBox::InputFlag::INITIAL_CAPS_WORD);\nthis->username->setInputMode(ui::EditBox::InputMode::SINGLE_LINE);\nthis->username->setMaxLength(15);\nthis->username->setReturnType(ui::EditBox::KeyboardReturnType::DONE);\nthis->username->setDelegate(this);\nthis->username->setTag(50);\nbgSprite->addChild(this->username, 5);\n```\n\nAnd the listeners in LoginRegisterScene.cpp\n\n```\nvoid LoginRegisterScene::editBoxEditingDidBegin(ui::EditBox* editBox)\n{\n    log(\"editBox %p DidBegin !\", editBox);\n}\n\nvoid LoginRegisterScene::editBoxEditingDidEnd(ui::EditBox* editBox)\n{\n    log(\"editBox %p DidEnd !\", editBox);\n}\n\nvoid LoginRegisterScene::editBoxTextChanged(ui::EditBox* editBox, const std::string& text)\n{\n    switch(editBox->getTag()){\n    case 50:\n        this->txtUsername = text.c_str();\n        log(\"username: %s\", this->txtUsername.c_str());\n        break;\n    case 100:\n        this->txtPassword = text.c_str();\n        log(\"password: %s\", this->txtPassword.c_str());\n        break;\n    case 150:\n        this->txtEmail = text.c_str();\n        log(\"email: %s\", this->txtEmail.c_str());\n        break;\n    }\n}\n\nvoid LoginRegisterScene::editBoxReturn(ui::EditBox* editBox)\n{\n    log(\"editBox %p was returned !\",editBox);\n}\n```\n","I wonder if it's about using #parma once instead #ifndef\n","@hgokturk \nCould you make a minimal demo project and send it to me?\nThanks.\n","any fix for this found, it seems like, I am also facing the same issue.\nbut for me it happens in iOS as well. in v3.9\n","@pabitrapadhy\nCould I reproduce this issue with cpp-tests? thanks\n"],"labels":["type:bug","platform:android"]},{"title":"[BUG] ccui.EditBox - Black Label When Editing Finished","body":"![7](https:\/\/cloud.githubusercontent.com\/assets\/5449223\/12601879\/be99f576-c4df-11e5-8255-6b8f2a61e229.png)\nVersion: cocos2d-x-3.7\nPlatform: android\nDevices: Nexus 5, Huawei Nexus 6P\nIssue: When editing finish (after enter clicked), label turns to black block. Sometimes, crashed directly.\n\nAfter checking logcat, found that editBoxCallbackFunc (in file UIEditBoxImpl-android.cpp) used to refresh the text of the EditBox were invoked in different thread, neither in GL thread nor in UI thread when editing finished occasionally.\n\nhttp:\/\/discuss.cocos2d-x.org\/t\/bug-ccui-editbox-black-label-when-editing-finished\/26520\n","comments":["``` java\n                            mCocos2dxActivity.runOnGLThread(new Runnable() {\n                                @Override\n                                public void run() {\n                                    Cocos2dxEditBoxHelper.__editBoxEditingDidEnd(index, editBox.getText().toString());\n                                }\n                            });\n\n```\n\nIt's called in GL thread.\n","@zilongshanren \nYes. In this code, it should be called at GL thread. But, actually, sometimes it was not called at GL thread, tid not the same, the label turns black:\n\nLog below:\n\n![image](https:\/\/cloud.githubusercontent.com\/assets\/5449223\/12634097\/a30a3758-c5b1-11e5-846f-9a1d06010b45.png)\n\nGL thread, tid 1282\neditBoxCallbackFunc called tid 1278\n","@xiaoxiangzi \nI will investigate this issue later.  Try to use the latest v3.10 and test it in your device, thanks.\n","@xiaoxiangzi \nWired,  thanks.\n","@zilongshanren \nYou're welcome.\n","@xiaoxiangzi \nI have tested the latest v3.10 on Nexus 5 but it works great, no crash...\nplease recheck your code logic or you could send your code to me.\n\nthanks.\n","I encountered the same problem on Red Mi 2, I use Cocos2d v3.60\n","I have watched cocos2d v3.10, and what's the mean of `Set the font. Only system font is allowed.`\n"],"labels":["type:bug"]},{"title":"Android keyboard appears when returning from background after scene with web view is removed","body":"See forum post at http:\/\/discuss.cocos2d-x.org\/t\/keyboard-occasionally-appearing-after-using-web-view-on-android\/26476\/1\n","comments":["Thanks, I will take time to reproduce this issue and fix it soon.\n","Does this mean that it is NOT going to be fixed in 3.11?  This bug should be easy to fix, right?\n","FYI, I am not getting this issue when using https:\/\/www.assetstore.unity3d.com\/en\/#!\/content\/31086 in Unity, nor was I getting it when using Gree's Webview for Cocos 3.2, so it's not an Android problem.\n","I just tested 3.11 using NDK r10e and this is still broken on my 4 test devices running Android 5.x or older.  The Nexus 6P running Android 6.0 did not exhibit this issue.\n","I have the same issue on Xperia T.\n","@crazyhappygame  @hawkwood  I will try to reproduce this issue and fix it.\n"],"labels":["type:bug","platform:android"]},{"title":"cc.LoaderScene.preload does not realy load resources.","body":"cc.LoaderScene.preload does not realy load resources.\nand after you called\ncc.LoaderScene.preload(g_resources, function () {\n        cc.director.runScene(new HelloWorldScene());\n    }, this);\nyou still can not get resource from cc.loader.gerRes(\"xxx\")\n","comments":[],"labels":["type:bug","script:jsb"]},{"title":"ipad\u4e0a\u62c6\u5206\u3001\u5408\u5e76\u952e\u76d8\u51fa\u73b0\u7684bug","body":"CCEditBox\u70b9\u51fb\u540e\uff0c\u6253\u5f00\u4e86\u952e\u76d8\uff0c\u6b63\u5e38\u8f93\u5165\u6ca1\u6709\u95ee\u9898\uff0c\u5728ipad\u4e0a\u505a\u952e\u76d8\u62c6\u5206\uff0c\u5408\u5e76\u64cd\u4f5c\uff0c\u4e0d\u80fd\u987a\u5229\u8fdb\u884c\uff0c\u6709\u65f6\u5019\u80fd\u62c6\u5f00\uff0c\u6709\u65f6\u5019\u952e\u76d8\u4f1a\u5361\u4f4f\u3002\u952e\u76d8\u5982\u679c\u80fd\u6b63\u5e38\u62c6\u5206\u5f00\u540e\uff0c\u4e4b\u524d\u4e0a\u79fb\u7684\u6e38\u620f\u753b\u9762\u5076\u5c14\u4e0d\u80fd\u6062\u590d\uff0c\u5373\u4f7f\u662f\u8f93\u5165\u7ed3\u675f\uff0c\u6e38\u620f\u753b\u9762\u8fd8\u662f\u4fdd\u6301\u4e4b\u524d\u4e0a\u79fb\u7684\u4f4d\u7f6e\u3002\n\n\u4ea7\u54c1\u7248\u672c\uff1acocos2dx3.9\n\u5f00\u53d1\u8bed\u8a00\uff1alua\n\u64cd\u4f5c\u7cfb\u7edf\uff1aMac OS X, 10.10\n\u8fd0\u884c\u5e73\u53f0\uff1aiOS\n\n@xiaofeng11 \n","comments":["@zilongshanren Please take a look on this issue\n","@1078559858 \nThanks for reporting\n"],"labels":["platform:ios"]},{"title":"Analyzing directory exists function for mac & ios","body":"The 'isDirectoryExist(const std::string& dirPath)' function has some problems that can not return the correct result in iOS and mac when analyzing the bundle directory.\nAlso,it may not work in win32 and android for the same reason.\nI fixed it for iOS and mac, continue seeking solution for android and win32.\n","comments":["@zilongshanren Please review this PR.\n","@ookcode How can i reproduce the issue of current implementation?\n","Dear Vincent Yao(ookcode),\r\nWe are working on identifying redundant development and duplicated pull requests. We have found there is a pull request: https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/13687 which might be similar or duplicate to this one. We would really appreciate if you could help us to validate and give us feedback.\r\nThank you very much for your time!","@FancyCoder0 \r\n\r\ndid you find __redundant development and duplicated pull requests__ by some automated algorithm? that's cool and it will save much time."],"labels":["platform:ios","platform:mac"]},{"title":"[BUG] Screen flash under android's default brower.","body":"Cocos v3.9 release.   Web h5 version.\nAndroid version: 4.4\n\nScreen flash, one frame is normal, the next is black.\n\nHere's a simple demo can reproduce this situation.\nhttp:\/\/pan.baidu.com\/s\/1i4cRkbV \npassword: eakh\n","comments":["@chengstory This is a important issue for the web engine, can you take a look ?\n","PS. It works fine in cocos2d-x v3.8\n"],"labels":["type:bug","critical","platform:web"]},{"title":"videoplayer crash on iOS 9.2","body":"![image](https:\/\/cloud.githubusercontent.com\/assets\/785541\/12168031\/b3bd0fb4-b56a-11e5-8289-a773f7a6e051.png)\n\nThis solution is in the above code snippet.\n","comments":["Marked!\n"],"labels":["platform:ios"]},{"title":"Shader setUniform not working with JSBinding","body":"I made this simple app to test shaders setUniform.\nI'm working with cocos2d-js 3.9, the problem happens when compiling the native version of iOS.\n\nThe javascript code is the following:\n\n``` javascript\nvar sp = new cc.Sprite(img);\nshader = new cc.GLProgram();\nshader.retain();\nshader.init(res.colored_vsh, res.colored_fsh);\nshader.addAttribute(cc.ATTRIBUTE_NAME_POSITION, cc.VERTEX_ATTRIB_POSITION);\nshader.addAttribute(cc.ATTRIBUTE_NAME_COLOR, cc.VERTEX_ATTRIB_COLOR);\nshader.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD, cc.VERTEX_ATTRIB_TEX_COORDS);\nshader.link();\nshader.updateUniforms();\nsp.setShaderProgram(shader);\nshader.use();\nvar color_mult_loc = shader.getUniformLocationForName('color_m');\nshader.setUniformLocationWith1f(color_mult_loc, 1);\n```\n\nThe problem is with the uniform `color_m` in the fragment shader, the code is:\n\n```\nprecision lowp float;\nvarying vec4 v_fragmentColor; \nvarying vec2 v_texCoord; \nuniform float color_m;\n\nvoid main() \n{ \n    vec4 v_orColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord);\n\n    gl_FragColor = vec4(v_orColor.r * color_m, v_orColor.g, v_orColor.b, v_orColor.a);\n}\n```\n\nwhich in browser shows:\n\n![screen shot 2015-12-28 at 11 05 00 am](https:\/\/cloud.githubusercontent.com\/assets\/1079323\/12090998\/607bba98-b2d2-11e5-9a56-b1d591435120.png)\n\nbut in iOS shows:\n\n![img_0037](https:\/\/cloud.githubusercontent.com\/assets\/1079323\/12091005\/71e32050-b2d2-11e5-88cf-5e064581934a.PNG)\n\nas you can see, in browser the value of the uniform `color_m` is `1`, which is fine because of the line `shader.setUniformLocationWith1f(color_mult_loc, 1);`, but in iOS is `0`. You can see in the second image how the red channel is mutiplied by `0`.\n\nI'm having the same problem in Android.\n","comments":["@FernandoB i think you should use `GLProgramState` to set your own defined uniforms. Or you should set it before it is adding to Sprite. After program is added into Sprite, all uniforms are controlled by `GLProgramState`.\n\nMy be use the codes like:\n\n``` js\nvar sp = new cc.Sprite(img);\nshader = new cc.GLProgram();\nshader.retain();\nshader.init(res.colored_vsh, res.colored_fsh);\nshader.addAttribute(cc.ATTRIBUTE_NAME_POSITION, cc.VERTEX_ATTRIB_POSITION);\nshader.addAttribute(cc.ATTRIBUTE_NAME_COLOR, cc.VERTEX_ATTRIB_COLOR);\nshader.addAttribute(cc.ATTRIBUTE_NAME_TEX_COORD, cc.VERTEX_ATTRIB_TEX_COORDS);\nshader.link();\nshader.updateUniforms();\nsp.setShaderProgram(shader);\nshader.use();\n\/\/ set uniform like this\nsp.getGLProgramState().setUniformInt('color_m', 1);\n```\n"],"labels":["script:jsb"]},{"title":"EditBox cursor location not update","body":"The size is 100, 30 and the maxlength is 300, if the width of text beyond the 100, the cursor should update the the text end, but the cursor does not move to end.\n\nlocal editbox_chat = ccui.EditBox:create(cc.size(100, 30), \"Images\/arrowsBar.png\", 0)\neditbox_chat:setReturnType(cc.KEYBOARD_RETURNTYPE_DONE)\neditbox_chat:setPlaceHolder(\"\u8bf7\u8f93\u5165\u804a\u5929\u5185\u5bb9\")\neditbox_chat:setFontColor(cc.c3b(122, 117, 107))\neditbox_chat:setMaxLength(300)\neditbox_chat:setFontSize(25)\neditbox_chat:setPlaceholderFontSize(25)\neditbox_chat:setInputMode(cc.EDITBOX_INPUT_MODE_EMAILADDR)\neditbox_chat:setAnchorPoint(cc.p(0, 0))\neditbox_chat:setPosition(100, 100)\nlayer:addChild(editbox_chat)\n![ios simulator screen shot 2015 12 22 12 05 40](https:\/\/cloud.githubusercontent.com\/assets\/3081704\/11947661\/53c36544-a8a5-11e5-97ef-4882c854f6c5.png)\n","comments":[],"labels":["type:bug","platform:ios"]},{"title":"getDeviceUID() in Device class","body":"","comments":["Thanks, the PR has merge conflicts now, could you please fix it?\n","updated\n","@zilongshanren added win32 version\n","@newnon  :+1:  thanks, I will review this PR later.\n","Bump, could also look at using a cross-platform uuid code instead.\n"],"labels":["platform:win32"]},{"title":"BUG of UIEditBoxImpl-mac, should consider glview scale.","body":"if we change the glview size at the runtime.\nsuch as using the cocos player. please fix this :)\n\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/c77ea57fb13bf7d889582244e865fa38bf854fbc\/cocos\/ui\/UIEditBox\/UIEditBoxImpl-mac.mm#L563\n\nthe right way\n\n``` cpp\nvoid EditBoxImplMac::adjustTextFieldPosition()\n{\n    Size contentSize = _editBox->getContentSize();\n    GLView* view = Director::getInstance()->getOpenGLView();\n    Rect rect = Rect(0, 0, contentSize.width, contentSize.height);\n\n    rect = RectApplyAffineTransform(rect, _editBox->nodeToWorldTransform());\n\n    Vec2 designCoord = Vec2(rect.origin.x, rect.origin.y + rect.size.height);\n    [_sysEdit setPosition:convertDesignCoordToScreenCoord(designCoord, _inRetinaMode)];\n    NSSize newSize;\n    newSize.width = rect.size.width * view->getFrameZoomFactor();\n    newSize.height = rect.size.height * view->getFrameZoomFactor();\n    [_sysEdit setContentSize: newSize];\n}\n\n```\n","comments":["some update,\nwe may also need to set the fontsize if we change the openglviewsize.\n","@tangyiyang\num.. It's time to update EditBox on Mac now.\n"],"labels":["platform:mac"]},{"title":"Support localStorage and third party cookie on Cocos2dxWebView.","body":"Able to use local storage and third party cookie on Android webview.\n","comments":["[ci rebuild]\n","@glassonion1 \nIt can't pass CI, please check.\n","I fix it.\n","[ci rebuild]\n","\"cannot find symbol\" error occurred again.\nbut I was able to build without any errors in my environment.\nWhy?\n","@zilongshanren\nBug does not exist in my modified code.\nI want you to review build settings of CI.\n","[ci rebuild]\n","@glassonion1 please look at the error message\n\n```\n[javac] \/android_slave\/workspace\/ccs-pr\/node\/android\/cocos\/platform\/android\/java\/src\/org\/cocos2dx\/lib\/Cocos2dxWebView.java:66: error: cannot find symbol\n    [javac]             cookieManager.setAcceptThirdPartyCookies(this, true);\n``\n```\n","@glassonion1 could you please fix the compiling error?\n","@glassonion1 [setAcceptThirdPartyCookies](https:\/\/developer.android.com\/reference\/android\/webkit\/CookieManager.html#setAcceptThirdPartyCookies%28android.webkit.WebView, boolean%29) is added since Android API 21, and cocos2d-x supports Android 2.3.3+, so we can not add the codes. Or you should invoke it with reflection.\n","@glassonion1 any update?\n"],"labels":["platform:android"]},{"title":"ui::Checkbox inside ui::Scrollview bug","body":"\u5982\u679c\u5728ui::ScrollView\u4e2d\u653eui::CheckBox\uff0c\u70b9\u4e2dui::CheckBox\u6ed1\u52a8\u540e\uff0c\u4f1a\u6ed1\u52a8ScrollView\uff0c\u800c\u677e\u624b\u540e\u4f9d\u7136\u4f1a\u51fa\u53d1ui::CheckBox\u4e8b\u4ef6\u3002\n3.2\u4e0a\u6ca1\u6709\u8fd9\u4e2a\u95ee\u9898\uff0c3.2\u548c3.8\u7684ui::Button\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u79cd\u95ee\u9898\u3002\u67e5\u770b\u4e86\u4e0b3.8\u7684\u6e90\u7801\uff0c\u53d1\u73b0CheckBox\u505a\u4e86\u8f83\u5927\u4fee\u6539\uff0c\u73b0\u5728\u7ee7\u627f\u81eaAbstractCheckButton\u800c\u4e0d\u662f\u76f4\u63a5\u7ee7\u627f\u81eaWidget\uff0c\u5e76\u4e14\u91cd\u5199\u4e86onTouchEnded\u8fd9\u4e2a\u51fd\u6570\uff0c\u8fd9\u6837\u70b9\u51fb\u4e8b\u4ef6\u4f3c\u4e4e\u5c31\u7ed5\u8fc7\u4e86Widget\uff0c\u76f4\u63a5\u7531CheckBox\u81ea\u8eab\u505a\u5904\u7406\uff0c\u6ca1\u6709\u50cf\u4ee5\u524d\u90a3\u6837\u505a\u662f\u5426\u201c\u6253\u65ad\u201d\u7684\u5224\u65ad\u3002\n","comments":["@JourneyHans \nThanks, I will check the issue.\n"],"labels":["type:bug"]},{"title":"v3.9 javascript EditBox shows the capital letter keyboard on iOS","body":"The editbox in extension displays the capital letter keyboard on IOS as the default.   Please fix it asap.  Thanks\n","comments":[],"labels":["type:bug","script:jsb","platform:ios"]},{"title":"When pageview's size changed, the children don't refresh size","body":"```\n        PageView* page = PageView::create();\n        page->setBackGroundColorType(Layout::BackGroundColorType::SOLID);\n        page->setBackGroundColor(ccc3(100, 100, 0));\n        page->setSize(Size(300,300));\n\n        Layout* child = Layout::create();\n        child->setBackGroundColorType(Layout::BackGroundColorType::SOLID);\n        child->setBackGroundColor(ccc3(0, 100, 100));\n        page->addChild(child);\n\n        page->forceDoLayout();\n```\n\nchild's size should be equal page's size;\n","comments":["@zilongshanren @neokim Please check this issuse, thanks.\n","@neokim  \nI think the new implementation ignore this behavior and we should improve it :frowning:  \n","Sorry, I didn't know the requirement. No problem for modifying it as requested.\n\nBut I wonder, is it mandatory that child's size must be equal to the page's size? I can come up with many cases that child widget wants to have different size than page's size. One implementation of page scroll UI component I wrote before allows various size for children, which allows more options for SDK users using the component.\n"],"labels":["type:bug"]},{"title":"ios Info.plist\u914d\u7f6e\u6587\u4ef6\u95ee\u9898","body":"1\u30013.9\u7248\u672cios\u5de5\u7a0b\u9ed8\u8ba4\u56fe\u6807Icon-87.png  Icon-180.png  \u672a\u52a0\u5165\u3002\n2\u3001<key>CFBundleIconFiles<\/key>   <key>CFBundleIconFiles~ipad<\/key>  \u5c0f\u8282\uff0c\u90fd\u7f3a\u5c11.png\u540e\u7f00\u3002\n","comments":["@marswj  what's the error of this issue? I mean any crash or wrong effect?\n\nPS: please use english in future, then developers all over the world can discuss together. Thanks.\n"],"labels":["platform:ios"]},{"title":"LabelTTF.enableShadow arguments are inconsistent with JS API","body":"According to the [JsDocs](http:\/\/www.cocos2d-x.org\/reference\/html5-js\/V3.8\/index.html) LabelTTF.enableShadow should accept the following parameters:\n\n```\nParameters:\n{cc.Color | Number} a\n    Color or The x axis offset of the shadow\n{cc.Size | Number} b\n    Size or The y axis offset of the shadow\n{Number} c\n    The blur size of the shadow or The opacity of the shadow (0 to 1)\n{null | Number} d\n    Null or The blur size of the shadow\n```\n\nHowever, the [equivalent method in 2d-x](https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/d0c3275281d03ae319d076a30972ac5fd7512531\/cocos\/2d\/CCLabelTTF.cpp#L189) accepts:\n\n```\nLabelTTF::enableShadow(const Size &shadowOffset, float shadowOpacity, float shadowBlur, bool updateTexture)\n```\n\nFor example, this code in JS would raise an exception on native builds:\n\n``` javascript\nvar test = new cc.LabelTTF(\n    'Test', \n    'Arial', \n    32, \n    null, \n    cc.TEXT_ALIGNMENT_CENTER, \n    cc.VERTICAL_TEXT_ALIGNMENT_CENTER\n);\ntest.enableShadow(cc.color(33, 114, 255, 255), cc.size(0, 0), 15);\n```\n\n```\njs_cocos2dx_LabelTTF_enableShadow : Error processing arguments\n```\n\nFurthermore, the **blurRadius** parameter does not seem to be implemented at all: https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/d0c3275281d03ae319d076a30972ac5fd7512531\/cocos\/2d\/CCLabel.cpp#L877\n","comments":["+1\n"],"labels":["script:jsb"]},{"title":"Crash in js_cocos2dx_TextFieldTTF_textFieldWithPlaceHolder","body":"my android crashes sometimes for some of the users which i am able to see google developer console. \n\nBelow is the crash log for the entire crash which i extracted out of google break pad. The crash clearly says that in the following function\n\n> js_cocos2dx_TextFieldTTF_textFieldWithPlaceHolder\n\nbut i am not able to uderstand as to why this is happening. I am currently using cocos2dx-js v 3.5.\n\nAny help or idea as to why this crash happens or how can i prevent this crash from happening would be highly useful \n\n```\nBuild fingerprint: 'motorola\/falcon_bwaca\/falcon_umts:4.4.4\/KXB21.14-L1.50-1\/1:user\/release-keys'\npid: 30910, tid: 31705, name: Thread-6337 >>> in..test <<<\nsignal 6 (SIGABRT), code -6 (SI_TKILL), fault addr --------\nStack frame #00 pc 00022160 \/system\/lib\/libc.so (tgkill+12)\nStack frame #01 pc 000131b1 \/system\/lib\/libc.so (pthread_kill+48)\nStack frame #02 pc 000133c5 \/system\/lib\/libc.so (raise+10)\nStack frame #03 pc 000120fb \/system\/lib\/libc.so\nStack frame #04 pc 00021a14 \/system\/lib\/libc.so (abort+4)\nStack frame #05 pc 00c41251 libcocos2djs.so (__gnu_cxx::__verbose_terminate_handler()+228): Routine js_cocos2dx_TextFieldTTF_textFieldWithPlaceHolder(JSContext*, unsigned int, JS::Value*) at jsb_cocos2dx_auto.cpp:60716\n```\n","comments":[],"labels":["script:jsb","platform:android"]},{"title":"RichText being affected by syntax errors on unrelated lines","body":"Using the following Sonar Systems tutorial source:\nhttps:\/\/github.com\/SonarSystems\/Cocos2d-JS-v3-Tutorial-78---UIRichText\n\nAfter compiling and and running on an Android device (Fire HD 7) running the latest firmware I am unable to see any RichText elements. I'm using the latest version of Cocos2D (3.9), latest JDK, latest Android SDK, ANT 1.9.4, and NDK r10c.\n\n**Edit:**\nIt appears the syntax used to instantiate the Sprite is keeping RichText from being processed correctly. When changing from \"new cc.Sprite.create()\" to \"new cc.Sprite()\" the RichText is properly handled. These two elements are completely unrelated and an error in the syntax of one should not affect the other.\n","comments":[],"labels":["script:jsb","platform:android"]},{"title":"Touch bug on Mac","body":"I'm using v3.6 but think this one is unlikely to have been fixed in later versions of Cocos2d-x.\n\nThe wrong position is passed to onTouchBegan( cocos2d::Touch *touch, cocos2d::Event *event ).\nThis only seems to happen on the Mac (not tried win32 though).\n\nSteps to reproduce:\n- Start your application\n- DO NOT move your mouse cursor\n- Click using the mouse\n\nThe call to your onTouchBegan( cocos2d::Touch *touch, cocos2d::Event *event ) gives the wrong position.\n\nAll is fine if you move the mouse before clicking.\n","comments":[],"labels":["platform:mac"]},{"title":"Please add clone function on cc.Node ","body":"Please add clone function on cc.Node and other subclass.\n","comments":[],"labels":["type:request"]},{"title":"Ignore collision between 3D rigid bodies","body":"ref to http:\/\/discuss.cocos2d-x.org\/t\/3d-physics-used-in-cocos2dx-3-7rc\/23200\n","comments":[],"labels":["type:request"]},{"title":"iOS contextual prediction not work with TextField.","body":"iOS [contextual prediction](http:\/\/www.imore.com\/quicktype-keyboards-ios-8-explained) not work with TextField:\n\n![image](https:\/\/cloud.githubusercontent.com\/assets\/20248\/11274704\/071199ea-8f15-11e5-833a-faf23893bada.png)\n## Steps\n1. in iOS 8 or above, focus on a TextField to make keyboard shown\n2. switch to English (US) keyboard, by tap the globe icon\n3. tap globe icon (again) and hold and make sure Predictive is ON (see above prcture).\n4. try tap some letters: eg tap `hell` the `hell` get input into TextField immediately (as in picture below marked as **1** ).\n5. at same time, the contextual prediction shows, tap the `he'll` (as marked as **2** below) and nothing happened to TextField and the contextual prediction not consumed.\n## Expected Result\n\nTextField replace the `hell` with `he'll` and contextual prediction shows new items.\n## Actually Result\n\nTextFeild not responded to contextual prediction.\n\n![image](https:\/\/cloud.githubusercontent.com\/assets\/20248\/11275479\/c179794e-8f18-11e5-86d0-edca85579ce7.png)\n## PS\n\nI tested on Android 5.1.1 there is no issue with IME contextual prediction.\n","comments":["@zilongshanren \n\nAny ideas?\nSorry I'm here again to ask you for suggestions.\n","current workaround (or solution) is:\n\nAdd follow property to `CCEAGLView`.\n\n``` objective-c\n@property(nonatomic) UITextAutocorrectionType autocorrectionType;\n```\n\nand set its value to `UITextAutocorrectionTypeNo` in `- (id) initWithFrame: pixelFormat: depthFormat: preserveBackbuffer: sharegroup: multiSampling: numberOfSamples:`.\n\n@zilongshanren shall we accept this as a solution?\n","@xpol \nDo we really need auto correction? I think it's better to discuss with other developers.\nYour solution looks good to me, but I'm not sure whether it is acceptable now.\n","@zilongshanren \nYes, this is just a workaround, and its good enough for me.\nSolution is to implements all requires UIKeyInput\/UITextInput interface in  `CCEAGLView`.\nBut Its beyond my experience, I'm not an iOS developer.\n","I would think as long as the default is to have autocorrect turned off then it would be fine to support it and allow the developer to enable it.\n"],"labels":["platform:ios"]},{"title":"Add windowActionModeOverlay style to main activity and fixes #14401.","body":"Finally the solution is set `windowActionModeOverlay` to be `true`.\n","comments":["@xpol \n:+1: \nSorry for the late reply, I will test this PR later.\n\nI'm very busy with cocos creator these day, sorry for this.\n"],"labels":["platform:android"]},{"title":"UIEditBox not aligned when the text been selected.","body":"As the follow picture shows, before select (left), it works fine.\nThen I select the text, the  \"select cut copy paste\" toolbar shows, and it pushed the UIEditBox down (right).\n\n![uieditbox](https:\/\/cloud.githubusercontent.com\/assets\/20248\/11183525\/2b5f7b7e-8cad-11e5-81fa-4200185dad3e.png)\n\nI have tested under Android 5.1.1 (Mi note with original Android 5.1.1 ROM.)\n","comments":["@xpol  \nThis is a bug related to ROM. I have no idea how to resolve it.\n","@zilongshanren But why other apps works well? And this bug also show on my friend's Android phone. \n\nI think it should not be the ROM's bug.\n![screenshot_2015-11-16-22-37-49](https:\/\/cloud.githubusercontent.com\/assets\/20248\/11184526\/3036c002-8cb3-11e5-9a03-ea12a8abe2b4.png)\n","@xpol  Try to position your EditBox lower near the bottom of your screen and see what happens.\n","@xpol \nAny updates? I suggest you to try other Android devices and to see whether it is still a issue or not.\n\nSince the Android ecosystem has a  high degree of market fragmentation, so it's very hard to keep the behaviors the same on all the platforms, especially on some OS makers in China.\n","I have also tested under Huawei G601, same issue, so I can say (as in original Google Android ROM 5.1.1 and custom Huawei ROM 4.2.1 all have this issue) it is not a bug related to ROM.\n\nI currently my workaround is disable action bar for UIEditBox.\n\nin `frameworks\/cocos2d-x\/cocos\/platform\/android\/java\/src\/org\/cocos2dx\/lib\/Cocos2dxEditBox.java`:\n\n``` java\n    public  Cocos2dxEditBox(Context context){\n        super(context);\n        this.setCustomSelectionActionModeCallback(new ActionMode.Callback() {\n\n            public boolean onPrepareActionMode(ActionMode mode, Menu menu) {\n                return false;\n            }\n\n            public void onDestroyActionMode(ActionMode mode) {\n            }\n\n            public boolean onCreateActionMode(ActionMode mode, Menu menu) {\n                return false;\n            }\n\n            public boolean onActionItemClicked(ActionMode mode,  MenuItem item) {\n                return false;\n            }\n        });\n    }\n```\n\nI'm not android developer, but I think we should do something in onCreateActionMode() callback.\n\nI have asked [a question in Stackoverflow](http:\/\/stackoverflow.com\/questions\/33739117\/android-edittext-pushed-down-by-action-bar), no body answered yet.\n","Thanks, @xpol \nDoes this patch works well for others Android devices and different OS verions?\nIf so, I will merge your code.\n","@zilongshanren This is just a workaround, I want to fixes the problem.\nI'm sure someone must wan't the action bar to be shown.\n","@xpol \nUm.. I will do some research.\n","@zilongshanren \nTested and worked the answer is `windowActionModeOverlay` see #14438.\n"],"labels":["platform:android"]},{"title":"[WEB] iOS UIWebView (WeChat) back from background will crash app","body":"1. In Wechat, open a page with Cocos2d-JS webgl render mode\n2. share during game process\n3. crash can be reproduced frequently while returning back to game from sharing view\n\nTencent provided a crash log\n\n![wechat_1447661792](https:\/\/cloud.githubusercontent.com\/assets\/632460\/11178526\/5bfe4f78-8c88-11e5-880b-bfe7e1764022.png)\n\nBasically, it can be reproduced in any app with UIWebView and a webgl page.\n\nTo fix this issue, we'd better find out a walk around to avoid the issue, the original issue in UIWebView can't be fixed in the web engine\n","comments":[],"labels":["type:bug","platform:web","platform:ios"]},{"title":"MenuItemFont not working in Android: v3.8.1","body":"I am working with Cocos2dx-js version 3.8.1\n\nThe MenuItemFont and MenuItemImage click functions are not invoked, but MenuItemToggle is working.\n\nThis issue happens only in Android. In web, it all works perfectly fine.\n\n```\nctor                        :   function () {\n\n[some code goes here]\n\ncc.MenuItemFont.setFontName(Config.fontName);\ncc.MenuItemFont.setFontSize(fontSize);\n\nvar playAIMenuItem      =   cc.MenuItemFont.create('vs System', this.playAITapped, this);\nplayAIMenuItem.setPosition(cc.p(size.width * 0.5, size.height * (startY - diffY * 0)));\n\nvar musicOnMenuItem     =   cc.MenuItemImage.create(res.musicOn);\nvar musicOffMenuItem    =   cc.MenuItemImage.create(res.musicOff);\nvar musicMenuItem       =   cc.MenuItemToggle.create(musicOnMenuItem, musicOffMenuItem, this.toggleMusicTapped, this);\nmusicMenuItem.setPosition(cc.p(size.width - size.width * 0.12, size.height - size.height * 0.08));\nmusicMenuItem.setScale(iconScale);\n\nvar facebookMenuItem    =   cc.MenuItemImage.create(res.facebookIcon, null, null, this.facebookTapped, this);\nfacebookMenuItem.setPosition(cc.p(size.width - size.width * 0.25, size.height - size.height * 0.08));\nfacebookMenuItem.setScale(iconScale);\n\nthis.menu               =   cc.Menu.create(playAIMenuItem, musicMenuItem, facebookMenuItem);\nthis.menu.setPosition(cc.p(0, 0));\nthis.addChild(this.menu);\n},\n\nplayAITapped                :   function() {\n    console.log('Play AI Tapped'); \/\/This is not happening\n},\n\ntoggleMusicTapped      :   function() {\n    console.log('Toggle Music Tapped'); \/\/ This is working\n},\n\nfacebookTapped          :   function() {\n    console.log('Facebook Tapped'); \/\/This is not happening\n}\n```\n\nForum Link: http:\/\/discuss.cocos2d-x.org\/t\/menuitemfont-not-working-in-android-v3-8-1\/24923\n","comments":[],"labels":["script:jsb","platform:android"]},{"title":"cocos command  no clean android ndk build","body":"cocos command  no clean android ndk build.\n","comments":["Yep, i think it is needed.\n"],"labels":["type:request"]},{"title":"EditBox  \u5728UC\u6d4f\u89c8\u5668\u4e0a\u65e0\u6cd5\u8f93\u5165\u6570\u5b57\u7684\u4e00\u4e2a\u95ee\u9898","body":"EditBox \u6211\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u9047\u5230\u4e00\u4e2a\u95ee\u9898\uff0c \u5728UC\u6d4f\u89c8\u5668\u4e0a\uff0c\u5982\u679c\u6dfb\u52a0\u4e86\u4e8b\u4ef6\u76d1\u542c\uff0c\u5219\u5728\u4e0a\u9762\u65e0\u6cd5\u8f93\u5165\u6570\u5b57\u3002\u5982\u679c\u6ca1\u6dfb\u52a0\u4e8b\u4ef6\u76d1\u542c\uff0c\u5219\u53ef\u4ee5\u8f93\u5165\u6570\u5b57\u3002\n","comments":["@zeamais \nDo you mean the H5 version of EditBox?\n","@zilongshanren \n\u662f\u7684\uff0ccocos2d-js3.61\n","@VisualSJ please take a look.\n","\u540c\u95ee\uff0c\u6211\u7684\u8868\u73b0\u662f\u5b57\u6bcd\u53ca\u6570\u5b57\u5747\u4e0d\u53ef\u8f93\u5165\u3002\u5b89\u5353\u7248uc\u6d4f\u89c8\u5668 UCBrowser\/10.9.0.703\uff0cios\u7684uc\u6d4b\u8bd5\u6b63\u5e38\n"],"labels":["platform:web"]},{"title":"[js_bindings] Not received userData in JS from cpp CustomEvent (v3.6-3.8)","body":"Dispatch event from cpp:\n\n``` cpp\n    EventCustom event(\"SOME_EVENT_NAME\");\n    char* userData =new char[256];\n    sprintf(userData, \"%s\",(\"some string\").c_str());\n    event.setUserData(userData);\n    Director::getInstance()->getEventDispatcher()->dispatchEvent(&event);\n```\n\nListen event in JS:\n\n``` javascript\nfunction handler(_event) {\n    cc.log('----- ' + _event.getUserData());\n}\n\nvar listener = cc.EventListener.create({\n    event: cc.EventListener.CUSTOM,\n    eventName: 'SOME_EVENT_NAME',\n    callback: handler\n});\n\ncc.eventManager.addListener(listener, 1);\n```\n\n_event.getUserData() returns undefined.\nAnd in jsb_cocos2dx_auto.cpp not declared js_cocos2dx_EventCustom_getUserData, maybe need to add?\n","comments":[],"labels":["script:jsb"]},{"title":"UIRichText word wrapping cuts words instead of spaces","body":"For example, the string:\n\n```\nRestores 5,000 HP to all targets every 3 turns.\n```\n\nwill be wrapped like this, given the width is small enough:\n\n```\nRestores 5,000 HP to all tar\ngets every 3 turns.\n```\n\nThe word \"target\" should not be cut in the middle. It should be sent to the next line instead:\n\n```\nRestores 5,000 HP to all\ntargets every 3 turns.\n```\n","comments":["I edited this block of code to `UIRichText::handleTextRenderer()` (just after line 265) and it seems to work. But I'm not sure of its performance and how it will interact with other languages like Chinese or Japanese.\n\n```\nstd::string leftWords = Helper::getSubStringOfUTF8String(curText,0,leftLength);\n\n\/\/ Word wrap on last space (' ') character.\n\/\/ Might break word wrap for asian languages like chinese, japanese, etc.\nsize_t leftSpace = leftWords.find_last_of(\" \");\nif ( leftSpace != std::string::npos ) {\n    leftLength = leftLength - (leftLength - leftSpace);\n    leftWords = Helper::getSubStringOfUTF8String(curText,0,leftLength);\n    leftLength = leftLength + 1;    \/\/ remove space on next line\n}\n```\n","@tioalexis-indigo \nThe current implementation of UIRichText is badly designed and not even complete.\nWe are considering to rewrite the whole in the Label level, like adding BBCode feature to `cocos2d::Label`.\n"],"labels":["type:bug"]},{"title":"problem in CCNode.cpp","body":"In CCNode.cpp line 1431.\n\n``` cpp\n\nfor( const auto &child: _children)\n    child->onEnter();\n```\n\n![image](https:\/\/cloud.githubusercontent.com\/assets\/6873307\/11083397\/28aab296-886a-11e5-8d55-754a8d59c936.png)\n\nI have portal tencent behaviac in my project(Tencnt behaviac is a solution for the game agent's  behavior tree). but this two lines will be crash. if I have change this code to \n\n``` cpp\n   for (Vector<Node*>::iterator it = _children.begin(); \n        it != _children.end(); \n        ++it)\n    {\n        Node* child = *it;\n        child->onEnter();\n    }\n```\n\nthen it work well.\n\nbut I don't know why?\n","comments":["looks like a compiler bug. which compiler are you using ?\n","`_children` holds `Node*`, so i think we can remove `&` here. But i don't think it is related with this issue. @pjkui will you change the codes to\n\n``` c++\nfor( const auto child: _children)\n    child->onEnter();\n```\n\nand have a try?\n"],"labels":["platform:win32"]},{"title":"[Web engine] Removed node may still be hold by actions and cause memory leak","body":"A developer reported that when removing a node from the scene, if it has some actions attached, the action will cause the node still reachable from ActionManager, then it won't be collected by GC.\n\nIn the engine logic, normally, when a node detached from the scene, the cleanup should be called recursively from itself to its children node tree. The cleanup function is in charge of stopping actions and remove it from the action manager. If user report is right, it means there is something wrong in the detaching process.\n\nOur logic need to be reviewed and check whether the problem exist. \n","comments":[],"labels":["platform:web"]},{"title":"ParticleSystemQuad  setStartColor setEndColor","body":"ParticleSystemQuad   emitter:setStartColor(cc.c4f(1,1,0,1))  \u5e94\u8be5\u663e\u793a\u6210\u4e3a\u9ec4\u8272\u7684\u7c92\u5b50\uff0c\u4f46\u662f\u6548\u679c\u662f\u7eff\u8272\n\ntranslated by google: \"It should show become yellow particles, but the effect is green\"\n","comments":["please, post all your particle code. Most probably it has to do with your `setStartColorVar()` or similar\n"],"labels":["type:bug"]},{"title":"3.81\u7248\u672c lua\u7684\u4e25\u91cdbug","body":"3.81\u7248\u672c lua\u6709\u4e2a\u975e\u5e38\u4e25\u91cd\u7684bug:     \u4e24\u4e2a\u7ee7\u627f\u4e8eNode\u7684A\u4e0eB       1. \u5728layer\u7684init\u91cc  new A add A,  2.\u5728onTouch\u65f6 new B    removeA  3.\u518d\u6b21touch\u65f6 removeB     \u6b64\u65f6\u4e00\u5b9a\u4f1a\u6302\u5728Node\u7684\u6790\u6784\u51fd\u6570\u8fd9\u4e00\u53e5CCASSERT(!_running, \"Node still marked as running on node destruction! Was base class onExit() called in derived class onExit() implementations?\");\n\n\u6211\u5206\u6790\u5728step2    new B    \u4e0e   removeA \u8fd9\u91cc\uff0cc++\u7684\u5185\u5b58\u5206\u914d\u4e0a\u6709\u95ee\u9898\uff0c\u628aA\u7684\u5185\u5b58\u5206\u914d\u7ed9\u4e86B   \u5bfc\u81f4\u4e86\u6700\u7ec8\u7684\u5947\u602acrash \n","comments":["\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\nlocal a = myClassA:new()\n    self:addChild(a)\n    self.a = a\n\n```\nlocal function onTouchBegan(touch, event)\n    if self.a then\n        local b = myClassB:new()\n        self:addChild(b)\n        self.b = b\n\n        self.a:removeFromParent()\n        self.a = nil\n    elseif self.b then\n        self.b:removeFromParent()\n        self.b = nil\n    end\n    return true\nend\n\nlocal listener = cc.EventListenerTouchOneByOne:create()\nlistener:setSwallowTouches(true)\nlistener:registerScriptHandler(onTouchBegan, cc.Handler.EVENT_TOUCH_BEGAN)\n\nlocal eventDispatcher = self:getEventDispatcher()\neventDispatcher:addEventListenerWithSceneGraphPriority(listener, self)\n```\n","@xiaofeng11 Please assign someone to investigate\n","In general, we don't encourage removing child or release things during event callback, it may be not very stable in some circumstances. We will need to know better the problem to define it as a bug or not\n","\u82b1\u4e86\u70b9\u65f6\u95f4\uff0c\u6784\u9020\u4e86\u4e00\u4e2a\u66f4\u7b80\u5355\u800c\u4e14\u5b8c\u6574\u7684\u4f8b\u5b50\uff0c\u9996\u5148\u9700\u8981\u65b0\u5efa\u4e00\u4e2a3.81\u7248lua\u5de5\u7a0b\uff0c\u4e4b\u540e\u5c06MainScene.lua\u7684\u5185\u5bb9\u66ff\u6362\u4e3a\u4e0b\u9762\u7684\u4ee3\u7801\uff0c\u5219\u4f60\u4f1a\u5f97\u5230\u4e00\u4e2a\u5fc5\u73b0\u7684crash\n\n``` lua\nlocal MainScene = class(\"MainScene\", cc.load(\"mvc\").ViewBase)\n\nlocal BEEvents = {}\nBEEvents.lockEvent= \"baselayer_lock_event\"\nBEEvents.unlockEvent = \"baselayer_unlock_event\"\n\nlocal MyClassBase = class(\"MyClassBase\", function()\n    return display.newLayer()\nend)\n\nfunction MyClassBase:ctor()\n    self:enableNodeEvents()\nend\n\nfunction MyClassBase:onEnter()\n    --lock others\n    self:lock()\n\n    local dispatcher = self:getEventDispatcher()\n\n    --register lock msg\n    local lockListener = cc.EventListenerCustom:create(BEEvents.lockEvent, function(eventCustom)\n        print(\"lock message\")\n    end)\n    dispatcher:addEventListenerWithSceneGraphPriority(lockListener, self)\n\n    --register unlock msg\n    local unlockListener = cc.EventListenerCustom:create(BEEvents.unlockEvent, function(eventCustom)\n        print(\"unlock message\")\n    end)\n    dispatcher:addEventListenerWithSceneGraphPriority(unlockListener, self)\nend\n\nfunction MyClassBase:lock()\n    local lockEvent = cc.EventCustom:new(BEEvents.lockEvent)\n    local dispatcher = self:getEventDispatcher()\n    dispatcher:dispatchEvent(lockEvent)\nend\n\nfunction MyClassBase:unlock()\n    local unlockEvent = cc.EventCustom:new(BEEvents.unlockEvent)\n    local dispatcher = self:getEventDispatcher()\n    dispatcher:dispatchEvent(unlockEvent)\nend\n\nfunction MyClassBase:onExit()\n    self:unlock()\nend\n\n--classA\nlocal MyClassA = class(\"MyClassA\", MyClassBase)\n\nfunction MyClassA:ctor()\n    MyClassA.super.ctor(self)\n\n    local bkg = cc.LayerColor:create(cc.c4b(255, 255, 0, 77))\n    self:addChild(bkg)\n    self.bkgLayer = bkg\nend\n\nfunction MyClassA.show()\n    if not MyClassA.currentActivity then\n        local parent = cc.Director:getInstance():getRunningScene()\n        local activity = MyClassA.new()\n        parent:addChild(activity, 100000)\n        MyClassA.currentActivity = activity\n    end\n\nend\n\nfunction MyClassA.hide()\n    if MyClassA.currentActivity then\n        MyClassA.currentActivity:removeFromParent()\n        MyClassA.currentActivity = nil\n    end\nend\n\n\nlocal MyClassB = class(\"MyClassB\", function( ... )\n    return display.newNode()\nend)\n\nfunction MainScene:onCreate()\n    local function onTouchBegan(touch, event)\n        print(\"touch me\")\n\n        if self.state == nil then\n            MyClassA.show()\n            self.state = 1\n\n            print(\"step 1: crete a\")\n        elseif self.state == 1 then\n            self.b = MyClassB.new()\n            local scene = cc.Director:getInstance():getRunningScene()\n            scene:addChild(self.b)\n\n            MyClassA.hide()\n            self.state = 2\n\n            print(\"step 2: create b then remove a\")--and then it must be crash on c++ ~Node()\n        else\n            self.b:removeFromParent()\n            self.state = nil\n\n            print(\"step 3: remove b now\")\n        end\n\n        return true\n    end\n\n    local listener = cc.EventListenerTouchOneByOne:create()\n    listener:setSwallowTouches(true)\n    listener:registerScriptHandler(onTouchBegan, cc.Handler.EVENT_TOUCH_BEGAN)\n\n    local eventDispatcher = self:getEventDispatcher()\n    eventDispatcher:addEventListenerWithSceneGraphPriority(listener, self)\nend\n\nreturn MainScene\n```\n","\u5d29\u6e83\u7684\u60c5\u51b5\u6bd4\u6211\u63cf\u8ff0\u7684\u66f4\u590d\u6742\u4e00\u4e9b\uff0c\u4f46\u662f\u4ee3\u7801\u5e94\u8be5\u628a\u60c5\u666f\u5c55\u793a\u7684\u5f88\u6e05\u695a\u5566\n","Nobody answer?\n","I tested with latest codes on Mac, and nothing shown."],"labels":["type:bug","script:lua"]},{"title":"AudioEngine's getDuration method always returns -1","body":"Tested on iOS and on Android, with MP3 files.\n\nCode:\n<code>\nauto snd = cocos2d::experimental::AudioEngine::play2d(filename);\n\nfloat duration = cocos2d::experimental::AudioEngine::getDuration(snd);\n<\/code>\n","comments":["Maybe the filename is wrong path, AudioEngine is works fine in my device. IOS and ANDROID\n","I don't think it's a filename issue - the audio plays properly. Also the setFinishCallback method works as expected on the same file. \ngetDuration just returns only -1.000000\n\nHere's someone else mentioning the same problem:\nhttp:\/\/discuss.cocos2d-x.org\/t\/getting-duration-of-an-audio-file\/4194\/7\n","Here's one of the mp3 files I'm using. I couldn't upload it here so I've put it on Wetransfer ( expires after 7 days).\nhttp:\/\/we.tl\/UTu1aTxyZH\n","I'm using ogg files and getDuration for first few frames returns indeed -1 and later it returns correct number.\n","Interesting info @piotrros, I wonder if that is intended behaviour (probably not since this issue is now filed as \"bug\"). \n","It may have something to do with cocos2d::experimental::AudioEngine being out of sync with OpenAL, as described in this issue I recently submitted:\n\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/15419 \n\nFor the first few loops after play2d is called, the sound isn't actually playing yet in OpenAL, but once the OpenAL status is AL_PLAYING (I think this is the right state, can't verify at the moment), then a call to getDuration() will return the correct value.\n","play2d is async, we can not get duration immediately after it. In my project I changed some code and if the audio file is preloaded before calling play2d, I can get duration immediately. But I can not find a way to fix the problem for non-preloaded files.","Perhaps a callback should be added to for the game to hook into that gets called when the audio file has been loaded, and is ready for a call to getDuration.  At least then the game won't end up in some strange state because of an incorrect getDuration value.","Also you can't preload files that are \"long\". In my app I'm working around it by replacing my call to preload with a call to play2d with the volume set to 0, and replacing my calls to play2d with calls to setCurrentTime(0) and resume()"],"labels":["type:bug"]},{"title":"some suggestion for cocos v4.x","body":"1. **Use smart pointer instead of auto release.** Because the smart pointer is more safe for memory management and threading. The reference counter of an object should start at zero, any creation function should return a smart pointer instead of raw pointer.\n2. **Don't call any OpenGL function directly.** Wrapper all OpenGL function with c++ class. (eg, VertexBuffer, IndexBuffer, RenderContext). We may need support OpenGL ES v2.x, ES v3.x, OpenGL, DirectX in the future. It's safe and convenience to use an abstract renderer layer.\n3. **Add a thread safely reference class which inherited from `Ref`.** The class overwrite `retain` and `release` method, and makes them thread safe.\n4. **Support Tcp\/IP**\n\nI'm sorry about that my English is so bad, the following is Chinese translation.  \n1. **\u4f7f\u7528\u667a\u80fd\u6307\u9488\u66ff\u4ee3autorelease\u673a\u5236.** \u667a\u80fd\u6307\u9488\u53ef\u4ee5\u505a\u5230\u7ebf\u7a0b\u5b89\u5168\uff0c\u5e76\u4e14\u5728\u5185\u5b58\u6258\u7ba1\u4e0a\u66f4\u65b9\u4fbf\u548c\u5b89\u5168\uff0c\u4e0d\u4ec5\u80fd\u51cf\u5c11\u5927\u91cf\u5197\u4f59\u7684retain release\u4ee3\u7801\uff0c\u800c\u4e14\u80fd\u786e\u4fdd\u4f60\u4e0d\u4f1a\u5fd8\u4e86\u8c03\u7528release\u65b9\u6cd5\u3002\u76ee\u524d\u5f88\u591a\u6210\u719f\u7684\u5546\u4e1a\u5f15\u64ce\u90fd\u5728\u4f7f\u7528\u667a\u80fd\u6307\u9488\uff0c\u6211\u4eec\u6ca1\u6709\u7406\u7531\u4e0d\u4f7f\u7528\u5b83\u3002Ref\u7c7b\u7684\u5f15\u7528\u8ba1\u6570\u5e94\u8be5\u4ece0\u5f00\u59cb\uff0c\u8fd9\u6837\u4f1a\u66f4\u76f4\u89c2\uff0c\u6240\u6709\u521b\u5efa\u51fd\u6570\u90fd\u5e94\u8be5\u8fd4\u56de\u4e00\u4e2a\u667a\u80fd\u6307\u9488\uff0c\u8fd9\u5c31\u907f\u514d\u4e86\u4ece0\u5f00\u59cb\u7684\u53ef\u80fd\u5f15\u53d1\u7684\u4e0d\u5b89\u5168\u56e0\u7d20\u3002\n2. **\u907f\u514d\u76f4\u63a5\u8c03\u7528OpenGL\u51fd\u6570.** \u6211\u4eec\u5e94\u8be5\u5c01\u88c5\u6240\u6709OpenGL\u64cd\u4f5c\uff0c\u6bd4\u5982\u589e\u52a0\u4e00\u4e9b\u7c7b\uff1aVertexBuffer, IndexBuffer, RenderContext\u7b49\u3002\u8fd9\u6837\u4e0d\u4ec5\u5b89\u5168\uff0c\u800c\u4e14\u4f7f\u7528\u8d77\u6765\u66f4\u52a0\u65b9\u4fbf\uff0c\u4e5f\u4fbf\u4e8e\u79fb\u690d\u3002\u672a\u6765\u6211\u4eec\u4e5f\u8bb8\u8981\u652f\u6301OpenGL ES 3.x\uff0cOpenGL\u548cDX\uff08\u5982\u679c\u6211\u4eec\u60f3\u8981\u505a\u4e00\u4e2a\u771f\u6b63\u7684\u8de8\u5e73\u53f0\u7a0b\u5e8f\uff0c\u8fd9\u4e24\u4e2a\u4e5f\u662f\u5fc5\u5907\uff09\uff0c\u5c01\u88c5\u4f1a\u7ed9\u6211\u4eec\u5e26\u6765\u975e\u5e38\u5927\u7684\u6536\u76ca\u3002\n3. **\u589e\u52a0\u4e00\u4e2a\u7ebf\u7a0b\u5b89\u5168\u7684\u5f15\u7528\u8ba1\u6570\u7c7b\uff0c\u8be5\u7c7b\u6d3e\u751f\u81ea`Ref`.** \u591a\u7ebf\u7a0b\u662f\u672a\u6765\u7684\u8d8b\u52bf\uff0c\u7ebf\u7a0b\u5b89\u5168\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002\u6211\u4eec\u5e94\u8be5\u786e\u4fddretain\u548crelease\u65b9\u6cd5\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002\n4. **\u652f\u6301Tcp\/IP\u534f\u8bae.** \n","comments":["@youlanhai Thank you very much for your suggestion, indeed, memory management, multi thread and portable renderer are all very important for Cocos2d to getting anywhere further. We will consider your suggestions for our v4\n","cocos2d-x v4 seems to be frozen. so, when it will be resumed?\n","@youlanhai \nTCP\/IP implementation you can find here: https:\/\/github.com\/AlexanderShniperson\/cocos2dx_socket_example\n"],"labels":["highlight"]},{"title":" Glview::getFrameSize() & GLView::getVisibleSize() are getting the wrong size on iPhone6s+ and IOS 9.1","body":"Actually it wasn't a bug. It was the zoom option on the 6+ that was retriving 2001x1125 and we didn't know.\n\nOriginal post:\n\nCocos2d-x 3.6\nDeployment iPhone\/iPad\n\nWe released our first app for Iphone\/ Ipad. It works great on most devices, but we found out that only on the new iPhone6S Plus that run 9.0.2 or 9.1 Glview::getFrameSize() & GLView::getVisibleSize() are getting the wrong device size, therefore, all our app is displaying wrong.\n\nIt's really strange because the old iPhone 6 Plus is getting the correct size. Only on the new S models are retrieving the wrong size. But if these new models run 9.0.0, the size is correct.\n\nThe size that we get from the device is 2001 by 1125\n\nIs this a bug from IOS or are we missing something?\n","comments":["Did you provide correct icon for iPhone6s+?\n"],"labels":["platform:ios"]},{"title":"Memory leak in ScriptingCore.cpp?","body":"In cleanup function which belongs to ScriptingCore.cpp, \nwhy not variable _runLoop been delete ? \nIs it memory leak?\n\nthis code has no use:\n\n```\nif(this->_runLoop){\n    delete _runLoop;\n    this->_runLoop = nullptr;\n}\n```\n\n```\nvoid ScriptingCore::cleanup()\n{\n    localStorageFree();\n    removeAllRoots(_cx);\n    if (_cx)\n    {\n        JS_DestroyContext(_cx);\n        _cx = NULL;\n    }\n    if (_rt)\n    {\n        JS_DestroyRuntime(_rt);\n        _rt = NULL;\n    }\n    JS_ShutDown();\n    if (_js_log_buf) {\n        free(_js_log_buf);\n        _js_log_buf = NULL;\n    }\n\n    for (auto iter = _js_global_type_map.begin(); iter != _js_global_type_map.end(); ++iter)\n    {\n        free(iter->second->jsclass);\n        free(iter->second);\n    }\n    \/*\n    if(this->_runLoop){\n        delete _runLoop;\n        this->_runLoop = nullptr;\n    }\n    *\/\n    _js_global_type_map.clear();\n    filename_script.clear();\n    registrationList.clear();\n}\n```\n","comments":[],"labels":["script:jsb"]},{"title":"fopen(filename, \"ab\") must not be called in DownloadTaskCURL::init();","body":"In Win32, there are 512 fopen files limit(can be set up to 2048).\n\nAssetsManagerEx::batchDownload() create network::DownloadTaskCURL classes as many as their download-file-list in the network::DownloadTaskCURL::init().\n\nIt seems the logic must move to DownloadTaskCURL::writeDataProc() or DownloadTaskCURL::initProc();\n","comments":["Sorry, i don't quite understand the issue, could you please describe it in more detail?\n"],"labels":["platform:win32"]},{"title":"textDefinition in JS does not saves shadowColor","body":"When using textDefinition (or embedded solutions like the UIRichText) it doesn't make possible to set the shadow Color;\n\nline 518 of CCLabelTTF.js\n\/\/ shadow\n        if (textDefinition.shadowEnabled)\n            this.enableShadow(textDefinition.shadowOffsetX,\n                textDefinition.shadowOffsetY,\n                textDefinition.shadowOpacity,\n                textDefinition.shadowBlur);\n\nIf changing it to\n\/\/ shadow\n        if (textDefinition.shadowEnabled)\n            this.enableShadow( textDefinition.shadowColor, \/\/needs to be added.\n                cc.size(textDefinition.shadowOffsetX, textDefinition.shadowOffsetY),\n                textDefinition.shadowBlur);\n\nIt would be possible to do it.\n","comments":["@WenhaiLin Why we haven't supported shadow color ?\n","I verified and in CPP it has the same problem that can be solved very easily.\nThanks.\n","@pekayatt why not send a pull request?\n","Hi @minggo, sorry about that! I\n got a problem with my computer before I could send the pull request some time ago and never got back to it.\nI have been away from cocos for sometime now :(. Changed from 2D games to only VR now.\nI need to check in my backups if I still have the files to fix it. \nPS: I believe I have first sent the issue and then edit it with the solution.\n","thanks @pekayatt \n"],"labels":["platform:web"]},{"title":"Multiple definition of `__ctype_get_mb_cur_max'","body":"When building for arm64-v8a I get the error \"multiple definition of `__ctype_get_mb_cur_max'\" during the \"install\" phase of building for android. The definitions are in:\nCCApplication-android.cpp:45\nCCEnhanceAPI-android.cpp:35\n\nRemoving the repeated definition from CCEnhanceAPI-android.cpp seems to fix it for me.\n","comments":["@krishan711 \nCould you send a PR to resolve this issue? \nThanks.\n","@krishan711 how did you build for arm64-va8 since cocos2d-x doesn't provide corresponding 3rd party libs.\n","I also have the same problem.\r\n\r\n\ufeffCCEnhanceAPI-android.cpp:34: multiple definition of `__ctype_get_mb_cur_max'\r\n\ufeffCCApplication-android.cpp:44: first defined here\r\n\r\n","I delete these in CCEnhanceAPI-android.cpp and solved the problem.\r\n\r\n```c++\r\n\ufeff\/\/ FIXME: using ndk-r10c will cause the next function could not be found. It may be a bug of ndk-r10c.\r\n\/\/ Here is the workaround method to fix the problem.\r\n\/\/\ufeff#ifdef __aarch64__\r\n\/\/extern \"C\" size_t __ctype_get_mb_cur_max(void) {\r\n\/\/    return (size_t) sizeof(wchar_t);\r\n\/\/}\r\n\/\/#endif\r\n```"],"labels":["type:bug","platform:android"]},{"title":"ccui.Button does not show disabled image in cocos2d-html5","body":"cocos2d-x 3.8.1\n\nvar okBtn = new ccui.Button(\"res\/ok_button_normal.png\", \"res\/ok_button_pressed.png\", \"res\/ok_button_disabled.png\");\n\n( or auto create pressed & disabled images:\nvar okBtn = new ccui.Button(\"res\/ok_button_normal.png\", \"\", \"\"); )\n\nokBtn.attr({\n    enabled: false\n});\n\nrunning in html5 engine does not show grey disabled image but normal image instead. Same code running native android jsb shows grey button correctly.\n","comments":[],"labels":["platform:web"]},{"title":"3.8\/3.81\u7248\u672c js\u9879\u76ee\u5728android\u5fae\u4fe1\u4e0b\u4f1a\u6709\u504f\u79fb","body":"`cocos new Test -l js`\u65b0\u5efa\u4e00\u4e2a\u9879\u76ee\n\u7136\u540e\u4fee\u6539`mian.js`  `cc.view.setDesignResolutionSize(640, 960, cc.ResolutionPolicy.EXACT_FIT);`\n\u8fd0\u884c\u9879\u76ee \u5728android\u5fae\u4fe1\u6d4f\u89c8\u5668\u4e2d\u5c31\u4f1a\u4ea7\u751f\u504f\u79fb \u5e76\u4e14\u53ef\u4ee5\u62d6\u52a8\u504f\u79fb\u7684\u5730\u65b9\n![59_503580_682170a915d9df8](https:\/\/cloud.githubusercontent.com\/assets\/358364\/10420651\/3e242b0e-70cb-11e5-89d5-d3355892f060.jpg)\n![1](https:\/\/cloud.githubusercontent.com\/assets\/358364\/10420682\/c657945c-70cb-11e5-8871-d0f0eaf9de80.jpg)\n\n\u4f7f\u7528\u672a\u5408\u5e76\u76843.6\u7248\u672c\u6d4b\u8bd5 \u4e0d\u4f1a\u4ea7\u751f\u504f\u79fb\u95ee\u9898\n\n\u6d4b\u8bd5\u624b\u673a\u534e\u4e3aCHE-TL00H  \u4e09\u661fnote3\n","comments":["\u8bf7\u95ee\u5fae\u4fe1\u662f\u4ec0\u4e48\u7248\u672c\u7684\u54e6\uff1f\n\u7cfb\u7edf\u770b\u4e0a\u53bb\u662f5.0\u7684\u4e48\uff1f\n","\u534e\u4e3a\u578b\u53f7CHE-TL00H android\u7248\u672c 5.0.2 emui3.1   \u5fae\u4fe1\u7248\u672c6.2.6\n\u4e09\u661fGalaxy Note3 SM-N9009 android\u7248\u672c4.3 \u5fae\u4fe1\u7248\u672c 6.2.5\n","\u8bf7\u95ee\u8fd9\u4e2a\u95ee\u9898\u5927\u6982\u4ec0\u4e48\u65f6\u5019\u4f1a\u89e3\u51b3\u554a\n","@VisualSJ what's the status of this issue?\n"],"labels":["type:bug","platform:web"]},{"title":"\u5f53Sprite3D\u62e5\u6709\u591a\u4e2amesh\u65f6\u5019\uff0csetGLProgramState()\u6709\u95ee\u9898","body":"\u53d1\u73b0\u4e00\u4e2a\u9519\u8bef\uff0c\u5f53\u4e00\u4e2aSPrite3D\u8bfb\u53d6\u6a21\u578b\u540e\u62e5\u6709\u591a\u4e2amesh\u65f6\uff0c\u7528setGLProgramState()\u91cd\u8bbeshader\u540e\u6a21\u578b\u6e32\u67d3\u51fa\u9519\uff0c\u8fd9\u4e2a\u6a21\u578b\u662f\u7528\u4e86\u8499\u76ae\u9aa8\u9abc\u52a8\u753b\u7684\uff0cshader\u7684\u4ee3\u7801\u76f4\u63a5\u590d\u5236\u5f15\u64ce\u63d0\u4f9b\u7684cc3D_SkinPositionTex_vert \u548ccc3D_ColorTex_frag\u3002\u5982\u4e0b\u56fe\uff0c\u5de6\u8fb9\u662f\u7528setGLProgramState\u7684\uff0c\u53f3\u8fb9\u6ca1\u6709\uff0c\u7528\u7684\u662f\u540c\u4e00\u4e2a\u6a21\u578b\u3002\n![ttt](https:\/\/cloud.githubusercontent.com\/assets\/8038483\/10420271\/0aa8af92-70c2-11e5-8224-35b1bf39e65e.png)\n","comments":[],"labels":["type:bug"]},{"title":"IOS and Android FileUtils","body":"Hi,\n\nI am using latest (3.8.1) cocos2dx build. Written my game in Javascript. When i am calling jsb.fileUtils.isFileExist(DIRECTORY_PATH) returns TRUE on iOS and FALSE on Android. jsb.fileUtils.isDirectoryExist(DIRECTORY_PATH) returns FALSE on iOS and TRUE on Android.....\n","comments":["@mariuskurgonas \nWired...  @WenhaiLin  @minggo  Thoughts?\n","@zilongshanren \nI don't know why it happens, but it is an issue if it works like that.\nI think we should try to reproduce it and fix it.\n","@mariuskurgonas what's the DIRECTORY_PATH you used?\n","I am not sure let me check and get back to you\n\n2016-07-06 9:10 GMT+01:00 minggo notifications@github.com:\n\n> @mariuskurgonas https:\/\/github.com\/mariuskurgonas what's the\n> DIRECTORY_PATH you used?\n> \n> \u2014\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/14069#issuecomment-230706253,\n> or mute the thread\n> https:\/\/github.com\/notifications\/unsubscribe\/ACxPkc4QGEOPS0gDhByGjj52jTbEB9__ks5qS2L_gaJpZM4GIqf-\n> .\n"],"labels":["script:jsb"]},{"title":"Android: Activity reopens after calling Director::getInstance()->end();","body":"On some devices, like Samsung Galaxy Note 4 when calling Director::getInstance()->end(); to exit game,\nActivity will be recreated and game will be started again due to calling \n\n```\n android.os.Process.killProcess(android.os.Process.myPid());\n```\n\nThis happens because system thinks that process was killed forcefully and tries to restore it back.\n\nOne solution could be to call Activity.finish(), and let the system take care of resources, or even System.exit(0);\nI'm not sure about second one.\n","comments":["Yes, i can confirm this bug exists.. sometimes it restores the application, sometimes it won't.\n","Yeah, this is not 100% reproducible bug.\n"],"labels":["platform:android"]},{"title":"Crash on Label release","body":"This crash happens when scene is quickly pushed and then popped using the Director.\n\nerror type BAD_EXE_ACCESS in CCFontAtlasCache.cpp\n\n```\nbool FontAtlasCache::releaseFontAtlas(FontAtlas *atlas)\n{\n    if (nullptr != atlas)\n    {\n        for( auto &item: _atlasMap )\n        {\n            if ( item.second == atlas ) \/\/=====================> crash line ~250\n            {\n                if (atlas->getReferenceCount() == 1)\n                {\n                  _atlasMap.erase(item.first);\n                }\n\n                atlas->release();\n\n                return true;\n           }\n        }\n    }\n\n    return false;\n}\n```\n\nQueue:\n![screen shot 2015-09-11 at 11 13 18 am](https:\/\/cloud.githubusercontent.com\/assets\/10916275\/9804918\/31a5ec0e-5876-11e5-9b1c-6d0d4709db34.png)\n","comments":["Which version of cocos2d-x are you using? Any source code to reproduce this issue?\n","I am using 3.7.1. I would love to give you some code but its confidential. But basically, \n\nI replicated the issue this way which crashed 100%. Although I don't use it this way, It still produces a similar error 1 out of 1000 scene changes: \n    auto scene=TestLabelScene::createScene();\n    Director::getInstance()->pushScene(scene);\n    Director::getInstance()->popScene(); \/\/or replace\n\nBut it basically seems like it happens if the resources are not loaded yet or something along those lines\n","@StrikerScoleriWilliams I can't reproduced this issue in latest version. Can you provide more details?\n","I wasn't able to replicate this on 3.8 either. This may already been fixed. You can close this issue.\n","@StrikerScoleriWilliams I fixed a possible related crash on 3.8 version at https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/13210\n","Ok, I replicated this on Xcode using test cases. It crashes when you pop the scene but also close the application at the same time. When I use IOS test navigator it tests the scene but it also closes the application after test which causes the crash.\n","I got more time to test this and I have found some code to replicate this:\n\nIn XCODE test navigator:\n\n```\n- (void) testOptionScenes \n{\n    XCTAssert([cpp quickOpenTests], @\"Pass\");\n    XCTAssert(YES, @\"Quick Open Scene Tests\");\n}\n```\n\nFrom ObjC to C++ \n\n```\n- (BOOL) quickOpenTests {\n    return self.cpp.testQuickOpenScenes();\n}\n```\n\nIn C++\n\n```\nbool CPPTests::testQuickOpenScenes()\n{    \n    \/\/Test Option Scenes\n    CCLOG(\"TESTING -------------- %s\", \"Quick Open Close Test\");\n    auto scene = TempScene::createScene();\n    Director::getInstance()->pushScene(scene);\n    Director::getInstance()->popScene();\n\n    return true;\n}\n\nTempScene Class:\nclass TempScene : public GameClassDelegate \/\/Scene\n{\npublic:\n    static cocos2d::Scene* createScene()\n    {\n        auto scene = cocos2d::Scene::create();\n        auto layer = TempScene::create();\n        scene->addChild(layer);        \n\n        return scene;\n    };\n\n    virtual bool init()\n    {\n         if ( !Layer::init() )\n         {\n            return false;\n         }\n\n        onInit();\n        createBackground(XXX_BG_MENU);\n\n        \/\/===================FOLLOWING CODE WITH CAUSE CRASH\n        createTestLabel(); \/\/=====COMMENT OUT = NO CRASH \/\/CRASH HAPPENS 75% OF THE TIME\n\n        return true;\n    }\n\n   \/*\n     create menu items\n     *\/\n    void createTestLabel()\n    {\n        auto errorLabel = Label::createWithTTF(\"TEST LABEL\", XXX_FONT_HELVETICA, 32*m_DeviceScale);\n        errorLabel->setAdditionalKerning(3.2*m_DeviceScale);\n        errorLabel->setPosition(m_VisibleSize.width\/2, m_VisibleSize.height\/2);\n        addChild(errorLabel);\n    };\n\n    CREATE_FUNC(TempScene);\n};\n```\n","Btw this is v3.8\n","I'm also seeing crashes on cocos2d::FontAtlasCache::releaseFontAtlas(cocos2d::FontAtlas*), I'm not sure what exactly causes it but this issue might be related. For me the destructor of cocos2d::Label::~Label() + 120 seems to be called almost like an endless loop and finally it crashes in the above function. \n\nI have no idea how to reproduce it. It seems to happen to 1% or less of users on a live app.\n\nhttp:\/\/crashes.to\/s\/c891ca30477\n","@jonnyijapan thanks, interesting.\ndo you have the map files? could you tell us which function it is calling on `cocos2d::Label::~Label() + 120` ? thanks.\n","I'm also getting this ... seems like  item.second is NULL \nI applied many tests to this... with no luck finding what exactly the problem is.\n","the bug still exists in 3.13.1","Here is the crash report\r\n<pre>\r\nOS Version:          iPhone OS 10.2.1 (14D27)\r\nReport Version:      104\r\n\r\nException Type:  EXC_BAD_ACCESS (SIGSEGV)\r\nException Subtype: KERN_INVALID_ADDRESS at 0xbaddcbd992c3bed5\r\nTermination Signal: Segmentation fault: 11\r\nTermination Reason: Namespace SIGNAL, Code 0xb\r\nTerminating Process: exc handler [0]\r\nTriggered by Thread:  0\r\n\r\nThread 0 name:\r\nThread 0 Crashed:\r\n0   MyCoolGame-mobile            \t0x0000000100075540 cocos2d::FontAtlasCache::releaseFontAtlas(cocos2d::FontAtlas*) + 36\r\n1   MyCoolGame-mobile            \t0x000000010007f120 cocos2d::Label::~Label() + 112\r\n2   MyCoolGame-mobile            \t0x000000010007f120 cocos2d::Label::~Label() + 112\r\n3   MyCoolGame-mobile            \t0x000000010007f27c cocos2d::Label::~Label() + 12\r\n4   MyCoolGame-mobile            \t0x00000001000380c8 cocos2d::AutoreleasePool::clear() + 68\r\n5   MyCoolGame-mobile            \t0x0000000100038040 cocos2d::AutoreleasePool::~AutoreleasePool() + 20\r\n6   MyCoolGame-mobile            \t0x00000001000381dc cocos2d::PoolManager::~PoolManager() + 24\r\n7   MyCoolGame-mobile            \t0x000000010003816c cocos2d::PoolManager::destroyInstance() + 28\r\n8   MyCoolGame-mobile            \t0x0000000100034d6c cocos2d::ApplicationProtocol::~ApplicationProtocol() + 40\r\n9   libsystem_c.dylib             \t0x000000018918fff0 __cxa_finalize_ranges + 392 (atexit.c:274)\r\n10  libsystem_c.dylib             \t0x0000000189139390 exit + 24 (exit.c:78)\r\n11  UIKit                         \t0x00000001901877fc -[UIApplication _terminateWithStatus:] + 492 (UIApplication.m:6192)\r\n12  UIKit                         \t0x00000001903897cc __102-[UIApplication _handleApplicationDeactivationWithScene:shouldForceExit:transitionContext:completion:]_block_invoke.2100 + 792 (UIApplication.m:6489)\r\n13  UIKit                         \t0x000000019038cfdc _runAfterCACommitDeferredBlocks + 292 (UIApplication.m:2451)\r\n14  UIKit                         \t0x000000019037ed50 _cleanUpAfterCAFlushAndRunDeferredBlocks + 560 (UIApplication.m:2429)\r\n15  UIKit                         \t0x00000001900ee0b4 _afterCACommitHandler + 168 (UIApplication.m:2481)\r\n16  CoreFoundation                \t0x000000018a1fa0c0 __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__ + 32 (CFRunLoop.c:1802)\r\n17  CoreFoundation                \t0x000000018a1f7cf0 __CFRunLoopDoObservers + 372 (CFRunLoop.c:1898)\r\n18  CoreFoundation                \t0x000000018a1f8180 __CFRunLoopRun + 1024 (CFRunLoop.c:2849)\r\n19  CoreFoundation                \t0x000000018a1262b8 CFRunLoopRunSpecific + 444 (CFRunLoop.c:3113)\r\n20  GraphicsServices              \t0x000000018bbda198 GSEventRunModal + 180 (GSEvent.c:2245)\r\n21  UIKit                         \t0x00000001901667fc -[UIApplication _run] + 684 (UIApplication.m:2650)\r\n22  UIKit                         \t0x0000000190161534 UIApplicationMain + 208 (UIApplication.m:4092)\r\n23  MyCoolGame-mobile            \t0x0000000100026f68 main + 56 (main.m:5)\r\n24  libdyld.dylib                 \t0x00000001891095b8 start + 4\r\n\r\nThread 1:\r\n0   libsystem_kernel.dylib        \t0x000000018921ba88 __workq_kernreturn + 8\r\n1   libsystem_pthread.dylib       \t0x00000001892df160 _pthread_wqthread + 968 (pthread.c:2129)\r\n2   libsystem_pthread.dylib       \t0x00000001892ded8c start_wqthread + 4\r\n\r\nThread 2:\r\n0   libsystem_kernel.dylib        \t0x000000018921ba88 __workq_kernreturn + 8\r\n1   libsystem_pthread.dylib       \t0x00000001892df344 _pthread_wqthread + 1452 (pthread.c:2205)\r\n2   libsystem_pthread.dylib       \t0x00000001892ded8c start_wqthread + 4\r\n\r\nThread 3:\r\n0   libsystem_kernel.dylib        \t0x000000018921ba88 __workq_kernreturn + 8\r\n1   libsystem_pthread.dylib       \t0x00000001892df160 _pthread_wqthread + 968 (pthread.c:2129)\r\n2   libsystem_pthread.dylib       \t0x00000001892ded8c start_wqthread + 4\r\n\r\nThread 4:\r\n0   libsystem_kernel.dylib        \t0x000000018921ba88 __workq_kernreturn + 8\r\n1   libsystem_pthread.dylib       \t0x00000001892df344 _pthread_wqthread + 1452 (pthread.c:2205)\r\n2   libsystem_pthread.dylib       \t0x00000001892ded8c start_wqthread + 4\r\n\r\nThread 5 name:\r\nThread 5:\r\n0   libsystem_kernel.dylib        \t0x00000001891fd188 mach_msg_trap + 8\r\n1   libsystem_kernel.dylib        \t0x00000001891fcff8 mach_msg + 72 (mach_msg.c:103)\r\n2   CoreFoundation                \t0x000000018a1fa5d0 __CFRunLoopServiceMachPort + 192 (CFRunLoop.c:2527)\r\n3   CoreFoundation                \t0x000000018a1f81ec __CFRunLoopRun + 1132 (CFRunLoop.c:2870)\r\n4   CoreFoundation                \t0x000000018a1262b8 CFRunLoopRunSpecific + 444 (CFRunLoop.c:3113)\r\n5   Foundation                    \t0x000000018ac6326c -[NSRunLoop(NSRunLoop) runMode:beforeDate:] + 304 (NSRunLoop.m:367)\r\n6   Foundation                    \t0x000000018ac83dd0 -[NSRunLoop(NSRunLoop) runUntilDate:] + 96 (NSRunLoop.m:411)\r\n7   UIKit                         \t0x0000000190adac38 -[UIEventFetcher threadMain] + 136 (UIEventFetcher.m:279)\r\n8   Foundation                    \t0x000000018ad60e68 __NSThread__start__ + 1024 (NSThread.m:1163)\r\n9   libsystem_pthread.dylib       \t0x00000001892e1850 _pthread_body + 240 (pthread.c:697)\r\n10  libsystem_pthread.dylib       \t0x00000001892e1760 _pthread_start + 284 (pthread.c:744)\r\n11  libsystem_pthread.dylib       \t0x00000001892ded94 thread_start + 4\r\n\r\nThread 6 name:\r\nThread 6:\r\n0   libsystem_kernel.dylib        \t0x00000001891fd188 mach_msg_trap + 8\r\n1   libsystem_kernel.dylib        \t0x00000001891fcff8 mach_msg + 72 (mach_msg.c:103)\r\n2   CoreFoundation                \t0x000000018a1fa5d0 __CFRunLoopServiceMachPort + 192 (CFRunLoop.c:2527)\r\n3   CoreFoundation                \t0x000000018a1f81ec __CFRunLoopRun + 1132 (CFRunLoop.c:2870)\r\n4   CoreFoundation                \t0x000000018a1262b8 CFRunLoopRunSpecific + 444 (CFRunLoop.c:3113)\r\n5   AVFAudio                      \t0x00000001a36c3d24 GenericRunLoopThread::Entry(void*) + 164 (GenericRunLoopThread.h:106)\r\n6   AVFAudio                      \t0x00000001a36e9d9c CAPThread::Entry(CAPThread*) + 84\r\n7   libsystem_pthread.dylib       \t0x00000001892e1850 _pthread_body + 240 (pthread.c:697)\r\n8   libsystem_pthread.dylib       \t0x00000001892e1760 _pthread_start + 284 (pthread.c:744)\r\n9   libsystem_pthread.dylib       \t0x00000001892ded94 thread_start + 4\r\n\r\nThread 7 name:\r\nThread 7:\r\n0   libsystem_kernel.dylib        \t0x00000001891fd188 mach_msg_trap + 8\r\n1   libsystem_kernel.dylib        \t0x00000001891fcff8 mach_msg + 72 (mach_msg.c:103)\r\n2   AudioToolbox                  \t0x000000018d0d66fc AURemoteIO::IOThread::Run() + 288 (AURemoteIO.cpp:1588)\r\n3   AudioToolbox                  \t0x000000018d0daa18 AURemoteIO::IOThread::Entry(void*) + 40 (AURemoteIO.h:293)\r\n4   AudioToolbox                  \t0x000000018d3c5230 CAPThread::Entry(CAPThread*) + 84\r\n5   libsystem_pthread.dylib       \t0x00000001892e1850 _pthread_body + 240 (pthread.c:697)\r\n6   libsystem_pthread.dylib       \t0x00000001892e1760 _pthread_start + 284 (pthread.c:744)\r\n7   libsystem_pthread.dylib       \t0x00000001892ded94 thread_start + 4\r\n\r\nThread 8 name:\r\nThread 8:\r\n0   libsystem_kernel.dylib        \t0x00000001891fd188 mach_msg_trap + 8\r\n1   libsystem_kernel.dylib        \t0x00000001891fcff8 mach_msg + 72 (mach_msg.c:103)\r\n2   CoreFoundation                \t0x000000018a1fa5d0 __CFRunLoopServiceMachPort + 192 (CFRunLoop.c:2527)\r\n3   CoreFoundation                \t0x000000018a1f81ec __CFRunLoopRun + 1132 (CFRunLoop.c:2870)\r\n4   CoreFoundation                \t0x000000018a1262b8 CFRunLoopRunSpecific + 444 (CFRunLoop.c:3113)\r\n5   AudioToolbox                  \t0x000000018d1ed0cc GenericRunLoopThread::Entry(void*) + 164 (GenericRunLoopThread.h:106)\r\n6   AudioToolbox                  \t0x000000018d3c5230 CAPThread::Entry(CAPThread*) + 84\r\n7   libsystem_pthread.dylib       \t0x00000001892e1850 _pthread_body + 240 (pthread.c:697)\r\n8   libsystem_pthread.dylib       \t0x00000001892e1760 _pthread_start + 284 (pthread.c:744)\r\n9   libsystem_pthread.dylib       \t0x00000001892ded94 thread_start + 4\r\n\r\nThread 0 crashed with ARM Thread State (64-bit):\r\n    x0: 0x000000017419a5b0   x1: 0x00000001002a5400   x2: 0x0000000124861800   x3: 0x0000000000000018\r\n    x4: 0x000000010027c138   x5: 0x0000000000000000   x6: 0x0000000174138920   x7: 0x0000000000000000\r\n    x8: 0x0000000174199a50   x9: 0x0000000000000000  x10: 0x000000000000000e  x11: 0x000000007d4c86d3\r\n   x12: 0x000000000000bb46  x13: 0x0000000124fffff0  x14: 0x0000000000008018  x15: 0x00000000007f7e20\r\n   x16: 0x000000000000004b  x17: 0x07411624cacb4f6a  x18: 0x0000000000000000  x19: 0x000000017419a5b0\r\n   x20: 0xbaddcbd992c3bead  x21: 0x0000000124002e00  x22: 0x0000000000000000  x23: 0x0000000000000008\r\n   x24: 0x00000001af0a8000  x25: 0x00000001af0a8de0  x26: 0x0000000000000002  x27: 0x0000000000000001\r\n   x28: 0x0000000000000002   fp: 0x000000016fdee580   lr: 0x000000010007f120\r\n    sp: 0x000000016fdee570   pc: 0x0000000100075540 cpsr: 0x80000000\r\n\r\n<\/pre>","@ivcoder, does it also exist in v3.14.1?","@dumganhar Still happening in 3.15.\r\n\r\n```\r\n\r\n# Platform: ios\r\n# Version: N\/A\r\n# Date: 2017-06-13T04:29:00Z\r\n# OS Version: 10.3.2 (14F89)\r\n# Device: iPad Pro (9.7 inch)\r\n# RAM Free: 3.6%\r\n# Disk Free: 70%\r\n\r\n#0. Crashed: com.apple.main-thread\r\n0  game-mobile                 0x1004d3cbc cocos2d::FontAtlasCache::releaseFontAtlas(cocos2d::FontAtlas*) + 4300029116\r\n1  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n2  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n3  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n4  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n5  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n6  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n7  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n8  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n9  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n10 game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n\r\n--\r\n\r\n#0. Crashed: com.apple.main-thread\r\n0  game-mobile                 0x1004d3cbc cocos2d::FontAtlasCache::releaseFontAtlas(cocos2d::FontAtlas*) + 4300029116\r\n1  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n2  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n3  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n4  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n5  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n6  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n7  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n8  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n9  game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n10 game-mobile                 0x1004df478 cocos2d::Label::~Label() + 4300076152\r\n\r\n#1. com.apple.uikit.eventfetch-thread\r\n0  libsystem_kernel.dylib         0x18eb9b224 mach_msg_trap + 8\r\n1  libsystem_kernel.dylib         0x18eb9b09c mach_msg + 72\r\n2  CoreFoundation                 0x18fb6ce90 __CFRunLoopServiceMachPort + 192\r\n3  CoreFoundation                 0x18fb6aae4 __CFRunLoopRun + 1060\r\n4  CoreFoundation                 0x18fa9ada4 CFRunLoopRunSpecific + 424\r\n5  Foundation                     0x1905b4d74 -[NSRunLoop(NSRunLoop) runMode:beforeDate:] + 304\r\n6  Foundation                     0x1905d5b44 -[NSRunLoop(NSRunLoop) runUntilDate:] + 96\r\n7  UIKit                          0x1966d86a8 -[UIEventFetcher threadMain] + 136\r\n8  Foundation                     0x1906b22d8 __NSThread__start__ + 996\r\n9  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n10 libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n11 libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#2. AVAudioSession Notify Thread\r\n0  libsystem_kernel.dylib         0x18eb9b224 mach_msg_trap + 8\r\n1  libsystem_kernel.dylib         0x18eb9b09c mach_msg + 72\r\n2  CoreFoundation                 0x18fb6ce90 __CFRunLoopServiceMachPort + 192\r\n3  CoreFoundation                 0x18fb6aae4 __CFRunLoopRun + 1060\r\n4  CoreFoundation                 0x18fa9ada4 CFRunLoopRunSpecific + 424\r\n5  AVFAudio                       0x1a9713540 GenericRunLoopThread::Entry(void*) + 164\r\n6  AVFAudio                       0x1a9739814 CAPThread::Entry(CAPThread*) + 84\r\n7  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n8  libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n9  libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#3. Thread\r\n0  libsystem_kernel.dylib         0x18ebb8e1c __psynch_cvwait + 8\r\n1  libsystem_pthread.dylib        0x18ec80814 _pthread_cond_wait + 640\r\n2  libc++.1.dylib                 0x18e5a9ac8 std::__1::condition_variable::wait(std::__1::unique_lock<std::__1::mutex>&) + 56\r\n3  JavaScriptCore                 0x194446f94 void std::__1::condition_variable_any::wait<std::__1::unique_lock<bmalloc::Mutex> >(std::__1::unique_lock<bmalloc::Mutex>&) + 112\r\n4  JavaScriptCore                 0x194446f08 bmalloc::AsyncTask<bmalloc::Heap, void (bmalloc::Heap::*)()>::threadRunLoop() + 168\r\n5  JavaScriptCore                 0x194446de8 std::__1::__shared_ptr_emplace<std::__1::mutex, std::__1::allocator<std::__1::mutex> >::~__shared_ptr_emplace() + 34\r\n6  JavaScriptCore                 0x194447098 void* std::__1::__thread_proxy<std::__1::tuple<void (*)(bmalloc::AsyncTask<bmalloc::Heap, void (bmalloc::Heap::*)()>*), bmalloc::AsyncTask<bmalloc::Heap, void (bmalloc::Heap::*)()>*> >(void*) + 92\r\n7  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n8  libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n9  libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#4. WebThread\r\n0  libsystem_kernel.dylib         0x18ebb8e64 __psynch_mutexwait + 8\r\n1  libsystem_pthread.dylib        0x18ec84b8c _pthread_mutex_lock_wait + 96\r\n2  libsystem_pthread.dylib        0x18ec84d94 _pthread_mutex_lock_slow + 300\r\n3  WebCore                        0x194767bfc _WebTryThreadLock(bool) + 128\r\n4  WebCore                        0x194767b5c WebRunLoopLock(__CFRunLoopObserver*, unsigned long, void*) + 44\r\n5  CoreFoundation                 0x18fb6c9a8 __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__ + 32\r\n6  CoreFoundation                 0x18fb6a630 __CFRunLoopDoObservers + 372\r\n7  CoreFoundation                 0x18fb6ac18 __CFRunLoopRun + 1368\r\n8  CoreFoundation                 0x18fa9ada4 CFRunLoopRunSpecific + 424\r\n9  WebCore                        0x194765608 RunWebThread(void*) + 456\r\n10 libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n11 libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n12 libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#5. com.apple.NSURLConnectionLoader\r\n0  libsystem_kernel.dylib         0x18eb9b224 mach_msg_trap + 8\r\n1  libsystem_kernel.dylib         0x18eb9b09c mach_msg + 72\r\n2  CoreFoundation                 0x18fb6ce90 __CFRunLoopServiceMachPort + 192\r\n3  CoreFoundation                 0x18fb6aae4 __CFRunLoopRun + 1060\r\n4  CoreFoundation                 0x18fa9ada4 CFRunLoopRunSpecific + 424\r\n5  CFNetwork                      0x1902a6df4 +[NSURLConnection(Loader) _resourceLoadLoop:] + 404\r\n6  Foundation                     0x1906b22d8 __NSThread__start__ + 996\r\n7  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n8  libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n9  libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#6. HZAFNetworking\r\n0  libsystem_kernel.dylib         0x18eb9b224 mach_msg_trap + 8\r\n1  libsystem_kernel.dylib         0x18eb9b09c mach_msg + 72\r\n2  CoreFoundation                 0x18fb6ce90 __CFRunLoopServiceMachPort + 192\r\n3  CoreFoundation                 0x18fb6aae4 __CFRunLoopRun + 1060\r\n4  CoreFoundation                 0x18fa9ada4 CFRunLoopRunSpecific + 424\r\n5  Foundation                     0x1905b4d74 -[NSRunLoop(NSRunLoop) runMode:beforeDate:] + 304\r\n6  Foundation                     0x1906096c4 -[NSRunLoop(NSRunLoop) run] + 88\r\n7  game-mobile                 0x100131fa0 +[HZAFURLConnectionOperation networkRequestThreadEntryPoint:] (HZAFURLConnectionOperation.m:164)\r\n8  Foundation                     0x1906b22d8 __NSThread__start__ + 996\r\n9  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n10 libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n11 libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#7. com.twitter.crashlytics.ios.MachExceptionServer\r\n0  game-mobile                 0x10063da1c CLSProcessRecordAllThreads + 4301511196\r\n1  game-mobile                 0x10063da1c CLSProcessRecordAllThreads + 4301511196\r\n2  game-mobile                 0x10063d8d8 CLSProcessRecordAllThreads + 4301510872\r\n3  game-mobile                 0x10062da4c CLSHandler + 4301445708\r\n4  game-mobile                 0x1006289f0 CLSMachExceptionServer + 4301425136\r\n5  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n6  libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n7  libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#8. GAIThread\r\n0  libsystem_kernel.dylib         0x18eb9b224 mach_msg_trap + 8\r\n1  libsystem_kernel.dylib         0x18eb9b09c mach_msg + 72\r\n2  CoreFoundation                 0x18fb6ce90 __CFRunLoopServiceMachPort + 192\r\n3  CoreFoundation                 0x18fb6aae4 __CFRunLoopRun + 1060\r\n4  CoreFoundation                 0x18fa9ada4 CFRunLoopRunSpecific + 424\r\n5  Foundation                     0x1905b4d74 -[NSRunLoop(NSRunLoop) runMode:beforeDate:] + 304\r\n6  Foundation                     0x1906096c4 -[NSRunLoop(NSRunLoop) run] + 88\r\n7  game-mobile                 0x1006877f0 statusForFlags + 4301813744\r\n8  Foundation                     0x1906b22d8 __NSThread__start__ + 996\r\n9  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n10 libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n11 libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#9. Thread\r\n0  libsystem_kernel.dylib         0x18ebb8e1c __psynch_cvwait + 8\r\n1  libsystem_pthread.dylib        0x18ec80814 _pthread_cond_wait + 640\r\n2  libc++.1.dylib                 0x18e5a9ac8 std::__1::condition_variable::wait(std::__1::unique_lock<std::__1::mutex>&) + 56\r\n3  game-mobile                 0x100489b88 void std::__1::condition_variable_any::wait<std::__1::mutex>(std::__1::mutex&) + 4299725704\r\n4  game-mobile                 0x100489958 cocos2d::network::HttpClient::networkThread() + 4299725144\r\n5  game-mobile                 0x10048bfc8 void* std::__1::__thread_proxy<std::__1::tuple<std::__1::__bind<void (cocos2d::network::HttpClient::*)(), cocos2d::network::HttpClient*> > >(void*) + 4299734984\r\n6  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n7  libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n8  libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#10. AURemoteIO::IOThread\r\n0  libsystem_kernel.dylib         0x18eb9b224 mach_msg_trap + 8\r\n1  libsystem_kernel.dylib         0x18eb9b09c mach_msg + 72\r\n2  AudioToolbox                   0x192a0de00 AURemoteIO::IOThread::Run() + 280\r\n3  AudioToolbox                   0x192a1205c AURemoteIO::IOThread::Entry(void*) + 40\r\n4  AudioToolbox                   0x192cf24bc CAPThread::Entry(CAPThread*) + 84\r\n5  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n6  libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n7  libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#11. Thread\r\n0  libsystem_kernel.dylib         0x18ebb8e1c __psynch_cvwait + 8\r\n1  libsystem_pthread.dylib        0x18ec80814 _pthread_cond_wait + 640\r\n2  libc++.1.dylib                 0x18e5a9ac8 std::__1::condition_variable::wait(std::__1::unique_lock<std::__1::mutex>&) + 56\r\n3  game-mobile                 0x1004f466c cocos2d::TextureCache::loadImage() + 4300162668\r\n4  game-mobile                 0x1004f5bdc void* std::__1::__thread_proxy<std::__1::tuple<void (cocos2d::TextureCache::*)(), cocos2d::TextureCache*> >(void*) + 4300168156\r\n5  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n6  libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n7  libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#12. com.apple.CoreMotion.MotionThread\r\n0  libsystem_kernel.dylib         0x18eb9b224 mach_msg_trap + 8\r\n1  libsystem_kernel.dylib         0x18eb9b09c mach_msg + 72\r\n2  CoreFoundation                 0x18fb6ce90 __CFRunLoopServiceMachPort + 192\r\n3  CoreFoundation                 0x18fb6aae4 __CFRunLoopRun + 1060\r\n4  CoreFoundation                 0x18fa9ada4 CFRunLoopRunSpecific + 424\r\n5  CoreFoundation                 0x18fae79c0 CFRunLoopRun + 112\r\n6  CoreMotion                     0x196bed01c (null) + 203104\r\n7  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n8  libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n9  libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#13. WebCore: LocalStorage\r\n0  libsystem_kernel.dylib         0x18ebb8e1c __psynch_cvwait + 8\r\n1  libsystem_pthread.dylib        0x18ec80814 _pthread_cond_wait + 640\r\n2  JavaScriptCore                 0x193a9a8b4 WTF::ThreadCondition::timedWait(WTF::Mutex&, double) + 80\r\n3  JavaScriptCore                 0x19442db18 WTF::ParkingLot::parkConditionallyImpl(void const*, WTF::ScopedLambda<bool ()> const&, WTF::ScopedLambda<void ()> const&, WTF::TimeWithDynamicClockType const&) + 2256\r\n4  WebKitLegacy                   0x1959d51b0 bool WTF::ConditionBase::waitUntil<WTF::Lock>(WTF::Lock&, WTF::TimeWithDynamicClockType const&) + 172\r\n5  WebKitLegacy                   0x1959d7e48 std::__1::unique_ptr<WTF::Function<void ()>, std::__1::default_delete<WTF::Function<void ()> > > WTF::MessageQueue<WTF::Function<void ()> >::waitForMessageFilteredWithTimeout<WTF::MessageQueue<WTF::Function<void ()> >::waitForMessage()::'lambda'(WTF::Function<void ()> const&)>(WTF::MessageQueueWaitResult&, WTF::MessageQueue<WTF::Function<void ()> >::waitForMessage()::'lambda'(WTF::Function<void ()> const&)&&, WTF::WallTime) + 144\r\n6  WebKitLegacy                   0x1959d7450 WebCore::StorageThread::threadEntryPoint() + 68\r\n7  JavaScriptCore                 0x193a96e88 WTF::threadEntryPoint(void*) + 212\r\n8  JavaScriptCore                 0x193a96d98 WTF::wtfThreadEntryPoint(void*) + 24\r\n9  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n10 libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n11 libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#14. Thread\r\n0  libsystem_kernel.dylib         0x18ebb9a88 __workq_kernreturn + 8\r\n1  libsystem_pthread.dylib        0x18ec7efd0 _pthread_wqthread + 792\r\n2  libsystem_pthread.dylib        0x18ec7ecac start_wqthread + 4\r\n\r\n#15. com.apple.CFNetwork.CustomProtocols\r\n0  libsystem_kernel.dylib         0x18eb9b224 mach_msg_trap + 8\r\n1  libsystem_kernel.dylib         0x18eb9b09c mach_msg + 72\r\n2  CoreFoundation                 0x18fb6ce90 __CFRunLoopServiceMachPort + 192\r\n3  CoreFoundation                 0x18fb6aae4 __CFRunLoopRun + 1060\r\n4  CoreFoundation                 0x18fa9ada4 CFRunLoopRunSpecific + 424\r\n5  CFNetwork                      0x190402f50 _privateRunloopEmulationSet(void*) + 264\r\n6  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n7  libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n8  libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#16. Thread\r\n0  libsystem_kernel.dylib         0x18ebb9a88 __workq_kernreturn + 8\r\n1  libsystem_pthread.dylib        0x18ec7f1a4 _pthread_wqthread + 1260\r\n2  libsystem_pthread.dylib        0x18ec7ecac start_wqthread + 4\r\n\r\n#17. Thread\r\n0  libsystem_kernel.dylib         0x18ebb9a88 __workq_kernreturn + 8\r\n1  libsystem_pthread.dylib        0x18ec7f1a4 _pthread_wqthread + 1260\r\n2  libsystem_pthread.dylib        0x18ec7ecac start_wqthread + 4\r\n\r\n#18. Thread\r\n0  libsystem_kernel.dylib         0x18ebb9a88 __workq_kernreturn + 8\r\n1  libsystem_pthread.dylib        0x18ec7efd0 _pthread_wqthread + 792\r\n2  libsystem_pthread.dylib        0x18ec7ecac start_wqthread + 4\r\n\r\n#19. Thread\r\n0  libsystem_kernel.dylib         0x18ebb9a88 __workq_kernreturn + 8\r\n1  libsystem_pthread.dylib        0x18ec7f1a4 _pthread_wqthread + 1260\r\n2  libsystem_pthread.dylib        0x18ec7ecac start_wqthread + 4\r\n\r\n#20. Thread\r\n0  libsystem_kernel.dylib         0x18eb9b278 semaphore_timedwait_trap + 8\r\n1  libdispatch.dylib              0x18ea896b4 _os_semaphore_timedwait + 92\r\n2  libdispatch.dylib              0x18ea88c5c _dispatch_semaphore_wait_slow + 72\r\n3  libdispatch.dylib              0x18ea87f48 _dispatch_worker_thread + 268\r\n4  libsystem_pthread.dylib        0x18ec8168c _pthread_body + 240\r\n5  libsystem_pthread.dylib        0x18ec8159c _pthread_body + 282\r\n6  libsystem_pthread.dylib        0x18ec7ecb4 thread_start + 4\r\n\r\n#21. Thread\r\n0  libsystem_pthread.dylib        0x18ec7eca8 start_wqthread + 126\r\n\r\n\r\n```","@zilongshanren , could you have a look at this issue? Thanks.","@crugthew \r\nHow could I reproduce this issue? \r\ncould you provide any code snippets?\r\n\r\nthanks.","@zilongshanren sorry for late reply. \r\n\r\nThis is a seemingly random crash. I have only experienced it once myself some time ago, but I can't provide any useful test cases.\r\n\r\nAll I can say is that this crash is happening once ~30 minutes with 500k daily active users, affecting < 1% of them. So it's not critical, but still.\r\n\r\nAlso it appears to be universal, affecting every app we release. So there must be a bug somewhere in the engine.","This is our biggest crash as well, it's still an issue in 3.15.0","Still exists in 3.16 as well.","For my projects I can confirm this crash in 3.17.2. The STR is to simply kill game in iOS, i.e.\r\n- while in game press home to go to main screen\r\n- press home twice to show previous apps\r\n- swipe your game up to shut it down\r\n\r\nGame crashes during shutdown. From what I see the problem is that there is no terminate handler in cocos. What is happening:\r\n- main loop exits\r\n- static variables are being destroyed (C++ standard does not define order, so it depends on compiler)\r\n- FontAtlasCache::_atlasMap seems to be destroyed and freed before e.g. Director.\r\n- When scene graph is being released, _atlasMap is long gone and game crashes.\r\n\r\nHandling termination in director would give it chance to do a proper cleanup. AppDelegate could use such callback too, to clean my code as well..."," I can confirm this crash in 3.17.1.","Cocos v4 still got this crash.\r\n\r\n```\r\nCrashed: com.apple.main-thread\r\n0  MyApp                          0x1023f06e8 cocos2d::FontAtlasCache::releaseFontAtlas(cocos2d::FontAtlas*) + 4337305320\r\n1  MyApp                          0x1023f83e0 cocos2d::Label::~Label() + 4337337312\r\n2  MyApp                          0x1023f8678 cocos2d::Label::~Label() + 4337337976\r\n3  MyApp                          0x102432f14 cocos2d::AutoreleasePool::~AutoreleasePool() + 4504\r\n4  MyApp                          0x102433170 cocos2d::PoolManager::destroyInstance() + 5108\r\n5  MyApp                          0x102482970 cocos2d::Application::~Application() + 106780\r\n6  libsystem_c.dylib              0x1b75bb064 __cxa_finalize_ranges + 416\r\n7  libsystem_c.dylib              0x1b75bb3a0 exit + 28\r\n```"],"labels":["critical","module:ui"]},{"title":"[JS-plugin-FB] FAILS in release mode","body":"Works great in debug but in release mode it throws:\n\n```\nplugin.FacebookAgent.getInstance is not a function\n```\n\nI've double checked that this is called:\n\n```\n    sc->addRegisterCallback(register_all_pluginx_protocols);\n    sc->addRegisterCallback(register_pluginx_js_extensions);\n    SDEBUG(LEVEL_INFO, \"app\", \"FB JS-support ENABLED\", \"\");\n```\n\nThe log shows the `FB JS-support ENABLED` message.\nAny hint how could I identify the problem? \nI've put several log dump messages inside the `js_register_pluginx_protocols_FacebookAgent` to make sure it is called and it is...\n\nI've tried it with cocos 3.5, 3.7 and 3.8 and all have this same issue.\n\nI know that plugins are not a prio since there is SDKBOX now, but this functionality doesn't work properly on SDKBOX, please support the plugins till the SDKBOX is mature enough.\n\nIt seems that the JS compilation messes this, could it be? Note that I use in 3.5 JS compilation from 3.7.1. which fixes the bug with JS source code included.\nUPDATE: I've tried it with original 3.5 JS compiler and the bug is still there....\n","comments":["Facebook JS SDK doesn't support advanced mode, please use \n\n```\ncocos compile -p web -m release\n```\n\nno `--advanced`\n","Hey, I get error same. I compile with cocos compile -p web -m release but get error Uncaught Error: Invalid argument game.min.js 1862.\nFacebook Plugin SDK error???\n\nI write by -l JS and using pluginx, plugin-facebook.\nI upgrade v3.11 (v3.9) and using sdkbox facebook for web, but sdkbox is not defined on web.\n\nFacebook_sdk.js new \/_1464152818,,JIT Construction: v2354536,en_US_\/\nold \/_1411456395,,JIT Construction: v1425205,zh_CN_\/\n\nyou can update edit facebook.js\nI can not unterstand to do it.\nThanks!\n"],"labels":["script:jsb"]},{"title":"Support Lua on Windows phone","body":"I would love to see Lua on Windows phone. We are in this process of porting our games, which are all written in Lua, to the platform and realized that Lua on the Windows phone platform is unsupported. \n\nI wouldn't mind doing the work to complete this. I wanted to know 1) who I can talk to help with this work? 2) does anyone know platform specific issues that may give me trouble when trying to port the Lua bindings? 3) has someone already started the work to complete this feature?\n\nAlso, I've heard talk about Windows Universal apps where the build process builds for all platforms. Is this work done? If it is, does that mean that Lua will work on the phone Without special build steps?\n\nAny help would be appreciated. \n\nThank you!\n","comments":["Hi Eric,\n\nThe cocos2d community briefly added lua support for Windows Phone 8.0 in cocos2d-x v 2.x but that work did not continue into cocos2d-x v3.x.\n\nIf you are interested in doing the port I would be happy to guide you. Please feel free to contact me directly by email.\n\nThanks,\n\nDale\n","Yes. I am very interested in doing this. I'll shoot you an email as soon as I am able. Thank you, Dale. \n\nEric\n\n> On Sep 26, 2015, at 7:09 AM, Dale Stammen notifications@github.com wrote:\n> \n> Hi Eric,\n> \n> The cocos2d community briefly added lua support for Windows Phone 8.0 in cocos2d-x v 2.x but that work did not continue into cocos2d-x v3.x.\n> \n> If you are interested in doing the port I would be happy to guide you. Please feel free to contact me directly by email.\n> \n> Thanks,\n> \n> Dale\n> \n> \u2014\n> Reply to this email directly or view it on GitHub.\n","Great! Talk with you soon.\n\n---\n\nFrom: Eric Chamberlain notifications@github.com\nSent: Saturday, September 26, 2015 10:53:00 AM\nTo: cocos2d\/cocos2d-x\nCc: Dale Stammen\nSubject: Re: [cocos2d-x] Support Lua on Windows phone (#13761)\n\nYes. I am very interested in doing this. I'll shoot you an email as soon as I am able. Thank you, Dale.\n\nEric\n\n> On Sep 26, 2015, at 7:09 AM, Dale Stammen notifications@github.com wrote:\n> \n> Hi Eric,\n> \n> The cocos2d community briefly added lua support for Windows Phone 8.0 in cocos2d-x v 2.x but that work did not continue into cocos2d-x v3.x.\n> \n> If you are interested in doing the port I would be happy to guide you. Please feel free to contact me directly by email.\n> \n> Thanks,\n> \n> Dale\n> \n> ## \n> \n> Reply to this email directly or view it on GitHub.\n\n## \n\nReply to this email directly or view it on GitHubhttps:\/\/na01.safelinks.protection.outlook.com\/?url=https%3a%2f%2fgithub.com%2fcocos2d%2fcocos2d-x%2fissues%2f13761%23issuecomment-143475612&data=01%7c01%7cdalestam%40microsoft.com%7c58202ec0b8c24de23b5c08d2c69b540c%7c72f988bf86f141af91ab2d7cd011db47%7c1&sdata=OBbwjDe1XELetOqEzxOHHG4baqGgJmSsXSiWzp3FsDg%3d.\n","how is the progress about this plan?\n","Really waiting for this. Any progress? Can help if required.\n"],"labels":["script:lua"]},{"title":"custom action can not use reverse and clone","body":"custom action can not use reverse and clone\n\nreverse and clone will return the custom action's parent.\n\nright design:\nreverse and clone need return the custom action.\n","comments":["Note: this is a JS thing, not a C++, obviously, because in C++ you can override `reverse` and `clone`\n"],"labels":["script:jsb"]},{"title":"Particles and Text overlap, text will appear black border","body":"\u00b7\u00b7\u00b7Cocos 2d-x v3.7```\n\n``` cpp\n    auto l = Label::createWithTTF(\"After 5 seconds grossini should move\", \"fonts\/Thonburi.ttf\", 66.0f);\n    l->setPosition(Vec2(140, 130));\n    l->enableShadow(Color4B::RED, Size(2, -2), 0);\n    addChild(l);\n\nParticleSystemQuad *system = ParticleSystemQuad::create(\"defaultParticle.plist\");\n    addChild(system, 10);\n    system->setScale(2.0f);\n    system->setPosition(Vec2(240,160));\n```\n\n![891629f1-be51-4f0f-a344-4d5a9f53a509](https:\/\/cloud.githubusercontent.com\/assets\/3455415\/9487695\/a85a1d10-4c06-11e5-85eb-59144809028d.png)\n","comments":["A temporary fix:\n\n``` cpp\nParticleSystem::initWithDictionary(ValueMap& dictionary, const std::string& dirname)\n{\n    \/\/...\n    \/\/uncomment the following line\n    \/*if (_configName.length()>0)\n    {\n        _blendFunc.src = dictionary[\"blendFuncSource\"].asFloat();\n    }\n    else\n    {\n        _blendFunc.src = dictionary[\"blendFuncSource\"].asInt();\n    }\n    _blendFunc.dst = dictionary[\"blendFuncDestination\"].asInt();*\/\n}\n```\n\nThis issue cause by each image is loaded with premultiplied alpha.\n"],"labels":["type:bug"]},{"title":"websocket lua sendString","body":"the function in Lua_web_socket.cpp  tolua_Cocos2d_WebSocket_sendString00:\n\n```\n    LuaWebSocket* self    = (LuaWebSocket*)  tolua_tousertype(tolua_S,1,0);\n    size_t size = 0;\n    const char* data = (const char*) lua_tolstring(tolua_S, 2, &size);\n    if ( NULL == data)\n        return 0;\n\n    if (strlen(data) != size)\n    {\n        self->send((const unsigned char*)data, (unsigned int)size);\n    }\n    else\n    {\n        self->send(data);\n    }\n```\n\nit's strange, you have already know the size of the string, you should just  self->send the string and the size. Why are you judging the size and auto judge to send as binary or text? \nthis add the receiver's work!\nI think If you want to supply two mode of send, you may add a parameter to let the sender to decide whether the string is text or binary.\n","comments":[],"labels":["script:lua"]},{"title":"cocos2d-x 3.8beta0: websocket still not support for cookie","body":"On web platform browser support cookie automatic, but on device developer must manager cookie for websocket by modify onSocketCallback method of WebSocket class as below:\n\n```\ncase LWS_CALLBACK_CLIENT_APPEND_HANDSHAKE_HEADER:\n{\n    if (!_cookie.empty()) {\n        char **p = (char **)in;\n        if (len < 100)\n            return 1;\n\n        *p += sprintf(*p, \"Cookie: %s\\x0d\\x0a\", _cookie.c_str());\n        return 0;\n    }\n }\n break;\n```\n\nPlease support cookie for WebSocket, thank you very much!\n","comments":[],"labels":["type:request"]},{"title":"RenderTexture problem with Clang 3.6.1 on Linux Ubuntu","body":"I tried to use RenderTexture with Clang 3.6.1 on Ubuntu 14.04, got error when calling \n\nrenderTexture->end()\n\nWorks fine on GCC 4.9\n","comments":["What kind of error did you get? Could you add more details? Thanks.\n"],"labels":["platform:linux"]},{"title":"Can't add 3D Sprite on tmx file background using Cocos-2dx","body":"We have been working on sample game, wherein we want to show 3D sprite on .tmx file(background). But 3D sprite is never shown up, though we tried setting `tileMap->setGlobalZOrder(-1).`\n\nFollowing is the sample code:\n\n```\nCCTMXTiledMap tileMap = new CCTMXTiledMap();\ntileMap->initWithTMXFile(\"map.tmx\");    \ntileMap->setGlobalZOrder(-1);\n\/\/tileMap->setGlobalZOrder(-1000);\nthis->addChild(tileMap, 0);\n\n\/\/Sprite3D player = Sprite3D::create(\"player.c3b\");\nauto player = Sprite3D::create(\"player.c3b\");\nplayer->setScale(10.0f);\nplayer->setPosition3D(Vec3(200, 500, 0));\n\nthis->addChild(player, 1);\n```\n\nBut 3D Sprite is never shown up. Kindly help.\n\nYour help is highly appreciated!\n\nThanks.\n","comments":["It appears that issue is quite severe and orthogonal and isometric tiles bug out differently:\n1) orthogonal tiles get always drawn in front of 3D sprites, hiding them\n2) isometric tiles get corrupted (only half of each tile remains) when Sprite3D gets added into scene (tried boss and ogre from tests)\n","@super626  please take a look at it.\n","@Ninganagouda Could you please describe the requirement?\n","Hi,\n\nThanks for looking into the issue.\n\nWe are building an experimental game preferably in 2.5D approach. As 2.5D can be described in two ways:\n1) 2D background(May be tmx) with 3D sprite\n2) 3D background with 2D sprite\n\nWhile we were exploring with first approach, we couldn't show 3D sprite on tmx file. \n","@dabingnn I think this requirement is reasonable. \n\n@dabingnn @Ninganagouda \nI thought another method to achieve this. Have two cameras, one for tiledmap, and another for the 3D objects. You can keep the two cameras together. You can have a look at the cpptests, Node:Scene3D.\n","Hi,\nThanks for the suggestion. We will definitely explore the another possibility as suggested.\n\nIt would be highly appreciated, if we will be informed about this issue fix(Possibly in upcoming releases).\n\nThanks again!\n","This is still a bug even if two cameras is a workaround. It may require user setting a \"render as 3D\" flag on the tilemap, or possibly only need to set the tilemap's global Z to negative to force it into the background.\n\nIf the 3D objects need to have a z-depth or sorting order in between tiles or tile layers that is a different beast altogether and probably requires a derived or new implementation (we have such a system, but it's very specific to our game and not generalized).\n","workaround with two cameras works only if you don't add sprite3D as a child to TMXTiledMap.\nIn that case tiles are always drawn over sprite. ZOrder doesn't take any effect.\nMaybe someone found another workaround?\n"],"labels":["type:bug"]},{"title":"CCRenderTexture gets black screenshot when using multiple  Camera","body":"Cocos 2d-x v3.6\n\n``` cpp\n...\n\n_camera = Camera::createPerspective(60, (GLfloat)s.width \/ s.height, 1, 1000);\n_camera->setCameraFlag(CameraFlag::USER1);\n_layer3D->addChild(_camera, 0,\"camera1\");\n_layer3D->setCameraMask(0x2);\n\n\n\nCCRenderTexture* render = RenderTexture::create(size.width\/CC_CONTENT_SCALE_FACTOR(), size.height\/CC_CONTENT_SCALE_FACTOR());\n\nrender->setKeepMatrix(true);\nrender->beginWithClear(0, 0, 0, 0);\nvisit();\nrender->end();\nDirector::getInstance()->getRenderer()->render();\n\nchar jpg2[20];\nsprintf(jpg2, \"image-%d.jpg\", 123);\nstd::string fullpath1 = FileUtils::getInstance()->getWritablePath() + jpg2;\nImage* image1 = render->newImage();\nimage1->saveToFile(fullpath1, true);\nimage1->release();\n```\n\nThe saved image is black.\n","comments":["@yangws  please take a look at it.\n","i try to fix this bug by set cameramask, \n     Camera\\* visitCamera = Camera::getVisitingCameraEx();\n     Camera::setVisitingCamera(_activeCamera);\n    _rendTexture->setKeepMatrix(true);\n    _rendTexture->setCameraMask(0x2);\n\n```\n   _modelDrawNode->visit();\n\n_rendTexture->end();\n_rendTexture->saveToFile(fileNanme);\nDirector::getInstance()->getRenderer()->render();\nCamera::setVisitingCamera(visitCamera);\n```\n\nit can work for draw3d. but for sprite3d, it is failed, there is no 3dmodel displayed in picture file . \ni find it is caused by meshcammand. if not use meshcammand and use custom render command like this:\n    CustomCommand &cc = std::get<2>(effect);\n            cc.func = CC_CALLBACK_0(MyEffect3D::draw, std::get<1>(effect), transform);\n            renderer->addCommand(&cc);\nit can work. how to fixed this bug?\n\nI fix this. \nit cause by commend type. need to add somefunction. set rendertexture begin and end commend type to 3D\n"],"labels":["type:bug"]},{"title":"TextField hitbox invalid","body":"Hi,\n\nI just found that the hitbox of TextField is completely wrong.\n\nTake this sample code, use cocos 3.6 (or 3.7):\n\n```\n    auto createTextField = [](const std::string placeHolder, const std::string text) -> Node*\n    {\n        auto fieldSize = Size(600,100);\n        auto tf = ui::TextField::create(placeHolder, \"fonts\/arial.ttf\", 44);\n        auto bg = LayerColor::create(Color4B::RED, fieldSize.width, fieldSize.height);\n        tf->setAnchorPoint(Vec2::ANCHOR_MIDDLE);\n        tf->setPosition(fieldSize \/ 2);\n        tf->setTextColor(Color4B::BLUE);\n        tf->setTextHorizontalAlignment(TextHAlignment::CENTER);\n        tf->setTouchAreaEnabled(true);\n        tf->setTouchSize(fieldSize);\n        tf->setString(text);\n        bg->addChild(tf);\n        return bg;\n    };\n\n    auto f = createTextField(\"Enter your login\", \"\");\n    f->ignoreAnchorPointForPosition(false);\n    f->setAnchorPoint(Vec2::ANCHOR_MIDDLE);\n    f->setPosition(visibleSize \/ 2);\n    this->addChild(f);\n```\n\nI expect the textfield to become active when I touch inside the red box (since I used `setTouchAreaEnabled` and `setTouchSize` to cover the whole Layer size). And I expect it to become inactive when I touch outside the box.\n\nBut running this sample, it **becomes active** when you touch **somewhere to the left outside** of the box, and it **doesn't** when you touch **inside it somewhere to its right**.\n\nI quickly looked at the hitTest method and it seems it's incorrectly computing the boundingbox of the textfield when a touchArea is specified.\n","comments":["I think the issue is because the hitTest method is converting the touch to the textfield's nodeSpace which starts at (0,0) of the textfield (and in the worldSpace, this depends on the current length of the text inside the textfield), then creating a box around this point.\nIt should create the box around the **center** of the textfield instead (and of course you have to take into account the anchor point and textAlignment).\n","This seems to fix the issue for me.\nI tested using a scale of 0.5f and it worked fine too (it scaled down the `touchSize` too), and different anchor values for the textfield.\n\n```\nbool TextField::hitTest(const Vec2 &pt)\n{\n    if (_useTouchArea)\n    {\n        Vec2 nsp = getParent()->convertToNodeSpace(pt);\n        float scaledWidth = _touchWidth * getScaleX();\n        float scaledHeight = _touchHeight * getScaleY();\n        Rect bb = Rect(-scaledWidth * _anchorPoint.x + getPositionX(), -scaledHeight * _anchorPoint.y + getPositionY(), scaledWidth, scaledHeight);\n        if (nsp.x >= bb.origin.x && nsp.x <= bb.origin.x + bb.size.width\n            && nsp.y >= bb.origin.y && nsp.y <= bb.origin.y + bb.size.height)\n        {\n            return true;\n        }\n    }\n    else\n    {\n        return Widget::hitTest(pt);\n    }\n\n    return false;\n}\n```\n"],"labels":["type:bug"]},{"title":"Possibility to remove entirely 3d module","body":"Plese add compilation define ENABLE_3D.\n","comments":["Currently, if you haven't use any 3d header files, 3d module will be stripped dynamically at compilation. It may not be very clean in JSB \/ LuaB.\n\nFor total clean removal, I think the right way to do this is the following:\n1. Provide plugin system, or C++ module system\n2. Make 3D a plugin or a module so that user can remove or add it freely.\n"],"labels":["type:request"]},{"title":"Request ParallaxNode children node position calculation timing to be flexible","body":"```\nvoid ParallaxNode::visit(Renderer *renderer, const Mat4 &parentTransform, uint32_t parentFlags)\n{\n    \/\/    Vec2 pos = position_;\n    \/\/    Vec2    pos = [self convertToWorldSpace:Vec2::ZERO];\n    Vec2 pos = this->absolutePosition();\n    if( ! pos.equals(_lastPosition) )\n    {\n        for( int i=0; i < _parallaxArray->num; i++ ) \n        {\n            PointObject *point = (PointObject*)_parallaxArray->arr[i];\n            float x = -pos.x + pos.x * point->getRatio().x + point->getOffset().x;\n            float y = -pos.y + pos.y * point->getRatio().y + point->getOffset().y;            \n            point->getChild()->setPosition(x,y);\n        }\n        _lastPosition = pos;\n    }\n    Node::visit(renderer, parentTransform, parentFlags);\n}\n```\n\n\u73b0\u5728ParallaxNode\u8ba1\u7b97\u5b50\u8282\u70b9\u7684\u4f4d\u7f6e\u662f\u5728visit\u51fd\u6570\u7684\uff0c\u4f46\u662f\u8fd9\u4e2a\u51fd\u6570\u5bf9\u4e8e\u903b\u8f91\u4ee3\u7801\u6765\u8bf4\u6709\u53ef\u80fd\u592a\u665a\u4e86\uff0c\u5982\u679c\u903b\u8f91\u51fd\u6570\u9700\u8981\u4f7f\u7528\u6700\u7ec8\u5b50\u8282\u70b9\u4f4d\u79fb\u6765\u8ba1\u7b97\u7684\u8bdd\uff0c\u56e0\u4e3avisit\u5c31\u5230\u4e86\u6e32\u67d3\u90a3\u4e00\u6b65\u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4\u903b\u8f91\u4ee3\u7801\u9700\u8981\u4e0b\u4e00\u5e27\u624d\u80fd\u83b7\u53d6\u5230\u6b63\u786e\u7684node\u4f4d\u7f6e\u3002\n\u4ee5\u4e0b\u662f\u4e00\u4e2a\u4f7f\u7528\u573a\u666f\uff0c\u5730\u56fe\u7cfb\u7edf\n1. \u6211\u4eec\u6709\u591a\u4e2a\u56fe\u5c42\uff08Node\uff09\uff0c\u6bcf\u4e2a\u56fe\u5c42NxN\u5757\u5730\u8868\uff0c\u6211\u4eec\u901a\u8fc7\u68c0\u67e5\u6444\u50cf\u673a\u4e2d\u5fc3\u548c\u89c6\u91ce\u6765\u51b3\u5b9a\u54ea\u4e9b\u5730\u8868\u9700\u8981\u88ab\u52a0\u8f7d\u3002\n2. \u800c\u4e14\u56fe\u5c42\u4eec\u90fd\u52a0ParallaxNode\u8282\u70b9\u4e0a\uff0c\u6709\u4e0d\u540c\u7684\u89c6\u5deeratio\n3. \u6839\u636e\u903b\u8f91\u4ee3\u7801\uff0cParallxNode  setPosition \u5207\u6362\u5230\u5730\u56fe\u4e0d\u540c\u7684\u70b9\uff0c\u6807\u8bb0dirty\n4. \u901a\u8fc7convertToNodeSpace\u8ba1\u7b97\u6bcf\u4e2a\u5730\u8868\u5c42\u6b21\u771f\u6b63\u7684\u6444\u50cf\u673a\u4e2d\u5fc3\u70b9\n5. \u5982\u679cdirty,\u6839\u636e\u5404\u81ea\u5c42\u6b21\u7684\u6444\u50cf\u673a\u4f4d\u7f6e\uff0c\u8ba1\u7b97\u90a3\u4e9btile\u4f1a\u88ab\u52a0\u8f7d\u548c\u663e\u793a\n6. ParallxNode:visit (\u6b64\u65f6\u624d\u6267\u884c\uff0c\u5b50\u63a7\u4ef6\u7684\u4f4d\u79fb)\n\n\u56e0\u4e3a6\u57284\u4e4b\u540e\u6267\u884c\uff0c\u6240\u4ee5convertToNodeSpace\u51fa\u6765\u7684\u7ed3\u679c\u662f\u4e0d\u5bf9\u7684\u3002\n\u6211\u4eec\u5c1d\u8bd5\u7528\u7ee7\u627f\u6765\u4fee\u590d\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f46\u662fPointObject\u662f\u5b9a\u4e49\u5728ParallaxNode.cpp\u91cc\u9762\u7684\uff0c\u6839\u672c\u6ca1\u529e\u6cd5\uff0c\u53ea\u80fd\u76f4\u63a5\u6539ParallaxNode.cpp\n","comments":[],"labels":["type:request"]},{"title":"cc.textureCache.addImageAsync and cc.RenderTexture cause crashed when changing scene or low memory on iOS","body":"I'm using `cc.textureCache.addImageAsync` to download multiple online image at the same time.\n\n> cc.textureCache.addImageAsync(imageUrl, this.imageDownloaded, this);\n> imageDownloaded : function(texture)\n\nIn `this.imageDownloaded` callback, i use the texture to create a sprite and `cc.RenderTexture` to save the image to file.\n\n> var image = new cc.Sprite(texture);\n> this.addChild(image);\n> \n> var renderer = new cc.RenderTexture(image.getContentSize().width, image.getContentSize().height, cc.Texture2D.PIXEL_FORMAT_RGBA8888);\n> renderer.retain();\n> renderer.setSprite(image);\n> renderer.beginWithClear(255, 255, 255, 0, 0 , 0);\n> renderer.sprite.visit();\n> renderer.end();\n> \n> var saveSuccess = renderer.saveToFile(imageName, cc.IMAGE_FORMAT_JPEG);\n> if(saveSuccess)\n> {\n>   renderer.release();\n> }\n\nThe crashed happen when changing scene or received low memory warning while the image is still downloading or being saved by renderer.saveToFile. This can be known as some sprite is shown while some is not.\n\n`cocos2d::Director::getInstance()->purgeCachedData();` will be called to get more memory.\n\n2 type of crashed will happen\n\n> 1. malloc: **\\* error for object 0x92b0e14: incorrect checksum for freed object - object was probably modified after being freed.\n> 2. Received memory warning.\n>    libc++abi.dylib: terminating with uncaught exception of type std::out_of_range: map::at:  key not found\n\nI try to use this solution by modify 2d\/CCRenderTexture.cpp\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/10985\n\n> bool RenderTexture::saveToFile(const std::string& fileName, Image::Format format, bool isRGBA, std::function<void (RenderTexture*, const std::string&)> callback)\n> \n> Director::getInstance()->getRenderer()->addCommand(&_saveToFileCommand);\n> ++Director::getInstance()->getRenderer()->render(); <-- add this line\n\nIt do reduced the chance of crashed but it still will crashed occasionally.\n\nThe crashed happen only on device but not iOS simulator. Mac and Android is running fine.\n\nTested with iPad 2 iOS 7.1.2, Cocos2d-JS v3.6.1 and Cocos2d-JS v3.7\n","comments":[],"labels":["type:bug","script:jsb"]},{"title":"RenderTexture:onClear() \u6df1\u5ea6\u7f13\u5b58\u6ca1\u88ab\u6e05\u7a7a","body":"RenderTexture:onClear() \u6df1\u5ea6\u7f13\u5b58\u6ca1\u88ab\u6e05\u7a7a\n\u56e0\u4e3a\u6df1\u5ea6\u7f13\u5b58\u5e76\u6ca1\u6709\u8bbe\u7f6e\u53ef\u5199\u5165\uff0c\u6e32\u67d3\u5e26\u67093D\u6a21\u578b\u7684RTT\u7684\u65f6\u5019\u5c31\u4f1a\u51fa\u73b0\u6df1\u5ea6\u9519\u4e71\u3002\n\u65e2\u7136\u53ef\u9009clearFlag GL_DEPTH_BUFFER_BIT\uff0c\u90a3\u4e48\u5e94\u8be5\u8981\u8bbe\u7f6eglDepthMask(true);\n","comments":["\u8bf7\u63d0\u4f9b\u4e00\u4e2a\u6d4b\u8bd5\u4f8b\uff08\u4ee3\u7801\u7247\u6bb5\uff09\uff0c\u4ee5\u53ca\u6d4b\u8bd5\u7684\u73af\u5883\u9700\u6c42\uff08\u5e73\u53f0\uff1f\u8bbe\u5907\uff1f\uff09\u611f\u8c22~\n\nCould you please provide some pieces of code and the environment requirement? Thanks.\n","\u6211\u4f7f\u7528CodeXL\u67e5\u770bRenderTexture\u8c03\u7528onClear\u7684OpenGL\u53d8\u91cf\u7684\u65f6\u5019\u53d1\u73b0\u7684\uff0c\u89c9\u5f97\u662f\u6709\u8fd9\u4e2a\u98ce\u9669\u3002\n"],"labels":["type:bug"]},{"title":"20 * 2000 TMXTiledMap last few tiles can't display","body":"cocos2d-x v3.7\n\nMap size: 20 x 2000\nLast few tiles can't display in cocos2d-x:\n\n``` cpp\n    auto map = TMXTiledMap::create(\"map.tmx\");\n    addChild(map, 0, kTagTileMap);\n```\n\n<img width=\"1279\" alt=\"screen shot 2015-07-24 at 11 52 05 am\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/3455415\/8867323\/771d0bf2-31fa-11e5-87f4-7da16bc74791.png\">\n\nHere is my map resource: http:\/\/vdisk.weibo.com\/s\/u2pFxSLc-nv-\n","comments":["I believe this issue is related overflow on the OpenGL vertex buffer or index buffer, but I haven't nailed it down quite yet. I do know that the maximum # of tiles with the current TMX system is 128*128=16384 and the # of visible tiles in your .tmx map is something around 16390 or so and is thus cutting off the last 6 visible tiles (approx).\n\nI'll respond with more as I look at it. I'm looking to improve TMX tiled map.\n\nEdit: the number is based on storing information in an unsigned short somewhere in the renderer or OpenGL. 2^16 \/ 4 = 16384 (4 bytes per tile => 16384 max visible tiles). It's related to the fact that TMX uses a SpriteBatch as renderer and the atlas index overflows at this number related to the amount of visible tiles.\n","The real solution is likely to enable support for splitting up a map into layer chunks. Could create multiple vertex\/index buffers as well, but might as well support a better abstraction with splitting up a map into max sized regions by chunking as needed. This lends itself as well toward streaming in map and loading only adjacent chunks as player moves around map. If you need to see the full map of such a large size one could still load and render all chunks with the limits of CPU\/GPU memory size (and performance for FPS) instead, thus the limits would be on the rendering side and not the storage (map representation).\n","Yes, Map streaming sounds to be a good solution for the limitation of vertex and index buffer\u3002\n"],"labels":["type:bug"]},{"title":"\u8bf7\u63d0\u4f9b\u66f4\u591a\u7684App\u6d88\u606f\u900f\u4f20\u5230\u811a\u672c","body":"1. \u7a0b\u5e8f\u9000\u51fa\u7684\u6d88\u606f\uff0c\u867d\u7136\u73b0\u5728\u53ef\u4ee5\u901a\u8fc7\u573a\u666f\u7684exit\u4e8b\u4ef6\u76d1\u542c\u6765\u5b9e\u73b0\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u80fd\u591f\u6709\u7a0b\u5e8f\u9000\u51fa\u7684\u5404\u4e2a\u9636\u6bb5\u7684\u6d88\u606f\u63d0\u4f9b\u7ed9\u811a\u672c\u66f4\u597d\uff0c\u8fd9\u6837\u53ef\u4ee5\u5e2e\u52a9\u811a\u672c\u68c0\u67e5\u81ea\u8eab\u7684\u5f15\u7528\u60c5\u51b5\u3002\n2. \u5185\u5b58\u8b66\u544a\u6d88\u606f\n","comments":[],"labels":["type:request"]},{"title":"Physics debugDraw does not match with nodes when Scene is transformed","body":"If a transformation is applied to the Scene, such as MoveBy\/To, ScaleBy\/To, or RotateBy\/To,  the debugDraw layer no longer matches up with the visual nodes.\n\nThis is easiest to see by adding a runAction to PhysicsTests.cpp of cpp-tests:\n\n> void PhysicsDemo::toggleDebug()\n> {\n>    runAction( RotateBy::create( 2.0, 360 ));\n>    ....\n\nYou can see that the debug frames spin as expected with the non-physics elements on the scene, whereas the actual nodes (such as the sprites of grossini in Pyramid Stack test) spin as a group the wrong direction, as well as individually spinning, which they shouldn't. \n","comments":["add codes  like this:\nvoid PhysicsDemo::toggleDebug()\n{\n    #if CC_USE_PHYSICS\n    _debugDraw = !_debugDraw;\n    getPhysicsWorld()->setDebugDrawMask(_debugDraw ? PhysicsWorld::DEBUGDRAW_ALL :   PhysicsWorld::DEBUGDRAW_NONE);\n**runAction( ScaleTo::create(2020, 0.5, 0.5));**\n#endif\n}\nto your physicsTest demo,  run the action after you set the drawMask, \nand then, at **CCScene.cpp** ,\nat **void Scene::render(Renderer\\* renderer)** function, after  \n**director->pushMatrix(MATRIX_STACK_TYPE::MATRIX_STACK_PROJECTION);**\n add these codes:\n\n```\nCamera* visitingCamera = Camera::_visitingCamera;\n        Mat4 scalProject;\n        Mat4::createScale(Vec3(_scaleX,_scaleY,_scaleZ), &scalProject);\n        visitingCamera->setAdditionalProjection(scalProject);\n```\n\nthen you'll see\n<img width=\"885\" alt=\"tranphysics\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/5564318\/9024989\/732cdb2a-3921-11e5-86ab-682305140796.png\">\n<img width=\"915\" alt=\"ps2\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/5564318\/9025017\/c3bc0830-3922-11e5-85f6-c05fca661e29.png\">\n\nI think consider adding this function to allow developer's to change the scene's shape and run action. but it has some other problems such as the touch event location ect.\n","or override the scene node's setScaleX, scaleY, scaleZ  etc. works properly ,  but still have some problem, i'll ask if it is take into consideration since it will have some other effection. @pandamicro \n","@qiululu changing the camera seems to break the touch location.  Using these changes, if I scale the scene to 0.5, the \"toggle debug\" button is now closer to the middle of the screen (as expected), but the touch location for it is still in the upper righthand corner.\n\nAlso, rotating the scene is better (debug matches sprites), but gets a weird skew to it.  Move is still broken.\n","thanks, the first way is simple as the problem shooting. I think the second way maybe better, I havn't finish it yet, moving and skewing is not yet complete.\n","as you can see from the reference..  you can try to wirt implementation for it, I don't know if they will take into consideration for it.\n","transform the normal scene is as same as transform the viewport's shape, do you think so? whether it is action or simple transform,so...\n"],"labels":["type:bug"]},{"title":"Use RenderTexture with stencil buffer on Terga cause error!","body":"Same error: https:\/\/github.com\/gameplay3d\/GamePlay\/issues\/774\n\nGL error on XiaoMi 3 \n","comments":[],"labels":["type:bug","platform:android"]},{"title":"collision rebound will slow, and sometimes will stop","body":"@WenhaiLin \n\ncocos2d-x v3.6\n1. PhysicsMaterial(0.0f,1.0f,0.0f)\n2. setGravityEnable(false);\nBut collision rebound will slow, and sometimes will stop.\n\n``` cpp\n#include \"HelloWorldScene.h\"\n#include \"cocostudio\/CocoStudio.h\"\n#include \"ui\/CocosGUI.h\"\n#include <math.h>\n\nUSING_NS_CC;\n\nusing namespace cocostudio::timeline;\nusing namespace ui;\n\n\nScene* HelloWorld::createScene()\n{\n    auto scene = Scene::createWithPhysics();\n    scene->getPhysicsWorld()->setGravity(Vec2(0,-1000));\n    scene->getPhysicsWorld()->setDebugDrawMask(PhysicsWorld::DEBUGDRAW_ALL);\n\n    auto layer = HelloWorld::create();\n    scene->addChild(layer);\n\n    return scene;\n}\n\nbool HelloWorld::init()\n{\n    if ( !Layer::init() )\n    {\n        return false;\n    }\n\n    Size winSize = Director::getInstance()->getWinSize();\n    Sprite* phyArea = Sprite::create();\n    phyArea->setTag(100);\n    PhysicsBody* physicsBody = PhysicsBody::createEdgeBox(winSize ,PhysicsMaterial(0.0f,1.0f,0.0f), 1);\n    physicsBody->setCategoryBitmask(0x400);\n    physicsBody->setContactTestBitmask(0x400);  \/\/\u00d5\u00ae\u00f7\u2122\u0192\u2039\u2264\u00aa\u0192\u2039\u2248\u02c6\u25ca\u2264\n    physicsBody->setCollisionBitmask(0xC00);\n    phyArea->setPosition(winSize.width\/2, winSize.height\/2);\/\/\u0152\u00aa\u00f7\u221a\u2026\u00cb\u00f7\u221a\u2018\u2044\u2206\u00a1\u0192\u00aa\u00f7\u2013\u2014\u00ce\n    phyArea->setPhysicsBody(physicsBody);\n    addChild(phyArea);\n\n    auto touchListener = EventListenerTouchOneByOne::create();\n    touchListener->onTouchBegan = CC_CALLBACK_2(HelloWorld::onTouchBegan,this);\n    _eventDispatcher->addEventListenerWithSceneGraphPriority(touchListener,this);\n\n    return true;\n}\nbool HelloWorld::onTouchBegan(Touch* touch,Event* event)\n{\n    Goods* goodA = Goods::create();\n    goodA->inition(\"ui\/other\/dropspr.png\", \"alltexiao\/zhadan.csb\", true);\n    this->addChild((Node*)goodA);\n\n    Goods* goodB = Goods::create();\n    goodB->inition(\"ui\/other\/dropspr.png\", \"alltexiao\/gaoneng.csb\", true);\n    this->addChild((Node*)goodB);\n\n    return true;\n}\n\n\n\n\n\nvoid Goods::inition(const std::string& filename, const std::string& efffilename, bool flag)\n{\n    this->initWithFile(filename);\n    this->setPosition(200, 300);\n\n    Node* effNode = CSLoader::createNode(efffilename);\n    ActionTimeline *action = CSLoader::createTimeline(efffilename);\n    action->gotoFrameAndPlay(0, true);\n    effNode->runAction(action);\n    this->addChild(effNode);\n\n    auto size = effNode->getChildByName(\"diaoluo_gaoneng_1\")->getContentSize();\n    body = PhysicsBody::createCircle(size.width\/2, PhysicsMaterial(0.0f,1.0f,0.0f), Vec2(0,0));\n    body->setGroup(-1);\n    this->setPhysicsBody(body);\n\n    if (flag)\n    {\n        float velocityf = 0;\n        velocityDirection = Vec2(0,1);\n        body->setCollisionBitmask(0x400);   \/\/0x01 0001 0x02 0010\n        body->setCategoryBitmask(0xC00);\n        body->setContactTestBitmask(0xC00);\n        body->setGravityEnable(false);\n\n        velocityf = getLeiBaoSuDu();\n        float jiaodu = dropGoodsChuShiRatain();\n        velocityDirection = velocityDirection.rotateByAngle(Vec2(0,0),CC_DEGREES_TO_RADIANS(jiaodu));\n        velocityDirection *= velocityf;\n        body->setVelocity(velocityDirection);\n    }else\n    {\n        body->setVelocity(Vec2(0,0));\n        body->setGravityEnable(false);\n        body->setCollisionBitmask(0x0);\n        body->setCategoryBitmask(0x0);\n        body->setContactTestBitmask(0x0);   \/\/\u00d5\u00ae\u00f7\u2122\u0192\u2039\u2264\u00aa\u0192\u2039\u2248\u02c6\u25ca\u2264\n    }\n\n    scheduleUpdate();\n}\nfloat Goods::getLeiBaoSuDu(){\n    float randValue1 = 100;\n    float randValue2 = 300;\n    int randValue = randValue2 - randValue1;\n    randValue = abs(rand()%randValue) + 1;\n    return randValue1 + randValue;\n}\nfloat Goods::dropGoodsChuShiRatain(){\n    int randValue = 360;\n    randValue = abs(rand()%randValue) + 1;\n    return randValue;\n}\nvoid Goods::update(float dt)\n{\n    Vec2 v = body->getVelocity();\n    if (fabs(velocityDirection.x) != fabs(v.x) || fabs(velocityDirection.y) != fabs(v.y))\n    {\n        CCLOG(\"old: %f  %f  --  new: %f  %f\", velocityDirection.x, velocityDirection.y, v.x, v.y);\n\n    }\n}\n```\n\nlog:\n\n```\nold: -263.113922  -95.765633  --  new: 31.562717  -95.765633\n```\n\nMy test project: http:\/\/vdisk.weibo.com\/s\/u2pFxSLdtiYi\n","comments":[],"labels":["type:bug"]},{"title":"Add SpriteFrame support for AutoPolygon","body":"Right now AutoPolygon only supports generating PolygonInfo's from individual sprite files. We need to create them from a given SpriteFrame (loaded from SpriteFrameCache).\n\nCurrently, there's no direct way to do this.\n","comments":["@zawasp You can specify a rect for sprite sheet, please refer to polygon sprite test case 2.\n\n``` cpp\n    auto filename = s_pathGrossini;\n    Rect head = Rect(30,25,25,25);\n    auto pinfo = AutoPolygon::generatePolygon(filename, head);\n    spp = Sprite::create(pinfo);\n    addChild(spp);\n```\n","@fusijie I know, but there's no direct way of doing it, eg:\n\n```\nauto pinfo = AutoPolygon::generatePolygonFromSpriteFrameName(spriteName);\nspp = Sprite::create(pinfo);\n```\n\nMore (and worse) than this, the AutoPolygon constructor will reload the same SpriteSheet texture file each time it's called, for each SpriteFrame. This takes a lot of time for large spritesheets.\nIt should just lookup the texture name in the texture cache.\n","@zawasp Yes, you are right. Polygon Sprite is not a mature product, and I think we need a detailed discuss about it and relative tool.\n","I've extended SpriteFrameCache to load sprite frames with polygon information from a plist file. The format now contains 3 new optional values which can be used to pass the vertices and triangles:\n- `triangles`:        3 indices per triangle, pointing to vertices and verticesUV coordinates\n- `vertices`:         vertices in sprite coordinates, each vertex consists of a pair of x and y coordinates\n- `verticesUV`:       vertices in the sprite sheet, each vertex consists of a pair of x and y coordinates\n\nThe SpriteFrameCache creates standard quad sprites If these additional values are not present.\n\nThe API from a user's perspective is untouched. You simple load the plist file using\n\n`SpriteFrameCache::getInstance()->addSpriteFramesWithFile(\"spritesheet.plist\");`\n\nThe sprites are created as usual:\n\n`auto sprite = Sprite::createWithSpriteFrameName(\"grossini-dance-05.png\");`\n\nI've just opened a pull request here: https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/14049\n\nPlist files with polygon data can be created using TexturePacker, see: [Performance optimization for cocos2d-x using polygon sprite meshes](https:\/\/www.codeandweb.com\/blog\/2015\/10\/01\/cocos2d-x-performance-optimization)\n","Awesome, will test with the new beta TexturePacker (off-topic: does the 3.x license include an upgrade for 4.x?)\n","@zawasp We don't care about major or minor releases. You get all released that are covered within your upgrade period. E.g. if you have upgrades included until 2015-12 you can use the current version.\n","Does any other solution if i don't have TexturePacker v4 ?\nMaybe we need add generate SpriteFrame AutoPolygon method?\n\nThanks\n"],"labels":["type:request"]},{"title":"AllocatorStrategyFixedBlock crash if app is stopped forcefully","body":"When i quit app forcefully, app crashes here. This happens on OS X\nThing is that _pages are empty when this occurs. This happens when block is initialised but not a single object is instantiated yet.\n\n```\n    AllocatorStrategyFixedBlock\n    do\n    {\n        intptr_t* page = (intptr_t*)_pages;\n        intptr_t* next = (intptr_t*)*page;\n        ccAllocatorGlobal.deallocate(page);\n        _pages = (void*)next;\n    }\n    while (_pages);\n```\n","comments":[],"labels":["type:bug","platform:mac"]},{"title":"SpriteFrame rect offset changing on device, with textures exported from TexturePacker.","body":"I encountered this problem when I started cutting the level in my game in to smaller peices. I am using a sprite atlas exported from TexturePacker. If I move my Cocos2d::Camera (orthographic) in the Y axis the rect for each sprite frame appears to be changing its offset 1 by pixel. It doesn't happen consistently every frame, but maybe every 4-5 frames. \nThere is a visible offset of the spriteframe and I know the rect is changing because I can see the first line of pixels from the frame above that particular frame in the sprite atlas is getting drawn. I've tried every option in TexturePacker and I'm convinced that's not the problem. I'm 99% it's something going wrong in the Cocos2D-x engine.\n\nIt should be fairly simple to reproduce, export a texture pack (sprite atlas) with a few images. Run it on a device, I used iPhone 4S. Then move the camera every frame on the y-axis, I moved it up (+0.1f). I have also tested it on an Android device (Samsung Galaxy Tab 4 10.1) and it still happens.\n\nIt's worth mentioning the problem appears to go away if running on the iOS simulator or in Win32, hopefully that may help to fix it. \n\nIt's also worth mentioning that the problem appears to happen rather sporadically, i.e. it has no set pattern. My first thought was floating point innacuracies in the shader or something.\n","comments":["Oh I forgot to mention, it's much easier to see visually if you set the background clear colour to red or white. It's also easier to see the problem if you disabled anti aliasing. \nsprite->getTexture()->setAliasTexParameters();\n\nDon't misunderstand the cause however, the problem still exists with anti aliasing and no glclearcolour enabled. \n","Thought I'd add a few more comments on this problem. Here's a couple of things about reproducing the bug, make sure to move the camera up or down on the Y-axis, problem doesn't appear on the x-axis movement (this may give clues to fixing it). Make sure to move the camera by 0.05f every frame, this made the bug most noticeable for me, I think it's because this slow movement allows you to see exactly when the sprite gets redrawn at the next line of pixels. Make sure to disable anti aliasing on the sprite frames so the pixel edges are clean.\n\nIt's the top edge of pixels from the frame directly above in the sprite atlas that are drawn, so the sprite frame you test needs to have another frame above it. It's like the rect is offsetting by 1 pixel higher each frame then correcting itself.  \n\nAnother thing, how does the anti aliasing work in cocos? Maybe when you apply anti alias to a sprite frame wouldn't it mix in pixels from other sprite frames outside the sprite frame. I know extrude in texture packing software can solve these problems to an extent. \n\nHope this helps.\n","Thank you for the detailed explanation, we will check this issue later\n","@pandamicro  let me know if you need my help.\n","@pandamicro, @UKDeveloper99  is working on a very tight deadline for a large scale Cocos2d-x game. If we could see about resolving this as soon as makes sense, I think he would appreciate it very much :-)\n","@UKDeveloper99 I I almost understand the problem. but could you please provide me some reproduce codes and resource to avoid my misunderstanding test case. Thank you.\n","@fusijie Sure I'll put something together.\n","Hi @pandamicro @fusijie @ricardoquesada \n\nI put together a small test case using the hello world example project. I used Cocos2D-x v3.4 final from the cocos store, but I'll try later with the newer versions, I have a feeling the bug will still be there however.\n\nHere is the test project, all the code is the in the helloworldscene class. \nhttps:\/\/drive.google.com\/file\/d\/0BzImXAeK77t4Z2dCNEZ4X0d4SHM\/view?usp=sharing\nI packed the sprite atlas separately as well as in the project resources folder for your convenience.\nhttps:\/\/drive.google.com\/file\/d\/0BzImXAeK77t4T3FuNjJjWjA0ZVE\/view?usp=sharing\n\nCouple more notes: I had a bit of a problem recreating it first, it seems the camera positions and sprite positions make a difference.\n","@UKDeveloper99 Thanks for your detailed description and code. I have reproduced this issue and found that the cause may be the texture coordinates. Cocos2d-x provide a precompiled macro `CC_FIX_ARTIFACTS_BY_STRECHING_TEXEL` to use 99% of the texture. You can enable it in the `base\/ccConfig.h`.\n","@fusijie Does the `CC_FIX_ARTIFACTS_BY_STRECHING_TEXEL` fix the issue?\n\nIIRC, I added `CC_FIX_ARTIFACTS_BY_STRECHING_TEXEL` in cocos2d-iphone to prevent some bugs with textures. But actually it was fixing the bugs but it worked ok for some textures.\n","@fusijie @ricardoquesada  I was aware of CC_FIX_ARTIFACTS_BY_STRECHING_TEXEL, however a lot of my research indicated that this option was essentially a hack fix. it's also worth mentionining that there is visual stretching and shrinking of the textures. It really makes the visual quality poor. \n\nI don't think this can realistically be considered as a fix. I really think this issue needs revisiting and looking at some alternative options, judging by the amount of forum posts over the past 5 years it seems to have been a problem that has plagued developers for a while.\n\nAFAIK there is another hacky solution, you can also avoid the problem occuring by rounding sub pixel coordinates, but this means all coordinates, including parent nodes etc. And I don't think this works when anything is scaled. So yeah, someone brave want to have a look in to a proper fix for this?\n","@ricardoquesada \nlook familiar?\n\nhttp:\/\/forum.spritebuilder.com\/t\/possible-bug-of-cocos2d-texture-packer\/11429\n\nhttps:\/\/code.google.com\/p\/cocos2d-iphone\/issues\/detail?id=1345\n\nThe first link has a post which I believe describes the exact cause of the issue.\n","That does mention about the float precision in the shader, I haven't tried that yet, but it seems like a more sensible fix. Is there any big performance implications to having high precision floats in the shader?\n\nEdit: seems it does have a noticeable performance hit on some lower end devices.\n","http:\/\/blog.seasons.cc\/entry\/20101231\/1293802694\n","@UKDeveloper99  absolutely... that's why I was surprised that `CC_FIX_ARTIFACTS_BY_STRECHING_TEXEL` fixed the issue.\n\n@pandamicro @fusijie could you please check this issue again with the info posted by @UKDeveloper99 ? Thanks.\n","Ok, @fusijie is checking it\n","@UKDeveloper99 @ricardoquesada I have refined the test case on [my branch](https:\/\/github.com\/fusijie\/cocos2d-x\/tree\/check_spriteframebug). There are some similar issues happened and people either enable `CC_FIX_ARTIFACTS_BY_STRECHING_TEXEL` or `setAntiAliasTexParameters()` (implemented by use GL_LINEAR Filtering mode internally) to cover it, but it seems as hack fix. I have not found the solution now, but I want to update my research by now.\n\nI removed camera, and just moving the sprite per frame.\n\n**Contrast Tests**\n- Test1: Separate, single image. Nothing unusual.\n- Test2: SpriteFrame: `levelone_pack_complete1.plist\/png`\n  - Packing the **single** image by TexturePacker. the origin size is 250 \\* 30, but output size is 254 \\* 34, the four direction edge have 2 transparent pixels. \n    <img width=\"295\" alt=\"2015-07-21 17 23 44\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/5085300\/8797363\/7f1e6032-2fcd-11e5-9b06-c70ba92b71ca.png\">\n  - Run the test, we can see the **flash line** between two rectangle.\n  - Log the vertices position info(after transformed), which is the **same** as separate image. so, _the vertices position is not the cause_.\n  - But notice that now the texture coordinate is **not** from 0 to 1.\n- Test3: SpriteFrame: `levelone_pack_complete2.plist\/png`\n  - I copied the Test2 png&plist, **removed** the four direction edge's 2 transparent pixels and modified corresponding plist info(You can change the border padding setting of TexturePacker also). Now the size of png is 250 \\* 30.\n    <img width=\"228\" alt=\"2015-07-21 17 24 22\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/5085300\/8797370\/883ea528-2fcd-11e5-9a1a-146f36ee958c.png\">\n  - Run the test, the flash line disappeared.\n  - Now the  texture coordinate is from 0 to 1 again.\n- Test4: SpriteFrame: `levelone_pack_complete3.plist\/png`\n  - I copied the Test2 png&plist, change the four direction edge's 2 transparent pixels  to **white color**.\n    <img width=\"270\" alt=\"2015-07-21 17 25 00\" src=\"https:\/\/cloud.githubusercontent.com\/assets\/5085300\/8797377\/93216016-2fcd-11e5-9f86-b5b82f2f9afc.png\">\n  - Run the test, we can see the **white flash line** between two rectangle.\n  - Notice that now the texture coordinate is **not** from 0 to 1.\n  - _So It seems that texture sampler precision deviation issue_.\n\n**Other Tests**\n- Test1: SpriteFrame: `levelone_pack_complete4.plist\/png`\n  - Use **POT**. but there is no improvement.\n- Test2: Improve precision-qualifier\n  - replace mediump with **highp**. but there is no improvement. \n- Test3: Log the texture coordinate.\n  - The four vertices' texture coordinate is constant.\n    Any thoughts?\n","@fusijie A couple of things, I'm fairly sure you can't reproduce the issue if the single image occupies the entire texture pack. It's something to do with the texture coordinates that are < 1 and > 0 I think.\n\nAlso if this was the case then a regular sprite would also have the same issue.\n\nI think CC_FIX_ARTIFACTS_BY_STRECHING_TEXEL just masks the issue, because when the flash line appears the texture is stretching to fill that area (by 1 pixel) and then it returns to it's original size. It does this over and over. \n\nIt's like the rect size (of the frame) is deviating when the flash line appears.\n\nJust my thoughts.\n\nMaybe @ricardoquesada  has some ideas.\n","@UKDeveloper99 yes, you are right, but Test2 and  Test4 both have a 2 pixels padding, and Test3 just as a contrast test. No matter CC_FIX_ARTIFACTS_BY_STRECHING_TEXEL or setAntiAliasTexParameters only to cover the issue. Sorry for my poor English...\n","@fusijie Your English is fine :) Hmm unless I was sat trying to fix the issue myself I'm not sure what to suggest. Can you look at some more things in the debugger. See if the sprite frame rect is changing somewhere maybe?\n\nAlso I remember making a test with 0 padding and several frames and I was still experiencing the issue. I don't think the padding makes a difference.\n","@fusijie Please, create a test case that reproduces this bug, call it \"Bug #12847\" and send a Pull Request with the test case.\nIf you cannot fix it, I'll take a look at it.\nthanks\n","@fusijie One more thing. Please, make sure to add the test in the \"cpp-tests\" -> \"bugs\" section.\nThanks!\n","@fusijie thanks. I'm working on the bug now.\n","I haven't fixed the bug, and I'm not sure what is the best strategy to fix it yet.\n\nI continued with @fusijie 's test and replaced the top line with Pink and the bottom line with Yellow.\nThe example from the left is using simple sprites. The example from the right is using `SpriteFrame`.\nAs you can see the example from the left doesn't show the \"gap\", the background red line, because it is drawing the top line (Pink) twice.\nAnd the example from the left has the gap because it is not drawing the top line twice.\n\n![img_3436](https:\/\/cloud.githubusercontent.com\/assets\/232330\/8837885\/b834029a-307d-11e5-95b8-4436b2d66a3b.PNG)\n\nSo, my suggestions for the moment are:\n- If you are not doing a 3d game, set the `Director` projection to `Director::Projection::_2D`\n- Use the extrude option in TexturePacker with a 2 pixel pad.\n\nMore info about this bug:\n- This happens on regular sprites as well... sprites that use the whole texture (0,1), but it less noticeable\n- Yes, the bug is related to subpixeling, but turning on `highp` won't necessarily fix all the problems\n- `CC_FIX_ARTIFACTS_BY_STRECHING_TEXEL` might solve it, but it is not the real fix.\n","Pull Request that improves that test case: https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/12964\/files\n","@ricardoquesada interesting, I have seen some posts on forums about setting the projection to 2D. It's definitely not a straightforward bug. Keep up the good work, I'm sure you'll find the fix :) !\n","@UKDeveloper99  have you tried with \"extrude + 2 pixels of padding\/border\"? did it work?\n","@ricardoquesada I believe I tried it before and it didn't make a difference, but I'll try it again now and see if it makes a difference, so for clarity I will use. Extrude: 1, Padding: 2, Border: 2 and Projection::_2d\n","yes, please. thanks.\n","@ricardoquesada Yes I can confirm this appears to look correct to me. It's a little difficult to tell with the extrude option as obviously the outer edge of pixels looks identical so without a pink or yellow line like you have used you it's a little difficult to see. But it definitely doesn't look anywhere near as bad as the CC_FIX_ARTIFACTS_BY_STRECHING_TEXEL fix, with the visual stretching and shrinking. I don't think the top line of extruded pixels is flashing in and that's the most important thing.\n\nI still think the underlying cause needs to be resolved and I hope you can get it in to v3.8 as planned (e.g. other developers may run in to this problem and not be able to find this workaround). However I can work with this solution for now. Thanks.\n","@ricardoquesada @fusijie out of interest is there any performance implications or features that may stop working with 2D projection?\n","2d projection is not really needed. But if you are not going to use 3d features, I suggest using it. No performance implications in using one or the other.\n\nCreating spritesheets with extrude and 2 pixels of padding\/border is pretty much what I have been recommending from day one in cocos2d-iphone and cocos2d-x. All spritesheets must be created like that.\n\nYou are not triggering the bug you mentioned before... that one could be fixed by using `highp`.\nYou are triggering another one, which could be fixed by using extrude + border, or by changing some shaders to round up\/down the floats...\nI think this bug is low priority right now since the workaround is trivial to implement... and perhaps the \"real fix\" will have performance implications.\n","@ricardoquesada I know they are recommended, when you select the cocos2d preset in TexturePacker in turns them on for you. I was experimenting with them turned off because when I was trying to fix the original bug they weren't making a difference. \nOf course they help with the various OpenGL artifacts\/issues that can crop up, as can pre multiplied alpha.\n\nI don't think using highp is an option, I tested that last week and it really makes a difference to the fps. And obviously the more stuff you have in the scene the more noticeable that difference is.\n\nI did experiment with rounding, initially I thought it might help if all the positions were on rounded coordinates. Something like.... floor(position.x + 0.5f) as an example. That didn't help. I wouldn't know which parts to round in the shader.\n\nHmm I agree the workaround is trivial, but the fact is unless it is put in to the documentation\/ programmers guide. The average user isn't gona know what they need to do to fix it. It's trivial for you and me but it's not something that's enabled by default. \n\nI highly agree that if the \"real fix\" has performance implications then it can't be considered at all, it would be interesting to know if you had some idea of what the \"real fix\" might be, just out of curiosity.\n","@UKDeveloper99  good point. We should put it in the Programmers Guide!\n\nThe \"real fix\" has to do with subpixeling... at least that is my understanding of this problem. And the fix is to prevent subpixeling.\n\nSo, rouding the pixels, as you said before, should fix this. But I wouldn't know right now what is the best way to do it.\n","@slackmoehrle Programmers Guide^\n","Yes, we should definitely add. If you want to take a pass at the content to\nadd I can then put it in the correct format, make sure it makes sense, etc,\netc.\n\nOn Fri, Jul 24, 2015 at 11:49 AM, Mark notifications@github.com wrote:\n\n> @slackmoehrle https:\/\/github.com\/slackmoehrle Programmers Guide^\n> \n> \u2014\n> Reply to this email directly or view it on GitHub\n> https:\/\/github.com\/cocos2d\/cocos2d-x\/issues\/12847#issuecomment-124563880\n> .\n","@slackmoehrle sure, if I get a spare moment. This project is really intense at the moment.\n"],"labels":["type:bug"]},{"title":"Label:draw incorrectly with Simsun font if font size lower than 19.","body":"![screenshot_1_1435559518](https:\/\/cloud.githubusercontent.com\/assets\/5234286\/8668868\/20d79326-2a42-11e5-8d84-a6533c6f50e6.png)\n","comments":["@pandamicro  It can not be finished in 3.9 due to the time limit. I planning to fix this issue in future version.\n"],"labels":["type:bug"]},{"title":"wrong clipping effect of ScrollView while rotated","body":"if rotation is 90 or -90, it will total black.\nbetween 0 and 90, the clipping is always screen direction's rect\n","comments":["@zeas2 \nWhat's the engine version?\nThe target platform? iOS or Android or Desktop?\nWhat's the code snippet to reproduce this issue?\nThanks.\n"],"labels":["type:bug"]},{"title":"ScrollView::onTouchBegan miss touch while rotated","body":"original code is \"convert rect frame and check is touch hit in\"\nthe implemention of Widget::onTouchBegan is \"convert touch point to self node space and check\"\n","comments":["Solution proposed: https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/12793\n@zilongshanren Please take a look\n"],"labels":["type:bug"]},{"title":"Mechanism to pass event to lua is inconsistent","body":"- pass `update` event to lua\n\nThere is `Node::scheduleUpdateWithPriorityLua()`, so you can receive update event in lua like this\n\n``` lua\nlocal function update(dt)\n...\nend\nsprite:scheduleUpdateWithPriorityLua(update, 0)\n```\n- pass `onEnter`, `onExit` event to lua\n\nYou should write like this in lua\n\n``` lua\nlocal function onNodeEvent(event)\n...\nend\nsomeNode:registerScriptHandler(onNodeEvent)\n```\n\n`registerScriptHandler()` is not a member function of any Node, if you want to invoke this function on a Node, you should write lua-binding codes yourself.\n\nAdd functions in Node like `Node::scheduleUpdateWithPriorityLua()` is not a good idea. Write binding-codes for every Node that want to receive events is more bad.\n","comments":[],"labels":["script:lua"]},{"title":"Schedule::dispatchCustomEvent() is skipped in lua-binding","body":"As you can see [here](https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/v3\/tools\/tolua\/cocos2dx.ini#L114), `Schedule::dispatchCustomEvent()` is skipped. \n\nIs there any reason to skip this function?\n","comments":["dispatchCustomEvent is done in pure script for JS: https:\/\/github.com\/cocos2d\/cocos2d-x\/blob\/v3\/cocos\/scripting\/js-bindings\/script\/jsb_cocos2d.js#L1649\n\nI think it can be done equally in Lua in the same way\n","Ok, I see, the reason this API have been skipped is that `void *` can not be converted in auto bindings, so I suggest to bind this function manually.\nhttps:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/12788\/files\n\nPR reverted: https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/12791\n","Yep, there is an optional parameter that accepts `void*`.\n","Any news?"],"labels":["type:bug","script:lua"]},{"title":"getPhysicsWorld()->setAutoStep(false) physics initialization issue in 3.7 rc0","body":"```\n\/\/ Description of Bug\n\/\/-------------------\n\/\/ Sometimes the physics sprites are not setup\/initialized properly when\n\/\/ getPhysicsWorld()->setAutoStep(false) is used.\n\/\/ e.g. a manual physics step is used instead of the auto phyiscs step.\n\n\/\/ When using manual step for the integrated physics e.g. getPhysicsWorld()->setAutoStep(false) and\n\/\/ getPhysicsWorld()->step(dt) is manually called in an update loop, there seems to be physics\n\/\/ and sprite initialization issues.\n\/\/\n\/\/ If a method is scheduled from inside of a callback, and that method replaces the current scene,\n\/\/ for some reason the initialization of Physics objects, sprites, etc do not work as expected (when\n\/\/ using manual physics step).\n\/\/\n\/\/ When the button callback directly calls the replace scene, the strange behavior does occur, but\n\/\/ it occurs less often than when a method is scheduled inside of the callback and the schedduled\n\/\/ method replaces the scene.\n\/\/\n\/\/ I think that the HttpClient also schedules methods from the asyc completion to try to get back on\n\/\/ the main thread. It was the use of HttpClient where I first noticed this issue.\n\n\/\/----------------------\n\/\/ Steps to Recreate Bug\n\/\/----------------------\n\/\/ To recreate the issue:\n\/\/ Clone the github repo located at: https:\/\/github.com\/jimrange\/cocos2dxPhysicsBug\/tree\/manualStep12691\n\/\/ View Video of the behavior: https:\/\/youtu.be\/WGzviqqClRo\n\/\/ In HelloWorld.cpp, enable USE_PHYSICS_MANUAL_STEP and\n\/\/ enable SCHEDULE_SELECTOR_IN_MENU_CALLBACK below.\n\/\/ Then run the app and press the button in the lower right corner to replace the scene.\n#define USE_PHYSICS_MANUAL_STEP 1\n#define SCHEDULE_SELECTOR_IN_MENU_CALLBACK 1\n\n\/\/----------------------------\n\/\/ Work-around Fix (temporary)\n\/\/----------------------------\n\/\/ A hack work-around to fix the initialization issue described above is to delay calling\n\/\/ getPhysicsWorld()->setAutoStep(false) and delay the manual calling of getPhysicsWorld()->step(dt).\n#define DELAY_CHANGING_TO_MANUAL_PHYSICS_STEP 1\n\n\n\/\/----------------------------\n\/\/ Worth looking into this\n\/\/------------------------\n\/\/ Forcing the replace scene to the main thread seems to fix the issue. However, the initial setup on\n\/\/ launch still seems to have unexpected behavior when using a manual physics step.\n\/\/ To enable FORCE_REPLACE_SCENE_TO_MAIN_THREAD, you must also rename this file to HelloWorldScene.mm.\n#define FORCE_REPLACE_SCENE_TO_MAIN_THREAD 0\n\n\/\/ Calling the setup from the init method or from the onEneter did not seem to make a difference\n\/\/ regarding this bug.\n#define CALL_SETUP_IN_ON_ENTER 0\n```\n","comments":["Hopefully this bug can be confirmed and added to 3.8. \nI think this is a critical bug since it results in strange and unexpected behavior, essentially making the physics wrapper unusable without the temporary workaround I mentioned above.\n","I think it is important to fix this. A workaround I use is to use scheduleOnce to set autoUpdate = false and manually guarantee this scheduleOnce is the first one to be executed.\n","@dredok, can you provide more information about how you manually guarantee that the scheduleOnce is the first one to be executed. I am having some inconsistent results with the workaround that I proposed and want to try your fix.\n","I figured out another hack that helps to stabilize the physics world initialization.\nThe delay in changing from autostep to manual step that I described as my workaround had an issue.\nTo fix the issue, I do the following immediately after creating the scene that has physics enabled.\n\n```\n_scene->getPhysicsWorld()->setSpeed(0);\n```\n\nThen after a short delay I call getPhysicsWorld()->setAutoStep(true) and start stepping the physics simulation.\n","@WenhaiLin, did you have any issues reproducing this issue?\nJust curious why it is marked as unconfirmed.\n","@jimrange \nBy manually I mean that I know the flow of my instances and so I schedule this on a node which will be updated before any other node (for instance, the layer where physics world resides, which  I know has more priority than any of its children). That's dirty and that's what I mean by \"manually guarantee\".\n","Hi , Any possible fix for this issue?"],"labels":["type:bug"]},{"title":"EXC_BAD_ACCESS on Transition on OSX 10.11 beta 2","body":"The problem is in the file **CCTransition.m**\n\nWhen method \n`-(void)draw:(CCRenderer *)renderer transform:(const GLKMatrix4 *)transform`\ntries to run, the objc_msgSend call causes EXC_BAD_ACCESS.\n\nI fixed it changing this\n<code>typedef id (*Func)(id, SEL);\n((Func)objc_msgSend)(self, _drawSelector);<\/code>\n\nto this\n<code>void (_Func)(id, SEL) = (void (_)(id, SEL)) objc_msgSend;\nFunc(self, _drawSelector);<\/code>\n\nI checked in Github and the problem is still there in the last version.  I am using cocos2d V3 3.3.\nHope this helps to improved this great product!\n","comments":["Correction: Needed an asterisk\n\nvoid (Func)(id, SEL) = (void (*)(id, SEL)) objc_msgSend;\nFunc(self, _drawSelector);\n","![screen shot 2015-10-07 at 12 38 46 pm](https:\/\/cloud.githubusercontent.com\/assets\/11290022\/10331134\/6d060c6e-6cf0-11e5-8f17-757ef0e61aaf.png)\n\ni also got same issue after i update my Mac OS to 10.11 ,while i am running sample build while click on ENOUGH PINK to goto next scene while transitioning to other scene i got this \ncan any one help me out \n","@AnkoosMohd - Replaced that error with the code provided above.\n","![screen shot 2015-10-07 at 12 50 11 pm](https:\/\/cloud.githubusercontent.com\/assets\/11290022\/10331315\/03c4650a-6cf2-11e5-97df-27733ce3de73.png)\nafter updating code provided above i got another error \n","finally i got it its resolved by this code \n\n void (_Func)(id, SEL) = (void(_)(id, SEL)) objc_msgSend;\n    Func(self, _drawSelector);\n\nhere asterisk are not showing when we paste code check in below screen shot\n","![screen shot 2015-10-07 at 12 53 17 pm](https:\/\/cloud.githubusercontent.com\/assets\/11290022\/10331371\/6f5ce882-6cf2-11e5-8819-a7d976b08ded.png)\n","thanks a lot, worked for me also!\n"],"labels":["type:bug","platform:mac"]},{"title":"LabelTTF enableStroke have no effect in JSB","body":"cocos js 3.6.1 jsb\u4e0benableStroke\u4e0d\u751f\u6548\n","comments":["cc.LabelTTF\u7684enableStroke\u65b9\u6cd5~\n"],"labels":["type:bug","script:jsb"]},{"title":"JSB cc.easeBounceIn(...).reverse is not a function","body":"> I read api document said cc.EaseBounceIn has a static function named\n> \"reverse\" , it works in html5 but reports TypeError in jsb.\n> here is the code i wrote\n> moveY.easing(cc.easeBounceIn().reverse());\n\nSynced from here: https:\/\/github.com\/cocos2d\/cocos2d-js\/issues\/1777\n","comments":[],"labels":["type:bug","script:jsb"]},{"title":"WinRT Unicode failure","body":"Cocos2d-x is incorrectly converting from Unicode to UTF-8  in WinRT and therefore apps are crashing for users having username with non-Latin symbols.\n\nE.g., for Windows 8.1 user with name \"M\u0101ris\", writable path should be `\"C:\/Users\/M\u0101ris\/AppData\/...\/LocalState\/\"`\nBut `FileUtils::getInstance()->getWritablePath();`\nis returning `\"C:\/Users\/M\\x1ris\/AppData\/...\/LocalState\/\"` instead, which is invalid file path.\n\nWith this bug it is not possible to store any user data. `UserDefault` class is not working for the same reason\n","comments":["@kmbriedis  We will look into this.\n"],"labels":["type:bug"]},{"title":"WebView has a white edge on iPhone 5","body":"![iphone 5](https:\/\/cloud.githubusercontent.com\/assets\/5220134\/8422702\/ae27aa90-1f11-11e5-9965-8e3136e9dedf.PNG)\n![iphone 6 plus](https:\/\/cloud.githubusercontent.com\/assets\/5220134\/8422704\/b2f227e4-1f11-11e5-9a71-f6aa91704d61.PNG)\n\nCocos2d-x 3.3 with Lua\niPhone 6 Plus(Bottom) is nice while iPhone 5 leaving white edge. \niPhone 6 is the same as iPhone5\n","comments":["@RaoZiJian  How to reproduce? Could you make a sample demo?\n"," local url = \"http:\/\/caipiao.163.com\/nfop\/crazythreeabout\/index.htm\"\n local webView = ccexp.WebView:create()\n        :size(scrollSize)\n        :align(display.BOTTOM_CENTER, alignX, bottomY)\n        :addTo(self.frame)\n    webView:loadURL(url)\n    webView:setScalesPageToFit(true)\n","![common_window_bg_3](https:\/\/cloud.githubusercontent.com\/assets\/5220134\/8422930\/7f67eee2-1f14-11e5-90fd-63f0456b20ea.png)\nThis is the self.frame, it is just a background of the webView in the previous code\n","The scrollSize is about cc.size(649, 381)\n","I cannot make a new demo at right now\n","We modify the native code of webView on iOS to modify the background, and this issue has been avoided.\n\nself.uiWebView.backgroundColor = [UIColor clearColor];\n\nSo a suggestion is to add a \"setBackgroundColor(color3B)\" api to allow the developers modify the backColor by themselves to keep this bug from the logic.\n","@RaoZiJian Thanks. I will add this API in v3.8.\n"],"labels":["type:bug","platform:ios"]},{"title":"crash in mac","body":"![10e70ce4-ddcf-46b1-9737-17b928c9c3c1](https:\/\/cloud.githubusercontent.com\/assets\/5369941\/8395232\/bfb96a90-1d96-11e5-9131-eb5b4f87fd2f.png)\n\nin cocos2d-x 3.5,http response statue is 304, game has crash because statusString is nil\n","comments":[],"labels":["type:bug"]},{"title":"fbx-conv \"loses\" clamping on materials","body":"Fbx-conv has a bug where we seem to \"lose\" whether a file has clamping on its textures or not. A working .obj file with clamping set to true for materials will have wrapModeU and wrapModeV set to REPEAT in the converted c3t file (and corresponding c3b) instead of \"CLAMP\".\n\nIf needed, send me an email and I can send an example material and obj file.\n","comments":["A sample obj file is at http:\/\/tf3dm.com\/3d-model\/hn48-flying-car-10381.html . fbx-conv also loses the directory structure so I had to move the textures from the Maps folder to the main folder (I guess another bug) but I am a 3d newbie so please let me know if it's because I'm clueless to something.\n"],"labels":["type:bug"]},{"title":"I change a file in Resources but it does not have an effect on Windows","body":"Formerly when I was using cocos2d-x 3.2 the files were looked in Resources folder for windows applications. Hence, when I had a configuration file with game settings I could easily change some values and re-run the game and see what is changed. But now in cocos2d-x 3.5 the content of Resources is copied into `proj.win32\/Debug.win32` during Pre-Link Event which in Visual Studio is setup as follows:\n\n`xcopy \"$(ProjectDir)..\\Resources\" \"$(OutDir)\" \/D \/E \/I \/F \/Y`\n\nHence when I change .plist of .json file and re-run game without rebuilding it does not take effect - old resources are being used. The same is for graphics and shaders and it is very painful each time to delete from `proj.win32\/Debug.win32` and also change a line in a source code to get it recompiled on run and copied the files into `proj.win32\/Debug.win32`. Please address this extreme unhandy behavior.\n\nMore details here: http:\/\/discuss.cocos2d-x.org\/t\/i-change-a-file-in-resources-but-it-does-not-have-an-effect-on-windows\/21067\n","comments":["The workaround I use for this is add the xcopy command to the post link step, bind a shortcut to link your project, and hit that shortcut each time you want to use the updated file. Otherwise we're stuck with the current functionality.\n","@tankorsmash could you be more specific how you have solved this problem. What we should change in project settings? And couldn't it be included into Cocos2d-x default settings?\n","It's not ideal, so I'd rather a better fix be implemented, rather than this hacky workaround. \n\nIn your projects properties, go to Build Events -> Pre-Link Event, add \n\n```\nif not exist \"$(OutDir)\" mkdir \"$(OutDir)\"\nxcopy \/Y \/Q \"$(EngineRoot)external\\websockets\\prebuilt\\win32\\*.*\" \"$(OutDir)\"\nxcopy \"$(ProjectDir)..\\Resources\" \"$(OutDir)\" \/E \/I \/F \/Y  \/D \/K\n```\n\nI copied most of that from the post-build event, but it doesn't seem to hurt to be there either.\n\nIn Tools -> Options -> Environment -> Keyboards -> look up 'link' -> click Build.Link -> bind to key (I used Ctrl Shift G, globally.\n\nNow each time you change a resource file, open VS and hit Ctrl Shift G, it'll copy over the resources, if they're newer than the ones already copied.\n","Hi,\nwhy is this file not copied like the rest of the files from the src folder ?\n","This issue is still actual for me on linux build.","It works for me on Linux. Tell me more about your setup.","what @v1993 said fixed at https:\/\/github.com\/cocos2d\/cocos2d-x\/pull\/18816"],"labels":["platform:win32"]},{"title":"CCVector erase wrong element","body":"I use cocos2d-x with box2d. I have a joint (called A) linked with a node (called B). Joint A and node B have the same parent and A comes before B in their parent's children list. When I remove B from the scene, joint A will also be removed because box2d is integrated.\n\n```\niterator erase(ssize_t index) {\n        CCASSERT(!_data.empty() && index >=0 && index < size(), \"Invalid index!\");\n        auto it = std::next( begin(), index );\n        (*it)->release();\n        return _data.erase(it);\n}\n```\n\n`it` will point to wrong element after `(*it)->release()` is executed.\n","comments":["could you add the code to reproduce it? thanks.\n"],"labels":["type:bug"]},{"title":"LabelTTF appear similar to stroke under the WEB ","body":"Cocos 2d-js 3.6\n\n``` js\n        var yellowBox = new cc.LayerColor(cc.color(171,229,231,255), size.width, size.height);\n        this.addChild(yellowBox);\n\n        var helloLabel = new cc.LabelTTF(\"Hello World\", \"Arial\", 72);\n        helloLabel.x = size.width \/ 2;\n        helloLabel.y = size.height \/ 2;\n        this.addChild(helloLabel);\n```\n\nRun on chrome, safari:\n![screen shot 2015-06-19 at 2 16 30 pm](https:\/\/cloud.githubusercontent.com\/assets\/3455415\/8248159\/3585ea74-168e-11e5-8168-e4dc1863bf41.png)\n\nRun on simulator:\n![screen shot 2015-06-19 at 2 25 27 pm](https:\/\/cloud.githubusercontent.com\/assets\/3455415\/8248228\/085f8e32-168f-11e5-8010-709593dace5e.png)\n","comments":["Any update on this issue?\n"],"labels":["platform:web"]},{"title":"It is time to support resizable Open GL view\/window","body":"Currently desktop version doesn't support resizing like normal windows. We should be able to resize window, and with that resize OpenGl view. There should be some kind of callback that will return us new visible size, so we can reposition all elements on the screen. This will give us option to test different aspect ratios while resizing a window. This should also be implemented with all other platforms. Since beginning iOS9 and split view, app can be resized while running.\n\nBefore i've switched to cocos2d-x i was using LibGDX, and that feature helped me to develop games easily for all aspect ratios, since i was dynamically positioning elements depending on the screen size.\n","comments":[],"labels":["type:request"]},{"title":"Bug: isTargetPaused return a function rather than a Boolean.","body":"`2d-js v3.6.1`\n\nIf call function \"cc.director.getScheduler().isTargetPaused(target)\" and not call \"scheduleUpdateForTarget(target)\",  the isTargetPaused will return a function rather than a Boolean.\n\nExpected a Boolean value.\n","comments":["On web ? or native ?\n","native\n"],"labels":["type:bug"]},{"title":"set attachment of a spine after create it immediately will not take effect.","body":"Here is the code snippet.\n\n```\n\n    local spine = sp.SkeletonAnimation:create(  \"spine\/\" .. spineFileName .. \".json\", \n                                         \"spine\/\" .. spineFileName .. \".atlas\")\n\n    -- set after a frame, will take effect\n    local dc = delaycall(1\/60, function()\n        local attachmentOk = spine:setAttachment('spellbutton', attachmentName )\n        end)\n    self:runAction(dc)\n\n    -- this is a bug, set attachment takes no effect\n\n    -- local attachmentOk = spine:setAttachment('spellbutton', attachmentName )\n    -- print('attachmentOk = ', attachmentOk)\n    -- assert(attachmentOk, 'attach ment set failed!')\n\n    spine:setAnimation(0, 'idle', true)\n\n    spine:setPosition(cc.p(self.gridWidth\/2, self.gridHeight\/2))\n    self:addChild(spine)\n    return spine\n\n```\n","comments":[],"labels":["type:bug"]},{"title":"3.6 cocos luacompile error","body":"1. my lua code was in src1\/\n2. I try to use  \"cocos luacompile -s src1\/ -d src\/ -e -k 123456 -b 123456 --disable-compile\" to compile lua code, but can not open the game after compile.  And I create a new lua runtime template project, use the same \"cocos luacompile -s src1\/ -d src\/ -e -k 123456 -b 123456 --disable-compile\", have the same problem. However, only use \"cocos luacompile -s src1\/ -d src\/\" is OK. is XXTEA have problem?\n3. I try change the key and sign, still have the problem.\n","comments":[],"labels":["script:lua"]},{"title":"Notify when API is not compatible in JSB for Chipmunk classes","body":"Originally reported in : http:\/\/discuss.cocos2d-x.org\/t\/properties-missing-from-chipmunk-body-on-compiled-js-app\/21908\n","comments":[],"labels":["script:jsb"]}]