[{"title":"BUG:  Unexpected Styler.format behavior","body":"### Pandas version checks\n\n- [X] I have checked that this issue has not already been reported.\n\n- [X] I have confirmed this bug exists on the [latest version](https:\/\/pandas.pydata.org\/docs\/whatsnew\/index.html) of pandas.\n\n- [X] I have confirmed this bug exists on the [main branch](https:\/\/pandas.pydata.org\/docs\/dev\/getting_started\/install.html#installing-the-development-version-of-pandas) of pandas.\n\n\n### Reproducible Example\n\n```python\ndf = pd.DataFrame([\"_\"])\r\nstyler = df.style.format(lambda x: x.replace(\"_\", \"A\"), escape=\"latex\")\r\nprint(styler.to_string())\n```\n\n\n### Issue Description\n\nThe code returns `\\A` instead of `A`. \r\n```\r\n0\r\n0 \\A\r\n```\r\n\r\nThis is because instead of `escape(format(val))`: `_` -> `A` -> `A`\r\n\r\npandas does `format(escape(val))` instead: `_` -> `\\_` -> `\\A`\n\n### Expected Behavior\n\n```\r\n0\r\n0 A\r\n```\n\n### Installed Versions\n\n<details>\r\n\r\nINSTALLED VERSIONS\r\n------------------\r\ncommit                : 05f75c65d4daeee151e8f423ee133a283492ee44\r\npython                : 3.10.13.final.0\r\npython-bits           : 64\r\nOS                    : Darwin\r\nOS-release            : 23.3.0\r\nVersion               : Darwin Kernel Version 23.3.0: Wed Dec 20 21:30:59 PST 2023; root:xnu-10002.81.5~7\/RELEASE_ARM64_T6030\r\nmachine               : arm64\r\nprocessor             : arm\r\nbyteorder             : little\r\nLC_ALL                : None\r\nLANG                  : None\r\nLOCALE                : None.UTF-8\r\n\r\npandas                : 3.0.0.dev0+267.g05f75c65d4\r\nnumpy                 : 1.26.4\r\npytz                  : 2024.1\r\ndateutil              : 2.9.0\r\nsetuptools            : 69.2.0\r\npip                   : 24.0\r\nCython                : 3.0.9\r\npytest                : 8.1.1\r\nhypothesis            : 6.99.6\r\nsphinx                : 7.2.6\r\nblosc                 : None\r\nfeather               : None\r\nxlsxwriter            : 3.1.9\r\nlxml.etree            : 5.1.0\r\nhtml5lib              : 1.1\r\npymysql               : 1.4.6\r\npsycopg2              : 2.9.9\r\njinja2                : 3.1.3\r\nIPython               : 8.22.2\r\npandas_datareader     : None\r\nadbc-driver-postgresql: None\r\nadbc-driver-sqlite    : None\r\nbs4                   : 4.12.3\r\nbottleneck            : 1.3.8\r\nfastparquet           : 2024.2.0\r\nfsspec                : 2024.2.0\r\ngcsfs                 : 2024.2.0\r\nmatplotlib            : 3.8.3\r\nnumba                 : 0.59.0\r\nnumexpr               : 2.9.0\r\nodfpy                 : None\r\nopenpyxl              : 3.1.2\r\npyarrow               : 15.0.1\r\npyreadstat            : 1.2.7\r\npython-calamine       : None\r\npyxlsb                : 1.0.10\r\ns3fs                  : 2024.2.0\r\nscipy                 : 1.12.0\r\nsqlalchemy            : 2.0.28\r\ntables                : 3.9.2\r\ntabulate              : 0.9.0\r\nxarray                : 2024.2.0\r\nxlrd                  : 2.0.1\r\nzstandard             : 0.22.0\r\ntzdata                : 2024.1\r\nqtpy                  : None\r\npyqt5                 : None\r\n\r\n\r\n<\/details>\r\n","comments":[],"labels":["Bug","Needs Triage"],"number":57980},{"title":"ENH: Add leftsemi merge","body":"- [ ] closes #42784 (Replace xxxx with the GitHub issue number)\r\n- [ ] [Tests added and passed](https:\/\/pandas.pydata.org\/pandas-docs\/dev\/development\/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature\r\n- [ ] All [code checks passed](https:\/\/pandas.pydata.org\/pandas-docs\/dev\/development\/contributing_codebase.html#pre-commit).\r\n- [ ] Added [type annotations](https:\/\/pandas.pydata.org\/pandas-docs\/dev\/development\/contributing_codebase.html#type-hints) to new arguments\/methods\/functions.\r\n- [ ] Added an entry in the latest `doc\/source\/whatsnew\/vX.X.X.rst` file if fixing a bug or adding a new feature.\r\n\r\nI want to add anti joins as a follow up, which can be incorporated into the new class","comments":[],"labels":["Enhancement","Reshaping"],"number":57979},{"title":"BUG: Wrong kurtosis outcome due to inadequate fix to previous issues","body":"### Pandas version checks\n\n- [X] I have checked that this issue has not already been reported.\n\n- [X] I have confirmed this bug exists on the [latest version](https:\/\/pandas.pydata.org\/docs\/whatsnew\/index.html) of pandas.\n\n- [X] I have confirmed this bug exists on the [main branch](https:\/\/pandas.pydata.org\/docs\/dev\/getting_started\/install.html#installing-the-development-version-of-pandas) of pandas.\n\n\n### Reproducible Example\n\n```python\nimport polars as pl\r\nimport pandas as pd\r\nimport numpy as np\r\nimport scipy.stats as st\r\n\r\ndata = np.array([-2.05191341e-05,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,\r\n        0.00000000e+00, -4.10391103e-05,  0.00000000e+00,  0.00000000e+00,\r\n        0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,\r\n        0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,\r\n        0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,\r\n        0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,\r\n        0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  0.00000000e+00,\r\n        0.00000000e+00])\r\n\r\nprint(pl.Series(data).kurtosis())\r\nprint(pd.Series(data).kurt())\r\nprint(st.kurtosis(data))\n```\n\n\n### Issue Description\n\nThe output of `pandas` kurtosis function is incorrect. \r\n\r\nAfter simple debugging I found a comment at `core\/nanops.py` line 1360, in function `nankurt`,\r\nsaying to fix #18044 it manually zeros out values less than 1e-14, which is in any way improper.\r\nThis affects whatever data comes with not much variance but lots of data.\r\n\r\n\n\n### Expected Behavior\n\nOutput of provided example:\r\n```text\r\n14.916104870028523\r\n0.0\r\n14.916104870028551\r\n```\r\n\r\nExpected output: roughly 14.9161 for unbiased (`pandas`'s default behaviour) is correct.\r\n\n\n### Installed Versions\n\n<details>\r\n\r\n\r\nINSTALLED VERSIONS\r\n------------------\r\ncommit                : bdc79c146c2e32f2cab629be240f01658cfb6cc2\r\npython                : 3.10.13.final.0\r\npython-bits           : 64\r\nOS                    : Linux\r\nOS-release            : 5.19.0-1010-nvidia-lowlatency\r\nVersion               : #10-Ubuntu SMP PREEMPT_DYNAMIC Wed Apr 26 00:40:27 UTC 2023\r\nmachine               : x86_64\r\nprocessor             : x86_64\r\nbyteorder             : little\r\nLC_ALL                : None\r\nLANG                  : en_US.UTF-8\r\nLOCALE                : en_US.UTF-8\r\n\r\npandas                : 2.2.1\r\nnumpy                 : 1.26.4\r\npytz                  : 2024.1\r\ndateutil              : 2.8.2\r\nsetuptools            : 65.5.0\r\npip                   : 24.0\r\nCython                : None\r\npytest                : None\r\nhypothesis            : None\r\nsphinx                : None\r\nblosc                 : None\r\nfeather               : None\r\nxlsxwriter            : None\r\nlxml.etree            : None\r\nhtml5lib              : None\r\npymysql               : None\r\npsycopg2              : None\r\njinja2                : None\r\nIPython               : 8.22.1\r\npandas_datareader     : None\r\nadbc-driver-postgresql: None\r\nadbc-driver-sqlite    : None\r\nbs4                   : None\r\nbottleneck            : None\r\ndataframe-api-compat  : None\r\nfastparquet           : None\r\nfsspec                : 2024.2.0\r\ngcsfs                 : None\r\nmatplotlib            : 3.8.3\r\nnumba                 : 0.59.0\r\nnumexpr               : None\r\nodfpy                 : None\r\nopenpyxl              : None\r\npandas_gbq            : None\r\npyarrow               : 15.0.0\r\npyreadstat            : None\r\npython-calamine       : None\r\npyxlsb                : None\r\ns3fs                  : None\r\nscipy                 : 1.12.0\r\nsqlalchemy            : None\r\ntables                : None\r\ntabulate              : None\r\nxarray                : None\r\nxlrd                  : None\r\nzstandard             : None\r\ntzdata                : 2024.1\r\nqtpy                  : None\r\npyqt5                 : None\r\n\r\n<\/details>\r\n","comments":["Good point. Reproducing your example, this does happen in your example. Trying to scale it up to larger input distributions alleviates the issue though.\r\n\r\nYour example is a sweet spot for this error, rescaling your distribution to be larger, the zeroing out stops happening very quickly due to the O(count^2) and O(count^3) terms in the numerator and denominator equations counteracting lifting the very small m4 and m2^2 above the e-14 threshold.\r\n\r\nDoing a check of the form (pseudocode)\r\n`count < 100 and abs(frexp(denominator) - frexp(numerator)) < 24`\r\nbefore doing the zeroing out should alleviate this issue, but I would like to hear someone else's opinion before putting in a PR.","Another note: the kurtosis fomulation then still deviates from the scipy implementation by 3, up until a distribution size of about 10x your example, using the same shape of your example.\r\n\r\nI was not able to iron out that instability, though.","> Another note: the kurtosis fomulation then still deviates from the scipy implementation by 3, up until a distribution size of about 10x your example, using the same shape of your example.\r\n> \r\n> I was not able to iron out that instability, though.\r\n\r\nDo you mean that the difference of their output is roughly 3? If you have not set `bias=False` in `scipy` or `polars`, the difference here will be roughly 3.","> Do you mean that the difference of their output is roughly 3?\r\n\r\nExactly \r\n\r\n> If you have not set `bias=False` in `scipy` or `polars`, the difference here will be roughly 3.\r\n\r\nI did not, so then that's also explained. Then I see no issues with my solution anymore.\r\n\r\n"],"labels":["Bug","Needs Triage"],"number":57972},{"title":"CLN: Enforce deprecation of argmin\/max and idxmin\/max with NA values","body":"- [ ] closes #xxxx (Replace xxxx with the GitHub issue number)\r\n- [ ] [Tests added and passed](https:\/\/pandas.pydata.org\/pandas-docs\/dev\/development\/contributing_codebase.html#writing-tests) if fixing a bug or adding a new feature\r\n- [ ] All [code checks passed](https:\/\/pandas.pydata.org\/pandas-docs\/dev\/development\/contributing_codebase.html#pre-commit).\r\n- [ ] Added [type annotations](https:\/\/pandas.pydata.org\/pandas-docs\/dev\/development\/contributing_codebase.html#type-hints) to new arguments\/methods\/functions.\r\n- [ ] Added an entry in the latest `doc\/source\/whatsnew\/vX.X.X.rst` file if fixing a bug or adding a new feature.\r\n\r\nRef: #33941, #51276\r\n\r\nThis is complicated by #57745 - we still need a proper deprecation for groupby's idxmin\/idxmax. For DataFrame with EAs and axis=1, we use groupby's implementation. So I'm leaving that deprecation in place for now, and we can enforce it after groupby's is deprecated and ready to be enforced.","comments":[],"labels":["Missing-data","Clean","Reduction Operations"],"number":57971},{"title":"WEB: Updating active\/inactive core devs","body":"I've checked with the devs who weren't active in pandas recently to see if they wished to become inactive, and few were happy to become inactive.\r\n\r\nBesides to manage expectations of other core devs and the community, this is relevant for the decision making proposed in [PDEP-1](https:\/\/github.com\/pandas-dev\/pandas\/pull\/53576\/files). With the current proposal, the number of maintainers to have a quorum is lowered from 12 to 11 after this PR, and it'll have an impact if more people become a maintainer.\r\n\r\n@bashtage I couldn't get an answer from you via email (I sent two emails). If you'd like to remain active that's totally fine, just let me know.","comments":["I'm updating the finance workgroup. Wes was the lead but he's becoming inactive, so I'm removing him from the workgroup. @mroeschke I'm adding you as leader of the workgroup, since I think you've been doing most of the work recently (at least approving expenses). If you want to have a discussion with the rest of the workgroup and there is a different outcome, please let me know:\r\n\r\nCC: @jreback @jorisvandenbossche @TomAugspurger ","SGTM. If anyone else wants a spot on the finance group I'm more than happy to step aside.","sgtm ","@TomAugspurger I personally don't think it's needed to have many people in the workgroups. I think having a couple of people to have a backup is good, or maybe 3 depending on the workgroup. So, seems reasonable that you step aside even if nobody new takes your spot, we already got Matt, Jeff and Joris.\r\n\r\nAlso, in the responsibilities we've got for the finance workgroup now we only have \"approve the expenses\". Not sure if it'd make sense to include requesting the grants and organizing the funds. Maybe in that case it could make sense if @phofl joins it?","> Maybe in that case it could make sense if @phofl joins it?\r\n\r\nsgtm"],"labels":["Admin","Web"],"number":57969}]