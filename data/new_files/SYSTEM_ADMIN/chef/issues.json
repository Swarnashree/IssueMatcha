[{"title":"Deprecate osx_profile resource since it can longer silently install profiles","body":"## Context\r\n\r\nIn 2020, Apple dropped support for non-interactively installing configuration profiles. The final macOS version to support this was macOS Catalina (version 10.15), which was released in 2019 and [stopped receiving security updates in 2022](https:\/\/support.apple.com\/en-us\/HT201222).\r\n\r\nThis change was only really documented in the man page for the `profiles` tool:\r\n\r\n```\r\nDESCRIPTION\r\n     profiles is used to handle various profile types on macOS.   Starting with macOS 11.0 (profiles tool 8.0 or later), this tool cannot be\r\n         used to install configuration profiles.  You should add your profiles using the System Settings Profiles\r\n         preference pane.    Additionally, startup profiles are no longer supported.\r\n```\r\n\r\nFrustratingly, this requires access to a macOS device because [Apple doesn't publish man pages online](https:\/\/apple.stackexchange.com\/questions\/239484\/does-apple-provide-a-web-site-with-content-of-man-pages-for-the-command-line-c) and the `profiles` tool is nonfree\/proprietary so there's no public source code to link as documentation.\r\n\r\nThis line in a video transcript of a June 2020 dev talk is the closest I can get to an Apple statement on the subject:\r\n\r\n> As of macOS Big Sur, you will no longer be able to completely install profiles using Terminal.\r\n\r\nhttps:\/\/developer.apple.com\/videos\/play\/wwdc2020\/10639\/?time=629\r\n\r\n## Motivation\r\n\r\n```\r\nAs a Chef user,\r\nI want Chef core resources to match my expectations,\r\nso that using Chef is easier.\r\n```\r\n(copied from [RFC-98 Deprecate deploy and erl_call](https:\/\/github.com\/chef-boneyard\/chef-rfc\/blob\/master\/rfc098-deprecate-deploy-and-erlcall-resources.md))\r\n\r\n## Specification\r\n\r\nSince this resource can't install new profiles, it [doesn't really do anything useful](https:\/\/github.com\/chef\/chef\/issues\/10075) on currently-supported versions of macOS.\r\n\r\nAnyone who was using this resource has almost certainly replaced it with MDM-managed profiles a long time ago, since the overlap between having an MDM server and needing config profiles on nodes should be near 1:1. This could be marked as deprecated in the next Chef Infra 18 release and eventually removed in either Chef Infra 19 or 20.\r\n\r\n## Downstream Impact\r\n\r\nI searched Github for repos referencing `osx_profile` and didn't find any repos that were updated in the last five years.","comments":["I would be so bold and say it should be **fully removed without any deprecation notice**, since Chef currently only supports macOS 12 and higher. https:\/\/docs.chef.io\/platforms\/\r\n\r\n```\r\nPlatform and Version | Vendor End-of-Life Date | Chef End-of-Life Date\r\n-- | -- | --\r\nApple macOS 11 | Sep 26, 2023 | Sep 26, 2023\r\n-- | -- | --\r\n```\r\n\r\nIf you attempt to use this resource on a support version of macOS, chef will fail without explicitly marking as `ignore_failure true`"],"labels":["Status: Untriaged"],"number":14278},{"title":"Bump omnibus-software from `40ca2a9` to `842b603` in \/omnibus","body":"Bumps [omnibus-software](https:\/\/github.com\/chef\/omnibus-software) from `40ca2a9` to `842b603`.\n<details>\n<summary>Commits<\/summary>\n<ul>\n<li><a href=\"https:\/\/github.com\/chef\/omnibus-software\/commit\/842b603cf83fb82b5c6cf69763a3ac9db9790a35\"><code>842b603<\/code><\/a> Merge pull request <a href=\"https:\/\/redirect.github.com\/chef\/omnibus-software\/issues\/1865\">#1865<\/a> from chef\/CHEF-8427-gtar-version-update<\/li>\n<li><a href=\"https:\/\/github.com\/chef\/omnibus-software\/commit\/70d6b70d62a96f8235b77ec5c372c5147d1279d4\"><code>70d6b70<\/code><\/a> added version 1.35 to version list<\/li>\n<li>See full diff in <a href=\"https:\/\/github.com\/chef\/omnibus-software\/compare\/40ca2a902ff20905aaa36ca35b1701fba8812160...842b603cf83fb82b5c6cf69763a3ac9db9790a35\">compare view<\/a><\/li>\n<\/ul>\n<\/details>\n<br \/>\n\n\nDependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.\n\n[\/\/]: # (dependabot-automerge-start)\n[\/\/]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options<\/summary>\n<br \/>\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot show <dependency name> ignore conditions` will show all of the ignore conditions of the specified dependency\n- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)\n\n\n<\/details>","comments":["## [![Quality Gate Passed](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/checks\/QualityGateBadge\/qg-passed-20px.png 'Quality Gate Passed')](https:\/\/sonarcloud.io\/dashboard?id=chef_chef&pullRequest=14268) **Quality Gate passed**  \nIssues  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/passed-16px.png '') [0 New issues](https:\/\/sonarcloud.io\/project\/issues?id=chef_chef&pullRequest=14268&resolved=false&inNewCodePeriod=true)  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/accepted-16px.png '') [0 Accepted issues](https:\/\/sonarcloud.io\/component_measures?id=chef_chef&pullRequest=14268&metric=new_accepted_issues&view=list)\n\nMeasures  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/passed-16px.png '') [0 Security Hotspots](https:\/\/sonarcloud.io\/project\/security_hotspots?id=chef_chef&pullRequest=14268&resolved=false&inNewCodePeriod=true)  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/no-data-16px.png '') No data about Coverage  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/no-data-16px.png '') No data about Duplication  \n  \n[See analysis details on SonarCloud](https:\/\/sonarcloud.io\/dashboard?id=chef_chef&pullRequest=14268)\n\n"],"labels":["Type: Chore"],"number":14268},{"title":"Bump omnibus-software from `86649fa` to `842b603` in \/omnibus","body":"Bumps [omnibus-software](https:\/\/github.com\/chef\/omnibus-software) from `86649fa` to `842b603`.\n<details>\n<summary>Commits<\/summary>\n<ul>\n<li><a href=\"https:\/\/github.com\/chef\/omnibus-software\/commit\/842b603cf83fb82b5c6cf69763a3ac9db9790a35\"><code>842b603<\/code><\/a> Merge pull request <a href=\"https:\/\/redirect.github.com\/chef\/omnibus-software\/issues\/1865\">#1865<\/a> from chef\/CHEF-8427-gtar-version-update<\/li>\n<li><a href=\"https:\/\/github.com\/chef\/omnibus-software\/commit\/70d6b70d62a96f8235b77ec5c372c5147d1279d4\"><code>70d6b70<\/code><\/a> added version 1.35 to version list<\/li>\n<li><a href=\"https:\/\/github.com\/chef\/omnibus-software\/commit\/40ca2a902ff20905aaa36ca35b1701fba8812160\"><code>40ca2a9<\/code><\/a> Merge pull request <a href=\"https:\/\/redirect.github.com\/chef\/omnibus-software\/issues\/1876\">#1876<\/a> from chef\/CHEF-10219-update-open-jre-to-11-0-21<\/li>\n<li><a href=\"https:\/\/github.com\/chef\/omnibus-software\/commit\/fff30b0ffb78f1becf2f7c5e31888e2826986f77\"><code>fff30b0<\/code><\/a> Update open-jre-11.0.21<\/li>\n<li><a href=\"https:\/\/github.com\/chef\/omnibus-software\/commit\/8e647fec6cd592628f6914ab96a2b1404543a303\"><code>8e647fe<\/code><\/a> Executed '.expeditor\/determine_version.sh'<\/li>\n<li><a href=\"https:\/\/github.com\/chef\/omnibus-software\/commit\/6d0b9ac13cad1b2e9a51491cdd3cc7d311dbbb8f\"><code>6d0b9ac<\/code><\/a> Merge pull request <a href=\"https:\/\/redirect.github.com\/chef\/omnibus-software\/issues\/1877\">#1877<\/a> from chef\/dummypr\/muthuja<\/li>\n<li><a href=\"https:\/\/github.com\/chef\/omnibus-software\/commit\/76c8e6d1340c71fdc8f435b6745498a4d0c01124\"><code>76c8e6d<\/code><\/a> it is just dummy pr to check bump version<\/li>\n<li><a href=\"https:\/\/github.com\/chef\/omnibus-software\/commit\/57d57bc1ab469d0f9d4910b9e9d9944fa10eb986\"><code>57d57bc<\/code><\/a> Merge pull request <a href=\"https:\/\/redirect.github.com\/chef\/omnibus-software\/issues\/1873\">#1873<\/a> from chef\/Add\/openssl_3.0.9_to_versionlist\/muthuja<\/li>\n<li><a href=\"https:\/\/github.com\/chef\/omnibus-software\/commit\/7388b00a14205dd0ef8aec6608a7f65c25859d81\"><code>7388b00<\/code><\/a> Build OpenSSL 3.x and Ruby &lt; 3.1<\/li>\n<li><a href=\"https:\/\/github.com\/chef\/omnibus-software\/commit\/9d0fd56137fd5c790cd07c340dfc5ba30e554968\"><code>9d0fd56<\/code><\/a> Executed '.expeditor\/determine_version.sh'<\/li>\n<li>Additional commits viewable in <a href=\"https:\/\/github.com\/chef\/omnibus-software\/compare\/86649fa63c1c1ef83371404d5dd08b095ef9cbd8...842b603cf83fb82b5c6cf69763a3ac9db9790a35\">compare view<\/a><\/li>\n<\/ul>\n<\/details>\n<br \/>\n\n\nDependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.\n\n[\/\/]: # (dependabot-automerge-start)\n[\/\/]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options<\/summary>\n<br \/>\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot show <dependency name> ignore conditions` will show all of the ignore conditions of the specified dependency\n- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)\n\n\n<\/details>","comments":["## [![Quality Gate Passed](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/checks\/QualityGateBadge\/qg-passed-20px.png 'Quality Gate Passed')](https:\/\/sonarcloud.io\/dashboard?id=chef_chef&pullRequest=14265) **Quality Gate passed**  \nIssues  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/passed-16px.png '') [0 New issues](https:\/\/sonarcloud.io\/project\/issues?id=chef_chef&pullRequest=14265&resolved=false&inNewCodePeriod=true)  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/accepted-16px.png '') [0 Accepted issues](https:\/\/sonarcloud.io\/component_measures?id=chef_chef&pullRequest=14265&metric=new_accepted_issues&view=list)\n\nMeasures  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/passed-16px.png '') [0 Security Hotspots](https:\/\/sonarcloud.io\/project\/security_hotspots?id=chef_chef&pullRequest=14265&resolved=false&inNewCodePeriod=true)  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/no-data-16px.png '') No data about Coverage  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/no-data-16px.png '') No data about Duplication  \n  \n[See analysis details on SonarCloud](https:\/\/sonarcloud.io\/dashboard?id=chef_chef&pullRequest=14265)\n\n"],"labels":["Type: Chore"],"number":14265},{"title":"OpenSSL 3.0.9 upgrade - merge after 17.11.x","body":"<!--- Provide a short summary of your changes in the Title above -->\r\n\r\n## Description\r\n<!--- Describe your changes in detail, what problems does it solve? -->\r\n\r\n## Related Issue\r\n<!--- If you are suggesting a new feature or change, please create an issue first -->\r\n<!--- Please link to the issue, discourse, or stackoverflow here: -->\r\n\r\n## Types of changes\r\n<!--- What types of changes does your code introduce? Put an `x` in all the boxes that apply: -->\r\n- [ ] Bug fix (non-breaking change which fixes an issue)\r\n- [ ] New feature (non-breaking change which adds functionality)\r\n- [ ] Breaking change (fix or feature that would cause existing functionality to change)\r\n- [ ] Chore (non-breaking change that does not add functionality or fix an issue)\r\n\r\n## Checklist:\r\n<!--- Go over all the following points, and put an `x` in all the boxes that apply. -->\r\n<!--- If you're unsure about any of these, don't hesitate to ask. We're here to help! -->\r\n- [ ] I have read the **CONTRIBUTING** document.\r\n- [ ] I have run the pre-merge tests locally and they pass.\r\n- [ ] I have updated the documentation accordingly.\r\n- [ ] I have added tests to cover my changes.\r\n- [ ] If `Gemfile.lock` has changed, I have used `--conservative` to do it and included the full output in the Description above.\r\n- [ ] All new and existing tests passed.\r\n- [ ] All commits have been signed-off for [the Developer Certificate of Origin](https:\/\/github.com\/chef\/chef\/blob\/master\/CONTRIBUTING.md#developer-certification-of-origin-dco).\r\n","comments":["## [![Quality Gate Passed](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/checks\/QualityGateBadge\/qg-passed-20px.png 'Quality Gate Passed')](https:\/\/sonarcloud.io\/dashboard?id=chef_chef&pullRequest=14263) **Quality Gate passed**  \nIssues  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/passed-16px.png '') [0 New issues](https:\/\/sonarcloud.io\/project\/issues?id=chef_chef&pullRequest=14263&resolved=false&inNewCodePeriod=true)  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/accepted-16px.png '') [0 Accepted issues](https:\/\/sonarcloud.io\/component_measures?id=chef_chef&pullRequest=14263&metric=new_accepted_issues&view=list)\n\nMeasures  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/passed-16px.png '') [0 Security Hotspots](https:\/\/sonarcloud.io\/project\/security_hotspots?id=chef_chef&pullRequest=14263&resolved=false&inNewCodePeriod=true)  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/no-data-16px.png '') No data about Coverage  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/passed-16px.png '') [0.0% Duplication on New Code](https:\/\/sonarcloud.io\/component_measures?id=chef_chef&pullRequest=14263&metric=new_duplicated_lines_density&view=list)  \n  \n[See analysis details on SonarCloud](https:\/\/sonarcloud.io\/dashboard?id=chef_chef&pullRequest=14263)\n\n"],"labels":["Do Not Merge","Status: Waiting on Release","Chef 17.12"],"number":14263},{"title":"apt_repository should not use deprecated apt-key anymore","body":"### Describe the Enhancement:\r\nThe `apt_repository` ressource (as of Chef 18 as well as on `master`) [leverages `apt-key add`](https:\/\/github.com\/chef\/chef\/blob\/718b2ef032da1cfd0132934707cb4abb1d292930\/lib\/chef\/resource\/apt_repository.rb#L303=) to import the repository signing key.\r\nThis way of importing the key has been deprecated for security reason (it trusts all packages from the repository instead of only the installed package) and will be last available in Debian 11 and Ubuntu 22.04.\r\nSources:\r\n- https:\/\/itsfoss.com\/apt-key-deprecated\/\r\n- https:\/\/www.linuxuprising.com\/2021\/01\/apt-key-is-deprecated-how-to-add.html\r\n\r\n### Describe the Need:\r\nWe need to refactor the  `apt_repository` to use this more complex method instead:\r\n```\r\nwget -O- <https:\/\/example.com\/key\/repo-key.gpg> | gpg --dearmor | sudo tee \/usr\/share\/keyrings\/<myrepository>-archive-keyring.gpg\r\n```\r\n\r\n### Current Alternative\r\nAs a workaround, one can use the `execute` resource to import the key before `apt_repository`\r\n\r\n### Can We Help You Implement This?:\r\nI'm willing to prepare a pull request. Let me know you opinion and if you think it's needed to keep `apt-key add` as a fallback method for older Ubuntu\/Debian releases (I'm testing on Ubuntu 22.04)","comments":[],"labels":["Status: Untriaged"],"number":14258},{"title":"chef_client_config errors out for bool property","body":"<!---\r\n!!!!!! NOTE: CHEF CLIENT BUGS ONLY !!!!!!\r\n\r\nThis issue tracker is for the code contained within this repo -- `chef-client`, base `knife` functionality (not\r\nplugins), `chef-apply`, `chef-solo`, `chef-client -z`, etc.\r\n\r\n* Requests for new or alternative functionality should be made to [feedback.chef.io](https:\/\/feedback.chef.io\/forums\/301644-chef-product-feedback\/category\/110832-chef-client)\r\n* [Chef Server issues](https:\/\/github.com\/chef\/chef-server\/issues\/new)\r\n* [ChefDK issues](https:\/\/github.com\/chef\/chef-dk\/issues\/new)\r\n* Cookbook Issues (see the https:\/\/github.com\/chef-cookbooks repos or search [Supermarket](https:\/\/supermarket.chef.io) or GitHub\/Google)\r\n\r\n-->\r\n\r\n## Description\r\nWhen I tried to set a bool property inside chef_client_config resource, like \r\n\r\n- policy_persist_run_list\r\n- minimal_ohai\r\n\r\nthe chef compilation fails with the following error:\r\n\r\n```\r\n        template(\"\/etc\/cinc\/client.rb\") do\r\n        action [:create]\r\n        default_guard_interpreter :default\r\n        source \"\/opt\/cinc\/embedded\/lib\/ruby\/gems\/2.7.0\/gems\/chef-16.16.13\/lib\/chef\/resource\/support\/client.erb\"\r\n        declared_type :template\r\n        cookbook_name \"system-base\"\r\n        owner \"root\"\r\n        group \"root\"\r\n        local true\r\n        variables {:chef_license=>\"accept\", :chef_server_url=>\"chefzero:\/\/localhost:1\", :event_loggers=>[], :exception_handlers=>[], :file_backup_path=>\"\/var\/lib\/chef\", :file_cache_path=>\"\/var\/chef\/cache\", :file_staging_uses_destdir=>nil, :formatters=>[], :http_proxy=>nil, :https_proxy=>nil, :ftp_proxy=>nil, :log_level=>:info, :log_location=>\"\/var\/log\/chef\/client.log\", :minimal_ohai=>false, :named_run_list=>nil, :no_proxy=>\"\", :node_name=>\"wgao-redhat-79\", :ohai_disabled_plugins=>[], :ohai_optional_plugins=>[], :pid_file=>\"var\/run\/chef\/client.pid\", :policy_group=>nil, :policy_name=>nil, :report_handlers=>[], :ssl_verify_mode=>:verify_none, :start_handlers=>[], :additional_config=>nil}\r\n        mode \"0640\"\r\n        path \"\/etc\/cinc\/client.rb\"\r\n        verifications []\r\n             end\r\n             \r\n             Template Context:\r\n             -----------------\r\n             on line #22\r\n       20:       @policy_name\r\n       21:       @ssl_verify_mode).each do |prop| -%>\r\n       22: <% next if instance_variable_get(prop).nil? || instance_variable_get(prop).empty? -%>\r\n       23: <%=prop.delete_prefix(\"@\") %> <%= instance_variable_get(prop).inspect %>\r\n       24: <% end -%>\r\n             \r\n             System Info:\r\n             ------------\r\n             chef_version=16.16.13\r\n             platform=redhat\r\n             platform_version=7.9\r\n             ruby=ruby 2.7.4p191 (2021-07-07 revision a21a3b7d23) [x86_64-linux]\r\n             program_name=\/opt\/cinc\/bin\/cinc-client\r\n             executable=\/opt\/cinc\/bin\/cinc-client\r\n             \r\n           \r\n           ================================================================================\r\n           Error executing action `create` on resource 'chef_client_config[Create client.rb]'\r\n           ================================================================================\r\n           \r\n           Chef::Mixin::Template::TemplateError\r\n           ------------------------------------\r\n           undefined method `empty?' for false:FalseClass\r\n```\r\n\r\nThis code looks like is from \r\nhttps:\/\/github.com\/chef\/chef\/blob\/main\/lib\/chef\/resource\/support\/client.erb#L22\r\n\r\n```\r\n<% next if instance_variable_get(prop).nil? || instance_variable_get(prop).empty? -%>\r\n```\r\n\r\nQuick Ruby testing\r\n\r\n```\r\nirb(main):001:0> false.nil?\r\n=> false\r\nirb(main):002:0> false.empty?\r\nNoMethodError: undefined method `empty?' for false:FalseClass\r\n\tfrom (irb):2\r\n\tfrom \/bin\/irb:12:in `<main>'\r\nirb(main):003:0> \r\n```\r\n \r\n## Chef Version\r\n16.16.13\r\n\r\n## Platform Version\r\nRHEL 7.9\r\n\r\n## Replication Case\r\nSee above Ruby test\r\n\r\n## Client Output\r\nSee above inside issue description\r\n\r\n## Stacktrace\r\nSee above inside issue description\r\n","comments":[],"labels":["Status: Waiting on Release","Chef 18.5"],"number":14254},{"title":"'log' resource ignores the 'message' attribute, and will always use the name of the resource as the message","body":"<!---\r\n!!!!!! NOTE: CHEF CLIENT BUGS ONLY !!!!!!\r\n\r\nThis issue tracker is for the code contained within this repo -- `chef-client`, base `knife` functionality (not\r\nplugins), `chef-apply`, `chef-solo`, `chef-client -z`, etc.\r\n\r\n* Requests for new or alternative functionality should be made to [feedback.chef.io](https:\/\/feedback.chef.io\/forums\/301644-chef-product-feedback\/category\/110832-chef-client)\r\n* [Chef Server issues](https:\/\/github.com\/chef\/chef-server\/issues\/new)\r\n* [ChefDK issues](https:\/\/github.com\/chef\/chef-dk\/issues\/new)\r\n* Cookbook Issues (see the https:\/\/github.com\/chef-cookbooks repos or search [Supermarket](https:\/\/supermarket.chef.io) or GitHub\/Google)\r\n\r\n-->\r\n\r\n## Description\r\nThe 'log' resource, when used in a recipe, ignores the 'message' attribute and instead will use whatever the name of the log resource is as its message.\r\n\r\nThe following will always spit out \"message\"\r\n```\r\nlog 'message' do\r\n  message 'This is the message that should be added to the log.'\r\n  level :info\r\nend\r\n```\r\n\r\nI discovered this while trying to do something with lazy evaluation:\r\n\r\n```\r\nlog 'dummy message' do  # ignores the 'message' value and always spits out 'dummy message'\r\n  message lazy { node.run_state[:dump_master_log_file] }\r\nend\r\n```\r\n\r\n## Chef Version\r\n18.4.2\r\n\r\n## Platform Version\r\nUbuntu 20.04 LTS\r\n\r\n## Replication Case\r\n\r\nThe most minimal example I can think of would be:\r\n```\r\nlog 'dummy message' do\r\n  message 'this is a much better message'\r\nend\r\n```\r\n\r\nExpected output should be 'this is a much better message'\r\n\r\n## Client Output\r\n\r\n```\r\nlog[dummy message] action write\r\n```\r\n\r\n## Stacktrace\r\nN\/A","comments":[],"labels":["Status: Untriaged"],"number":14253},{"title":"Bump kitchen-vagrant from 1.14.1 to 2.0.0 in \/omnibus","body":"Bumps [kitchen-vagrant](https:\/\/github.com\/opscode\/kitchen-vagrant) from 1.14.1 to 2.0.0.\n<details>\n<summary>Release notes<\/summary>\n<p><em>Sourced from <a href=\"https:\/\/github.com\/opscode\/kitchen-vagrant\/releases\">kitchen-vagrant's releases<\/a>.<\/em><\/p>\n<blockquote>\n<h2>v1.14.2<\/h2>\n<h2><a href=\"https:\/\/github.com\/test-kitchen\/kitchen-vagrant\/compare\/v1.14.1...v1.14.2\">1.14.2<\/a> (2023-11-27)<\/h2>\n<h3>Bug Fixes<\/h3>\n<ul>\n<li>Add New lint and publish workflows (<a href=\"https:\/\/redirect.github.com\/test-kitchen\/kitchen-vagrant\/issues\/488\">#488<\/a>) (<a href=\"https:\/\/github.com\/test-kitchen\/kitchen-vagrant\/commit\/744fdc93d006ad32f80994b371c198e5a2a9deb6\">744fdc9<\/a>)<\/li>\n<\/ul>\n<\/blockquote>\n<\/details>\n<details>\n<summary>Changelog<\/summary>\n<p><em>Sourced from <a href=\"https:\/\/github.com\/test-kitchen\/kitchen-vagrant\/blob\/main\/CHANGELOG.md\">kitchen-vagrant's changelog<\/a>.<\/em><\/p>\n<blockquote>\n<h2><a href=\"https:\/\/github.com\/test-kitchen\/kitchen-vagrant\/compare\/v1.14.2...v2.0.0\">2.0.0<\/a> (2024-02-14)<\/h2>\n<ul>\n<li>Require Vagrant 2.4 or later<\/li>\n<li>Drop support for EOL Ruby 2.7 release<\/li>\n<li>Add a new <code>box_arch<\/code> configuration option for defining the architecture to use<\/li>\n<li>Eliminate the need for the vagrant-winrm plugin on Windows boxes<\/li>\n<\/ul>\n<h2><a href=\"https:\/\/github.com\/test-kitchen\/kitchen-vagrant\/compare\/v1.14.1...v1.14.2\">1.14.2<\/a> (2023-11-27)<\/h2>\n<h3>Bug Fixes<\/h3>\n<ul>\n<li>Add New lint and publish workflows (<a href=\"https:\/\/redirect.github.com\/test-kitchen\/kitchen-vagrant\/issues\/488\">#488<\/a>) (<a href=\"https:\/\/github.com\/test-kitchen\/kitchen-vagrant\/commit\/744fdc93d006ad32f80994b371c198e5a2a9deb6\">744fdc9<\/a>)<\/li>\n<\/ul>\n<\/blockquote>\n<\/details>\n<details>\n<summary>Commits<\/summary>\n<ul>\n<li><a href=\"https:\/\/github.com\/test-kitchen\/kitchen-vagrant\/commit\/098e5c66e50f3c8e3703c75c01e65463d63f11cc\"><code>098e5c6<\/code><\/a> Release 2.0.0 (<a href=\"https:\/\/redirect.github.com\/opscode\/kitchen-vagrant\/issues\/492\">#492<\/a>)<\/li>\n<li><a href=\"https:\/\/github.com\/test-kitchen\/kitchen-vagrant\/commit\/cdd899908ddbfafb1c7e8068602ffcf3e0460d53\"><code>cdd8999<\/code><\/a> add vagrant architecture support (<a href=\"https:\/\/redirect.github.com\/opscode\/kitchen-vagrant\/issues\/491\">#491<\/a>)<\/li>\n<li><a href=\"https:\/\/github.com\/test-kitchen\/kitchen-vagrant\/commit\/3b7c4b5b8508232e7a1e4b630feac2bc60b48224\"><code>3b7c4b5<\/code><\/a> chore(deps): update google-github-actions\/release-please-action action to v4 ...<\/li>\n<li><a href=\"https:\/\/github.com\/test-kitchen\/kitchen-vagrant\/commit\/ad99627151b86184434bcae4c6fc3a0e7f86b549\"><code>ad99627<\/code><\/a> chore(main): release 1.14.2 (<a href=\"https:\/\/redirect.github.com\/opscode\/kitchen-vagrant\/issues\/489\">#489<\/a>)<\/li>\n<li><a href=\"https:\/\/github.com\/test-kitchen\/kitchen-vagrant\/commit\/00be941e364e9a34af7e32b7683e1f4378318e1b\"><code>00be941<\/code><\/a> Configure renovate<\/li>\n<li><a href=\"https:\/\/github.com\/test-kitchen\/kitchen-vagrant\/commit\/744fdc93d006ad32f80994b371c198e5a2a9deb6\"><code>744fdc9<\/code><\/a> fix: Add New lint and publish workflows (<a href=\"https:\/\/redirect.github.com\/opscode\/kitchen-vagrant\/issues\/488\">#488<\/a>)<\/li>\n<li><a href=\"https:\/\/github.com\/test-kitchen\/kitchen-vagrant\/commit\/a3707d6d07b412b1cbb30cf6e0bc75f089ed88b1\"><code>a3707d6<\/code><\/a> Update chefstyle requirement from 2.2.2 to 2.2.3 (<a href=\"https:\/\/redirect.github.com\/opscode\/kitchen-vagrant\/issues\/486\">#486<\/a>)<\/li>\n<li>See full diff in <a href=\"https:\/\/github.com\/opscode\/kitchen-vagrant\/compare\/v1.14.1...v2.0.0\">compare view<\/a><\/li>\n<\/ul>\n<\/details>\n<br \/>\n\n\n[![Dependabot compatibility score](https:\/\/dependabot-badges.githubapp.com\/badges\/compatibility_score?dependency-name=kitchen-vagrant&package-manager=bundler&previous-version=1.14.1&new-version=2.0.0)](https:\/\/docs.github.com\/en\/github\/managing-security-vulnerabilities\/about-dependabot-security-updates#about-compatibility-scores)\n\nYou can trigger a rebase of this PR by commenting `@dependabot rebase`.\n\n[\/\/]: # (dependabot-automerge-start)\n[\/\/]: # (dependabot-automerge-end)\n\n---\n\n<details>\n<summary>Dependabot commands and options<\/summary>\n<br \/>\n\nYou can trigger Dependabot actions by commenting on this PR:\n- `@dependabot rebase` will rebase this PR\n- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it\n- `@dependabot merge` will merge this PR after your CI passes on it\n- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it\n- `@dependabot cancel merge` will cancel a previously requested merge and block automerging\n- `@dependabot reopen` will reopen this PR if it is closed\n- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually\n- `@dependabot show <dependency name> ignore conditions` will show all of the ignore conditions of the specified dependency\n- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)\n- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)\n\n\n<\/details>\n\n> **Note**\n> Automatic rebases have been disabled on this pull request as it has been open for over 30 days.\n","comments":["## [![Quality Gate Passed](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/checks\/QualityGateBadge\/qg-passed-20px.png 'Quality Gate Passed')](https:\/\/sonarcloud.io\/dashboard?id=chef_chef&pullRequest=14240) **Quality Gate passed**  \nIssues  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/passed-16px.png '') [0 New issues](https:\/\/sonarcloud.io\/project\/issues?id=chef_chef&pullRequest=14240&resolved=false&inNewCodePeriod=true)  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/accepted-16px.png '') [0 Accepted issues](https:\/\/sonarcloud.io\/component_measures?id=chef_chef&pullRequest=14240&metric=new_accepted_issues&view=list)\n\nMeasures  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/passed-16px.png '') [0 Security Hotspots](https:\/\/sonarcloud.io\/project\/security_hotspots?id=chef_chef&pullRequest=14240&resolved=false&inNewCodePeriod=true)  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/no-data-16px.png '') No data about Coverage  \n![](https:\/\/sonarsource.github.io\/sonarcloud-github-static-resources\/v2\/common\/no-data-16px.png '') No data about Duplication  \n  \n[See analysis details on SonarCloud](https:\/\/sonarcloud.io\/dashboard?id=chef_chef&pullRequest=14240)\n\n"],"labels":["Type: Chore"],"number":14240},{"title":"18.4.2 windows_service property \"description\": NoMethodError","body":"## Description\r\n\r\nAs of 18.4.2, the `windows_service` resource does not process the `description` property\/argument correctly. Example code:\r\n```\r\nwindows_service service_name do\r\n  binary_path_name startup_command\r\n   name new_resource.agent_name\r\n   description \"#{new_resource.agent_name} agent\"\r\n   delayed_start false\r\n   timeout 30\r\n   action %i[create enable start]\r\n end\r\n```\r\n\r\nThe error is:\r\n\r\n```\r\nNoMethodError\r\n-------------\r\nundefined method `description' for #<struct Struct::ServiceConfigInfo service_type=\"own process\",\r\n start_type=\"auto start\", error_control=\"normal\", binary_path_name=\"C:\/vault\/vault.exe agent \r\n-config=C:\/vault\/config\/agent.hcl \", load_order_group=\"\", tag_id=0, dependencies=[], \r\nservice_start_name=\"LocalSystem\", display_name=\"vault\">\r\n\r\n            current_resource.description(config_info.description)           if new_resource.description\r\n                                                    ^^^^^^^^^^^^\r\n```\r\n\r\nRemoving the `description` property from the resource works around the problem.\r\n\r\n## Chef Version\r\n18.4.2 (was working in 18.3.0)\r\n\r\n## Platform Version\r\n```\r\n      System Info:\r\n      ------------\r\n      chef_version=18.4.2\r\n      platform=windows\r\n      platform_version=10.0.17763\r\n      ruby=ruby 3.1.2p20 (2022-04-12 revision 4491bb740a) [x64-mingw-ucrt]\r\n```\r\n\r\n## Stacktrace\r\n```\r\nC:\/cinc-project\/cinc\/embedded\/lib\/ruby\/gems\/3.1.0\/gems\/chef-18.4.2-x64-mingw-ucrt\/lib\/chef\/provider\/service\/windows.rb:77:in `load_current_resource'\r\nC:\/cinc-project\/cinc\/embedded\/lib\/ruby\/gems\/3.1.0\/gems\/chef-18.4.2-x64-mingw-ucrt\/lib\/chef\/provider.rb:228:in `run_action'\r\nC:\/cinc-project\/cinc\/embedded\/lib\/ruby\/gems\/3.1.0\/gems\/chef-18.4.2-x64-mingw-ucrt\/lib\/chef\/resource.rb:601:in `block in run_action'\r\n```","comments":[],"labels":["Status: Untriaged"],"number":14229},{"title":"Cloud helper functions return incorrect results after nodes are moved between clouds (Azure -> AWS)","body":"<!---\r\n!!!!!! NOTE: CHEF CLIENT BUGS ONLY !!!!!!\r\n\r\nThis issue tracker is for the code contained within this repo -- `chef-client`, base `knife` functionality (not\r\nplugins), `chef-apply`, `chef-solo`, `chef-client -z`, etc.\r\n\r\n* Requests for new or alternative functionality should be made to [feedback.chef.io](https:\/\/feedback.chef.io\/forums\/301644-chef-product-feedback\/category\/110832-chef-client)\r\n* [Chef Server issues](https:\/\/github.com\/chef\/chef-server\/issues\/new)\r\n* [ChefDK issues](https:\/\/github.com\/chef\/chef-dk\/issues\/new)\r\n* Cookbook Issues (see the https:\/\/github.com\/chef-cookbooks repos or search [Supermarket](https:\/\/supermarket.chef.io) or GitHub\/Google)\r\n\r\n-->\r\n\r\n## Description\r\nWe sometimes move nodes between different clouds and end up with situations where the cloud helper functions return erroneous results. For example, when a node was moved from Azure to AWS, `ohai` reports `azure` is present, but `azure.metadata` is null\r\n\r\n```json\r\n{\r\n  \"azure\": {\r\n    \"metadata\": null\r\n  },\r\n  \"ec2\": {\r\n    \"account_id\": \"...\"\r\n  }\r\n}\r\n```\r\n\r\nAlso note `cloud` key is missing for the attributes in the example. And to be clear the node can be seen still running in the EC2 console, all the AWS attributes are valid.\r\n\r\nResult of helpers for above node:\r\n\r\n```\r\nchef (17.10.3)> ec2?\r\n=> true\r\nchef (17.10.3)> azure?\r\n=> true\r\nchef (17.10.3)> cloud?\r\n=> false\r\n```\r\n\r\nWe expected `true`, `false` and `true` in this case. The node is still running in ECS. Also we don't understand how `cloud?` can ever be false if one of the cloud provider helpers is true.\r\n\r\nSometimes the `cloud` metadata is missing too, even though the node is running in EC2 or similar. We think this may have to do with moving a node from on-prem to the cloud.\r\n\r\nChecking the helper methods, it looks like they only check for the presence of the `azure` key and such. Maybe more robust checking is needed for edge cases like these.\r\n\r\n## Chef Version\r\n`17.10.3`\r\n\r\n## Platform Version\r\nWSL Ubuntu 22.04.03 LTS\r\n\r\n## Replication Case\r\n1. Transfer node from Azure to AWS, or on-prem to Azure to AWS\r\n2. Observe metadata that retains\/misses `azure` or `cloud` attributes\r\n","comments":[],"labels":["Status: Untriaged"],"number":14215}]