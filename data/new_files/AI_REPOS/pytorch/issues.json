[{"title":"[NOT READY FOR REVIEW] optimizing number of buffers sent to scheduler for foreach","body":"Fixes #ISSUE_NUMBER\r\n\n\ncc @voznesenskym @penguinwu @EikanWang @jgong5 @Guobing-Chen @XiaobingSuper @zhuhaozhe @blzheng @wenzhe-nrv @jiayisunx @peterbell10 @ipiszy @yf225 @chenyang78 @kadeng @muchulee8 @aakhundov @ColinPeppler @amjames @desertfire @chauhang","comments":["<!-- drci-comment-start -->\n\n## :link: Helpful Links\n### :test_tube: See artifacts and rendered test results at [hud.pytorch.org\/pr\/122567](https:\/\/hud.pytorch.org\/pr\/122567)\n* :page_facing_up: Preview [Python docs built from this PR](https:\/\/docs-preview.pytorch.org\/pytorch\/pytorch\/122567\/index.html)\n* :page_facing_up: Preview [C++ docs built from this PR](https:\/\/docs-preview.pytorch.org\/pytorch\/pytorch\/122567\/cppdocs\/index.html)\n* :question: Need help or want to give feedback on the CI? Visit the [bot commands wiki](https:\/\/github.com\/pytorch\/pytorch\/wiki\/Bot-commands) or our [office hours](https:\/\/github.com\/pytorch\/pytorch\/wiki\/Dev-Infra-Office-Hours)\n\nNote: Links to docs will display an error until the docs builds have been completed.\n\n\n## :x: 1 New Failure, 72 Pending\nAs of commit 93ab1e13c9bb0746519f9532a804f353fbcee3e9 with merge base f0d461beacded34abe196c72ec4bcdb55bf01793 (<sub><sub><img alt=\"image\" width=70 src=\"https:\/\/img.shields.io\/date\/1711251741?label=&color=FFFFFF&style=flat-square\"><\/sub><\/sub>):\n<details open><summary><b>NEW FAILURE<\/b> - The following job has failed:<\/summary><p>\n\n* [pull \/ linux-focal-cuda12.1-py3.10-gcc9-sm86 \/ test (default, 3, 5, linux.g5.4xlarge.nvidia.gpu)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122567#23021904994) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406961518\/job\/23021904994))\n    `inductor\/test_compiled_optimizers.py::CompiledOptimizerTests::test_sgd_momentum_dampening_foreach_cuda`\n<\/p><\/details>\n\n\nThis comment was automatically generated by Dr. CI and updates every 15 minutes.\n<!-- drci-comment-end -->"],"labels":["ciflow\/trunk","module: inductor","ciflow\/inductor"],"number":122567},{"title":"[dynamo] Suppress warning about torch.autograd.Function()","body":"Stack from [ghstack](https:\/\/github.com\/ezyang\/ghstack) (oldest at bottom):\n* __->__ #122566\n\nPR #120577 got reverted due to issues in fbcode.  This hides warning\nthat PR was trying to fix until we can debug the fbcode issue.\n\ncc @voznesenskym @penguinwu @EikanWang @jgong5 @Guobing-Chen @XiaobingSuper @zhuhaozhe @blzheng @wenzhe-nrv @jiayisunx @chenyang78 @kadeng @chauhang","comments":["<!-- drci-comment-start -->\n\n## :link: Helpful Links\n### :test_tube: See artifacts and rendered test results at [hud.pytorch.org\/pr\/122566](https:\/\/hud.pytorch.org\/pr\/122566)\n* :page_facing_up: Preview [Python docs built from this PR](https:\/\/docs-preview.pytorch.org\/pytorch\/pytorch\/122566\/index.html)\n* :page_facing_up: Preview [C++ docs built from this PR](https:\/\/docs-preview.pytorch.org\/pytorch\/pytorch\/122566\/cppdocs\/index.html)\n* :question: Need help or want to give feedback on the CI? Visit the [bot commands wiki](https:\/\/github.com\/pytorch\/pytorch\/wiki\/Bot-commands) or our [office hours](https:\/\/github.com\/pytorch\/pytorch\/wiki\/Dev-Infra-Office-Hours)\n\nNote: Links to docs will display an error until the docs builds have been completed.\n\n\n## :x: 1 New Failure, 42 Pending, 1 Unrelated Failure\nAs of commit 8e019ac4a571e3861dd9f5865af334dade3839e2 with merge base failed to retrieve merge base, please contact dev infra:\n<details open><summary><b>NEW FAILURE<\/b> - The following job has failed:<\/summary><p>\n\n* [inductor \/ linux-jammy-cpu-py3.8-gcc11-inductor \/ test (inductor_torchbench_cpu_smoketest_perf, 1, 1, linux.12xlarge)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122566#23021350122) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406853943\/job\/23021350122))\n    `Process completed with exit code 1.`\n<\/p><\/details>\n<details ><summary><b>FLAKY<\/b> - The following job failed but was likely due to flakiness present on trunk:<\/summary><p>\n\n* [pull \/ before-test \/ llm-retrieval](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122566#23021186429) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406852600\/job\/23021186429))\n    `Process completed with exit code 1.`\n<\/p><\/details>\n\n\nThis comment was automatically generated by Dr. CI and updates every 15 minutes.\n<!-- drci-comment-end -->"],"labels":["module: dynamo","ciflow\/inductor"],"number":122566},{"title":"[dynamo] Support __next__ on UserDefinedObjectVariable","body":"Stack from [ghstack](https:\/\/github.com\/ezyang\/ghstack) (oldest at bottom):\n* __->__ #122565\n* #122564\n* #122559\n\n\n\ncc @voznesenskym @penguinwu @EikanWang @jgong5 @Guobing-Chen @XiaobingSuper @zhuhaozhe @blzheng @wenzhe-nrv @jiayisunx @chenyang78 @kadeng @chauhang","comments":["<!-- drci-comment-start -->\n\n## :link: Helpful Links\n### :test_tube: See artifacts and rendered test results at [hud.pytorch.org\/pr\/122565](https:\/\/hud.pytorch.org\/pr\/122565)\n* :page_facing_up: Preview [Python docs built from this PR](https:\/\/docs-preview.pytorch.org\/pytorch\/pytorch\/122565\/index.html)\n* :page_facing_up: Preview [C++ docs built from this PR](https:\/\/docs-preview.pytorch.org\/pytorch\/pytorch\/122565\/cppdocs\/index.html)\n* :question: Need help or want to give feedback on the CI? Visit the [bot commands wiki](https:\/\/github.com\/pytorch\/pytorch\/wiki\/Bot-commands) or our [office hours](https:\/\/github.com\/pytorch\/pytorch\/wiki\/Dev-Infra-Office-Hours)\n\nNote: Links to docs will display an error until the docs builds have been completed.\n\n\n## :x: 14 New Failures, 34 Pending, 1 Unrelated Failure\nAs of commit 127e1b5d9de2b87775624878e3d4692810de960b with merge base failed to retrieve merge base, please contact dev infra:\n<details open><summary><b>NEW FAILURES<\/b> - The following jobs have failed:<\/summary><p>\n\n* [Lint \/ lintrunner-noclang \/ linux-job](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021401844) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873296\/job\/23021401844))\n    `>>> Lint for test\/dynamo\/test_repros.py:`\n* [pull \/ linux-focal-cuda12.1-py3.10-gcc9 \/ test (default, 4, 5, linux.4xlarge.nvidia.gpu)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021461492) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021461492))\n    `dynamo\/test_dynamic_shapes.py::DynamicShapesMiscTests::test_itertools_infinite_cycle_dynamic_shapes`\n* [pull \/ linux-focal-cuda12.1-py3.10-gcc9 \/ test (default, 5, 5, linux.4xlarge.nvidia.gpu)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021461546) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021461546))\n    `dynamo\/test_misc.py::MiscTests::test_itertools_infinite_cycle`\n* [pull \/ linux-focal-cuda12.1-py3.10-gcc9-sm86 \/ test (default, 3, 5, linux.g5.4xlarge.nvidia.gpu)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021637079) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021637079))\n    `dynamo\/test_misc.py::MiscTests::test_itertools_infinite_cycle`\n* [pull \/ linux-focal-cuda12.1-py3.10-gcc9-sm86 \/ test (default, 4, 5, linux.g5.4xlarge.nvidia.gpu)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021637165) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021637165))\n    `dynamo\/test_dynamic_shapes.py::DynamicShapesMiscTests::test_itertools_infinite_cycle_dynamic_shapes`\n* [pull \/ linux-focal-py3.11-clang10 \/ test (default, 2, 3, linux.2xlarge)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021371424) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021371424))\n    `dynamo\/test_dynamic_shapes.py::DynamicShapesMiscTests::test_itertools_infinite_cycle_dynamic_shapes`\n* [pull \/ linux-focal-py3.11-clang10 \/ test (dynamo, 2, 3, linux.2xlarge)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021371760) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021371760))\n    `test_fx.py::TestFX::test_immutable_list_pytree_ops`\n* [pull \/ linux-focal-py3.8-clang10 \/ test (default, 2, 3, linux.2xlarge)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021369342) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021369342))\n    `dynamo\/test_dynamic_shapes.py::DynamicShapesMiscTests::test_itertools_infinite_cycle_dynamic_shapes`\n* [pull \/ linux-focal-py3.8-clang10 \/ test (default, 3, 3, linux.2xlarge)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021369401) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021369401))\n    `dynamo\/test_misc.py::MiscTests::test_itertools_infinite_cycle`\n* [pull \/ linux-focal-py3.8-clang10 \/ test (dynamo, 2, 3, linux.2xlarge)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021369621) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021369621))\n    `test_fx.py::TestFX::test_immutable_list_pytree_ops`\n* [pull \/ linux-jammy-py3.10-clang15-asan \/ test (default, 5, 6, linux.4xlarge)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021370196) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021370196))\n    `dynamo\/test_dynamic_shapes.py::DynamicShapesMiscTests::test_itertools_infinite_cycle_dynamic_shapes`\n* [pull \/ linux-jammy-py3.10-clang15-asan \/ test (default, 6, 6, linux.4xlarge)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021370250) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021370250))\n    `dynamo\/test_misc.py::MiscTests::test_itertools_infinite_cycle`\n* [pull \/ linux-jammy-py3.8-gcc11 \/ test (default, 2, 3, linux.2xlarge)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021375287) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021375287))\n    `dynamo\/test_misc.py::MiscTests::test_itertools_infinite_cycle`\n* [pull \/ linux-jammy-py3.8-gcc11 \/ test (default, 3, 3, linux.2xlarge)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021375323) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021375323))\n    `dynamo\/test_dynamic_shapes.py::DynamicShapesMiscTests::test_itertools_infinite_cycle_dynamic_shapes`\n<\/p><\/details>\n<details ><summary><b>FLAKY<\/b> - The following job failed but was likely due to flakiness present on trunk:<\/summary><p>\n\n* [pull \/ before-test \/ llm-retrieval](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122565#23021249192) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873250\/job\/23021249192))\n    `Process completed with exit code 1.`\n<\/p><\/details>\n\n\nThis comment was automatically generated by Dr. CI and updates every 15 minutes.\n<!-- drci-comment-end -->"],"labels":["module: dynamo","ciflow\/inductor"],"number":122565},{"title":"[dynamo] Support hasattr on UserDefinedClassVariable","body":"Stack from [ghstack](https:\/\/github.com\/ezyang\/ghstack) (oldest at bottom):\n* #122565\n* __->__ #122564\n* #122559\n\n","comments":["<!-- drci-comment-start -->\n\n## :link: Helpful Links\n### :test_tube: See artifacts and rendered test results at [hud.pytorch.org\/pr\/122564](https:\/\/hud.pytorch.org\/pr\/122564)\n* :page_facing_up: Preview [Python docs built from this PR](https:\/\/docs-preview.pytorch.org\/pytorch\/pytorch\/122564\/index.html)\n* :page_facing_up: Preview [C++ docs built from this PR](https:\/\/docs-preview.pytorch.org\/pytorch\/pytorch\/122564\/cppdocs\/index.html)\n* :question: Need help or want to give feedback on the CI? Visit the [bot commands wiki](https:\/\/github.com\/pytorch\/pytorch\/wiki\/Bot-commands) or our [office hours](https:\/\/github.com\/pytorch\/pytorch\/wiki\/Dev-Infra-Office-Hours)\n\nNote: Links to docs will display an error until the docs builds have been completed.\n\n\n## :x: 2 New Failures, 42 Pending, 1 Unrelated Failure\nAs of commit 9930d91e66ebb47cd15bf3f6cbecd63eaf89882a with merge base failed to retrieve merge base, please contact dev infra:\n<details open><summary><b>NEW FAILURES<\/b> - The following jobs have failed:<\/summary><p>\n\n* [pull \/ linux-focal-py3.11-clang10 \/ test (dynamo, 2, 3, linux.2xlarge)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122564#23021363120) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873393\/job\/23021363120))\n    `test_fx.py::TestFX::test_immutable_list_pytree_ops`\n* [pull \/ linux-focal-py3.8-clang10 \/ test (dynamo, 2, 3, linux.2xlarge)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122564#23021367332) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873393\/job\/23021367332))\n    `test_fx.py::TestFX::test_immutable_list_pytree_ops`\n<\/p><\/details>\n<details ><summary><b>FLAKY<\/b> - The following job failed but was likely due to flakiness present on trunk:<\/summary><p>\n\n* [pull \/ before-test \/ llm-retrieval](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122564#23021243171) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406873393\/job\/23021243171))\n    `Process completed with exit code 1.`\n<\/p><\/details>\n\n\nThis comment was automatically generated by Dr. CI and updates every 15 minutes.\n<!-- drci-comment-end -->"],"labels":["module: dynamo","ciflow\/inductor"],"number":122564},{"title":"[AOTInductor] Support use_runtime_constant_folding for CPU.","body":"Summary:\nWe allow CPU to use the config use_runtime_constant_folding.\nChanges include\n1. Rearrange USE_CUDA flags. Add CPU sections that consumes memory directly.\n2. Codegen changes to accomodate cpp fusions for CPU only. Specifically, we shouldn't generate 2 headers that would cause re-declaration.\n\nTest Plan: Activate tests that were deactivated for CPU before.\n\nReviewed By: khabinov\n\nDifferential Revision: D55234300\n\n\n\n\ncc @voznesenskym @penguinwu @EikanWang @jgong5 @Guobing-Chen @XiaobingSuper @zhuhaozhe @blzheng @wenzhe-nrv @jiayisunx @peterbell10 @ipiszy @yf225 @chenyang78 @kadeng @aakhundov @ColinPeppler @amjames @desertfire @chauhang","comments":["<!-- drci-comment-start -->\n\n## :link: Helpful Links\n### :test_tube: See artifacts and rendered test results at [hud.pytorch.org\/pr\/122563](https:\/\/hud.pytorch.org\/pr\/122563)\n* :page_facing_up: Preview [Python docs built from this PR](https:\/\/docs-preview.pytorch.org\/pytorch\/pytorch\/122563\/index.html)\n* :page_facing_up: Preview [C++ docs built from this PR](https:\/\/docs-preview.pytorch.org\/pytorch\/pytorch\/122563\/cppdocs\/index.html)\n* :question: Need help or want to give feedback on the CI? Visit the [bot commands wiki](https:\/\/github.com\/pytorch\/pytorch\/wiki\/Bot-commands) or our [office hours](https:\/\/github.com\/pytorch\/pytorch\/wiki\/Dev-Infra-Office-Hours)\n\nNote: Links to docs will display an error until the docs builds have been completed.\n\n\n## :x: 1 New Failure\nAs of commit b2d1bccf3e40b1fa584c1fa3f9d7fda238875f9e with merge base a52b4e22571507abc35c2d47de138497190d2e0a (<sub><sub><img alt=\"image\" width=70 src=\"https:\/\/img.shields.io\/date\/1711246328?label=&color=FFFFFF&style=flat-square\"><\/sub><\/sub>):\n<details open><summary><b>NEW FAILURE<\/b> - The following job has failed:<\/summary><p>\n\n* [pull \/ linux-focal-cuda12.1-py3.10-gcc9-sm86 \/ test (default, 5, 5, linux.g5.4xlarge.nvidia.gpu)](https:\/\/hud.pytorch.org\/pr\/pytorch\/pytorch\/122563#23020631241) ([gh](https:\/\/github.com\/pytorch\/pytorch\/actions\/runs\/8406393250\/job\/23020631241))\n    `\/tmp\/torchinductor_jenkins\/cxyq6hhar6z62njwcupgzkyncs4tx3coo7zgkh4pjb24jyyjzsqe\/cb4jgpryov54zeokp5umfyql6syaryjzktehucp5q2co2lenohge.cpp:573:33: error: \u2018aoti_torch_cpu_index_Tensor\u2019 was not declared in this scope; did you mean \u2018aoti_torch_cpu_index_Tensor_out\u2019?`\n<\/p><\/details>\n\n\nThis comment was automatically generated by Dr. CI and updates every 15 minutes.\n<!-- drci-comment-end -->","This pull request was **exported** from Phabricator. Differential Revision: [D55234300](https:\/\/www.internalfb.com\/diff\/D55234300)"],"labels":["fb-exported","module: inductor","ciflow\/inductor"],"number":122563}]